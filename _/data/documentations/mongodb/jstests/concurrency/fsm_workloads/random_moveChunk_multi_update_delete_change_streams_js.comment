['text':'*
 * Performs a series of {multi: true} updates/deletes while moving chunks, and checks that the
 * expected change stream events are received and that no events are generated to writes on orphan
 * documents.
 *
 * @tags: [
 *  requires_sharding,
 *  assumes_balancer_off,
 *  uses_change_streams
 * ];
 ','line_number':1,'multiline':True]['text':' Number of documents per partition. Note that there is one chunk per partition and one','line_number':20,'multiline':False]['text':' partition per thread.','line_number':21,'multiline':False]['text':' Keep track of the number of write operations. Used only as a sort element for the operations','line_number':24,'multiline':False]['text':' side-table.','line_number':25,'multiline':False]['text':' network_error_and_txn_override refuses to run {multi: true} writes. Skip retries and','line_number':67,'multiline':False]['text':' just ignore errors.','line_number':68,'multiline':False]['text':' If the document existed, we expect a change stream event to be eventually seen regarding','line_number':78,'multiline':False]['text':' this update.','line_number':79,'multiline':False]['text':' Log this operation on a side collection. It will be used later to validate the change','line_number':82,'multiline':False]['text':' stream events.','line_number':83,'multiline':False]['text':' Update the in-memory representation of the updated document.','line_number':95,'multiline':False]['text':' multi:true ','line_number':105,'multiline':True]['text':' network_error_and_txn_override refuses to run {multi: true} writes. Skip retries and','line_number':113,'multiline':False]['text':' just ignore errors.','line_number':114,'multiline':False]['text':' If the document existed, we expect a change stream event to be eventually seen regarding','line_number':124,'multiline':False]['text':' this delete.','line_number':125,'multiline':False]['text':' Log this operation on a side collection. It will be used later to validate the change','line_number':127,'multiline':False]['text':' stream events.','line_number':128,'multiline':False]['text':' Remove the in-memory representation of the deleted document.','line_number':137,'multiline':False]['text':' Keep only this tid's documents','line_number':142,'multiline':False]['text':' Lists that store the update/delete change stream events seen by this tid. Used to check','line_number':156,'multiline':False]['text':' that no duplicate events (e.g due to writes on orphans) are received. Only used in','line_number':157,'multiline':False]['text':' non-transaction suites. For transaction suites we do a strict check on the expected','line_number':158,'multiline':False]['text':' events.','line_number':159,'multiline':False]['text':' Read the operations that the workload threads did.','line_number':163,'multiline':False]['text':' tid -> [operations]','line_number':164,'multiline':False]['text':' Check change stream','line_number':169,'multiline':False]['text':' Check that this event corresponds to the next outstanding operation one of the','line_number':184,'multiline':False]['text':' worker threads did.','line_number':185,'multiline':False]['text':' Remove that operation from the array of outstanding operations.','line_number':195,'multiline':False]['text':' Check that no duplicate events are seen on the change stream.','line_number':204,'multiline':False]['text':' - For deletes this means that we should not see the same document deleted more','line_number':205,'multiline':False]['text':' than once (since the workload does not perform any inserts after setup).','line_number':206,'multiline':False]['text':' - For updates, this means that for each document, we should never see the same','line_number':207,'multiline':False]['text':' updated value more than once. This is because the updates are {$inc: 1}, so they','line_number':208,'multiline':False]['text':' must be strictly incrementing.','line_number':209,'multiline':False]['text':' If running in a txn suite, ensure we eventually see all events. We can only do this in','line_number':232,'multiline':False]['text':' txn suites because on non-txn suites we have no guarantee that a multi-update/delete','line_number':233,'multiline':False]['text':' actually was actually applied on all the intended documents (SERVER-20361).','line_number':234,'multiline':False]['text':' Set the 'x' field to mirror the '_id' and 'skey' fields. 'x' will be used as query for','line_number':248,'multiline':False]['text':' {multi: true} writes.','line_number':249,'multiline':False]['text':' Store the operationTime after which we finished all updates to the collection during','line_number':254,'multiline':False]['text':' setup. It will be used as a starting point for the changeStream.','line_number':255,'multiline':False]['text':' Increment it so that the change stream won't see the last of the updates done as part of','line_number':258,'multiline':False]['text':' setup()','line_number':259,'multiline':False]['text':' Store an in-memory representation of the documents in the collection.','line_number':262,'multiline':False]['text':' Make sure the 'operations' collection is created before we start running the FSM states.','line_number':265,'multiline':False]['text':' This prevents failures in suites where states run in transactions, as creating a','line_number':266,'multiline':False]['text':' collection within a multi-shard transaction is not allowed.','line_number':267,'multiline':False]['text':' Drop the collection as to have a sentinel event (drop) on the change stream.','line_number':272,'multiline':False]['text':' Validate the change stream events after setting 'writePeriodicNoops'  on all the nodes of','line_number':275,'multiline':False]['text':' the cluster to ensure liveness in case there are nodes with no events to report.','line_number':276,'multiline':False]['text':' Restore the original configuration.','line_number':295,'multiline':False]