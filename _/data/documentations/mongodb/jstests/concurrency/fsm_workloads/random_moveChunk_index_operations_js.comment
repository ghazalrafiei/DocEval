['text':'*
 * Performs a series of index operations while chunk migrations are running in the background
 * and verifies that indexes are not left in an inconsistent state.
 *
 * @tags: [
 *  requires_sharding,
 *  assumes_balancer_off,
 * ]
 ','line_number':1,'multiline':True]['text':' Specify TTL as a default option during index creation to enable collMod to modify any','line_number':21,'multiline':False]['text':' index.','line_number':22,'multiline':False]['text':' List of key patterns that are available for index creation.','line_number':25,'multiline':False]['text':' List of index key patterns that we expect to exist for the current thread's collection.','line_number':28,'multiline':False]['text':' Create a sharded collection for each thread and split it into two chunks.','line_number':32,'multiline':False]['text':' Default collection size.','line_number':35,'multiline':False]['text':' Insert documents','line_number':41,'multiline':False]['text':' Execute the inserts and split the data into two chunks.','line_number':46,'multiline':False]['text':' Pick a tid at random until we pick one that doesn't target this thread's collection.','line_number':60,'multiline':False]['text':' Pick a chunk from that thread's collection','line_number':65,'multiline':False]['text':' Pick a shard at random to move it to.','line_number':76,'multiline':False]['text':' Issue a moveChunk command.','line_number':81,'multiline':False]['text':' Ignore Interrupted errors, which come when a moveChunk is interrupted by a','line_number':86,'multiline':False]['text':' concurrent index operation.','line_number':87,'multiline':False]['text':' Indexes may be transiently inconsistent across shards, which can lead a','line_number':94,'multiline':False]['text':' concurrent migration to abort if the recipient's collection is non-empty.','line_number':95,'multiline':False]['text':' Pick an available keyPattern at random and create an index for it.','line_number':105,'multiline':False]['text':' Remove created index from available list and record it in expected index map.','line_number':120,'multiline':False]['text':' Pick an existing index at random and drop it.','line_number':125,'multiline':False]['text':' Since dropping an index across shards is not atomic, it can be the case that','line_number':137,'multiline':False]['text':' the cluster ends up in an inconsistent state temporarily. In particular, a','line_number':138,'multiline':False]['text':' successful dropIndexes may retry on a stale config error only for the retry','line_number':139,'multiline':False]['text':' to see that the index was dropped by the first attempt. Therefore, we ignore this','line_number':140,'multiline':False]['text':' error.','line_number':141,'multiline':False]['text':' Remove dropped index from list of existing indexes and add key pattern back to','line_number':149,'multiline':False]['text':' available list.','line_number':150,'multiline':False]['text':' Verify that the indexes that we expect to be on disk are actually there and that indexes','line_number':170,'multiline':False]['text':' are consistent across all shards for this thread's collection.','line_number':171,'multiline':False]['text':'','line_number':172,'multiline':False]['text':' Because it is possible that indexes can be temporarily inconsistent, we retry this','line_number':173,'multiline':False]['text':' verification up to 3 times, after which point it's very unlikely that inconsistent','line_number':174,'multiline':False]['text':' indexes have persisted across shards.','line_number':175,'multiline':False]['text':'','line_number':176,'multiline':False]['text':' Note that we retry after waiting for 2 seconds to allow for any temporarily','line_number':177,'multiline':False]['text':' inconsistent indexes the chance to clear up.','line_number':178,'multiline':False]['text':' Check that the indexes that we expect to exist actually do.','line_number':188,'multiline':False]['text':' Check that each shard has each reported index.','line_number':206,'multiline':False]['text':' First step should always be to create an index so that we can have at least one index to','line_number':229,'multiline':False]['text':' drop or modify when transitioning to either dropIndexes or collMod.','line_number':230,'multiline':False]