['text':'*
 * Tests that an aggregation cursor is killed when it is timed out by the ClientCursorMonitor.
 *
 * This test was designed to reproduce SERVER-25585.
 ','line_number':1,'multiline':True]['text':' Cursor timeout on mongod is handled by a single thread/timer that will sleep for','line_number':6,'multiline':False]['text':' "clientCursorMonitorFrequencySecs" and add the sleep value to each operation's duration when','line_number':7,'multiline':False]['text':' it wakes up, timing out those whose "now() - last accessed since" time exceeds. A cursor','line_number':8,'multiline':False]['text':' timeout of 2 seconds with a monitor frequency of 1 second means an effective timeout period','line_number':9,'multiline':False]['text':' of 1 to 2 seconds.','line_number':10,'multiline':False]['text':' We use the "cursorTimeoutMillis" server parameter to decrease how long it takes for a','line_number':17,'multiline':False]['text':' non-exhausted cursor to time out. We use the "clientCursorMonitorFrequencySecs"','line_number':18,'multiline':False]['text':' server parameter to make the ClientCursorMonitor that cleans up the timed out cursors','line_number':19,'multiline':False]['text':' run more often. The combination of these server parameters reduces the amount of time','line_number':20,'multiline':False]['text':' we need to wait within this test.','line_number':21,'multiline':False]['text':' We use a batch size of 2 to ensure that the mongo shell does not exhaust the cursor on its','line_number':31,'multiline':False]['text':' first batch.','line_number':32,'multiline':False]['text':' Wait until the idle cursor background job has killed the aggregation cursor.','line_number':50,'multiline':False]['text':' We attempt to exhaust the aggregation cursor to verify that sending a getMore returns an','line_number':62,'multiline':False]['text':' error due to the cursor being killed.','line_number':63,'multiline':False]['text':' Confirm that cursor timeout occurs outside of sessions.','line_number':71,'multiline':False]['text':' Confirm that cursor timeout occurs within sessions when the','line_number':76,'multiline':False]['text':' `enableTimeoutOfInactiveSessionCursors` parameter is set to true. If false, we rely on','line_number':77,'multiline':False]['text':' session expiration to cleanup outstanding cursors.','line_number':78,'multiline':False]['text':' Test that a regular aggregation cursor is killed when the timeout is reached.','line_number':91,'multiline':False]['text':' Test that an aggregation cursor with a $lookup stage is killed when the timeout is reached.','line_number':94,'multiline':False]['text':' Test that an aggregation cursor with nested $lookup stages is killed when the timeout is','line_number':109,'multiline':False]['text':' reached.','line_number':110,'multiline':False]