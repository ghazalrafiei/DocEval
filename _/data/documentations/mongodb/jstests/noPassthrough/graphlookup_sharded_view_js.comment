['text':' Test that sharded $graphLookup can resolve sharded views correctly.','line_number':1,'multiline':False]['text':' @tags: [requires_sharding, requires_fcv_51]','line_number':2,'multiline':False]['text':' Drop the 'profile' tables and then enable profiling on all shards.','line_number':17,'multiline':False]['text':' Create 'docs' collection which will be backed by shard 1 from which we will run aggregations.','line_number':24,'multiline':False]['text':' Create first 'subjects' collection which will be backed by shard 2.','line_number':38,'multiline':False]['text':' To resolve view 'view1' defined on view 'view2' defined on collection 'coll', we would get a','line_number':58,'multiline':False]['text':' dependency chain of the form [view1, view2, coll] in the 'resolvedViews' field of the','line_number':59,'multiline':False]['text':' system.profile entry. This function combines all namespaces listed in the dependency chains of an','line_number':60,'multiline':False]['text':' aggregation's resolved views to produce a map counting how many times each namesapce was seen,','line_number':61,'multiline':False]['text':' e.g.: {"test.view1": 1, "test.view2": 1, "test.coll": 1}','line_number':62,'multiline':False]['text':' Count how many CommandOnShardedViewNotSupported exceptions we get and verify that they','line_number':87,'multiline':False]['text':' match the number we were expecting.','line_number':88,'multiline':False]['text':' In order to trigger CommandOnShardedViewNotSupportedOnMongod exceptions where a shard cannot','line_number':114,'multiline':False]['text':' resolve a view definition, ensure that:','line_number':115,'multiline':False]['text':' - 'docs' is backed by shard 1.','line_number':116,'multiline':False]['text':' - 'subjects' is backed by shard 2.','line_number':117,'multiline':False]['text':' Create a view with an empty pipeline on 'subjects'.','line_number':121,'multiline':False]['text':' Test a $graphLookup that triggers a CommandOnShardedViewNotSupportedOnMongod exception for a view','line_number':125,'multiline':False]['text':' with an empty pipeline.','line_number':126,'multiline':False]['text':' Expect only one exception when trying to resolve the view 'emptyViewOnSubjects'.','line_number':149,'multiline':False]['text':' Test a $graphLookup with a restrictSearchWithMatch that triggers a','line_number':153,'multiline':False]['text':' CommandOnShardedViewNotSupportedOnMongod exception for a view with an empty pipeline.','line_number':154,'multiline':False]['text':' Expect only one exception when trying to resolve the view 'emptyViewOnSubjects'.','line_number':178,'multiline':False]['text':' Create a view with an empty pipeline on the existing empty view on 'subjects'.','line_number':182,'multiline':False]['text':' Test a $graphLookup that triggers a CommandOnShardedViewNotSupportedOnMongod exception for a view','line_number':187,'multiline':False]['text':' on another view.','line_number':188,'multiline':False]['text':' Expect only one exception when trying to resolve the view 'emptyViewOnSubjects'.','line_number':211,'multiline':False]['text':' Create a view with a pipeline on 'docs' that runs another $graphLookup.','line_number':215,'multiline':False]['text':' Test a $graphLookup that triggers a CommandOnShardedViewNotSupportedOnMongod exception for a view','line_number':248,'multiline':False]['text':' with a pipeline that contains a $graphLookup.','line_number':249,'multiline':False]['text':' Expect one exception when trying to resolve the view 'physicists' on collection 'docs' and','line_number':270,'multiline':False]['text':' one on 'subjects' when trying to resolve 'emptyViewOnSubjects'.','line_number':271,'multiline':False]['text':' Create a view with a pipeline on 'physicists' to test resolution of a view on another view.','line_number':275,'multiline':False]['text':' Test a $graphLookup that triggers a CommandOnShardedViewNotSupportedOnMongod exception for a view','line_number':280,'multiline':False]['text':' on another view.','line_number':281,'multiline':False]['text':' Expect one exception when trying to resolve the view 'physicists' on collection 'docs' and','line_number':299,'multiline':False]['text':' one on 'subjects' when trying to resolve 'emptyViewOnSubjects'.','line_number':300,'multiline':False]['text':' Test a $graphLookup with restrictSearchWithMatch that triggers a','line_number':304,'multiline':False]['text':' CommandOnShardedViewNotSupportedOnMongod exception for a view with a pipeline that contains a','line_number':305,'multiline':False]['text':' $graphLookup.','line_number':306,'multiline':False]['text':' Expect one exception when trying to resolve the view 'physicists' on collection 'docs' and','line_number':325,'multiline':False]['text':' another one on 'subjects' when trying to resolve 'emptyViewOnSubjects'.','line_number':326,'multiline':False]