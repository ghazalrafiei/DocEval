['text':' Tests that a change stream requires the correct privileges to be run.','line_number':1,'multiline':False]['text':' This test uses the WiredTiger storage engine, which does not support running without journaling.','line_number':2,'multiline':False]['text':' @tags: [','line_number':3,'multiline':False]['text':'   requires_majority_read_concern,','line_number':4,'multiline':False]['text':'   requires_persistence,','line_number':5,'multiline':False]['text':'   requires_replication,','line_number':6,'multiline':False]['text':' ]','line_number':7,'multiline':False]['text':' Wrap different sections of the test in separate functions to make the scoping clear.','line_number':20,'multiline':False]['text':' Create some collection-level roles.','line_number':23,'multiline':False]['text':' Create some privileges at the database level.','line_number':52,'multiline':False]['text':' Create some privileges at the admin database level.','line_number':78,'multiline':False]['text':' Create some roles at the any-db, any-collection level.','line_number':103,'multiline':False]['text':' Create some roles at the cluster level.','line_number':120,'multiline':False]['text':' Create some users for a specific collection. Use the name of the role as the name of the','line_number':142,'multiline':False]['text':' user.','line_number':143,'multiline':False]['text':' Create some users at the database level. Use the name of the role as the name of the','line_number':148,'multiline':False]['text':' user, except for the built-in roles.','line_number':149,'multiline':False]['text':' Create some users on the admin database. Use the name of the role as the name of the','line_number':156,'multiline':False]['text':' user, except for the built-in roles.','line_number':157,'multiline':False]['text':' Create some users with privileges on all databases. Use the name of the role as the name','line_number':166,'multiline':False]['text':' of the user, except for the built-in roles.','line_number':167,'multiline':False]['text':' Create some users on the whole cluster. Use the name of the role as the name of the user.','line_number':174,'multiline':False]['text':' Test that users without the required privileges cannot open a change stream. A user','line_number':185,'multiline':False]['text':' needs both the 'find' and 'changeStream' action on the collection. Note in particular','line_number':186,'multiline':False]['text':' that the whole-cluster privileges (specified with {cluster: true}) is not enough to open','line_number':187,'multiline':False]['text':' a change stream on any particular collection.','line_number':188,'multiline':False]['text':' Test that a user with the required privileges can open a change stream.','line_number':217,'multiline':False]['text':' Test that users without the required privileges cannot open a change stream. A user needs','line_number':234,'multiline':False]['text':' both the 'find' and 'changeStream' action on the database. Note in particular that the','line_number':235,'multiline':False]['text':' whole-cluster privileges (specified with {cluster: true}) is not enough to open a change','line_number':236,'multiline':False]['text':' stream on the whole database.','line_number':237,'multiline':False]['text':' Test that a user with the required privileges can open a change stream.','line_number':266,'multiline':False]['text':' Test that users without the required privileges cannot open a change stream. A user needs','line_number':282,'multiline':False]['text':' both the 'find' and 'changeStream' action on _any_ resource. Note in particular that the','line_number':283,'multiline':False]['text':' whole-cluster privileges (specified with {cluster: true}) is not enough to open a change','line_number':284,'multiline':False]['text':' stream on the whole cluster.','line_number':285,'multiline':False]['text':' Test that a user with the required privileges can open a change stream.','line_number':319,'multiline':False]