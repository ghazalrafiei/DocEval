['text':'*
 * Tests resource consumption metrics for index builds.
 * @tags: [
 *   requires_replication,
 * ]
 ','line_number':1,'multiline':True]['text':' Resource consumption metrics may be overstated due to write conflicts.','line_number':15,'multiline':False]['text':' Existing test assertions assume the absence of write conflicts.','line_number':16,'multiline':False]['text':' Increasing the log verbosity for retrying write operations due to write','line_number':17,'multiline':False]['text':' conflicts helps provide context when investigating future test assertion','line_number':18,'multiline':False]['text':' failures around resource consumption metrics.','line_number':19,'multiline':False]['text':' This log configuration is copied from temporarily_unavailable_error.js.','line_number':20,'multiline':False]['text':' Get aggregated metrics keyed by database name.','line_number':41,'multiline':False]['text':'*
 * Load documents into the collection. Expect that metrics are reasonable and only reported on the
 * primary node.
 ','line_number':66,'multiline':True]['text':' Each document is 29 bytes and we do not count oplog writes.','line_number':80,'multiline':False]['text':' The inserted keys will vary in size from 2 to 4 bytes depending on their value. Assert','line_number':84,'multiline':False]['text':' that the number of bytes fall within that range.','line_number':85,'multiline':False]['text':' The secondary should not collect metrics for replicated index builds.','line_number':91,'multiline':False]['text':'*
 * Build an index. Expect that metrics are reasonable and only reported on the primary node.
 ','line_number':99,'multiline':True]['text':' Each document is 29 bytes. Assert that we read at least as many document bytes as there','line_number':107,'multiline':False]['text':' are in the collection. Some additional data is read from the catalog, but it has','line_number':108,'multiline':False]['text':' randomized fields, so we don't make any exact assertions.','line_number':109,'multiline':False]['text':' We intentionally do not collect sorting metrics for index builds due to their already','line_number':113,'multiline':False]['text':' high impact on the server.','line_number':114,'multiline':False]['text':' Some bytes are written to the catalog and config.system.indexBuilds collection.','line_number':118,'multiline':False]['text':' The inserted keys will vary in size from 4 to 7 bytes depending on their value. Assert','line_number':122,'multiline':False]['text':' that the number of bytes fall within that range.','line_number':123,'multiline':False]['text':' Some index entries are written to the config.system.indexBuilds collection, but we should','line_number':127,'multiline':False]['text':' read at least as many units as there are documents in the collection.','line_number':128,'multiline':False]['text':' The secondary should not collect metrics for replicated index builds.','line_number':132,'multiline':False]['text':'*
 * Build an index. Expect that metrics are reasonable and only reported on the primary node.
 ','line_number':141,'multiline':True]['text':' Each document is 29 bytes. Assert that we read at least as many document bytes as there','line_number':149,'multiline':False]['text':' are in the collection. Some additional data is read from the catalog, but it has','line_number':150,'multiline':False]['text':' randomized fields, so we don't make any exact assertions.','line_number':151,'multiline':False]['text':' We intentionally do not collect sorting metrics for index builds due to their already','line_number':155,'multiline':False]['text':' high impact on the server.','line_number':156,'multiline':False]['text':' Some bytes are written to the catalog and config.system.indexBuilds collection.','line_number':160,'multiline':False]['text':' The inserted keys will vary in size from 4 to 7 bytes depending on their value. Assert','line_number':164,'multiline':False]['text':' that the number of bytes fall within that range.','line_number':165,'multiline':False]['text':' Some index entries are written to the config.system.indexBuilds collection, but we should','line_number':169,'multiline':False]['text':' read at least as many units as there are documents in the collection.','line_number':170,'multiline':False]['text':' The secondary should not collect metrics for replicated index builds.','line_number':174,'multiline':False]['text':'*
 * Build a unique index that fails. Expect that metrics are reasonable and only reported on the
 * primary node.
 ','line_number':183,'multiline':True]['text':' Insert a document at the end that makes the index non-unique.','line_number':188,'multiline':False]['text':' Each document is 29 bytes. Assert that we read at least as many document bytes as there','line_number':196,'multiline':False]['text':' are in the collection. Some additional data is read from the catalog, but it has','line_number':197,'multiline':False]['text':' randomized fields, so we don't make any exact assertions.','line_number':198,'multiline':False]['text':' We intentionally do not collect sorting metrics for index builds due to their already','line_number':202,'multiline':False]['text':' high impact on the server.','line_number':203,'multiline':False]['text':' Some bytes are written to the catalog and config.system.indexBuilds collection.','line_number':207,'multiline':False]['text':' The inserted keys will vary in size from 4 to 7 bytes depending on their value. Assert','line_number':211,'multiline':False]['text':' that the number of bytes fall within that range.','line_number':212,'multiline':False]['text':' Some index entries are written to the config.system.indexBuilds collection, but we should','line_number':216,'multiline':False]['text':' read at least as many units as there are documents in the collection.','line_number':217,'multiline':False]['text':' The secondary should not collect metrics for replicated index builds.','line_number':221,'multiline':False]['text':'*
 * Abort an active index build. Expect that the primary node that aborts the index build collects
 * and reports read metrics.
 ','line_number':228,'multiline':True]['text':' Hang the index build after kicking off the build on the primary, but before scanning the','line_number':235,'multiline':False]['text':' collection.','line_number':236,'multiline':False]['text':' Waits until the collection scan is finished.','line_number':241,'multiline':False]['text':' Abort the index build and wait for it to exit.','line_number':244,'multiline':False]['text':' Wait for the abort to replicate.','line_number':256,'multiline':False]['text':' Each document is 29 bytes. Assert that we read at least as many document bytes as there','line_number':261,'multiline':False]['text':' are in the collection since the index build is interrupted after this step. Some','line_number':262,'multiline':False]['text':' additional data is read from the catalog, but it has randomized fields, so we don't make','line_number':263,'multiline':False]['text':' any exact assertions.','line_number':264,'multiline':False]['text':' We intentionally do not collect sorting metrics for index builds due to their already','line_number':270,'multiline':False]['text':' high impact on the server.','line_number':271,'multiline':False]['text':' Some bytes are written to the catalog and config.system.indexBuilds collection.','line_number':277,'multiline':False]['text':' The index build will have been interrupted before inserting any keys into the index,','line_number':281,'multiline':False]['text':' however it will have written documents into the config.system.indexBuilds collection when','line_number':282,'multiline':False]['text':' created and interrupted by the drop.','line_number':283,'multiline':False]['text':' No metrics should be collected on the secondary.','line_number':292,'multiline':False]['text':' Ensure the index was not built. Do this after checking metrics because the helper calls','line_number':297,'multiline':False]['text':' listIndexes which contributes to metrics.','line_number':298,'multiline':False]['text':'*
 * Start an index build on one node and commit it on a different node. Expect that the primary node
 * that commits the index build collects and reports read metrics attributed to the primary state.
 * The the stepped-down node should not collect anything.
 ','line_number':303,'multiline':True]['text':' Hang the index build after kicking off the build on the secondary, but before scanning the','line_number':312,'multiline':False]['text':' collection.','line_number':313,'multiline':False]['text':' Step down the primary node. The command will return an error but the index build will','line_number':322,'multiline':False]['text':' continue running.','line_number':323,'multiline':False]['text':' Allow the secondary to take over. Note that it needs a quorum (by default a majority) and','line_number':327,'multiline':False]['text':' will wait for the old primary to complete.','line_number':328,'multiline':False]['text':' Allow the index build to resume and wait for it to commit.','line_number':331,'multiline':False]['text':' Get the metrics from what is now the new primary.','line_number':336,'multiline':False]['text':' Each document is 29 bytes. Assert that we read at least as many document bytes as there','line_number':338,'multiline':False]['text':' are in the collection. Some additional data is read from the catalog, but it has','line_number':339,'multiline':False]['text':' randomized fields, so we don't make any exact assertions.','line_number':340,'multiline':False]['text':' We intentionally do not collect sorting metrics for index builds due to their already','line_number':346,'multiline':False]['text':' high impact on the server.','line_number':347,'multiline':False]['text':' Some bytes are written to the catalog and config.system.indexBuilds collection.','line_number':353,'multiline':False]['text':' The inserted keys will vary in size from 4 to 7 bytes depending on their value. Assert','line_number':357,'multiline':False]['text':' that the number of bytes fall within that range.','line_number':358,'multiline':False]['text':' Some index entries are written to the config.system.indexBuilds collection, but we should','line_number':362,'multiline':False]['text':' read at least as many units as there are documents in the collection.','line_number':363,'multiline':False]['text':' No significant metrics should be collected on the old primary.','line_number':367,'multiline':False]['text':' The old primary may have read document bytes on the catalog and config.system.indexBuilds','line_number':369,'multiline':False]['text':' when setting up, but ensure that it does not read an entire collection's worth of data.','line_number':370,'multiline':False]['text':' The reads are attributed to the secondary state because the node is no longer primary','line_number':371,'multiline':False]['text':' when it aggregates its metrics after getting interrupted by the stepdown.','line_number':372,'multiline':False]['text':' We intentionally do not collect sorting metrics for index builds due to their already','line_number':377,'multiline':False]['text':' high impact on the server.','line_number':378,'multiline':False]['text':' Ensure the index was actually built. Do this after checking metrics because the helper calls','line_number':391,'multiline':False]['text':' listIndexes which contributes to metrics.','line_number':392,'multiline':False]