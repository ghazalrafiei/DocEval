['text':'*
 * Tests that FTDC collects information about the pre-image collection, including its purging job.
 * @tags: [ requires_replication ]
 ','line_number':1,'multiline':True]['text':' Validates the 'changeStreamPreImages' section of 'serverStatus', 'actualServerStats', has values','line_number':27,'multiline':False]['text':' which align with 'expectedServerStats'. The 'expectedServerStats' should match the structure of','line_number':28,'multiline':False]['text':' the section, but is allowed to omit fields since not all are deterministic. Only the specified','line_number':29,'multiline':False]['text':' fields will be compared with the current serverStatus.','line_number':30,'multiline':False]['text':'','line_number':31,'multiline':False]['text':'  Example 'expectedServerStats':','line_number':32,'multiline':False]['text':'      {','line_number':33,'multiline':False]['text':'          numDocs: <>,','line_number':34,'multiline':False]['text':'          totalBytes: <>,','line_number':35,'multiline':False]['text':'          ...,','line_number':36,'multiline':False]['text':'          purgingJob: {','line_number':37,'multiline':False]['text':'              'docsDeleted': <>,','line_number':38,'multiline':False]['text':'              ....','line_number':39,'multiline':False]['text':'          }','line_number':40,'multiline':False]['text':'      };','line_number':41,'multiline':False]['text':' Validate top level fields first.','line_number':43,'multiline':False]['text':' 'purgingJob' stats are validated after.','line_number':46,'multiline':False]['text':' Returns the wall time ('operationTime') in milliseconds of the latest pre-image inserted into','line_number':61,'multiline':False]['text':' conn's pre-images collection. Returns 0 if there are no pre-images in the collection.','line_number':62,'multiline':False]['text':' Returns the wall time ('operationTime') in milliseconds of the first (oldest) pre-image in conn's','line_number':73,'multiline':False]['text':' pre-images collection. Returns 0 if there are no pre-images in the collection.','line_number':74,'multiline':False]['text':' The test expects pre-images to expire by 'expireAfterSeconds'. Set the oplog to a large size','line_number':94,'multiline':False]['text':' to ensure pre-images don't expire by the oldest oplog entry timestamp.','line_number':95,'multiline':False]['text':'* MB ','line_number':96,'multiline':True]['text':' If the feature flag is disabled, the 'purgingJob' doesn't perform any real work on secondaries','line_number':105,'multiline':False]['text':' because deletes are replicated from the primary.','line_number':106,'multiline':False]['text':' Inserts into the pre-images collection are replicated.','line_number':127,'multiline':False]['text':' Node agnostic once all writes are replicated given the wall time of a pre-image is defined when','line_number':130,'multiline':False]['text':' it is inserted on the primary.','line_number':131,'multiline':False]['text':' With truncates, 'maxStartWallTimeMillis' represents the wall time ('operationTime') of the','line_number':140,'multiline':False]['text':' entry with the highest wall time which has been truncated.','line_number':141,'multiline':False]['text':' TODO SERVER-70591: Remove extra logic to cover collection scan deletes and simplify all the','line_number':144,'multiline':False]['text':' logic in this test to only account for truncates.','line_number':145,'multiline':False]['text':' With collection scan based deletes, 'maxStartWallTimeMillis' represents the maximum','line_number':147,'multiline':False]['text':' wall time ('operationTime') of the oldest pre-image (pre-image with the smallest 'ts')','line_number':148,'multiline':False]['text':' across nsUUIDs in the pre-images collection seen by the purgingJob. In the case of','line_number':149,'multiline':False]['text':' secondaries, the purgingJob never inspects the pre-images collection, so the value is','line_number':150,'multiline':False]['text':' only ever non-zero on the primary in this test.','line_number':151,'multiline':False]['text':' Wait at least kExpireAfterSeconds to ensure everything is expired prior to setting','line_number':180,'multiline':False]['text':' expireAfterSeconds, to ensure the purging job sees all documents as expired in a single pass.','line_number':181,'multiline':False]['text':' Ensure purging job deletes the expired pre-image entries of the test collection.','line_number':189,'multiline':False]['text':' The purgingJob is responsible for deleting on the secondary only when deletes are','line_number':203,'multiline':False]['text':' unreplicated.','line_number':204,'multiline':False]['text':' Must be greater than 0 given there were documents removed.','line_number':233,'multiline':False]