['text':' Library functions for change_stream_pre_image_time_based_expiration tests.','line_number':1,'multiline':False]['text':' Helper to verify if expected pre-images are present in pre-image collection.','line_number':5,'multiline':False]['text':' Get the newest pre-image and compute a time that would make it expire. The time is computed by','line_number':27,'multiline':False]['text':' adding (expireAfterSeconds + 0.001) seconds to the operation time of the last recorded pre-image.','line_number':28,'multiline':False]['text':' Status for pre-images that define if pre-image is expected to expire or not.','line_number':38,'multiline':False]['text':' Each element defines a sequence of documents belonging to one collection.','line_number':42,'multiline':False]['text':' Each documents has has associated status - 'expire' or 'retain'. This structure models the','line_number':43,'multiline':False]['text':' state of the pre-images associated with a particular document of the collection, ie. the','line_number':44,'multiline':False]['text':' pre-images corresponding to the documents 'shouldExpire' will be deleted by the remover job','line_number':45,'multiline':False]['text':' and those with 'shouldRetain' will be retained.','line_number':46,'multiline':False]['text':' Create several collections with pre- and post-images enabled.','line_number':62,'multiline':False]['text':' Get the collections information and sort them by uuid. The pre-image documents are naturally','line_number':69,'multiline':False]['text':' sorted first by uuid and then by timestamp in a pre-images collection. Sorting of collection','line_number':70,'multiline':False]['text':' helps in setting up of the pre-images in the required order. The 'collectionsInfo' has','line_number':71,'multiline':False]['text':' one-to-one mapping with 'docsStatePerCollection'.','line_number':72,'multiline':False]['text':' Disable pre-image time-based expiration policy.','line_number':79,'multiline':False]['text':' Insert documents to each collection. Iterate through the documents and group them as','line_number':88,'multiline':False]['text':' 'shouldExpire' or 'shouldRetain' based on the document states. Each element of these groups','line_number':89,'multiline':False]['text':' is an array, where the first element is the collection index and the second is the document','line_number':90,'multiline':False]['text':' id.','line_number':91,'multiline':False]['text':' Helper to update the document in the collection.','line_number':114,'multiline':False]['text':' Update each document that should expire, this will create pre-images.','line_number':123,'multiline':False]['text':' Verify that pre-images to be expired is recorded.','line_number':128,'multiline':False]['text':' Sleep for 1 ms before doing the next updates. The will ensure that the difference in','line_number':133,'multiline':False]['text':' operation time between pre-images to be retained and pre-images to be expired is at least','line_number':134,'multiline':False]['text':' 1 ms.','line_number':135,'multiline':False]['text':' Update each document for which pre-images will be retained. These pre-images will be ordered','line_number':138,'multiline':False]['text':' after pre-images that should expire for a particular collection.','line_number':139,'multiline':False]['text':' Verify that all pre-images are recorded.','line_number':142,'multiline':False]['text':' Tests time-based change stream pre-image retention policy.','line_number':154,'multiline':False]['text':' When run on a replica set, both 'conn' and 'primary' store connections to the','line_number':155,'multiline':False]['text':' replica set primary node.','line_number':156,'multiline':False]['text':' When run on a sharded cluster, 'conn' represents the connection to the mongos while','line_number':157,'multiline':False]['text':' 'primary' represents the connection to the shard primary node.','line_number':158,'multiline':False]['text':' Configure the current time for the pre-image remover job. At this point, the time-based','line_number':169,'multiline':False]['text':' pre-image expiration is still disabled.','line_number':170,'multiline':False]['text':' Wait until at least 1 complete cycle of pre-image removal job is completed.','line_number':176,'multiline':False]['text':' Verify that when time-based pre-image expiration disabled, no pre-images are not deleted.','line_number':180,'multiline':False]['text':' Enable time-based pre-image expiration and configure the 'expireAfterSeconds' to 1 seconds.','line_number':183,'multiline':False]['text':' Verify that at some point in time, all expired pre-images will be deleted.','line_number':189,'multiline':False]['text':' Verify that pre-images corresponding to documents with document states 'shouldRetain' are','line_number':194,'multiline':False]['text':' present.','line_number':195,'multiline':False]