['text':'*
 * Verify that write operations on orphaned documents (1) do not show up unexpected events in change
 * streams and (2) have a certain behavior on the persisted data.
 *
 * The behavior is tested in the following scenarios:
 *   - Test case 1: Direct operations to shard on orphaned documents
 *   - Test case 2: Broadcasted operations (from router) on orphaned documents
 *   - Test case 3: Transaction from router updating both orphaned and owned documents
 *   - Test case 4: Transaction to shard updating both orphaned and owned documents
 ','line_number':1,'multiline':True]['text':' Asserts that there is no event.','line_number':13,'multiline':False]['text':' Enable explicitly the periodic no-op writer to allow the router to process change stream events','line_number':30,'multiline':False]['text':' coming from all shards. This is enabled for production clusters by default.','line_number':31,'multiline':False]['text':' Suspend the range deletion on the first shard to force the orphaned documents to stay here after','line_number':40,'multiline':False]['text':' the chunks have been moved to the second shard.','line_number':41,'multiline':False]['text':' Create a shard collection with documents having both a key field and a non-key field.','line_number':44,'multiline':False]['text':' Test case 4','line_number':49,'multiline':False]['text':' Test case 3','line_number':50,'multiline':False]['text':' Test case 1','line_number':51,'multiline':False]['text':' Test case 1','line_number':52,'multiline':False]['text':' Test case 2','line_number':53,'multiline':False]['text':' Test case 2','line_number':54,'multiline':False]['text':' Test case 2','line_number':55,'multiline':False]['text':' Test case 3','line_number':56,'multiline':False]['text':' Test case 4','line_number':57,'multiline':False]['text':' Move the chunk to the second shard leaving orphaned documents on the first shard.','line_number':59,'multiline':False]['text':' Setup a change stream on the collection to receive real-time events on any data changes.','line_number':64,'multiline':False]['text':'//////////////////////////////////////////////////////////////////////////////////////////////////','line_number':67,'multiline':False]['text':' Test case 1: Direct operations to shard on orphaned documents','line_number':68,'multiline':False]['text':'//////////////////////////////////////////////////////////////////////////////////////////////////','line_number':69,'multiline':False]['text':' Direct insert to first shard of an orphaned document.','line_number':73,'multiline':False]['text':' No event is notified.','line_number':76,'multiline':False]['text':' The orphaned document on first shard has been inserted.','line_number':79,'multiline':False]['text':' Send a direct update to first shard on an orphaned document.','line_number':85,'multiline':False]['text':' No change stream event is generated.','line_number':88,'multiline':False]['text':' The orphaned document on first shard has been updated.','line_number':91,'multiline':False]['text':' Send a direct delete to first shard on an orphaned document.','line_number':97,'multiline':False]['text':' No change stream event is generated.','line_number':100,'multiline':False]['text':' The orphaned document on first shard has been removed.','line_number':103,'multiline':False]['text':' Send a direct update to first shard on two orphaned documents.','line_number':109,'multiline':False]['text':' No change stream event is generated.','line_number':113,'multiline':False]['text':' The orphaned documents on first shard have been updated','line_number':116,'multiline':False]['text':' Send a direct delete to first shard on an orphaned document.','line_number':123,'multiline':False]['text':' No change stream event is generated.','line_number':126,'multiline':False]['text':' The orphaned documents on first shard have been removed.','line_number':129,'multiline':False]['text':'//////////////////////////////////////////////////////////////////////////////////////////////////','line_number':134,'multiline':False]['text':' Test case 2: Broadcasted operations (from router) on orphaned documents','line_number':135,'multiline':False]['text':'//////////////////////////////////////////////////////////////////////////////////////////////////','line_number':136,'multiline':False]['text':' Send a broadcasted update (query on non-key field) on a single document to all the shards.','line_number':140,'multiline':False]['text':' The document is hosted by the second shard and the update event is notified. The first shard','line_number':143,'multiline':False]['text':' still hosts the orphaned document so no additional event must be notified.','line_number':144,'multiline':False]['text':' The orphaned document on first shard has not been updated, unlike the owned one on the second','line_number':149,'multiline':False]['text':' shard.','line_number':150,'multiline':False]['text':' Send a broadcasted delete (query on non-key field) on a single document to all the shards.','line_number':157,'multiline':False]['text':' The document is hosted by the second shard and the delete event is notified. The first shard','line_number':160,'multiline':False]['text':' still hosts the orphaned document so no additional event must be notified.','line_number':161,'multiline':False]['text':' The orphaned document on first shard has not been removed, unlike the owned one on the second','line_number':166,'multiline':False]['text':' shard.','line_number':167,'multiline':False]['text':' Send a broadcasted update (query on non-key field) on two documents to all the shards.','line_number':174,'multiline':False]['text':' The documents are hosted by the second shard and two delete events are notified. The first','line_number':177,'multiline':False]['text':' shard still hosts the orphaned documents so no additional event must be notified.','line_number':178,'multiline':False]['text':' The orphaned documents on first shard have not been updated, unlike the owned ones on the','line_number':185,'multiline':False]['text':' second shard.','line_number':186,'multiline':False]['text':' Send a broadcasted delete (query on non-key field) on two documents to all the shards.','line_number':195,'multiline':False]['text':' The documents are hosted by the second shard and two delete events are notified. The first','line_number':198,'multiline':False]['text':' shard still hosts the orphaned documents so no additional event must be notified.','line_number':199,'multiline':False]['text':' The orphaned documents on first shard have not been removed, unlike the owned ones on the','line_number':206,'multiline':False]['text':' second shard.','line_number':207,'multiline':False]['text':'//////////////////////////////////////////////////////////////////////////////////////////////////','line_number':214,'multiline':False]['text':' Test case 3: Transaction from router updating both orphaned and owned documents','line_number':215,'multiline':False]['text':'//////////////////////////////////////////////////////////////////////////////////////////////////','line_number':216,'multiline':False]['text':' Send a broadcasted transaction to the router updating both orphaned and owned documents.','line_number':221,'multiline':False]['text':' The primary shard hosts orphaned (james) and owned (olivia) documents, whereas the second','line_number':231,'multiline':False]['text':' shard hosts an owned document (james). Consequently, two update events are notified.','line_number':232,'multiline':False]['text':' The orphaned document on first shard (james) has not been updated, unlike the owned ones on','line_number':239,'multiline':False]['text':' both primary and second shards (olivia and james).','line_number':240,'multiline':False]['text':' Send a broadcasted transaction to the router deleting both orphaned and owned documents.','line_number':249,'multiline':False]['text':' The primary shard hosts orphaned (james) and owned (olivia) documents, whereas the second','line_number':259,'multiline':False]['text':' shard hosts an owned document (james). Consequently, two delete events are notified.','line_number':260,'multiline':False]['text':' The orphaned document on first shard (james) has not been removed, unlike the owned ones on','line_number':267,'multiline':False]['text':' both primary and second shards (olivia and james).','line_number':268,'multiline':False]['text':'//////////////////////////////////////////////////////////////////////////////////////////////////','line_number':274,'multiline':False]['text':' Test case 4: Transaction to shard updating both orphaned and owned documents','line_number':275,'multiline':False]['text':'//////////////////////////////////////////////////////////////////////////////////////////////////','line_number':276,'multiline':False]['text':' Send a direct transaction to a shard updating both orphaned and owned documents.','line_number':281,'multiline':False]['text':' The shard hosts both orphaned (liam) and non-orphaned (emma) documents. Consequently, only','line_number':291,'multiline':False]['text':' one update event is notified.','line_number':292,'multiline':False]['text':' Both orphaned (liam) and owned (emma) documents on the shard have been updated.','line_number':297,'multiline':False]['text':' Send a direct transaction to a shard deleting both orphaned and owned documents.','line_number':305,'multiline':False]['text':' The shard hosts both orphaned (liam) and non-orphaned (emma) documents. Consequently, only','line_number':315,'multiline':False]['text':' one update event is notified.','line_number':316,'multiline':False]['text':' Both orphaned (liam) and owned (emma) documents on the shard have been removed.','line_number':321,'multiline':False]['text':'//////////////////////////////////////////////////////////////////////////////////////////////////','line_number':326,'multiline':False]['text':' Essentially, this verifies that the operation before dropping the collection did not notify','line_number':332,'multiline':False]['text':' additional and unexpected events.','line_number':333,'multiline':False]