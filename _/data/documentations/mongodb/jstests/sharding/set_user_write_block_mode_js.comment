['text':'*
 * Tests sharding specific functionality of the setUserWriteBlockMode command. Non sharding specific
 * aspects of this command should be checked on jstests/noPassthrough/set_user_write_block_mode.js
 * instead.
 *
 * @tags: [
 *   requires_fcv_60,
 * ]
 ','line_number':1,'multiline':True]['text':' Test addShard sets the proper user writes blocking state on the new shard.','line_number':32,'multiline':False]['text':' Create a collection on the new shard before adding it to the cluster.','line_number':34,'multiline':False]['text':' Start blocking user writes.','line_number':41,'multiline':False]['text':' Add a new shard.','line_number':44,'multiline':False]['text':' Check that we cannot write on the new shard.','line_number':47,'multiline':False]['text':' Now unblock and check we can write to the new shard.','line_number':50,'multiline':False]['text':' Block again and see we can remove the shard even when write blocking is enabled. Before','line_number':54,'multiline':False]['text':' removing the shard we first need to drop the dbs for which 'newShard' is the db-primary','line_number':55,'multiline':False]['text':' shard.','line_number':56,'multiline':False]['text':' Disable write blocking while 'newShard' is not part of the cluster.','line_number':61,'multiline':False]['text':' Add the shard back and check that user write blocking is disabled.','line_number':64,'multiline':False]['text':' Test addShard serializes with setUserWriteBlockMode.','line_number':69,'multiline':False]['text':' Start setUserWriteBlockMode and make it hang during the SetUserWriteBlockModeCoordinator','line_number':71,'multiline':False]['text':' execution.','line_number':72,'multiline':False]['text':' Test chunk migrations work even if user writes are blocked','line_number':93,'multiline':False]['text':' Insert a document to the chunk that will be migrated to ensure that the recipient will at','line_number':97,'multiline':False]['text':' least insert one document as part of the migration.','line_number':98,'multiline':False]['text':' Create an index to check that the recipient, upon receiving its first chunk, can create it.','line_number':101,'multiline':False]['text':' Start blocking user writes.','line_number':105,'multiline':False]['text':' Move one chunk to shard1.','line_number':108,'multiline':False]['text':' Check that the index has been created on recipient.','line_number':116,'multiline':False]['text':' Check that orphans are deleted from the donor.','line_number':119,'multiline':False]['text':' Create an extra index on shard1. This index is not present in the shard0, thus shard1 will','line_number':124,'multiline':False]['text':' drop it when it receives its first chunk.','line_number':125,'multiline':False]['text':' Leave shard1 without any chunk.','line_number':127,'multiline':False]['text':' Create an extra index on shard1.','line_number':131,'multiline':False]['text':' Move a chunk to shard1.','line_number':137,'multiline':False]['text':' Check the mismatched index was dropped.','line_number':141,'multiline':False]['text':' Test movePrimary works while user writes are blocked.','line_number':148,'multiline':False]['text':' Create an unsharded collection so that its data needs to be cloned to the new db-primary.','line_number':150,'multiline':False]['text':' Start blocking user writes','line_number':156,'multiline':False]['text':' Check that the new primary has cloned the data.','line_number':163,'multiline':False]['text':' Check that the collection has been removed from the former primary.','line_number':166,'multiline':False]['text':' Test setAllowMigrations works while user writes are blocked.','line_number':175,'multiline':False]['text':' Start blocking user writes.','line_number':180,'multiline':False]['text':' Disable migrations for 'ns'.','line_number':183,'multiline':False]['text':' Reenable migrations for 'ns'.','line_number':192,'multiline':False]['text':' Send _shardsvrSetUserWriteBlockMode commands to directly to shard0 so that it starts blocking','line_number':206,'multiline':False]['text':' user writes.','line_number':207,'multiline':False]['text':' Check shard0 is now blocking writes.','line_number':225,'multiline':False]['text':' Send _shardsvrSetUserWriteBlockMode commands to directly to shard0 so that it stops blocking','line_number':228,'multiline':False]['text':' user writes.','line_number':229,'multiline':False]['text':' Check shard0 is no longer blocking writes.','line_number':247,'multiline':False]['text':' Replay the first two _shardsvrSetUserWriteBlockMode commands (as if it was due to a duplicate','line_number':250,'multiline':False]['text':' network packet). These messages should fail to process, so write blocking should not be','line_number':251,'multiline':False]['text':' re-enabled.','line_number':252,'multiline':False]['text':' Check shard0 is not blocking writes.','line_number':272,'multiline':False]