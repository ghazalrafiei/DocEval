['text':'*
 * Test that a shardsvr replica set that has not initialized its shard identity via an
 * addShard command can validate and sign cluster times, and that after its shard identity has
 * been initialized, it is still able to validate cluster times that were signed when it was not a
 * shard. If running in a config shard suite, instead test that a configsvr and shardsvr replica
 * set that has not initialized its shard identity via a transitionFromDedicatedConfigServer
 * command can validate and sign cluster times, and that after its shard identity has been
 * initialized, it is still able to validate cluster times that were signed when it was not a
 * shard.
 ','line_number':1,'multiline':True]['text':' Start a replica set with keyfile authentication enabled so it will return signed cluster times','line_number':42,'multiline':False]['text':' its responses.','line_number':43,'multiline':False]['text':' Used to allow restarting config server as an independent replica set.','line_number':52,'multiline':False]['text':' If testing config shard, specify "wiredTiger" as the storage engine so that when this test runs','line_number':57,'multiline':False]['text':' in the inMemory variant this replica set doesn't get started with the "inMemory" storage engine','line_number':58,'multiline':False]['text':' and fail since the config server cannot use the "inMemory" storage engine.','line_number':59,'multiline':False]['text':' Create a user for running commands later on in the test. Make the user not have the','line_number':64,'multiline':False]['text':' advanceClusterTime privilege. This ensures that the server will not return cluster times','line_number':65,'multiline':False]['text':' signed with a dummy key.','line_number':66,'multiline':False]['text':' Restart the replica set as a shardsvr (or configsvr if testing config shard). Use TestData with','line_number':89,'multiline':False]['text':' authentication settings so Mongo.prototype.getDB() takes care of re-authenticating after the','line_number':90,'multiline':False]['text':' network connection is re-established during ReplSetTest.prototype.upgradeSet().','line_number':91,'multiline':False]['text':' Restart the replica set as a shardsvr.','line_number':104,'multiline':False]['text':' Restart the replica set as a configsvr.','line_number':109,'multiline':False]['text':' Reconnect and re-authenticate after the network connection was closed due to restart.','line_number':120,'multiline':False]['text':' Verify that the application is able to use a signed cluster time although the addShard','line_number':125,'multiline':False]['text':' or transitionFromDedicatedConfigServer command has not been run.','line_number':126,'multiline':False]['text':' Start a sharded cluster and add the shardsvr replica set to it.','line_number':133,'multiline':False]['text':' Additionally test TTL deletion of key documents. To speed up the test, make the','line_number':140,'multiline':False]['text':' documents expire right away. To prevent the documents from being deleted before all','line_number':141,'multiline':False]['text':' cluster time validation testing is completed, make the TTL monitor have a large','line_number':142,'multiline':False]['text':' sleep interval at first and then lower it at the end of the test when verifying that','line_number':143,'multiline':False]['text':' the documents do get deleted by the TTL monitor.','line_number':144,'multiline':False]['text':' Start a sharded cluster and add the configsvr replica set to it.','line_number':153,'multiline':False]['text':' Make sure the configsvr is in the same FCV as the mongos.','line_number':155,'multiline':False]['text':' Transitioning from last-lts to last-continuous is only allowed when','line_number':158,'multiline':False]['text':' setFeatureCompatibilityVersion is called with fromConfigServer: true.','line_number':159,'multiline':False]['text':' Wait for the new FCV to propagate to all configsvr nodes.','line_number':163,'multiline':False]['text':' Each client connection may only be authenticated once.','line_number':172,'multiline':False]['text':' As a performance optimization, LogicalTimeValidator::validate() skips validating $clusterTime','line_number':179,'multiline':False]['text':' values which have a $clusterTime.clusterTime value smaller than the currently known signed','line_number':180,'multiline':False]['text':' $clusterTime value. It is possible (but not strictly guaranteed) for internal communication','line_number':181,'multiline':False]['text':' to have already happened between cluster members such that they all know about a signed','line_number':182,'multiline':False]['text':' $clusterTime value. This signed $clusterTime value would come from the new signing key','line_number':183,'multiline':False]['text':' generated by the config server primary. Here we use the alwaysValidateClientsClusterTime','line_number':184,'multiline':False]['text':' fail point to simulate the behavior of case when the internal communication with a signed','line_number':185,'multiline':False]['text':' $clusterTime value has not happened yet.','line_number':186,'multiline':False]['text':' Verify that after the addShard or transitionFromDedicatedConfigServer command has been run,','line_number':193,'multiline':False]['text':' the application is still able to use the cluster time signed when the replica set was not a','line_number':194,'multiline':False]['text':' shard.','line_number':195,'multiline':False]['text':' Verify that the new cluster time was signed with the sharded cluster's key (generated by','line_number':199,'multiline':False]['text':' the config server) instead of the shardsvr replica set's key.','line_number':200,'multiline':False]['text':' Verify that the old cluster time can also be used against the mongos, config server, and','line_number':203,'multiline':False]['text':' other shard.','line_number':204,'multiline':False]['text':' Verify that the new cluster time was signed with the existing key.','line_number':212,'multiline':False]['text':' Verify that the old cluster time can also be used against the mongos.','line_number':215,'multiline':False]