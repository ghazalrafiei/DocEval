['text':'*
 * Test updates into sharded timeseries collection.
 *
 * @tags: [
 *   # TODO (SERVER-70605): Remove this tag once the time-series always compressed buckets feature
 *   # flag can be removed.
 *   multiversion_incompatible,
 * ]
 ','line_number':1,'multiline':True]['text':'','line_number':16,'multiline':False]['text':' Constants used throughout all tests.','line_number':17,'multiline':False]['text':'','line_number':18,'multiline':False]['text':'','line_number':61,'multiline':False]['text':' Helper functions.','line_number':62,'multiline':False]['text':'','line_number':63,'multiline':False]['text':'*
 * Confirms that a set of updates returns the expected set of documents.
 ','line_number':65,'multiline':True]['text':' Updates on timeseries collections are not allowed if no metaField is defined.','line_number':94,'multiline':False]['text':' Updates on sharded timeseries meta fields are only allowed as long as the field updated is','line_number':102,'multiline':False]['text':' not in the shard key.','line_number':103,'multiline':False]['text':'*
 * Wrapper on testShardedUpdate to compose tests with a given shardKey/timeseries combo.
 ','line_number':129,'multiline':True]['text':' Set up the shard key for the tests.','line_number':133,'multiline':False]['text':' Run a series of updates.','line_number':142,'multiline':False]['text':' Helper lambda which has the extensions field set to:','line_number':144,'multiline':False]['text':' - undefined if we are updating the meta field.','line_number':145,'multiline':False]['text':' - the name of a subfield of meta we are updating.','line_number':146,'multiline':False]['text':' - an array of names of subfields of meta we are updating.','line_number':147,'multiline':False]['text':' If we do not have the meta field in the shard key, we are able to update it.','line_number':150,'multiline':False]['text':' If the top-level meta field is in the shard key, we cannot update it.','line_number':154,'multiline':False]['text':'*
 * Helper function to generate the parameters to pass to 'testUpdates' when an update is expected to
 * fail.
 ','line_number':182,'multiline':True]['text':'','line_number':195,'multiline':False]['text':' Test cases when the update command fails.','line_number':196,'multiline':False]['text':'','line_number':197,'multiline':False]['text':' Replace a document to have no metaField, which should fail since updates with replacement','line_number':215,'multiline':False]['text':' documents are not supported.','line_number':216,'multiline':False]['text':' Replace a document with an empty document, which should fail since updates with replacement','line_number':226,'multiline':False]['text':' documents are not supported.','line_number':227,'multiline':False]['text':' Modify the metaField, which should fail since pipeline-style updates are not supported.','line_number':237,'multiline':False]['text':' Query on a field which is not the (nonexistent) metaField.','line_number':256,'multiline':False]['text':' Query on all documents and update them to be empty documents.','line_number':266,'multiline':False]['text':' Query on all documents and update them to be non-empty documents.','line_number':276,'multiline':False]['text':' Query on a field that is not the metaField.','line_number':286,'multiline':False]['text':' Query on the metaField and a field that is not the metaField.','line_number':296,'multiline':False]['text':' Query on a field that is not the metaField using dot notation and modify the metaField.','line_number':308,'multiline':False]['text':' Query on the metaField and modify a field that is not the metaField.','line_number':324,'multiline':False]['text':' Query on the metaField and modify the metaField and fields that are not the metaField.','line_number':334,'multiline':False]['text':' Rename the metaField.','line_number':344,'multiline':False]['text':' Rename a subfield of the metaField to something not in the metaField.','line_number':354,'multiline':False]['text':'','line_number':365,'multiline':False]['text':' Test cases when the update command succeeds.','line_number':366,'multiline':False]['text':'','line_number':367,'multiline':False]['text':' Multiple updates, ordered: query on the metaField and modify the metaField multiple times.','line_number':370,'multiline':False]['text':' Multiple updates, ordered: query on the metaField and on a field that is not the metaField.','line_number':400,'multiline':False]['text':' If the shardKey is on one of the fields being updated, this must fail.','line_number':416,'multiline':False]['text':' Multiple updates, ordered: query on the metaField and modify the metaField and a field that','line_number':422,'multiline':False]['text':' is not the metaField using dot notation.','line_number':423,'multiline':False]['text':' If the shardKey is on the field being updated, this must fail to update any docs.','line_number':444,'multiline':False]['text':' Multiple updates, ordered: query on the metaField and modify a field that is not the','line_number':450,'multiline':False]['text':' metaField using dot notation.','line_number':451,'multiline':False]['text':' Multiple updates, unordered: Modify the metaField, a field that is not the metaField, and','line_number':469,'multiline':False]['text':' the metaField. The first and last updates should succeed.','line_number':470,'multiline':False]['text':' Rename a subfield to the metaField.','line_number':505,'multiline':False]['text':' Query on the metaField and modify the metaField.','line_number':518,'multiline':False]['text':' Query on the metaField and modify the metaField of 1 matching document.','line_number':531,'multiline':False]['text':' Query on the metaField and update the metaField of multiple matching documents.','line_number':550,'multiline':False]['text':' Compound query on the metaField using dot notation and modify the metaField.','line_number':574,'multiline':False]['text':' Query on the metaField using dot notation and modify the metaField.','line_number':587,'multiline':False]['text':' Query on the metaField using dot notation and modify the metaField.','line_number':600,'multiline':False]['text':' Query with an empty document (i.e update all documents in the collection).','line_number':618,'multiline':False]['text':' Remove the metaField.','line_number':634,'multiline':False]['text':' Update where one of the matching documents is a no-op update.','line_number':644,'multiline':False]['text':' Query for documents using $jsonSchema with the metaField required.','line_number':664,'multiline':False]['text':' Query for documents using $jsonSchema with the metaField in dot notation required.','line_number':681,'multiline':False]['text':' Query for documents using $jsonSchema with a field that is not the metaField required.','line_number':695,'multiline':False]['text':' Query for documents using $jsonSchema with the metaField required and a required subfield','line_number':708,'multiline':False]['text':' of the metaField with the same name as the metaField.','line_number':709,'multiline':False]['text':' Query for documents using $jsonSchema with the metaField required and an optional field','line_number':727,'multiline':False]['text':' that is not the metaField.','line_number':728,'multiline':False]['text':' Query for documents on the metaField with the metaField nested within nested operators.','line_number':744,'multiline':False]['text':' Updates where upsert:false should not insert a new document when no match is found. In case','line_number':762,'multiline':False]['text':' the shard key is on the meta field, this should not update any documents but also but not','line_number':763,'multiline':False]['text':' report a failure, since no documents were matched.','line_number':764,'multiline':False]['text':' Do the same test case as above but with upsert:true, which should fail.','line_number':777,'multiline':False]['text':' Use a variable defined in the let option in the query to modify the metaField.','line_number':791,'multiline':False]['text':' Variables defined in the let option can only be used in the update if the update is an','line_number':809,'multiline':False]['text':' pipeline update. Since this update is an update document, the literal name of the variable','line_number':810,'multiline':False]['text':' will be used in the update instead of the variable's value.','line_number':811,'multiline':False]['text':' Use variables defined in the let option in the query to modify the metaField multiple times.','line_number':825,'multiline':False]['text':' Query on the metaField and modify the metaField using collation with strength level 1.','line_number':857,'multiline':False]['text':' Query on the metaField and modify the metaField using collation with the default strength','line_number':875,'multiline':False]['text':' (level 3).','line_number':876,'multiline':False]['text':' Assumes shard key is meta.a.','line_number':896,'multiline':False]['text':' Query on the metaField and modify the metaField using collation with strength level 1.','line_number':902,'multiline':False]['text':' Run tests with a variety of shardKeys and timeseries configurations.','line_number':919,'multiline':False]['text':' Run a relevant subset of tests in the case when meta.a is the shard key.','line_number':941,'multiline':False]