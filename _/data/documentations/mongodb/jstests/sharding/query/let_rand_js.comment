['text':'*
 * Test that $rand in a command-level 'let' is evaluated only once.
 *
 * @tags: [
 *   # Before 7.2, $rand was evaluated more than once in sharded find (SERVER-75927).
 *   requires_fcv_72,
 * ]
 ','line_number':1,'multiline':True]['text':' Split at zero so each shard gets one document.','line_number':25,'multiline':False]['text':' Run the command and assert that both documents have the same value of 'rand'.','line_number':28,'multiline':False]['text':' Assert that both shards see the same pseudo-random value.','line_number':38,'multiline':False]['text':' Test update command.','line_number':65,'multiline':False]['text':'','line_number':66,'multiline':False]['text':' Pick a random value and update all documents with it.','line_number':67,'multiline':False]['text':' Then we expect all documents to have the same value.','line_number':68,'multiline':False]['text':'TODO SERVER-82042','line_number':69,'multiline':True]['text':' Undo changes.','line_number':84,'multiline':False]['text':' Test the 'bulkWrite' command.','line_number':88,'multiline':False]['text':'TODO SERVER-82042','line_number':89,'multiline':True]['text':' Undo changes.','line_number':108,'multiline':False]['text':' Test the 'findAndModify' command.','line_number':113,'multiline':False]['text':'','line_number':114,'multiline':False]['text':' Randomly choose an 'x' value to update, and update it.','line_number':115,'multiline':False]['text':' If we correctly evaluate $rand once up front, then we'll always have exactly one update.','line_number':116,'multiline':False]['text':'TODO SERVER-82042','line_number':117,'multiline':True]['text':' Pick either {x: 2} or {x: -2} randomly, and update it.','line_number':119,'multiline':False]['text':' If we incorrectly evaluated $rand independently per shard, then it's possible for each','line_number':134,'multiline':False]['text':' shard to pick the value it does not contain, resulting in no updates. If we correctly','line_number':135,'multiline':False]['text':' evaluate $rand once, we expect exactly one update.','line_number':136,'multiline':False]['text':' Reset for next trial.','line_number':142,'multiline':False]['text':' Test the 'delete' command.','line_number':147,'multiline':False]['text':'','line_number':148,'multiline':False]['text':' Put the values 0..99 on each shard.','line_number':149,'multiline':False]['text':' Pick 0..9 randomly and deleteMany that value.','line_number':150,'multiline':False]['text':' If we incorrectly evaluate per shard, we will very likely remove a different value.','line_number':151,'multiline':False]['text':' TODO SERVER-82042 ','line_number':152,'multiline':True]['text':' Put the values 0..99 on each shard.','line_number':153,'multiline':False]['text':' Randomly choose 0..99 to delete.','line_number':158,'multiline':False]['text':' If we correctly evaluate $rand once, we'll delete the same value on each shard.','line_number':159,'multiline':False]['text':' If we incorrectly evaluate per shard, we're 99% likely to delete two different values.','line_number':160,'multiline':False]['text':' no limit: delete all matching documents.','line_number':166,'multiline':False]