['text':' Tests that aggregations with a $merge stage respect the options set on the command.','line_number':1,'multiline':False]['text':' Enable profiling on the test DB.','line_number':13,'multiline':False]['text':' Enable sharding on the test DB and ensure that shard0 is the primary.','line_number':17,'multiline':False]['text':' Shard the target collection, and set the unique flag to ensure that there's a unique','line_number':21,'multiline':False]['text':' index on the shard key.','line_number':22,'multiline':False]['text':' The shardCollection command will send a listIndexes on the target collection.','line_number':34,'multiline':False]['text':' Force a refresh on rs0. This is necessary because MongoS will get StaleDbVersion upon sending','line_number':41,'multiline':False]['text':' the agg request below, causing it to retry the agg command from the top and thus send','line_number':42,'multiline':False]['text':' listIndexes to the primary shard twice.','line_number':43,'multiline':False]['text':' Test that the maxTimeMS value is used for both the listIndexes command for uniqueKey','line_number':47,'multiline':False]['text':' validation as well as the $merge aggregation itself.','line_number':48,'multiline':False]['text':' Verify the profile entry for the aggregate on the source collection.','line_number':63,'multiline':False]['text':' The listIndexes command should be sent to the primary shard only. Note that the','line_number':74,'multiline':False]['text':' maxTimeMS will *not* show up in the profiler since the parameter is used as a timeout for','line_number':75,'multiline':False]['text':' the remote command vs. part of the command itself.','line_number':76,'multiline':False]['text':' Configure the "maxTimeAlwaysTimeOut" fail point on the primary shard, which forces','line_number':85,'multiline':False]['text':' mongod to throw if it receives an operation with a max time.','line_number':86,'multiline':False]['text':' Test that the $merge correctly fails when the maxTimeMS is exceeded.','line_number':90,'multiline':False]['text':' The actual aggregate should not be in the profiler since the initial listIndexes should','line_number':109,'multiline':False]['text':' have timed out.','line_number':110,'multiline':False]['text':' TODO(SERVER-47998): The listIndexes command should be sent to the primary shard,','line_number':121,'multiline':False]['text':' but due to SERVER-47998 it does not show up in the profiler.','line_number':122,'multiline':False]['text':' Test that setting a read preference on the $merge also applies to the listIndexes','line_number':133,'multiline':False]['text':' command.','line_number':134,'multiline':False]['text':' Verify that the profiler on the secondary includes an entry for the listIndexes.','line_number':152,'multiline':False]['text':' Verify that the primary shard does *not* have an additional listIndexes profiler entry.','line_number':159,'multiline':False]['text':' Test that $out can be run against a secondary.','line_number':176,'multiline':False]['text':' Note that running on secondaries in every case is not yet supported.','line_number':177,'multiline':False]['text':' https://jira.mongodb.org/browse/SERVER-37250','line_number':178,'multiline':False]