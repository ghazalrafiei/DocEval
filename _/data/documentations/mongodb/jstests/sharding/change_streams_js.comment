['text':' Tests the behavior of change streams on sharded collections.','line_number':1,'multiline':False]['text':' @tags: [','line_number':2,'multiline':False]['text':'   requires_majority_read_concern,','line_number':3,'multiline':False]['text':'   uses_change_streams,','line_number':4,'multiline':False]['text':' ]','line_number':5,'multiline':False]['text':' Intentionally disable the periodic no-op writer in order to allow the test have','line_number':19,'multiline':False]['text':' control of advancing the cluster time. For when it is enabled later in the test,','line_number':20,'multiline':False]['text':' use a higher frequency for periodic noops to speed up the test.','line_number':21,'multiline':False]['text':'','line_number':32,'multiline':False]['text':' Test that the config server is running with {periodicNoopIntervalSecs: 1}. This ensures that','line_number':33,'multiline':False]['text':' the config server does not unduly delay a change stream despite its low write rate.','line_number':34,'multiline':False]['text':'','line_number':35,'multiline':False]['text':'','line_number':40,'multiline':False]['text':' Sanity tests','line_number':41,'multiline':False]['text':'','line_number':42,'multiline':False]['text':' Test that $sort and $group are banned from running in a $changeStream pipeline.','line_number':44,'multiline':False]['text':' Test that using change streams with $out results in an error.','line_number':52,'multiline':False]['text':'','line_number':56,'multiline':False]['text':' Main tests','line_number':57,'multiline':False]['text':'','line_number':58,'multiline':False]['text':' Shard the test collection and split it into 2 chunks:','line_number':75,'multiline':False]['text':'  [MinKey, 0) - shard0, [0, MaxKey) - shard1','line_number':76,'multiline':False]['text':' shard key ','line_number':78,'multiline':True]['text':' split at ','line_number':79,'multiline':True]['text':' move to shard 1 ','line_number':80,'multiline':True]['text':' Write a document to each chunk.','line_number':82,'multiline':False]['text':' Test that a change stream can see inserts on shard 0.','line_number':88,'multiline':False]['text':' Because the periodic noop writer is disabled, do another write to shard 0 in order to','line_number':100,'multiline':False]['text':' advance that shard's clock and enabling the stream to return the earlier write to shard 1','line_number':101,'multiline':False]['text':' Test that all changes are eventually visible due to the periodic noop writer.','line_number':112,'multiline':False]['text':' The multi-update events can be observed in any order, depending on the clusterTime at which','line_number':148,'multiline':False]['text':' they are written on each shard.','line_number':149,'multiline':False]['text':' Test that it is legal to open a change stream, even if the','line_number':162,'multiline':False]['text':' 'internalQueryProhibitMergingOnMongos' parameter is set.','line_number':163,'multiline':False]['text':' We awaited the replication of the first write, so the change stream shouldn't return it.','line_number':172,'multiline':False]['text':' Use { w: "majority" } to deal with journaling correctly, even though we only have one','line_number':173,'multiline':False]['text':' node.','line_number':174,'multiline':False]['text':' Drop the collection and test that we return a "drop" followed by an "invalidate" entry','line_number':181,'multiline':False]['text':' and close the cursor.','line_number':182,'multiline':False]['text':' Wait for the drop to actually happen.','line_number':186,'multiline':False]['text':' Shard the test collection and split it into 2 chunks:','line_number':198,'multiline':False]['text':'  [MinKey, 0) - shard0, [0, MaxKey) - shard1','line_number':199,'multiline':False]['text':' shard key ','line_number':201,'multiline':True]['text':' split at ','line_number':202,'multiline':True]['text':' move to shard 1 ','line_number':203,'multiline':True]['text':' Write one document to each chunk.','line_number':205,'multiline':False]['text':' Store a valid resume token before dropping the collection, to be used later in the test','line_number':214,'multiline':False]['text':' With an explicit collation, test that we can resume from before the collection drop','line_number':239,'multiline':False]['text':' Test that we can resume from before the collection drop without an explicit collation.','line_number':256,'multiline':False]