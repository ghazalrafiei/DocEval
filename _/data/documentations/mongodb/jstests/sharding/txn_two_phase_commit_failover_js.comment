['text':'*
 * Exercises transaction coordinator failover by inducing stepdowns at specific points and ensuring
 * the transaction completes and the router is able to learn the decision by retrying
 * coordinateCommitTransaction.
 *
 * @tags: [uses_transactions, uses_multi_shard_transaction]
 ','line_number':1,'multiline':True]['text':' The UUID consistency check uses connections to shards cached on the ShardingTest object, but this','line_number':9,'multiline':False]['text':' test causes failovers on a shard, so the cached connection is not usable.','line_number':10,'multiline':False]['text':' Lower the transaction timeout for participants, since this test exercises the case where the','line_number':24,'multiline':False]['text':' coordinator fails over before writing the participant list and then checks that the','line_number':25,'multiline':False]['text':' transaction is aborted on all participants, and the participants will only abort on reaching','line_number':26,'multiline':False]['text':' the transaction timeout.','line_number':27,'multiline':False]['text':' We are making one of the secondaries non-electable to ensure','line_number':39,'multiline':False]['text':' that elections always result in a winner (see SERVER-42234)','line_number':40,'multiline':False]['text':' Create a sharded collection with a chunk on each shard:','line_number':92,'multiline':False]['text':' shard0: [-inf, 0)','line_number':93,'multiline':False]['text':' shard1: [0, 10)','line_number':94,'multiline':False]['text':' shard2: [10, +inf)','line_number':95,'multiline':False]['text':' Start a new transaction by inserting a document onto each shard.','line_number':108,'multiline':False]['text':' Manually abort the transaction on one of the participants, so that the','line_number':138,'multiline':False]['text':' participant fails to prepare.','line_number':139,'multiline':False]['text':' Run commitTransaction through a parallel shell.','line_number':154,'multiline':False]['text':' We are testing the prepare phase','line_number':164,'multiline':False]['text':' A remote participant will vote abort','line_number':165,'multiline':False]['text':' Wait for the abort to the local host to be scheduled as well.','line_number':166,'multiline':False]['text':' Induce the coordinator primary to step down.','line_number':172,'multiline':False]['text':' The router should retry commitTransaction against the new primary.','line_number':183,'multiline':False]['text':' Check that the transaction committed or aborted as expected.','line_number':186,'multiline':False]['text':' Use assert.soon(), because although coordinateCommitTransaction currently blocks','line_number':192,'multiline':False]['text':' until the commit process is fully complete, it will eventually be changed to only','line_number':193,'multiline':False]['text':' block until the decision is *written*, so the documents may not be visible','line_number':194,'multiline':False]['text':' immediately.','line_number':195,'multiline':False]['text':'','line_number':228,'multiline':False]['text':' Run through all the failpoints when one participant responds to prepare with vote abort.','line_number':229,'multiline':False]['text':'','line_number':230,'multiline':False]['text':' make a participant abort ','line_number':234,'multiline':True]['text':' expect abort decision ','line_number':234,'multiline':True]['text':'','line_number':237,'multiline':False]['text':' Run through all the failpoints when all participants respond to prepare with vote commit.','line_number':238,'multiline':False]['text':'','line_number':239,'multiline':False]['text':' Note: If the coordinator fails over before making the participant list durable,','line_number':242,'multiline':False]['text':' the transaction will abort even if all participants could have committed. This is','line_number':243,'multiline':False]['text':' a property of the coordinator only, and would be true even if a participant's','line_number':244,'multiline':False]['text':' in-progress transaction could survive failover.','line_number':245,'multiline':False]['text':' make a participant abort ','line_number':250,'multiline':True]['text':' same node always steps up after stepping down ','line_number':257,'multiline':True]['text':' same node always steps up after stepping down ','line_number':258,'multiline':True]