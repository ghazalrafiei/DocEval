['text':' Tests mongos behavior on stale shard version errors received in a transaction.','line_number':1,'multiline':False]['text':'','line_number':2,'multiline':False]['text':' @tags: [','line_number':3,'multiline':False]['text':'  requires_sharding,','line_number':4,'multiline':False]['text':'  uses_transactions,','line_number':5,'multiline':False]['text':'  uses_multi_shard_transaction,','line_number':6,'multiline':False]['text':'  assumes_balancer_off','line_number':7,'multiline':False]['text':' ]','line_number':8,'multiline':False]['text':' Disable checking for index consistency to ensure that the config server doesn't trigger a','line_number':31,'multiline':False]['text':' StaleShardVersion exception on shards and cause them to refresh their sharding metadata.','line_number':32,'multiline':False]['text':' Disable the best-effort recipient metadata refresh after migrations to simplify simulating','line_number':42,'multiline':False]['text':' stale shard version errors.','line_number':43,'multiline':False]['text':' Shard two collections in the same database, each with 2 chunks, [minKey, 0), [0, maxKey),','line_number':51,'multiline':False]['text':' with one document each, all on Shard0.','line_number':52,'multiline':False]['text':'','line_number':82,'multiline':False]['text':' Stale shard version on first overall command should succeed.','line_number':83,'multiline':False]['text':'','line_number':84,'multiline':False]['text':' Move a chunk in the first collection from Shard0 to Shard1 through the main mongos, so Shard1','line_number':86,'multiline':False]['text':' is stale but not the router.','line_number':87,'multiline':False]['text':' Targets Shard1, which is stale.','line_number':93,'multiline':False]['text':'','line_number':98,'multiline':False]['text':' Stale shard version on second command to a shard should fail.','line_number':99,'multiline':False]['text':'','line_number':100,'multiline':False]['text':' Move a chunk in the other collection from Shard0 to Shard1 through the main mongos, so Shard1','line_number':104,'multiline':False]['text':' is stale for the other collection but not the router.','line_number':105,'multiline':False]['text':' Targets Shard1 for the first ns, which is not stale.','line_number':112,'multiline':False]['text':' Targets the other sharded collection on Shard1, which is stale. Because a previous statement','line_number':115,'multiline':False]['text':' has executed on Shard1, the retry will not restart the transaction, and will fail when it','line_number':116,'multiline':False]['text':' finds the transaction has aborted because of the stale shard version.','line_number':117,'multiline':False]['text':'','line_number':125,'multiline':False]['text':' Stale shard version on first command to a new shard should succeed.','line_number':126,'multiline':False]['text':'','line_number':127,'multiline':False]['text':' Move a chunk for the other collection from Shard1 to Shard0 through the main mongos, so','line_number':131,'multiline':False]['text':' Shard0 is stale for it and the router is not.','line_number':132,'multiline':False]['text':' Targets Shard1 for the first ns, which is not stale.','line_number':139,'multiline':False]['text':' Targets Shard0 for the other ns, which is stale.','line_number':142,'multiline':False]['text':'','line_number':147,'multiline':False]['text':' Stale mongos aborts on old shard.','line_number':148,'multiline':False]['text':'','line_number':149,'multiline':False]['text':' Move a chunk in the first collection from Shard1 to Shard0 through the other mongos, so','line_number':151,'multiline':False]['text':' Shard1 and the main mongos are stale for it.','line_number':152,'multiline':False]['text':' Targets Shard1, which hits a stale version error, then re-targets Shard0, which is also','line_number':160,'multiline':False]['text':' stale but should succeed.','line_number':161,'multiline':False]['text':' Verify there is no in-progress transaction on Shard1.','line_number':166,'multiline':False]['text':'','line_number':176,'multiline':False]['text':' More than one stale shard version error.','line_number':177,'multiline':False]['text':'','line_number':178,'multiline':False]['text':' Move chunks for the first ns from Shard0 to Shard1 and Shard2 through the main mongos, so','line_number':180,'multiline':False]['text':' both are stale but not the router.','line_number':181,'multiline':False]['text':' Targets all shards, two of which are stale.','line_number':190,'multiline':False]['text':'','line_number':195,'multiline':False]['text':' Can retry a stale write on the first statement.','line_number':196,'multiline':False]['text':'','line_number':197,'multiline':False]['text':' Move a chunk to Shard1 to make it stale.','line_number':199,'multiline':False]['text':' Targets Shard1, which is stale.','line_number':205,'multiline':False]['text':'','line_number':210,'multiline':False]['text':' Can retry a stale write past the first statement if the write has been sent to only new','line_number':211,'multiline':False]['text':' participant shard(s).','line_number':212,'multiline':False]['text':'','line_number':213,'multiline':False]['text':' TODO SERVER-37207: Change batch writes to retry only the failed writes in a batch, to allow','line_number':214,'multiline':False]['text':' retrying writes beyond the first overall statement.','line_number':215,'multiline':False]['text':'','line_number':216,'multiline':False]['text':' Move a chunk to Shard2 to make it stale.','line_number':218,'multiline':False]['text':' Targets Shard1, which is not stale.','line_number':224,'multiline':False]['text':' Targets Shard2, which is stale.','line_number':227,'multiline':False]['text':'','line_number':232,'multiline':False]['text':' The final StaleConfig error should be returned if the router exhausts its retries.','line_number':233,'multiline':False]['text':'','line_number':234,'multiline':False]['text':' Move a chunk to Shard0 to make it stale.','line_number':236,'multiline':False]['text':' Disable metadata refreshes on the stale shard so it will indefinitely return a stale version','line_number':240,'multiline':False]['text':' error.','line_number':241,'multiline':False]['text':' Target Shard2, to verify the transaction on it is aborted implicitly later.','line_number':247,'multiline':False]['text':' Targets all shards. Shard0 is stale and won't refresh its metadata, so mongos should exhaust','line_number':250,'multiline':False]['text':' its retries and implicitly abort the transaction.','line_number':251,'multiline':False]['text':' Verify the shards that did not return an error were also aborted.','line_number':255,'multiline':False]