['text':' Tests that sub-queries across shards as part of $unionWith will obey the read preference','line_number':1,'multiline':False]['text':' specified by the user.','line_number':2,'multiline':False]['text':' @tags: [requires_majority_read_concern]','line_number':3,'multiline':False]['text':' In this test we perform writes which we expect to read on a secondary, so we need to enable','line_number':8,'multiline':False]['text':' causal consistency.','line_number':9,'multiline':False]['text':' Shard the test collection on _id with 2 chunks: [MinKey, 0), [0, MaxKey].','line_number':17,'multiline':False]['text':' Shard the union's target collection on _id with the same chunks, but moving the negative chunk','line_number':19,'multiline':False]['text':' off the primary shard so their distributions are flipped.','line_number':20,'multiline':False]['text':' Turn on the profiler.','line_number':24,'multiline':False]['text':' Write a document to each chunk.','line_number':36,'multiline':False]['text':' Test that $unionWith goes to the primary by default.','line_number':42,'multiline':False]['text':' Test that the union's sub-pipelines go to the primary.','line_number':50,'multiline':False]['text':' Test that $unionWith subpipelines go to the secondary when the readPreference is {mode:','line_number':63,'multiline':False]['text':' "secondary"}.','line_number':64,'multiline':False]['text':' Test that the union's sub-pipelines go to the secondary.','line_number':75,'multiline':False]['text':' We need to filter out any profiler entries with a stale config - this is the first','line_number':84,'multiline':False]['text':' read on this secondary with a readConcern specified, so it is the first read on this','line_number':85,'multiline':False]['text':' secondary that will enforce shard version.','line_number':86,'multiline':False]['text':' Now a more extreme test, add a nested $unionWith and a more complicated sub - pipeline to ensure','line_number':92,'multiline':False]['text':' any sub-operation always goes to the secondary if the read preference is secondary.','line_number':93,'multiline':False]['text':' Test that the union's sub-pipelines go to the secondary.','line_number':121,'multiline':False]['text':' We need to filter out any profiler entries with a stale config - this is the first','line_number':131,'multiline':False]['text':' read on this secondary with a readConcern specified, so it is the first read on this','line_number':132,'multiline':False]['text':' secondary that will enforce shard version.','line_number':133,'multiline':False]['text':' We need to filter out any profiler entries with a stale config - this is the first','line_number':143,'multiline':False]['text':' read on this secondary with a readConcern specified, so it is the first read on this','line_number':144,'multiline':False]['text':' secondary that will enforce shard version.','line_number':145,'multiline':False]