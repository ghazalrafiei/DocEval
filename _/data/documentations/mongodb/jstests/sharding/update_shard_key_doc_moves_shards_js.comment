['text':'*
 * Tests that changing the shard key value of a document using update and findAndModify works
 * correctly when the doc will change shards.
 * @tags: [
 *   uses_multi_shard_transaction,
 *   uses_transactions,
 * ]
 ','line_number':1,'multiline':True]['text':' Assert that the document is updated when the delete fails.','line_number':59,'multiline':False]['text':' Internal transactions will retry internally with the transaction API.','line_number':71,'multiline':False]['text':' upsert ','line_number':79,'multiline':True]['text':' returnNew ','line_number':80,'multiline':True]['text':' Internal transactions will retry internally with the transaction API.','line_number':88,'multiline':False]['text':' upsert ','line_number':96,'multiline':True]['text':' Reset the collection's documents.','line_number':115,'multiline':False]['text':' Assert that the document is not updated when the insert fails for a non transient reason.','line_number':119,'multiline':False]['text':' Reset the collection's documents.','line_number':148,'multiline':False]['text':' Assert that the shard key update is not committed when there are no write errors and the','line_number':152,'multiline':False]['text':' transaction is explicity aborted.','line_number':153,'multiline':False]['text':'','line_number':169,'multiline':False]['text':' Test that changing the shard key works correctly when either the update or findAndModify','line_number':170,'multiline':False]['text':' command is used and when the command is run either as a retryable write or in a transaction.','line_number':171,'multiline':False]['text':' Tuples represent [shouldRunCommandInTxn, runUpdateAsFindAndModifyCmd, isUpsert].','line_number':172,'multiline':False]['text':'','line_number':173,'multiline':False]['text':'','line_number':186,'multiline':False]['text':'  Tests for op-style updates.','line_number':187,'multiline':False]['text':'','line_number':188,'multiline':False]['text':' Failure cases. These tests do not take 'upsert' as an option so we do not need to test','line_number':243,'multiline':False]['text':' them for both upsert true and false.','line_number':244,'multiline':False]['text':'','line_number':272,'multiline':False]['text':' Tests for replacement style updates.','line_number':273,'multiline':False]['text':'','line_number':274,'multiline':False]['text':' Failure cases. These tests do not take 'upsert' as an option so we do not need to test','line_number':321,'multiline':False]['text':' them for both upsert true and false.','line_number':322,'multiline':False]['text':' ----Assert correct behavior when collection is hash sharded----','line_number':349,'multiline':False]['text':' Non-upsert case','line_number':351,'multiline':False]['text':' ----Assert correct error when changing a doc shard key conflicts with an orphan----','line_number':355,'multiline':False]['text':' ----Assert that specifying writeConcern succeeds----','line_number':377,'multiline':False]['text':' ----Assert retryable write result has WCE when the internal commitTransaction fails----','line_number':394,'multiline':False]['text':' Turn on failcommand fail point to fail CoordinateCommitTransaction','line_number':398,'multiline':False]['text':' ----Assert that updating the shard key in a batch with size > 1 fails----','line_number':431,'multiline':False]['text':' ----Multiple writes in txn-----','line_number':441,'multiline':False]['text':' Update two docs, updating one twice','line_number':443,'multiline':False]['text':' Check that doing $inc on doc A, then updating shard key for doc A, then $inc again only incs','line_number':462,'multiline':False]['text':' once','line_number':463,'multiline':False]['text':' Insert and $inc before moving doc','line_number':481,'multiline':False]