['text':'*
 * Tests that a change event which exceeds the 16MB limit will be split into multiple fragments.
 ','line_number':1,'multiline':True]['text':' Make sure the collection exists, because some validation might get skipped otherwise.','line_number':9,'multiline':False]['text':' Test that $changeStreamSplitLargeEvent cannot be used in a non-$changeStream pipeline.','line_number':13,'multiline':False]['text':' Test that $changeStreamSplitLargeEvent can only be used once in the pipeline.','line_number':23,'multiline':False]['text':' Test that $changeStreamSplitLargeEvent can only be the last stage in the pipeline.','line_number':37,'multiline':False]['text':' Compute the size for the large strings used in the subsequent tests.','line_number':50,'multiline':False]['text':' Insert two large documents into the test collection.','line_number':53,'multiline':False]['text':' For sharded passthrough suites with 2 or more shards, ensure the two inserted documents are on','line_number':59,'multiline':False]['text':' different shards.','line_number':60,'multiline':False]['text':' Enable pre- and post-images.','line_number':76,'multiline':False]['text':' Open a change stream without pre- and post-images.','line_number':80,'multiline':False]['text':' Record a resume token marking the start point of the test.','line_number':83,'multiline':False]['text':' Perform ~16MB updates which generate ~16MB change events and ~16MB post-images.','line_number':86,'multiline':False]['text':' Test that without pre- and post- images the $changeStreamSplitLargeEvent stage is not','line_number':91,'multiline':False]['text':' required.','line_number':92,'multiline':False]['text':' Test that for events which are not over the size limit, $changeStreamSplitLargeEvent does not','line_number':100,'multiline':False]['text':' change anything.','line_number':101,'multiline':False]['text':'*
 * Helper function to reconstruct the fragments of a split event into the original event. The
 * fragments are expected to be the next 'expectedFragmentCount' events retrieved from the cursor.
 * Also returns an array containing the resume tokens for each fragment.
 ','line_number':110,'multiline':True]['text':' Helper function to validate the reconstructed event.','line_number':131,'multiline':False]['text':' We declare 'resumeTokens' array outside of the for-scope to collect and share resume tokens','line_number':142,'multiline':False]['text':' across several test-cases.','line_number':143,'multiline':False]['text':' Test that for events which are over the size limit, $changeStreamSplitLargeEvent is','line_number':148,'multiline':False]['text':' required. Additionally, test that 'changeStreams.largeEventsFailed' metric is counted','line_number':149,'multiline':False]['text':' correctly.','line_number':150,'multiline':False]['text':' Ensure same behavior for replica sets and sharded clusters.','line_number':155,'multiline':False]['text':' We will hit the 'BSONObjectTooLarge' error once on each shard that encounters a large','line_number':164,'multiline':False]['text':' change event document. The error will occur maximum on 2 shards, because we trigger only','line_number':165,'multiline':False]['text':' 2 change events. The error might occur only on 1 shard when the collection is not sharded','line_number':166,'multiline':False]['text':' or due to the timing of exceptions on sharded clusters.','line_number':167,'multiline':False]['text':' Test that oversized events are split into fragments and can be reassembled to form the','line_number':173,'multiline':False]['text':' original event, and that the largeEventSplit metric counter is correctly incremented.','line_number':174,'multiline':False]['text':' Ensure same behavior for replica sets and sharded clusters.','line_number':179,'multiline':False]['text':' Test that we can filter on fields that sum to more than 16MB without throwing. Note that','line_number':199,'multiline':False]['text':' we construct this $match as an $or of the three large fields so that pipeline','line_number':200,'multiline':False]['text':' optimization cannot split this $match into multiple predicates and scatter them through','line_number':201,'multiline':False]['text':' the pipeline.','line_number':202,'multiline':False]['text':' Resume the stream from the second-last fragment and test that we see only the last','line_number':225,'multiline':False]['text':' fragment.','line_number':226,'multiline':False]['text':' Test that projecting out one of the large fields in the resumed pipeline changes the','line_number':240,'multiline':False]['text':' split such that the resume point won't be generated, and we therefore throw an exception.','line_number':241,'multiline':False]['text':' Ensure same behavior for replica sets and sharded clusters.','line_number':244,'multiline':False]['text':' Test that inhibiting pipeline optimization will cause $changeStreamSplitLargeEvent to throw','line_number':255,'multiline':False]['text':' if it cannot move to the correct position in the pipeline.','line_number':256,'multiline':False]['text':' Test that resuming from a split event token without requesting pre- and post- images fails,','line_number':270,'multiline':False]['text':' because the resulting event is too small to be split.','line_number':271,'multiline':False]['text':' Ensure same behavior for replica sets and sharded clusters.','line_number':273,'multiline':False]['text':' Test that resuming from split event without the $changeStreamSplitLargeEvent stage fails.','line_number':281,'multiline':False]