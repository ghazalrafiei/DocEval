['text':' Test that a pipeline of the form [{$changeStream: {}}, {$match: <predicate>}] with a predicate','line_number':1,'multiline':False]['text':' involving the 'documentKey' field can push down the $match and rewrite the $match and make it','line_number':2,'multiline':False]['text':' part of the oplog cursor's filter in order to filter out results as early as possible.','line_number':3,'multiline':False]['text':' @tags: [','line_number':4,'multiline':False]['text':'   requires_fcv_51,','line_number':5,'multiline':False]['text':'   requires_pipeline_optimization,','line_number':6,'multiline':False]['text':'   requires_sharding,','line_number':7,'multiline':False]['text':'   uses_change_streams,','line_number':8,'multiline':False]['text':'   change_stream_does_not_expect_txns,','line_number':9,'multiline':False]['text':'   assumes_unsharded_collection,','line_number':10,'multiline':False]['text':'   assumes_read_preference_unchanged','line_number':11,'multiline':False]['text':' ]','line_number':12,'multiline':False]['text':' Returns a newly created sharded collection, where shard key is 'shard'.','line_number':30,'multiline':False]['text':' shardKey ','line_number':31,'multiline':True]['text':' splitAt ','line_number':31,'multiline':True]['text':' Open a change stream and store the resume token. This resume token will be used to replay the','line_number':33,'multiline':False]['text':' stream after this point.','line_number':34,'multiline':False]['text':' A helper that opens a change stream on the whole cluster with the user supplied match expression','line_number':37,'multiline':False]['text':' 'userMatchExpr' and validates that:','line_number':38,'multiline':False]['text':' 1. for each shard, the events are seen in that order as specified in 'expectedResult'','line_number':39,'multiline':False]['text':' 2. the filtering is been done at oplog level','line_number':40,'multiline':False]['text':' 3. the number of docs returned by the oplog cursor on each shard matches what we expect','line_number':41,'multiline':False]['text':'    as specified in 'expectedOplogRetDocsForEachShard'.','line_number':42,'multiline':False]['text':' 4. the number of docs returned by each shard matches what we expect as specified by','line_number':43,'multiline':False]['text':'     'expectedChangeStreamDocsForEachShard'; and','line_number':44,'multiline':False]['text':' These operations will create oplog events. The change stream will apply several filters on these','line_number':59,'multiline':False]['text':' series of events and ensure that the '$match' expressions are rewritten correctly.','line_number':60,'multiline':False]['text':' Enable a failpoint that will prevent $expr match expressions from generating $_internalExprEq','line_number':79,'multiline':False]['text':' or similar expressions. This ensures that the following test-cases only exercise the $expr','line_number':80,'multiline':False]['text':' rewrites.','line_number':81,'multiline':False]['text':' Ensure that the '$match' on the 'insert', 'update', 'replace', and 'delete' operation types with','line_number':89,'multiline':False]['text':' various predicates are rewritten correctly.','line_number':90,'multiline':False]['text':' Test out a predicate on the full 'documentKey' field.','line_number':92,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':95,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':96,'multiline':True]['text':' Test out a predicate on 'documentKey._id'.','line_number':98,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':101,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':102,'multiline':True]['text':' Test out a predicate on 'documentKey.shard'.','line_number':104,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':107,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':108,'multiline':True]['text':' Test out a negated predicate on the full 'documentKey' field.','line_number':110,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':114,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':115,'multiline':True]['text':' Test out a negated predicate on 'documentKey._id'.','line_number':117,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':120,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':121,'multiline':True]['text':' Test out an {$eq: null} predicate on 'documentKey._id'.','line_number':123,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':126,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':127,'multiline':True]['text':' Test out a negated predicate on 'documentKey.shard'.','line_number':129,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':132,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':133,'multiline':True]['text':' Test out the '{$exists: false}' predicate on a field that doesn't exist in 'documentKey' but','line_number':135,'multiline':False]['text':' that does exist in some of the underlying documents.','line_number':136,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':139,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':140,'multiline':True]['text':' Test out the '{$eq: null}' predicate on a field that doesn't exist in 'documentKey' but that','line_number':142,'multiline':False]['text':' does exist in some of the underlying documents.','line_number':143,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':146,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':147,'multiline':True]['text':' Test out an $expr predicate on the full 'documentKey' field.','line_number':149,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':154,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':155,'multiline':True]['text':' Test out a negated predicate on the full 'documentKey' field.','line_number':157,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':165,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':166,'multiline':True]['text':' Test out an $expr predicate on 'documentKey._id'.','line_number':168,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':172,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':173,'multiline':True]['text':' Test out a negated $expr predicate on 'documentKey._id'.','line_number':175,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':179,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':180,'multiline':True]['text':' Test out an $expr predicate on 'documentKey.shard'.','line_number':182,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':186,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':187,'multiline':True]['text':' Test out a negated $expr predicate on 'documentKey.shard'.','line_number':189,'multiline':False]['text':' expectedOplogRetDocsForEachShard ','line_number':193,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':194,'multiline':True]['text':' expectedOplogRetDocsForEachShard ','line_number':199,'multiline':True]['text':' expectedChangeStreamDocsForEachShard ','line_number':200,'multiline':True]