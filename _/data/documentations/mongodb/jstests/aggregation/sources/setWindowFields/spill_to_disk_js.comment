['text':'
 * Test that spilling to disk in $setWindowFields works and returns the correct results.
 * @tags: [
 * requires_fcv_70,
 * requires_profiling,
 * assumes_read_concern_unchanged,
 * do_not_wrap_aggregations_in_facets,
 * not_allowed_with_signed_security_token,
 * ]
 ','line_number':1,'multiline':True]['text':' Doc size was found through logging the size in the SpillableCache. Partition sizes were chosen','line_number':25,'multiline':False]['text':' arbitrarily.','line_number':26,'multiline':False]['text':' Verify that this was a $setWindowFields stage as expected.','line_number':37,'multiline':False]['text':' Don't profile the setFCV command, which could be run during this test in the','line_number':51,'multiline':False]['text':' fcv_upgrade_downgrade_replica_sets_jscore_passthrough suite.','line_number':52,'multiline':False]['text':' Assert that spilling to disk doesn't affect the correctness of different accumulators.','line_number':84,'multiline':False]['text':' Spill to disk after 5 documents.','line_number':89,'multiline':False]['text':' Assert that spilling works across 'getMore' commands','line_number':97,'multiline':False]['text':' Turn off the failpoint for future tests.','line_number':114,'multiline':False]['text':' Assert a small, in memory, partition and a larger partition that requires spilling to disk','line_number':118,'multiline':False]['text':' returns correct results.','line_number':119,'multiline':False]['text':' Spill to disk after 5 documents. This number should be less than 'smallPartitionSize'.','line_number':121,'multiline':False]['text':' Create small partition.','line_number':125,'multiline':False]['text':' Create large partition.','line_number':129,'multiline':False]['text':' Run an aggregation that will keep all documents in the cache for all documents.','line_number':133,'multiline':False]['text':' Run an aggregation that will store too many documents in the function and force a spill.','line_number':164,'multiline':False]['text':' Spill to disk after 10 documents.','line_number':165,'multiline':False]['text':' Turn off the failpoint for future tests.','line_number':194,'multiline':False]['text':' Assert that 'usedDisk' is correctly set in an explain query.','line_number':198,'multiline':False]['text':' Don't drop the collection, since the set up in spillWithDifferentPartitions() is valid.','line_number':200,'multiline':False]['text':' Spill after 10 documents. This number should be bigger than the window size.','line_number':202,'multiline':False]['text':' Run an explain query where 'usedDisk' should be true.','line_number':205,'multiline':False]['text':' Run an explain query with the default memory limit, so 'usedDisk' should be false.','line_number':224,'multiline':False]['text':' Assert that situations that would require a large spill successfully write to disk.','line_number':232,'multiline':False]['text':' Spill to disk after 1000 documents.','line_number':242,'multiline':False]['text':' Run a document window over the whole collection to keep everything in the cache.','line_number':245,'multiline':False]['text':' Check that the command succeeded.','line_number':261,'multiline':False]['text':' Turn off the failpoint for future tests.','line_number':267,'multiline':False]['text':' Assert that usedDisk true is set to true if spilling occurs inside $lookup subpipline.','line_number':271,'multiline':False]['text':' Spill to disk after 5 documents.','line_number':277,'multiline':False]['text':' Turn off the failpoint for future tests.','line_number':299,'multiline':False]['text':' Assert that an error is raised when the pipeline exceeds the memory limit or disk use is not','line_number':316,'multiline':False]['text':' allowed.','line_number':317,'multiline':False]['text':' Don't drop the collection, since the set up in testUsedDiskInLookupPipeline() is valid.','line_number':319,'multiline':False]['text':' Decrease the maximum memory limit allowed. $push uses about ~950 to store all the values in','line_number':325,'multiline':False]['text':' the second partition.','line_number':326,'multiline':False]['text':' Assert the pipeline errors when exceeding maximum memory, even though the data spilled.','line_number':331,'multiline':False]['text':' Assert the pipeline errors when exceeding the maximum memory, even though the data spilled.','line_number':337,'multiline':False]['text':' Assert the pipeline fails when trying to spill, but 'allowDiskUse' is set to false.','line_number':343,'multiline':False]['text':' Reset the memory limit for other tests.','line_number':345,'multiline':False]['text':' Run the tests.','line_number':351,'multiline':False]['text':' We don't execute setWindowFields in a sharded explain.','line_number':354,'multiline':False]['text':' Reset profiler.','line_number':362,'multiline':False]