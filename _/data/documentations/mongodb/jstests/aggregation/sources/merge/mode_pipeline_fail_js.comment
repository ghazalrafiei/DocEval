['text':' Tests the behaviour of the $merge stage with whenMatched=[pipeline] and whenNotMatched=fail.','line_number':1,'multiline':False]['text':'','line_number':2,'multiline':False]['text':' Cannot implicitly shard accessed collections because a collection can be implictly created and','line_number':3,'multiline':False]['text':' exists when none is expected.','line_number':4,'multiline':False]['text':' Test $merge when some documents in the source collection don't have a matching document in','line_number':16,'multiline':False]['text':' the target collection.','line_number':17,'multiline':False]['text':' Single document without a match.','line_number':19,'multiline':False]['text':' Since there is no way to guarantee the ordering of the writes performed by $merge, it','line_number':24,'multiline':False]['text':' follows that the contents of the target collection will depend on when the write which','line_number':25,'multiline':False]['text':' triggers the MergeStageNoMatchingDocument error executes. As such, we test that the','line_number':26,'multiline':False]['text':' target collection contains some combination of its original documents and expected','line_number':27,'multiline':False]['text':' updates. In particular, it should be the case that each document has fields '_id' and','line_number':28,'multiline':False]['text':' 'b', but may or not have field 'x'. Additionally, 'b' should have the same value as','line_number':29,'multiline':False]['text':' '_id' and if 'x' is present, it should be equal to 2.','line_number':30,'multiline':False]['text':' Multiple documents without a match.','line_number':47,'multiline':False]['text':' Test $merge when all documents in the source collection have a matching document in the','line_number':57,'multiline':False]['text':' target collection.','line_number':58,'multiline':False]['text':' Source has a single element with a match in the target.','line_number':60,'multiline':False]['text':' Source has multiple documents with matches in the target.','line_number':69,'multiline':False]['text':' Test $merge when the source collection is empty. The target collection should not be','line_number':80,'multiline':False]['text':' modified.','line_number':81,'multiline':False]['text':' Test that variables referencing the fields in the source document can be specified in the','line_number':90,'multiline':False]['text':' 'let' argument and referenced in the update pipeline.','line_number':91,'multiline':False]