['text':'*
 * Tests the change collection periodic remover job.
 *
 * @tags: [requires_fcv_62]
 ','line_number':1,'multiline':True]['text':' Sleep interval in seconds for the change collection remover job.','line_number':16,'multiline':False]['text':' Number of seconds after which the documents in change collections will be expired.','line_number':18,'multiline':False]['text':' Number of seconds to sleep before inserting the next batch of documents in collections.','line_number':20,'multiline':False]['text':' Millisecond(s) that can be added to the wall time to advance it marginally.','line_number':22,'multiline':False]['text':' To imitate 1-by-1 deletion we specify a low amount of bytes per marker.','line_number':24,'multiline':False]['text':' Assert that the change collection contains all documents in 'expectedRetainedDocs' and no','line_number':40,'multiline':False]['text':' document in 'expectedDeletedDocs' for the collection 'stocksColl'.','line_number':41,'multiline':False]['text':' Assert that querying for 'expectedRetainedDocs' yields documents that are exactly the same as','line_number':49,'multiline':False]['text':' 'expectedRetainedDocs'.','line_number':50,'multiline':False]['text':' Assert that the query for any `expectedDeletedDocs` yields no results.','line_number':59,'multiline':False]['text':' Returns the operation time for the provided document 'doc'.','line_number':69,'multiline':False]['text':' Hard code a tenants information such that tenants can be identified deterministically.','line_number':76,'multiline':False]['text':' Create connections to the primary such that they have respective tenant ids stamped.','line_number':90,'multiline':False]['text':' Create a tenant connection associated with 'notUsedTenantId' such that only the tenant id exists','line_number':96,'multiline':False]['text':' in the replica set but no corresponding change collection exists. The purging job should safely','line_number':97,'multiline':False]['text':' ignore this tenant without any side-effects.','line_number':98,'multiline':False]['text':' Create connections to the secondary such that they have respective tenant ids stamped.','line_number':102,'multiline':False]['text':' Enable change streams for both tenants.','line_number':108,'multiline':False]['text':' Verify change streams state for all tenants.','line_number':112,'multiline':False]['text':' Get tenants respective change collections on the primary.','line_number':117,'multiline':False]['text':' Get tenants respective change collections on the secondary.','line_number':123,'multiline':False]['text':' Set the 'expireAfterSeconds' to 'kExpireAfterSeconds'.','line_number':129,'multiline':False]['text':' Get tenants respective collections for testing.','line_number':135,'multiline':False]['text':' Wait until the remover job hangs.','line_number':144,'multiline':False]['text':' Insert 5 documents to the 'stocks' collection owned by the 'stocksTenantId' that should be','line_number':152,'multiline':False]['text':' deleted.','line_number':153,'multiline':False]['text':' Insert 4 documents to the 'cities' collection owned by the 'citiesTenantId' that should be','line_number':162,'multiline':False]['text':' deleted.','line_number':163,'multiline':False]['text':' Insert documents to the 'stocks' collection and wait for the replication.','line_number':171,'multiline':False]['text':' Verify that the change collection for the 'stocks' tenant is consistent on both the primary and','line_number':175,'multiline':False]['text':' the secondary.','line_number':176,'multiline':False]['text':' expectedDeletedDocs ','line_number':179,'multiline':True]['text':' expectedRetainedDocs ','line_number':180,'multiline':True]['text':' expectedDeletedDocs ','line_number':183,'multiline':True]['text':' expectedRetainedDocs ','line_number':184,'multiline':True]['text':' Insert documents to the 'cities' collection and wait for the replication.','line_number':186,'multiline':False]['text':' Verify that the change collection for the 'cities' tenant is consistent on both the primary and','line_number':190,'multiline':False]['text':' the secondary.','line_number':191,'multiline':False]['text':' expectedDeletedDocs ','line_number':194,'multiline':True]['text':' expectedRetainedDocs ','line_number':195,'multiline':True]['text':' expectedDeletedDocs ','line_number':198,'multiline':True]['text':' expectedRetainedDocs ','line_number':199,'multiline':True]['text':' Insert 2 documents to the 'notUsed' collection such that the associated tenant becomes visible to','line_number':201,'multiline':False]['text':' the mongoD. The documents in these collections will not be consumed by the change stream.','line_number':202,'multiline':False]['text':' All document before and inclusive this wall time will be deleted by the purging job.','line_number':207,'multiline':False]['text':' Sleep for 'kSleepBetweenWritesSeconds' duration such that the next batch of inserts','line_number':210,'multiline':False]['text':' has a sufficient delay in their wall time relative to the previous batch.','line_number':211,'multiline':False]['text':' The documents for the 'stocks' collection owned by the 'stocksTenantId' that should not be','line_number':214,'multiline':False]['text':' deleted.','line_number':215,'multiline':False]['text':' The documents for the 'cities' collection owned by the 'citiesTenantId' that should not be','line_number':224,'multiline':False]['text':' deleted.','line_number':225,'multiline':False]['text':' Insert documents to the 'stocks' collection and wait for the replication.','line_number':233,'multiline':False]['text':' Verify that state of change collection both at the primary and the secondary.','line_number':237,'multiline':False]['text':' expectedDeletedDocs ','line_number':240,'multiline':True]['text':' expectedRetainedDocs ','line_number':241,'multiline':True]['text':' expectedDeletedDocs ','line_number':244,'multiline':True]['text':' expectedRetainedDocs ','line_number':245,'multiline':True]['text':' Insert documents to the 'cities' collection and wait for the replication.','line_number':247,'multiline':False]['text':' Verify that state of change collection both at the primary and the secondary.','line_number':251,'multiline':False]['text':' expectedDeletedDocs ','line_number':254,'multiline':True]['text':' expectedRetainedDocs ','line_number':255,'multiline':True]['text':' expectedDeletedDocs ','line_number':258,'multiline':True]['text':' expectedRetainedDocs ','line_number':259,'multiline':True]['text':' Calculate the 'currentWallTime' such that only the first batch of inserted documents','line_number':261,'multiline':False]['text':' should be expired, ie.: 'lastExpiredDocumentTime' + 'kExpireAfterSeconds' <','line_number':262,'multiline':False]['text':' 'currentWallTime' < first-non-expired-document.','line_number':263,'multiline':False]['text':' Unblock the change collection remover job such that it picks up on the injected','line_number':270,'multiline':False]['text':' 'currentWallTime'.','line_number':271,'multiline':False]['text':' Wait until the remover job has retrieved the injected 'currentWallTime' and reset the first','line_number':275,'multiline':False]['text':' failpoint.','line_number':276,'multiline':False]['text':' Wait for a complete cycle of the TTL job.','line_number':280,'multiline':False]['text':' Assert that only required documents are retained in change collections on the primary.','line_number':287,'multiline':False]['text':' Wait for the replication to complete and assert that the expired documents have also been deleted','line_number':293,'multiline':False]['text':' from the secondary and the state is consistent with the primary.','line_number':294,'multiline':False]