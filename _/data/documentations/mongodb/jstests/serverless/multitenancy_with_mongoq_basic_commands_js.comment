['text':' Test basic db operations in multitenancy using a securityToken.','line_number':1,'multiline':False]['text':' In this jstest, the collection (defined by kCollName) and the document "{_id: 0, a: 1, b: 1}"','line_number':47,'multiline':False]['text':' for the tenant (defined by kTenant) will be reused by all command tests. So, any test which','line_number':48,'multiline':False]['text':' changes the collection name or document should reset it.','line_number':49,'multiline':False]['text':' Test commands using a security token for one tenant.','line_number':51,'multiline':False]['text':' Create a user for kTenant and then set the security token on the connection.','line_number':53,'multiline':False]['text':' Logout the root user to avoid multiple authentication.','line_number':63,'multiline':False]['text':' Create a collection for the tenant kTenant and then insert into it.','line_number':66,'multiline':False]['text':' Find the document and call getMore on the cursor','line_number':71,'multiline':False]['text':' Add additional document in order to have two batches for getMore','line_number':73,'multiline':False]['text':' Test the aggregate command.','line_number':87,'multiline':False]['text':' Find and modify the document.','line_number':95,'multiline':False]['text':' Create a view on the collection, and check that listCollections sees the original','line_number':105,'multiline':False]['text':' collection, the view, and the system.views collection.  Then, call $listCatalog on','line_number':106,'multiline':False]['text':' the collection and views and validate the results.','line_number':107,'multiline':False]['text':' Get catalog without specifying target collection (collectionless).','line_number':130,'multiline':False]['text':' Check that the resulting array of catalog entries contains our target databases and','line_number':135,'multiline':False]['text':' namespaces.','line_number':136,'multiline':False]['text':' Also check that the resulting array contains views specific to our target database.','line_number':140,'multiline':False]['text':' Get catalog when specifying our target collection, which should only return one','line_number':146,'multiline':False]['text':' result.','line_number':147,'multiline':False]['text':' Check that the resulting array of catalog entries contains our target databases and','line_number':152,'multiline':False]['text':' namespaces.','line_number':153,'multiline':False]['text':' Test explain command with find','line_number':159,'multiline':False]['text':' Test count and distinct command.','line_number':166,'multiline':False]['text':' Test count on view collection.','line_number':180,'multiline':False]['text':' Rename the collection.','line_number':187,'multiline':False]['text':' Verify the the renamed collection by findAndModify existing documents.','line_number':195,'multiline':False]['text':' Reset the collection name and document data.','line_number':200,'multiline':False]['text':' ListDatabases only returns databases associated with kTenant.','line_number':207,'multiline':False]['text':' Create databases for kTenant. A new database is implicitly created when a collection','line_number':209,'multiline':False]['text':' is created.','line_number':210,'multiline':False]['text':' Test the collStats command.','line_number':222,'multiline':False]['text':' perform the same test on a timeseries collection','line_number':226,'multiline':False]['text':' Drop the collection, and then the database. Check that listCollections no longer returns','line_number':236,'multiline':False]['text':' the 3 collections.','line_number':237,'multiline':False]['text':' Drop the collection, and check that the "ns" returned is serialized correctly.','line_number':239,'multiline':False]['text':' Reset the collection and document.','line_number':256,'multiline':False]['text':' Test that transactions can be run successfully.','line_number':261,'multiline':False]['text':' Reset the collection and document.','line_number':273,'multiline':False]['text':' Test createIndexes, listIndexes and dropIndexes command.','line_number':278,'multiline':False]['text':' Drop those new created indexes.','line_number':310,'multiline':False]['text':' Test aggregation stage commands','line_number':321,'multiline':False]['text':' Create a number of collections and entries used to test agg stages','line_number':323,'multiline':False]['text':' Set up assertion targets','line_number':345,'multiline':False]['text':' $graphLookup agg stage','line_number':357,'multiline':False]['text':' $out agg stage using string input for collection name','line_number':379,'multiline':False]['text':' Because we're using the same graphLookup stage from the first test, we should see the','line_number':386,'multiline':False]['text':' exact same results but stored in kCollC','line_number':387,'multiline':False]['text':' $out agg stage using object input for collection name','line_number':396,'multiline':False]['text':' Because we're using the same graphLookup stage from the first test, we should see the','line_number':403,'multiline':False]['text':' exact same results but stored in kCollD','line_number':404,'multiline':False]['text':' $lookup agg stage using nested pipeline input','line_number':413,'multiline':False]['text':' $merge agg stage','line_number':430,'multiline':False]['text':' Merging kCollA into a new collection kCollD should give us matching contents','line_number':437,'multiline':False]['text':' $unionWith agg stage','line_number':445,'multiline':False]['text':' $collStats agg stage','line_number':456,'multiline':False]['text':' create a new collection to isolate stats results from other tests','line_number':459,'multiline':False]['text':' Also check the next() cursor results.','line_number':477,'multiline':False]['text':' Clean up remaining test collections.','line_number':490,'multiline':False]['text':' Test the validate command.','line_number':495,'multiline':False]['text':' Test commands using a security token for a different tenant and check that this tenant cannot','line_number':503,'multiline':False]['text':' access the other tenant's collection.','line_number':504,'multiline':False]['text':' Create a user for a different tenant, and set the security token on the connection.','line_number':506,'multiline':False]['text':' We reuse the same connection, but swap the token out.','line_number':507,'multiline':False]['text':' ListDatabases with securityToken of kOtherTenant cannot access databases created by','line_number':555,'multiline':False]['text':' kTenant.','line_number':556,'multiline':False]['text':' Only the 'admin' db exists','line_number':559,'multiline':False]['text':' Attempt to drop the database, then check it was not dropped.','line_number':565,'multiline':False]['text':' Run listCollections using the original user's security token to see the collection','line_number':568,'multiline':False]['text':' exists.','line_number':569,'multiline':False]['text':' Test aggregation stage commands','line_number':578,'multiline':False]['text':' Create a number of collections and entries used to test agg stages','line_number':580,'multiline':False]['text':' Set up agg stage input documents','line_number':602,'multiline':False]['text':' Set up assertion targets','line_number':607,'multiline':False]['text':' $lookup agg stage that exercises query planner.','line_number':614,'multiline':False]['text':' Test commands using a privleged user with an unsigned security token and check that the user can','line_number':627,'multiline':False]['text':' still run commands on the doc when on the correct connection, but not when on a different','line_number':628,'multiline':False]['text':' connection.','line_number':629,'multiline':False]['text':' Find and modify the document','line_number':641,'multiline':False]['text':' Reset document data.','line_number':651,'multiline':False]['text':' Rename the collection','line_number':656,'multiline':False]['text':' Verify the the renamed collection by findAndModify existing documents.','line_number':664,'multiline':False]['text':' Reset the collection name and document data.','line_number':669,'multiline':False]['text':' Test collMod','line_number':677,'multiline':False]['text':' Create the index used for collMod','line_number':679,'multiline':False]['text':' Modify the index with the tenantId','line_number':687,'multiline':False]['text':' Drop the index created','line_number':693,'multiline':False]['text':' Test dbCheck command.','line_number':697,'multiline':False]['text':' This should fail since dbCheck is not supporting using a security token.','line_number':698,'multiline':False]