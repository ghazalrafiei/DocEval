['text':'*
 * Verify that a non force replica set reconfig waits for all oplog entries committed in the
 * previous config to be committed in the current config.
 *
 ','line_number':1,'multiline':True]['text':' Make the secondary unelectable.','line_number':11,'multiline':False]['text':' The default WC is majority and stopServerReplication will prevent satisfying any majority writes.','line_number':20,'multiline':False]['text':' This makes the test run faster.','line_number':24,'multiline':False]['text':' Create collection.','line_number':28,'multiline':False]['text':' Stop replication on the secondary.','line_number':32,'multiline':False]['text':' Reconfig down to a 1 node replica set.','line_number':35,'multiline':False]['text':' Remove the second node.','line_number':38,'multiline':False]['text':'','line_number':43,'multiline':False]['text':' Below we start out in config C1 = {n0}, try to reconfig to C2 = {n0,n1}, and then to C3 =','line_number':44,'multiline':False]['text':' {n0,n1}. When we move from C1 -> C2, the last committed op in C1 cannot become committed in C2,','line_number':45,'multiline':False]['text':' because replication is paused on n1. We will install C2 and succeed, but the op is yet to','line_number':46,'multiline':False]['text':' commit in C2. If we try then to execute another reconfig to move from C2 -> C3, it should time','line_number':47,'multiline':False]['text':' out since the last committed op from C1 is still not committed in C2. Once replication is','line_number':48,'multiline':False]['text':' restarted on n1, the op can commit in C2 and we can complete a reconfig to C3.','line_number':49,'multiline':False]['text':'','line_number':50,'multiline':False]['text':' {n0}','line_number':53,'multiline':False]['text':' {n0, n1}','line_number':56,'multiline':False]['text':' {n0, n1}','line_number':60,'multiline':False]['text':' Leave one for the 'newlyAdded' automatic reconfig','line_number':62,'multiline':False]['text':' We expect this to succeed but the last committed op from C1 cannot become','line_number':68,'multiline':False]['text':' committed in C2, so the new config is not committed.','line_number':69,'multiline':False]['text':' force ','line_number':74,'multiline':True]['text':' Wait until the config has propagated to the secondary and the primary has learned of it, so that','line_number':79,'multiline':False]['text':' the config replication check is satisfied.','line_number':80,'multiline':False]['text':' Reconfig should time out since we have not committed the last committed op from C1 in C2.','line_number':83,'multiline':False]['text':' Make sure we can connect to the secondary after it was REMOVED.','line_number':88,'multiline':False]['text':' Let the last committed op from C1 become committed in the current config.','line_number':91,'multiline':False]['text':' Now that we can commit the op in the new config, reconfig should succeed.','line_number':95,'multiline':False]['text':'','line_number':100,'multiline':False]['text':' Test that a primary executing a reconfig waits for the first op time of its term to commit if it','line_number':101,'multiline':False]['text':' is newer than the latest committed op in a previous config.','line_number':102,'multiline':False]['text':'','line_number':103,'multiline':False]['text':' Pause replication on secondary so ops don't commit in this config.','line_number':108,'multiline':False]['text':' A reconfig should succeed now since all ops from previous configs are committed in the current','line_number':111,'multiline':False]['text':' config.','line_number':112,'multiline':False]['text':' Step down the primary and then step it back up so that it writes a log entry in a newer term.','line_number':118,'multiline':False]['text':' This new op won't become committed yet, though, since we have paused replication.','line_number':119,'multiline':False]['text':' end the stepdown period.','line_number':121,'multiline':False]['text':' Reconfig should now fail since the primary has not yet committed an op in its term.','line_number':126,'multiline':False]['text':' Wait for the config with the new term to propagate.','line_number':129,'multiline':False]['text':' Even though the current config has been replicated to all nodes, reconfig should still fail since','line_number':132,'multiline':False]['text':' the primary has not yet committed an op in its term.','line_number':133,'multiline':False]['text':' Restart server replication to let the primary commit an op.','line_number':138,'multiline':False]['text':' Reconfig should now succeed.','line_number':142,'multiline':False]