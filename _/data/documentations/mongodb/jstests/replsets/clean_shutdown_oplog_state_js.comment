['text':' SERVER-25071 We now require secondaries to finish clean shutdown with a completely clean state.','line_number':1,'multiline':False]['text':' WARNING: this test does not always fail deterministically. It is possible for a bug to be','line_number':2,'multiline':False]['text':' present without this test failing. In particular if the rst.stop(1) doesn't execute mid-batch,','line_number':3,'multiline':False]['text':' it isn't fully exercising the code. However, if the test fails there is definitely a bug.','line_number':4,'multiline':False]['text':'','line_number':5,'multiline':False]['text':' @tags: [','line_number':6,'multiline':False]['text':'   requires_persistence,','line_number':7,'multiline':False]['text':'   requires_majority_read_concern,','line_number':8,'multiline':False]['text':' ]','line_number':9,'multiline':False]['text':' Skip db hash check because secondary restarted as standalone.','line_number':12,'multiline':False]['text':' Waits for PRIMARY state.','line_number':28,'multiline':False]['text':' The default WC is majority and stopServerReplication will prevent satisfying any majority writes.','line_number':30,'multiline':False]['text':' Stop replication on the secondary.','line_number':34,'multiline':False]['text':' Prime the main collection.','line_number':37,'multiline':False]['text':' Start a w:2 write that will block until replication is resumed.','line_number':40,'multiline':False]['text':' Insert a lot of data in increasing order to test.coll.','line_number':46,'multiline':False]['text':' Resume replication and wait for ops to start replicating, then do a clean shutdown on the','line_number':53,'multiline':False]['text':' secondary.','line_number':54,'multiline':False]['text':' wait a bit to increase the chances of killing mid-batch.','line_number':57,'multiline':False]['text':' Create a copy of the secondary nodes dbpath for diagnostic purposes.','line_number':60,'multiline':False]['text':' Restart the secondary as a standalone node.','line_number':66,'multiline':False]['text':' Following clean shutdown of a node, the oplog must exactly match the applied operations.','line_number':80,'multiline':False]['text':' Additionally, the begin field must not be in the minValid document, the ts must match the','line_number':81,'multiline':False]['text':' top of the oplog (SERVER-25353), and the oplogTruncateAfterPoint must be null (SERVER-7200','line_number':82,'multiline':False]['text':' and SERVER-25071).','line_number':83,'multiline':False]