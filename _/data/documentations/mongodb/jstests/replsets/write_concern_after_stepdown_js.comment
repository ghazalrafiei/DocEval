['text':'
 * Tests that heartbeats containing writes from a different branch of history can't cause a stale
 * primary to incorrectly acknowledge a w:majority write that's about to be rolled back.
 ','line_number':1,'multiline':True]['text':' SERVER-20844 ReplSetTest starts up a single node replica set then reconfigures to the correct','line_number':30,'multiline':False]['text':' size for faster startup, so nodes[0] is always the first primary.','line_number':31,'multiline':False]['text':' The default WC is majority and stopServerReplication will prevent satisfying any majority writes.','line_number':37,'multiline':False]['text':' Wait for all data bearing nodes to get up to date.','line_number':42,'multiline':False]['text':' Stop the secondaries from replicating.','line_number':46,'multiline':False]['text':' Stop the primary from calling into awaitReplication().','line_number':48,'multiline':False]['text':' Stop the primary from being able to complete stepping down.','line_number':51,'multiline':False]['text':' Run hello command with 'hangUpOnStepDown' set to false to mark this connection as','line_number':57,'multiline':False]['text':' one that shouldn't be closed when the node steps down.  This makes it easier to detect','line_number':58,'multiline':False]['text':' the error returned by the write concern failure.','line_number':59,'multiline':False]['text':' Ensure the parallel shell hangs on the majority write before stepping the primary down.','line_number':72,'multiline':False]['text':' Allow the secondaries to replicate again.','line_number':80,'multiline':False]['text':' Only allow the old primary to connect to the other nodes, not the other way around.','line_number':90,'multiline':False]['text':' This is so that the old priamry will detect that it needs to step down and step itself down,','line_number':91,'multiline':False]['text':' rather than one of the other nodes detecting this and sending it a replSetStepDown command,','line_number':92,'multiline':False]['text':' which would cause the old primary to kill all operations and close all connections, making','line_number':93,'multiline':False]['text':' the way that the insert in the parallel shell fails be nondeterministic.  Rather than','line_number':94,'multiline':False]['text':' handling all possible failure modes in the parallel shell, allowing heartbeat connectivity in','line_number':95,'multiline':False]['text':' only one direction makes it easier for the test to fail deterministically.','line_number':96,'multiline':False]['text':' Allow the old primary to finish stepping down so that shutdown can finish.','line_number':100,'multiline':False]['text':' Node 0 will go into rollback after it steps down.  We want to wait for that to happen, and','line_number':110,'multiline':False]['text':' then complete, in order to get a clean shutdown.','line_number':111,'multiline':False]