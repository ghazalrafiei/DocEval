['text':'*
 *    Copyright (C) 2018-present MongoDB, Inc.
 *
 *    This program is free software: you can redistribute it and/or modify
 *    it under the terms of the Server Side Public License, version 1,
 *    as published by MongoDB, Inc.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    Server Side Public License for more details.
 *
 *    You should have received a copy of the Server Side Public License
 *    along with this program. If not, see
 *    <http://www.mongodb.com/licensing/server-side-public-license>.
 *
 *    As a special exception, the copyright holders give permission to link the
 *    code of portions of this program with the OpenSSL library under certain
 *    conditions as described in each individual source file and distribute
 *    linked combinations including the program with the OpenSSL library. You
 *    must comply with the Server Side Public License in all respects for
 *    all of the code used other than as permitted herein. If you modify file(s)
 *    with this exception, you may extend this exception to your version of the
 *    file(s), but you are not obligated to do so. If you do not wish to do so,
 *    delete this exception statement from your version. If you delete this
 *    exception statement from all source files in the program, then also delete
 *    it in the license file.
 ','line_number':1,'multiline':True]['text':' Set 'changeSyncSourceThresholdMillis' to 0 by default to avoid running ping time checks','line_number':136,'multiline':False]['text':' in unrelated tests. Tests for changing a sync source due to long ping times should set','line_number':137,'multiline':False]['text':' this param.','line_number':138,'multiline':False]['text':' Update config and set selfIndex','line_number':248,'multiline':False]['text':' If "now" is passed in, set _now to now+1','line_number':249,'multiline':False]['text':' Make the ReplSetMetadata coming from sync source.','line_number':268,'multiline':False]['text':' Only set visibleOpTime, primaryIndex and syncSourceIndex','line_number':269,'multiline':False]['text':' Make the OplogQueryMetadata coming from sync source.','line_number':285,'multiline':False]['text':' Only set lastAppliedOpTime, primaryIndex and syncSourceIndex','line_number':286,'multiline':False]['text':' timed out heartbeat to mark a node as down','line_number':321,'multiline':False]['text':' if we do not have an index in the config, we should get an empty syncsource','line_number':399,'multiline':False]['text':' member h2 is the furthest ahead','line_number':416,'multiline':False]['text':' We start with no sync source','line_number':421,'multiline':False]['text':' Fail due to insufficient number of pings','line_number':424,'multiline':False]['text':' Record 2nd round of pings to allow choosing a new sync source; all members equidistant','line_number':429,'multiline':False]['text':' Should choose h2, since it is furthest ahead','line_number':434,'multiline':False]['text':' h3 becomes further ahead, so it should be chosen','line_number':439,'multiline':False]['text':' h3 becomes an invalid candidate for sync source; should choose h2 again','line_number':445,'multiline':False]['text':' h3 back in SECONDARY and ahead','line_number':451,'multiline':False]['text':' h3 goes down','line_number':457,'multiline':False]['text':' h3 back up and ahead','line_number':462,'multiline':False]['text':' This node is lagged further than maxSyncSourceLagSeconds.','line_number':525,'multiline':False]['text':' Record 2nd round of pings to allow choosing a new sync source','line_number':540,'multiline':False]['text':' Should choose primary first; it's closest','line_number':577,'multiline':False]['text':' Primary goes far far away','line_number':581,'multiline':False]['text':' Should choose h4.  (if an arbiter has an oplog, it's a valid sync source)','line_number':588,'multiline':False]['text':' h6 is not considered because it is outside the maxSyncLagSeconds window.','line_number':589,'multiline':False]['text':' h4 goes down; should choose h1','line_number':593,'multiline':False]['text':' Primary and h1 go down; should choose h6','line_number':598,'multiline':False]['text':' h6 goes down; should choose h5','line_number':605,'multiline':False]['text':' h5 goes down; should choose h3','line_number':610,'multiline':False]['text':' h3 goes down; no sync source candidates remain','line_number':615,'multiline':False]['text':' old term','line_number':644,'multiline':False]['text':' Record 2nd round of pings to allow choosing a new sync source','line_number':647,'multiline':False]['text':' old term','line_number':656,'multiline':False]['text':' h1 goes down; no sync source candidates remain','line_number':662,'multiline':False]['text':' Two rounds of heartbeat pings from each member.','line_number':683,'multiline':False]['text':' Should choose h3 as it is a voter','line_number':689,'multiline':False]['text':' Since a new sync source was chosen, recentSyncSourceChanges should be updated','line_number':694,'multiline':False]['text':' Can't choose h2 as it is not a voter','line_number':698,'multiline':False]['text':' Since no new sync source was chosen, recentSyncSourceChanges shouldn't be updated.','line_number':703,'multiline':False]['text':' Should choose h3 as it is a voter, and ahead','line_number':707,'multiline':False]['text':' Two rounds of heartbeat pings from each member.','line_number':727,'multiline':False]['text':' No primary situation: should choose h2 sync source.','line_number':749,'multiline':False]['text':' Become primary','line_number':754,'multiline':False]['text':' Choose same sync source even when primary.','line_number':758,'multiline':False]['text':' two rounds of heartbeat pings from each member','line_number':780,'multiline':False]['text':' force should overrule other defaults','line_number':790,'multiline':False]['text':' force should cause shouldChangeSyncSource() to return true','line_number':794,'multiline':False]['text':' even if the currentSource is the force target','line_number':795,'multiline':False]['text':' force should only work for one call to chooseNewSyncSource','line_number':809,'multiline':False]['text':' Two rounds of heartbeat pings from each member.','line_number':828,'multiline':False]['text':' Should choose second best choice now that h3 is denylisted.','line_number':856,'multiline':False]['text':' After time has passed, should go back to original sync source','line_number':859,'multiline':False]['text':' Can't choose any sync source now.','line_number':907,'multiline':False]['text':' After time has passed, should go back to the primary','line_number':910,'multiline':False]['text':' We use readPreference nearest only when in initialSync','line_number':927,'multiline':False]['text':' No primary situation: should choose no sync source.','line_number':951,'multiline':False]['text':' Since no new sync source was chosen, recentSyncSourceChanges shouldn't be updated.','line_number':957,'multiline':False]['text':' Add primary','line_number':961,'multiline':False]['text':' h3 is primary, but its last applied isn't as up-to-date as ours, so it cannot be chosen','line_number':970,'multiline':False]['text':' as the sync source.','line_number':971,'multiline':False]['text':' Since no new sync source was chosen, recentSyncSourceChanges shouldn't be updated.','line_number':977,'multiline':False]['text':' Update the primary's position.','line_number':981,'multiline':False]['text':' h3 is primary and should be chosen as the sync source, despite being further away than h2','line_number':988,'multiline':False]['text':' and the primary (h3) being at our most recently applied optime.','line_number':989,'multiline':False]['text':' Since a new sync source was chosen, recentSyncSourceChanges should be updated.','line_number':996,'multiline':False]['text':' Become primary: should not choose self as sync source.','line_number':1000,'multiline':False]['text':' We use readPreference nearest only when in initialSync','line_number':1026,'multiline':False]['text':' No secondary situation: should choose no sync source.','line_number':1050,'multiline':False]['text':' Add secondary','line_number':1056,'multiline':False]['text':' h2 is a secondary, but its last applied isn't more up-to-date than ours, so it cannot be','line_number':1063,'multiline':False]['text':' chosen as the sync source.','line_number':1064,'multiline':False]['text':' Update h2's position.','line_number':1070,'multiline':False]['text':' h2 is a secondary and should be chosen as the sync source despite being further away than the','line_number':1077,'multiline':False]['text':' primary (h3).','line_number':1078,'multiline':False]['text':' Become primary: should choose nearest valid secondary as sync source.','line_number':1084,'multiline':False]['text':' We use readPreference nearest only when in initialSync','line_number':1110,'multiline':False]['text':' No primary situation: should choose h2.','line_number':1134,'multiline':False]['text':' Make sure that recentSyncSourceChanges is updated even though the primary is not chosen as','line_number':1141,'multiline':False]['text':' the next sync source.','line_number':1142,'multiline':False]['text':' Add primary','line_number':1146,'multiline':False]['text':' h3 is primary, but its last applied isn't as up-to-date as ours, so it cannot be chosen','line_number':1155,'multiline':False]['text':' as the sync source.','line_number':1156,'multiline':False]['text':' Make sure that recentSyncSourceChanges is updated even though the primary is not chosen as','line_number':1163,'multiline':False]['text':' the next sync source.','line_number':1164,'multiline':False]['text':' Update the primary's position.','line_number':1168,'multiline':False]['text':' h3 is primary and should be chosen as the sync source, despite being further away than h2','line_number':1175,'multiline':False]['text':' and the primary (h3) being at our most recently applied optime.','line_number':1176,'multiline':False]['text':' Make sure that recentSyncSourceChanges is updated when the primary is chosen as the next','line_number':1183,'multiline':False]['text':' sync source.','line_number':1184,'multiline':False]['text':' Sanity check: the same test as above should return the secondary "h2" if primary is not','line_number':1189,'multiline':False]['text':' preferred.','line_number':1190,'multiline':False]['text':' Become primary: should choose closest secondary (h2).','line_number':1196,'multiline':False]['text':' We use readPreference nearest only when in initialSync','line_number':1222,'multiline':False]['text':' No secondary situation: should choose primary as sync source','line_number':1246,'multiline':False]['text':' Add secondary','line_number':1252,'multiline':False]['text':' h2 is a secondary, but its last applied isn't more up-to-date than ours, so it cannot be','line_number':1259,'multiline':False]['text':' chosen as the sync source.','line_number':1260,'multiline':False]['text':' Update h2's position.','line_number':1266,'multiline':False]['text':' h2 is a secondary and should be chosen as the sync source despite being further away than the','line_number':1273,'multiline':False]['text':' primary (h3).','line_number':1274,'multiline':False]['text':' Sanity check: If we weren't preferring the secondary, we'd choose the primary in this','line_number':1280,'multiline':False]['text':' situation.','line_number':1281,'multiline':False]['text':' Become primary: should choose nearest valid secondary as sync source.','line_number':1287,'multiline':False]['text':' Generate enough heartbeats to select a sync source below','line_number':1315,'multiline':False]['text':' Good state setup done','line_number':1340,'multiline':False]['text':' Mark nodes down, ensure that we have no source and are secondary','line_number':1342,'multiline':False]['text':' Mark nodes down + unauth, ensure that we have no source and are secondary','line_number':1349,'multiline':False]['text':' Having an auth error but with another node up should bring us out of RECOVERING','line_number':1356,'multiline':False]['text':' Test that the heartbeat that brings us from RECOVERING to SECONDARY doesn't initiate','line_number':1361,'multiline':False]['text':' an election (SERVER-17164)','line_number':1362,'multiline':False]['text':' if we do not have an index in the config, we should get ErrorCodes::NotSecondary','line_number':1390,'multiline':False]['text':' Test trying to sync from another node when we are an arbiter','line_number':1401,'multiline':False]['text':' Try to sync while PRIMARY','line_number':1442,'multiline':False]['text':' Try to sync from self','line_number':1510,'multiline':False]['text':' Try to sync from an arbiter','line_number':1543,'multiline':False]['text':' Try to sync from a node that doesn't build indexes','line_number':1575,'multiline':False]['text':' Try to sync from a member that is down','line_number':1608,'multiline':False]['text':' Sync successfully from a member that is stale','line_number':1645,'multiline':False]['text':' Sync successfully from an up-to-date member','line_number':1687,'multiline':False]['text':' node goes down between forceSync and chooseNewSyncSource','line_number':1733,'multiline':False]['text':' Try to sync from a member that is unauth'd','line_number':1773,'multiline':False]['text':' Test trying to sync from another node','line_number':1791,'multiline':False]['text':' Sync successfully from an up-to-date member.','line_number':1835,'multiline':False]['text':' Sync successfully from another up-to-date member.','line_number':1851,'multiline':False]['text':' This test starts by configuring a TopologyCoordinator as a member of a 4 node replica','line_number':1859,'multiline':False]['text':' set, with each node in a different state.','line_number':1860,'multiline':False]['text':' The first node is DOWN, as if we tried heartbeating them and it failed in some way.','line_number':1861,'multiline':False]['text':' The second node is in state SECONDARY, as if we've received a valid heartbeat from them.','line_number':1862,'multiline':False]['text':' The third node is in state UNKNOWN, as if we've not yet had any heartbeating activity','line_number':1863,'multiline':False]['text':' with them yet.  The fourth node is PRIMARY and corresponds to ourself, which gets its','line_number':1864,'multiline':False]['text':' information for replSetGetStatus from a different source than the nodes that aren't','line_number':1865,'multiline':False]['text':' ourself.  After this setup, we call prepareStatusResponse and make sure that the fields','line_number':1866,'multiline':False]['text':' returned for each member match our expectations.','line_number':1867,'multiline':False]['text':' Now that the replica set is setup, put the members into the states we want them in.','line_number':1908,'multiline':False]['text':' Now node 0 is down, node 1 is up, and for node 2 we have no heartbeat data yet.','line_number':1932,'multiline':False]['text':' Test results for all non-self members','line_number':1950,'multiline':False]['text':' Test member 0, the node that's DOWN','line_number':1973,'multiline':False]['text':' Test member 1, the node that's SECONDARY','line_number':1991,'multiline':False]['text':' Test member 2, the node that's UNKNOWN','line_number':2010,'multiline':False]['text':' Now test results for ourself, the PRIMARY','line_number':2025,'multiline':False]['text':' Test no lastStableRecoveryTimestamp field.','line_number':2052,'multiline':False]['text':' This tests that writeMajorityCount differs from majorityVoteCount in replSetGetStatus when','line_number':2073,'multiline':False]['text':' the number of non-arbiter voters is less than majorityVoteCount.','line_number':2074,'multiline':False]['text':' This test verifies that `votingMembersCount` and `writableVotingMembersCount` in','line_number':2115,'multiline':False]['text':' replSetGetStatus are set correctly when arbiters and non-voting nodes are included in the','line_number':2116,'multiline':False]['text':' replica set.','line_number':2117,'multiline':False]['text':' This test starts by configuring a TopologyCoordinator to NOT be a member of a 3 node','line_number':2150,'multiline':False]['text':' replica set. Then running prepareStatusResponse should fail.','line_number':2151,'multiline':False]['text':' This one is not part of the replica set.','line_number':2166,'multiline':False]['text':' This tests that arbiters issue heartbeats at electionTimeout/2 frequencies','line_number':2184,'multiline':False]['text':'*
 * Checks that the queue contains the expected entries in the correct order.
 ','line_number':2215,'multiline':True]['text':' Make this two hours before now.','line_number':2261,'multiline':False]['text':' Make sure to restore the default value at the end of this test.','line_number':2276,'multiline':False]['text':' Make sure to restore the default value at the end of this test.','line_number':2300,'multiline':False]['text':' set up args with incorrect replset name','line_number':2382,'multiline':False]['text':' only protocolVersion should be set in this failure case','line_number':2395,'multiline':False]['text':' reconfig self out of set','line_number':2401,'multiline':False]['text':' only protocolVersion should be set in this failure case','line_number':2420,'multiline':False]['text':' set up args with our id as the senderId','line_number':2425,'multiline':False]['text':' only protocolVersion should be set in this failure case','line_number':2435,'multiline':False]['text':' set up args and acknowledge sender','line_number':2440,'multiline':False]['text':' prepare response and check the results','line_number':2445,'multiline':False]['text':' this change to true because we can now see a majority, unlike in the previous cases','line_number':2449,'multiline':False]['text':' default term of topology coordinator is -1','line_number':2453,'multiline':False]['text':' set up args without a senderID','line_number':2460,'multiline':False]['text':' prepare response and check the results','line_number':2467,'multiline':False]['text':' set up args with a senderID which is not present in our config','line_number':2479,'multiline':False]['text':' prepare response and check the results','line_number':2487,'multiline':False]['text':' set up args with a config version lower than ours','line_number':2499,'multiline':False]['text':' prepare response and check the results','line_number':2508,'multiline':False]['text':' set up args with a config version lower than ours','line_number':2521,'multiline':False]['text':' prepare response and check the results','line_number':2530,'multiline':False]['text':' set up args with a config version lower than ours','line_number':2543,'multiline':False]['text':' prepare response and check the results','line_number':2552,'multiline':False]['text':' set up args with a config version lower than ours','line_number':2565,'multiline':False]['text':' prepare response and check the results','line_number':2574,'multiline':False]['text':' set up args with a config version higher than ours','line_number':2587,'multiline':False]['text':' prepare response and check the results','line_number':2596,'multiline':False]['text':' set up args with a config term higher than ours','line_number':2609,'multiline':False]['text':' prepare response and check the results','line_number':2619,'multiline':False]['text':' prepare response and check the results','line_number':2640,'multiline':False]['text':' get a sync source','line_number':2658,'multiline':False]['text':' set up args','line_number':2667,'multiline':False]['text':' prepare response and check the results','line_number':2675,'multiline':False]['text':' The lastApplied and lastDurable should be null for any heartbeat responses we send while in','line_number':2709,'multiline':False]['text':' STARTUP_2, even when they are otherwise initialized.','line_number':2710,'multiline':False]['text':' If we are the only node and we are in maintenance mode, we should not become a candidate when','line_number':2737,'multiline':False]['text':' we transition to SECONDARY.','line_number':2738,'multiline':False]['text':' getMemberState() returns RS_RECOVERING while we are in maintenance mode even though','line_number':2744,'multiline':False]['text':' _memberState is set to RS_SECONDARY.','line_number':2745,'multiline':False]['text':' Once we are no longer in maintenance mode, getMemberState() should return RS_SECONDARY.','line_number':2748,'multiline':False]['text':' We should not become a candidate when we reconfig to become electable if we are currently in','line_number':2771,'multiline':False]['text':' maintenance mode.','line_number':2772,'multiline':False]['text':' despite being the only node, we are unelectable, so we should not become a candidate','line_number':2796,'multiline':False]['text':' config to be absent from the set','line_number':2806,'multiline':False]['text':' should become removed since we are not in the set','line_number':2815,'multiline':False]['text':' reconfig to add to set','line_number':2819,'multiline':False]['text':' having been added to the config, we should no longer be REMOVED and should enter STARTUP2','line_number':2830,'multiline':False]['text':' reconfig to remove self','line_number':2851,'multiline':False]['text':' should become removed since we are no longer in the set','line_number':2860,'multiline':False]['text':' win election and primary','line_number':2881,'multiline':False]['text':' reconfig to remove self','line_number':2886,'multiline':False]['text':' should become removed since we are no longer in the set even though we were primary','line_number':2895,'multiline':False]['text':' win election and primary','line_number':2916,'multiline':False]['text':' now lose primary due to loss of electability','line_number':2921,'multiline':False]['text':' win election and primary','line_number':2954,'multiline':False]['text':' Now reconfig in ways that leave us electable and ensure we are still the primary.','line_number':2959,'multiline':False]['text':' Add hosts','line_number':2960,'multiline':False]['text':' Change priorities and tags','line_number':2975,'multiline':False]['text':' reconfig and stay secondary','line_number':3009,'multiline':False]['text':' different candidate same term, should be a problem','line_number':3084,'multiline':False]['text':' Make sure the lastCommittedInPrevConfig is set to be the current committed optime.','line_number':3101,'multiline':False]['text':' Should not change.','line_number':3110,'multiline':False]['text':' Update commit point again.','line_number':3114,'multiline':False]['text':' dry run','line_number':3137,'multiline':False]['text':' second dry run fine','line_number':3152,'multiline':False]['text':' real request fine','line_number':3168,'multiline':False]['text':' dry post real, fails','line_number':3184,'multiline':False]['text':' real request fine','line_number':3215,'multiline':False]['text':' dry post real, fails','line_number':3230,'multiline':False]['text':' mismatched setName','line_number':3261,'multiline':False]['text':' mismatched configVersion','line_number':3299,'multiline':False]['text':' stale term','line_number':3366,'multiline':False]['text':' stale OpTime','line_number':3397,'multiline':False]['text':' set term to 1','line_number':3430,'multiline':False]['text':' and make sure we voted in term 1','line_number':3433,'multiline':False]['text':' mismatched setName','line_number':3450,'multiline':False]['text':' set term to 1','line_number':3479,'multiline':False]['text':' and make sure we voted in term 1','line_number':3482,'multiline':False]['text':' mismatched configVersion','line_number':3499,'multiline':False]['text':' set term to 1','line_number':3531,'multiline':False]['text':' and make sure we voted in term 1','line_number':3534,'multiline':False]['text':' stale term','line_number':3550,'multiline':False]['text':' set term to 2','line_number':3580,'multiline':False]['text':' mismatched configVersion','line_number':3584,'multiline':False]['text':' Candidates config(t, v) is (2, 1) and our config is (1, 2). Even though the candidate's','line_number':3596,'multiline':False]['text':' config version is lower, we grant our vote because the candidate's config term is higher.','line_number':3597,'multiline':False]['text':' set term to 1','line_number':3613,'multiline':False]['text':' and make sure we voted in term 1','line_number':3616,'multiline':False]['text':' repeat term','line_number':3633,'multiline':False]['text':' set term to 1','line_number':3662,'multiline':False]['text':' and make sure we voted in term 1','line_number':3665,'multiline':False]['text':' stale OpTime','line_number':3682,'multiline':False]['text':' In this test, the TopologyCoordinator should tell us to change sync sources away from','line_number':3772,'multiline':False]['text':' "host2" and to "host3" despite "host3" not building indexes because we do not build','line_number':3773,'multiline':False]['text':' indexes either and "host2" is more than maxSyncSourceLagSecs(30) behind "host3"','line_number':3774,'multiline':False]['text':' ahead by more than maxSyncSourceLagSecs (30)','line_number':3777,'multiline':False]['text':' set up complete, time for actual check','line_number':3798,'multiline':False]['text':' primaryIndex ','line_number':3803,'multiline':True]['text':' syncSourceIndex ','line_number':3803,'multiline':True]['text':' In this test, the TopologyCoordinator will tell us change our sync source away from "host2"','line_number':3813,'multiline':False]['text':' when it is not ahead of us, unless it is PRIMARY or has a sync source of its own.','line_number':3814,'multiline':False]['text':' Set lastOpTimeFetched to be before the sync source's OpTime.','line_number':3818,'multiline':False]['text':' Show we like host2 while it is primary.','line_number':3825,'multiline':False]['text':' visibleOpTime ','line_number':3828,'multiline':True]['text':' isPrimary ','line_number':3828,'multiline':True]['text':' primaryIndex ','line_number':3829,'multiline':True]['text':' Show that we also like host2 while it has a sync source.','line_number':3833,'multiline':False]['text':' visibleOpTime ','line_number':3839,'multiline':True]['text':' isPrimary ','line_number':3839,'multiline':True]['text':' Show that we do not like it when it is not PRIMARY and lacks a sync source and lacks progress','line_number':3844,'multiline':False]['text':' beyond our own.','line_number':3845,'multiline':False]['text':' But if it is secondary and has some progress beyond our own, we still like it.','line_number':3853,'multiline':False]['text':' In this test, the TopologyCoordinator will tell us change our sync source away from "host2"','line_number':3862,'multiline':False]['text':' when it is not ahead of us and it selects us to be its sync source, forming a sync source','line_number':3863,'multiline':False]['text':' cycle and we are currently in primary catchup.','line_number':3864,'multiline':False]['text':' Set lastOpTimeFetched to be same as the sync source's OpTime.','line_number':3871,'multiline':False]['text':' Show we like host2 while it is not syncing from us.','line_number':3874,'multiline':False]['text':' visibleOpTime ','line_number':3880,'multiline':True]['text':' isPrimary ','line_number':3880,'multiline':True]['text':' primaryIndex ','line_number':3882,'multiline':True]['text':' syncSourceIndex ','line_number':3883,'multiline':True]['text':' syncSourceHost ','line_number':3884,'multiline':True]['text':' Show that we also like host2 while we are not primary.','line_number':3888,'multiline':False]['text':' visibleOpTime ','line_number':3896,'multiline':True]['text':' isPrimary ','line_number':3896,'multiline':True]['text':' Sync source is also syncing from us.','line_number':3897,'multiline':False]['text':' primaryIndex ','line_number':3899,'multiline':True]['text':' syncSourceIndex ','line_number':3900,'multiline':True]['text':' syncSourceHost ','line_number':3901,'multiline':True]['text':' Show that we also like host2 while we are primary and it has some progress beyond our own.','line_number':3905,'multiline':False]['text':' visibleOpTime ','line_number':3914,'multiline':True]['text':' isPrimary ','line_number':3914,'multiline':True]['text':' Sync source is also syncing from us.','line_number':3915,'multiline':False]['text':' primaryIndex ','line_number':3917,'multiline':True]['text':' syncSourceIndex ','line_number':3918,'multiline':True]['text':' syncSourceHost ','line_number':3919,'multiline':True]['text':' Show that we do not like host2 it forms a sync source selection cycle with us and we','line_number':3923,'multiline':False]['text':' are primary and it lacks progress beyond our own.','line_number':3924,'multiline':False]['text':' visibleOpTime ','line_number':3930,'multiline':True]['text':' isPrimary ','line_number':3930,'multiline':True]['text':' Sync source is also syncing from us.','line_number':3931,'multiline':False]['text':' primaryIndex ','line_number':3933,'multiline':True]['text':' syncSourceIndex ','line_number':3934,'multiline':True]['text':' syncSourceHost ','line_number':3935,'multiline':True]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away from','line_number':3941,'multiline':False]['text':' "host2" and to "host3" despite "host2" being more than maxSyncSourceLagSecs(30) behind','line_number':3942,'multiline':False]['text':' "host3", since "host3" is down','line_number':3943,'multiline':False]['text':' Our last op time fetched must be behind host2, or we'll hit the case where we change','line_number':3945,'multiline':False]['text':' sync sources due to the sync source being behind, without a sync source, and not primary.','line_number':3946,'multiline':False]['text':' ahead by more than maxSyncSourceLagSecs (30)','line_number':3949,'multiline':False]['text':' while the host is up, we should want to change to its sync source','line_number':3957,'multiline':False]['text':' set up complete, time for actual check','line_number':3964,'multiline':False]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away from','line_number':3975,'multiline':False]['text':' "host2" and to "host3" despite "host2" being more than maxSyncSourceLagSecs(30) behind','line_number':3976,'multiline':False]['text':' "host3", since "host3" is denylisted','line_number':3977,'multiline':False]['text':' Then, confirm that undenylisting only works if time has passed the denylist time.','line_number':3978,'multiline':False]['text':' Our last op time fetched must be behind host2, or we'll hit the case where we change','line_number':3980,'multiline':False]['text':' sync sources due to the sync source being behind, without a sync source, and not primary.','line_number':3981,'multiline':False]['text':' ahead by more than maxSyncSourceLagSecs (30)','line_number':3984,'multiline':False]['text':' set up complete, time for actual check','line_number':3993,'multiline':False]['text':' undenylist with too early a time (node should remained denylisted)','line_number':4000,'multiline':False]['text':' undenylist and it should succeed','line_number':4008,'multiline':False]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away from','line_number':4022,'multiline':False]['text':' "host2" and to "host3" since "host2" is only more than maxSyncSourceLagSecs(30) behind','line_number':4023,'multiline':False]['text':' "host3" according to metadata, not heartbeat data.','line_number':4024,'multiline':False]['text':' ahead by more than maxSyncSourceLagSecs (30)','line_number':4027,'multiline':False]['text':' set up complete, time for actual check','line_number':4038,'multiline':False]['text':' primaryIndex ','line_number':4043,'multiline':True]['text':' syncSourceIndex ','line_number':4043,'multiline':True]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away from','line_number':4051,'multiline':False]['text':' "host2" and to "host3" since "host2" is only more than maxSyncSourceLagSecs(30) behind','line_number':4052,'multiline':False]['text':' "host3" according to heartbeat data, not metadata.','line_number':4053,'multiline':False]['text':' ahead by more than maxSyncSourceLagSecs (30)','line_number':4056,'multiline':False]['text':' set up complete, time for actual check','line_number':4067,'multiline':False]['text':' In this test, the TopologyCoordinator should tell us to change sync sources away from','line_number':4079,'multiline':False]['text':' "host2" and to "host3" since "host2" is more than maxSyncSourceLagSecs(30) behind "host3"','line_number':4080,'multiline':False]['text':' ahead by more than maxSyncSourceLagSecs (30)','line_number':4083,'multiline':False]['text':' set up complete, time for actual check','line_number':4094,'multiline':False]['text':' primaryIndex ','line_number':4099,'multiline':True]['text':' syncSourceIndex ','line_number':4099,'multiline':True]['text':' In this test, the TopologyCoordinator should tell us to change sync sources away from','line_number':4108,'multiline':False]['text':' "host2" and to "host3" since "host2" is down.','line_number':4109,'multiline':False]['text':' ahead by less than maxSyncSourceLagSecs (30)','line_number':4112,'multiline':False]['text':' set up complete, time for actual check','line_number':4122,'multiline':False]['text':' primaryIndex ','line_number':4127,'multiline':True]['text':' syncSourceIndex ','line_number':4127,'multiline':True]['text':' In this test, the TopologyCoordinator should tell us to change sync sources away from','line_number':4136,'multiline':False]['text':' "host2" and to "host3" since "host2" is down.','line_number':4137,'multiline':False]['text':' ahead by less than maxSyncSourceLagSecs (30)','line_number':4140,'multiline':False]['text':' set up complete, time for actual check','line_number':4150,'multiline':False]['text':' In this test, the TopologyCoordinator should still sync to the primary, "host2", although','line_number':4160,'multiline':False]['text':' "host3" is fresher.','line_number':4161,'multiline':False]['text':' set up complete, time for actual check','line_number':4174,'multiline':False]['text':' visibleOpTime ','line_number':4177,'multiline':True]['text':' isPrimary ','line_number':4177,'multiline':True]['text':' primaryIndex ','line_number':4178,'multiline':True]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away from','line_number':4184,'multiline':False]['text':' "host2" since we do not use the member's heartbeatdata in pv1.','line_number':4185,'multiline':False]['text':' Set lastOpTimeFetched to be before the sync source's OpTime.','line_number':4188,'multiline':False]['text':' In this test, the TopologyCoordinator should tell us to change sync sources away from','line_number':4199,'multiline':False]['text':' "host4" since "host4" is absent from the config of version 10.','line_number':4200,'multiline':False]['text':' In this test, the TopologyCoordinator should tell us to change sync sources away from','line_number':4212,'multiline':False]['text':' "host4" since "host4" is absent from the config of version 10.','line_number':4213,'multiline':False]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away from','line_number':4226,'multiline':False]['text':' "host2" since we are not aware of who the new primary is.','line_number':4227,'multiline':False]['text':' primaryIndex ','line_number':4249,'multiline':True]['text':' syncSourceIndex ','line_number':4249,'multiline':True]['text':' lastOpTimeFetched so that we are behind host2','line_number':4250,'multiline':False]['text':' In this test, the TopologyCoordinator should tell us to change sync sources away from','line_number':4256,'multiline':False]['text':' "host2" since "host3" is the new primary and chaining is disabled.','line_number':4257,'multiline':False]['text':' Old host should still be up; this is a stale heartbeat.','line_number':4278,'multiline':False]['text':' Set that host3 is the new primary.','line_number':4285,'multiline':False]['text':' primaryIndex ','line_number':4294,'multiline':True]['text':' syncSourceIndex ','line_number':4294,'multiline':True]['text':' lastOpTimeFetched so that we are behind host2 and host3','line_number':4295,'multiline':False]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away from','line_number':4304,'multiline':False]['text':' "host2" since we are not aware of who the new primary is.','line_number':4305,'multiline':False]['text':' lastOpTimeFetched so that we are behind host2','line_number':4326,'multiline':False]['text':' In this test, the TopologyCoordinator should tell us to change sync sources away from','line_number':4332,'multiline':False]['text':' "host2" since "host3" is the new primary and chaining is disabled.','line_number':4333,'multiline':False]['text':' Old host should still be up; this is a stale heartbeat.','line_number':4354,'multiline':False]['text':' Set that host3 is the new primary.','line_number':4361,'multiline':False]['text':' lastOpTimeFetched so that we are behind host2 and host3','line_number':4369,'multiline':False]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away from','line_number':4378,'multiline':False]['text':' "host2" since, though "host3" is the new primary, "host2" also thinks it is primary.','line_number':4379,'multiline':False]['text':' Old host should still be up, and thinks it is primary.','line_number':4400,'multiline':False]['text':' Set that host3 is the new primary.','line_number':4407,'multiline':False]['text':' Indicate host2 still thinks it is primary.','line_number':4414,'multiline':False]['text':' isPrimary ','line_number':4415,'multiline':True]['text':' primaryIndex ','line_number':4416,'multiline':True]['text':' syncSourceIndex ','line_number':4416,'multiline':True]['text':' lastOpTimeFetched so that we are behind host2 and host3','line_number':4417,'multiline':False]['text':' Set that we are primary.','line_number':4438,'multiline':False]['text':' primaryIndex ','line_number':4444,'multiline':True]['text':' syncSourceIndex ','line_number':4444,'multiline':True]['text':' lastOpTimeFetched so that we are behind host2','line_number':4445,'multiline':False]['text':' Set that we are primary.','line_number':4467,'multiline':False]['text':' lastOpTimeFetched so that we are behind host2','line_number':4472,'multiline':False]['text':' Set 'changeSyncSourceThresholdMillis' to a non-zero value to allow evaluating if the node','line_number':4492,'multiline':False]['text':' should change sync sources due to ping time.','line_number':4493,'multiline':False]['text':' Receive an up heartbeat from both sync sources. This will allow 'isEligibleSyncSource()'','line_number':4496,'multiline':False]['text':' to pass if the node reaches that check. We repeat this 5 times to satisfy that we have','line_number':4497,'multiline':False]['text':' received at least 5N heartbeats before re-evaluating our sync source.','line_number':4498,'multiline':False]['text':' Set lastOpTimeFetched to be before the sync source's OpTime.','line_number':4511,'multiline':False]['text':' Denylist "host3" to make it not eligible to be our sync source.','line_number':4568,'multiline':False]['text':' We should not change sync sources since there are no other eligible sync sources.','line_number':4572,'multiline':False]['text':' We should not change sync sources since the threshold is 0.','line_number':4586,'multiline':False]['text':' We should not change sync sources because we are in initial sync.','line_number':4598,'multiline':False]['text':' We should not change sync sources because we are in initial sync.','line_number':4610,'multiline':False]['text':' We should not change sync sources because we will only sync from the primary.','line_number':4622,'multiline':False]['text':' Tell the node that we're currently syncing from the primary.','line_number':4631,'multiline':False]['text':' election ','line_number':4635,'multiline':True]['text':' We should not change sync sources because we prefer to sync from the primary, and we are','line_number':4642,'multiline':False]['text':' currently doing so.','line_number':4643,'multiline':False]['text':' Tell the node that we're currently not syncing from the primary.','line_number':4653,'multiline':False]['text':' election ','line_number':4657,'multiline':True]['text':' We should allow changing sync sources due to ping times because we prefer to sync from the','line_number':4664,'multiline':False]['text':' primary, and we are not currently doing so.','line_number':4665,'multiline':False]['text':' Set 'changeSyncSourceThresholdMillis' to a non-zero value to allow evaluating if the node','line_number':4687,'multiline':False]['text':' should change sync sources due to ping time.','line_number':4688,'multiline':False]['text':' Do not set ping time for "host2".','line_number':4693,'multiline':False]['text':' Set 'changeSyncSourceThresholdMillis' to a non-zero value to allow evaluating if the node','line_number':4716,'multiline':False]['text':' should change sync sources due to ping time.','line_number':4717,'multiline':False]['text':' Do not set ping time for "host3".','line_number':4722,'multiline':False]['text':' Set up so that without secondaryDelaySecs, the node otherwise would have changed sync','line_number':4746,'multiline':False]['text':' sources.','line_number':4747,'multiline':False]['text':' Set up so that without secondaryDelaySecs and not being in the config, the node otherwise','line_number':4772,'multiline':False]['text':' would have changed sync sources.','line_number':4773,'multiline':False]['text':' We should not change sync sources because we have already changed sync sources more than','line_number':4802,'multiline':False]['text':' 'maxNumSyncSourceChangesPerHour' in the past hour.','line_number':4803,'multiline':False]['text':' We should allow changing sync sources because we have not yet changed sync sources more times','line_number':4826,'multiline':False]['text':' than 'maxNumSyncSourceChangesPerHour' in the past hour.','line_number':4827,'multiline':False]['text':' Set 'changeSyncSourceThresholdMillis' to a non-zero value to allow evaluating if the node','line_number':4847,'multiline':False]['text':' should change sync sources due to ping time.','line_number':4848,'multiline':False]['text':' Set lastOpTimeFetched to be before the sync source's OpTime.','line_number':4853,'multiline':False]['text':' Send fewer heartbeats than the required number to do a re-eval due to ping time.','line_number':4856,'multiline':False]['text':' This will cause us to set that the current sync source is forced.','line_number':4879,'multiline':False]['text':' Set up so that without forcing the sync source, the node otherwise would have changed sync','line_number':4883,'multiline':False]['text':' sources.','line_number':4884,'multiline':False]['text':' Make sure to turn off the failpoint at the end of this test.','line_number':4903,'multiline':False]['text':' This will cause us to set that the current sync source is forced.','line_number':4906,'multiline':False]['text':' Set up so that without forcing the sync source, the node otherwise would have changed sync','line_number':4910,'multiline':False]['text':' sources.','line_number':4911,'multiline':False]['text':' Test that we will select the node specified by the 'unsupportedSyncSource' parameter as a sync','line_number':4922,'multiline':False]['text':' source even if it is farther away.','line_number':4923,'multiline':False]['text':' Make the desired host much farther away.','line_number':4928,'multiline':False]['text':' Select a sync source.','line_number':4932,'multiline':False]['text':' Test that we will not change from the node specified by the 'unsupportedSyncSource' parameter','line_number':4938,'multiline':False]['text':' due to ping time.','line_number':4939,'multiline':False]['text':' Select a sync source.','line_number':4943,'multiline':False]['text':' Set up so that without forcing the sync source, the node otherwise would have changed sync','line_number':4948,'multiline':False]['text':' sources.','line_number':4949,'multiline':False]['text':' Test that we will not change sync sources due to the replSetSyncFrom command being run when','line_number':4960,'multiline':False]['text':' the 'unsupportedSyncSource' startup parameter is set - that is, the parameter should always','line_number':4961,'multiline':False]['text':' take priority.','line_number':4962,'multiline':False]['text':' Select a sync source.','line_number':4966,'multiline':False]['text':' Simulate calling replSetSyncFrom and selecting host3.','line_number':4971,'multiline':False]['text':' Assert the command failed.','line_number':4976,'multiline':False]['text':' Reselect a sync source, and confirm it hasn't changed.','line_number':4979,'multiline':False]['text':' Test that if a node is REMOVED but has 'unsupportedSyncSource' specified, we select no sync','line_number':4984,'multiline':False]['text':' source.','line_number':4985,'multiline':False]['text':' Remove ourselves from the config.','line_number':4989,'multiline':False]['text':' Confirm we were actually removed.','line_number':4998,'multiline':False]['text':' Confirm we select no sync source.','line_number':5000,'multiline':False]['text':' Test that we crash if the 'unsupportedSyncSource' parameter specifies a node that is not in the','line_number':5006,'multiline':False]['text':' replica set config.','line_number':5007,'multiline':False]['text':' Test that we crash if the 'unsupportedSyncSource' parameter specifies ourself as a node.','line_number':5015,'multiline':False]['text':' Become primary but don't completeTransitionToPrimary.','line_number':5069,'multiline':False]['text':' Construct a higher OpTime.','line_number':5085,'multiline':False]['text':' Check that heartbeat response updated the heartbeat data even on reconfig.','line_number':5101,'multiline':False]['text':' Older config version, same term.','line_number':5150,'multiline':False]['text':' Don't reconfig to an older config.','line_number':5167,'multiline':False]['text':' Don't reconfig to the same config.','line_number':5188,'multiline':False]['text':' Older config term, same version','line_number':5193,'multiline':False]['text':' Don't reconfig to an older config.','line_number':5210,'multiline':False]['text':' Newer version but older term.','line_number':5216,'multiline':False]['text':' Don't reconfig to an older config.','line_number':5233,'multiline':False]['text':' TODO(dannenberg) figure out what this is trying to test..','line_number':5237,'multiline':False]['text':' all three members up and secondaries','line_number':5242,'multiline':False]['text':' now request from host3 and receive after host2 has been removed via reconfig','line_number':5254,'multiline':False]['text':' primary should not be set and we should perform NoAction in response','line_number':5277,'multiline':False]['text':' TODO(dannenberg) figure out what this is trying to test..','line_number':5282,'multiline':False]['text':' all three members up and secondaries','line_number':5287,'multiline':False]['text':' now request from host3 and receive after host2 has been removed via reconfig','line_number':5299,'multiline':False]['text':' now primary should be host3, index 1, and we should perform NoAction in response','line_number':5328,'multiline':False]['text':' Become PRIMARY.','line_number':5347,'multiline':False]['text':' Become aware of other nodes.','line_number':5352,'multiline':False]['text':' Lose that awareness, but we are not going to step down, because stepdown only','line_number':5360,'multiline':False]['text':' depends on liveness.','line_number':5361,'multiline':False]['text':' Host 2 is the current primary in term 1.','line_number':5422,'multiline':False]['text':' Heartbeat from a secondary node shouldn't schedule a priority takeover.','line_number':5431,'multiline':False]['text':' Host 1 starts an election due to higher priority by sending vote requests.','line_number':5438,'multiline':False]['text':' Vote request updates my term.','line_number':5439,'multiline':False]['text':' This heartbeat shouldn't schedule priority takeover, because the current primary','line_number':5442,'multiline':False]['text':' host 1 is not in my term.','line_number':5443,'multiline':False]['text':' Create a mock heartbeat response to be able to compare who is the freshest node.','line_number':5472,'multiline':False]['text':' The latest heartbeat responses are looked at for determining the latest optime','line_number':5473,'multiline':False]['text':' and therefore freshness for catchup takeover.','line_number':5474,'multiline':False]['text':' Set optimes so that I am the freshest node and strictly ahead of the primary.','line_number':5485,'multiline':False]['text':' Create a mock heartbeat response to be able to compare who is the freshest node.','line_number':5525,'multiline':False]['text':' Set optimes so that the other (non-primary) node is ahead of me.','line_number':5536,'multiline':False]['text':' Create a mock heartbeat response to be able to compare who is the freshest node.','line_number':5578,'multiline':False]['text':' Set optimes so that the primary node is caught up with me.','line_number':5589,'multiline':False]['text':' Create a mock heartbeat response to be able to compare who is the freshest node.','line_number':5632,'multiline':False]['text':' Simulates a scenario where the node hasn't received a heartbeat from the primary in a while','line_number':5643,'multiline':False]['text':' but the primary is caught up and has written something. The node is aware of this change','line_number':5644,'multiline':False]['text':' and as a result realizes the primary is caught up.','line_number':5645,'multiline':False]['text':' Test for the bug described in SERVER-48958 where we would schedule a catchup takeover for a node','line_number':5667,'multiline':False]['text':' with priority 0.','line_number':5668,'multiline':False]['text':' Make ourselves the priority:0 secondary.','line_number':5681,'multiline':False]['text':' Start a new term for the new primary.','line_number':5686,'multiline':False]['text':' Create and process a mock heartbeat response from the primary indicating it is behind.','line_number':5691,'multiline':False]['text':' Even though we are fresher than the primary we do not schedule a catchup takeover','line_number':5707,'multiline':False]['text':' since we are priority:0.','line_number':5708,'multiline':False]['text':' These fields should all be empty, since this node has not received heartbeats and has','line_number':6020,'multiline':False]['text':' no sync source yet.','line_number':6021,'multiline':False]['text':' Receive heartbeats and choose a sync source.','line_number':6057,'multiline':False]['text':' Record two rounds of pings so the node can pick a sync source.','line_number':6062,'multiline':False]['text':' Node 0 (self) has received heartbeats and has a sync source.','line_number':6088,'multiline':False]['text':' Receive heartbeats and choose a sync source.','line_number':6125,'multiline':False]['text':' Record two rounds of pings so the node can pick a sync source.','line_number':6130,'multiline':False]['text':' Mimic that h1 sends a heartbeat response with hprimary as syncsource.','line_number':6136,'multiline':False]['text':' If readPreference is PrimaryOnly, hself should choose hprimary.','line_number':6150,'multiline':False]['text':' h1','line_number':6174,'multiline':False]['text':' hprimary','line_number':6181,'multiline':False]['text':' hself','line_number':6188,'multiline':False]['text':' This node is no longer part of this replica set.','line_number':6210,'multiline':False]['text':' These fields should all be empty, since this node is not a member of a replica set.','line_number':6228,'multiline':False]['text':' There are no other nodes in the set.','line_number':6246,'multiline':False]['text':' Node1 is electable, but not caught up.','line_number':6264,'multiline':False]['text':' Node1 is caught up, but not electable.','line_number':6286,'multiline':False]['text':' Node1 is electable, but not caught up.','line_number':6310,'multiline':False]['text':' Node2 is caught up, but not electable.','line_number':6313,'multiline':False]['text':' Node1 is caught up and electable.','line_number':6334,'multiline':False]['text':' Node1 is caught up, but not electable.','line_number':6360,'multiline':False]['text':' Node2 is electable, but not caught up.','line_number':6364,'multiline':False]['text':' Node3 is caught up and electable.','line_number':6368,'multiline':False]['text':' Node1 is caught up and has default priority (1).','line_number':6392,'multiline':False]['text':' Node2 is caught up and has priority 5.','line_number':6396,'multiline':False]['text':' Candidates tied in opTime. Choose node with highest priority.','line_number':6400,'multiline':False]['text':' Node1 is caught up and has default priority (1).','line_number':6420,'multiline':False]['text':' Node2 is caught up and has default priority (1).','line_number':6424,'multiline':False]['text':' Candidates tied in opTime and priority. Choose node with lowest member index.','line_number':6428,'multiline':False]['text':' Simulate a heartbeat to the remote.','line_number':6439,'multiline':False]['text':' Simulate heartbeat response from the remote.','line_number':6443,'multiline':False]['text':' This will call setUpValues, which will update the memberData for the remote.','line_number':6444,'multiline':False]['text':' Config with three nodes requires at least 2 nodes to replicate the config.','line_number':6457,'multiline':False]['text':' makeSelfPrimary() doesn't actually conduct a true election, so the term will still be 0.','line_number':6469,'multiline':False]['text':' Currently, only we have config 2 (the initial config).','line_number':6478,'multiline':False]['text':' This simulates a reconfig where only the primary has written down the configVersion and','line_number':6479,'multiline':False]['text':' configTerm.','line_number':6480,'multiline':False]['text':' Simulate a heartbeat to one of the other nodes.','line_number':6483,'multiline':False]['text':' Now, node 0 and node 1 should have the current config.','line_number':6485,'multiline':False]['text':' Update _rsConfig with config(v: 3, t: 0). configTerms are the same but configVersion 3 is','line_number':6488,'multiline':False]['text':' higher than 2.','line_number':6489,'multiline':False]['text':' Currently, only we have config 3.','line_number':6501,'multiline':False]['text':' This simulates a reconfig where only the primary has written down the configVersion and','line_number':6502,'multiline':False]['text':' configTerm.','line_number':6503,'multiline':False]['text':' Simulate a heartbeat to one of the other nodes.','line_number':6506,'multiline':False]['text':' Now, node 0 and node 2 should have the current config.','line_number':6508,'multiline':False]['text':' Update _rsConfig with config(v: 4, t: 1). configTerm 1 is higher than configTerm 0.','line_number':6511,'multiline':False]['text':' Currently, only we have config 4.','line_number':6523,'multiline':False]['text':' Now, node 0 and node 1 should have the current config.','line_number':6527,'multiline':False]['text':' makeSelfPrimary() doesn't actually conduct a true election, so the term will still be 0.','line_number':6544,'multiline':False]['text':' Currently, only the primary has config 2 (the initial config).','line_number':6547,'multiline':False]['text':' makeSelfPrimary() doesn't actually conduct a true election, so the term will still be 0.','line_number':6572,'multiline':False]['text':' Currently, only the primary has config 2 (the initial config).','line_number':6575,'multiline':False]['text':' Receive a heartbeat from the non-voting node, but haveTaggedNodesSatisfiedCondition should','line_number':6582,'multiline':False]['text':' still return false.','line_number':6583,'multiline':False]['text':' After receiving a heartbeat from the arbiter, we have 2/3 nodes that count towards the','line_number':6587,'multiline':False]['text':' config commitment check.','line_number':6588,'multiline':False]['text':' makeSelfPrimary() doesn't actually conduct a true election, so the term will still be 0.','line_number':6607,'multiline':False]['text':' Currently, only the primary has config 2 (the initial config).','line_number':6610,'multiline':False]['text':' makeSelfPrimary() doesn't actually conduct a true election, so the term will still be 0.','line_number':6640,'multiline':False]['text':' Currently, only the primary has config 2 (the initial config).','line_number':6643,'multiline':False]['text':' The config has 3 voting members including an arbiter, so the majority','line_number':6661,'multiline':False]['text':' number is 2.','line_number':6662,'multiline':False]['text':' One secondary is not caught up.','line_number':6692,'multiline':False]['text':' The non-voter is caught up, but should not count towards the majority.','line_number':6696,'multiline':False]['text':' The arbiter is caught up, but should not count towards the majority.','line_number':6700,'multiline':False]['text':' The secondary is caught up and counts towards the majority.','line_number':6704,'multiline':False]['text':' In a PSSA set, a w:3 write should only be acknowledged if both secondaries can satisfy it.','line_number':6710,'multiline':False]['text':' One secondary is caught up.','line_number':6734,'multiline':False]['text':' The other is not.','line_number':6737,'multiline':False]['text':' The arbiter is caught up, but should not count towards the w:3.','line_number':6740,'multiline':False]['text':' numNodes ','line_number':6744,'multiline':True]['text':' durablyWritten ','line_number':6744,'multiline':True]['text':' In a PSSAA set, a w:2 write should only be acknowledged if at least one of the secondaries','line_number':6748,'multiline':False]['text':' can satisfy it.','line_number':6749,'multiline':False]['text':' Neither secondary is caught up.','line_number':6778,'multiline':False]['text':' Both arbiters arae caught up, but neither should count towards the w:2.','line_number':6782,'multiline':False]['text':' numNodes ','line_number':6787,'multiline':True]['text':' durablyWritten ','line_number':6787,'multiline':True]['text':' The buildIndexes:false node can vote but not build indexes. The commit quorum should be','line_number':6904,'multiline':False]['text':' unsatisfiable.','line_number':6905,'multiline':False]['text':' This test starts by configuring a TopologyCoordinator as a member of a 3 node replica','line_number':6919,'multiline':False]['text':' set. The first and second nodes are secondaries, and the third is primary and corresponds','line_number':6920,'multiline':False]['text':' to ourself.','line_number':6921,'multiline':False]['text':' Chronologically, the OpTime of lastCommittedOpTimeAndWallTime is more recent than that of','line_number':6927,'multiline':False]['text':' initialCommittedOpTimeAndWallTime, even though the former's wall time is less recent than','line_number':6928,'multiline':False]['text':' that of the latter.','line_number':6929,'multiline':False]['text':' Advance the commit point to initialCommittedOpTimeAndWallTime.','line_number':6952,'multiline':False]['text':' memberOne's lastApplied and lastDurable OpTimeAndWallTimes are equal to','line_number':6972,'multiline':False]['text':' lastCommittedOpTimeAndWallTime, but memberTwo's are equal to','line_number':6973,'multiline':False]['text':' initialCommittedOpTimeAndWallTime. Only the ordering of OpTimes should influence advancing','line_number':6974,'multiline':False]['text':' the commit point.','line_number':6975,'multiline':False]['text':' Set a higher term to accompany the new primary.','line_number':7013,'multiline':False]['text':' Set a higher term to accompany the new primary.','line_number':7050,'multiline':False]['text':' Set a higher term to accompany the new primary.','line_number':7077,'multiline':False]['text':' Make sure our lastApplied is in the new term.','line_number':7082,'multiline':False]['text':' Make sure all non-voting nodes are down, that way we do not have a majority of nodes','line_number':7133,'multiline':False]['text':' but do have a majority of votes since one of two voting members is up and so are we.','line_number':7134,'multiline':False]['text':' We are electable now.','line_number':7151,'multiline':False]['text':' We are electable now.','line_number':7177,'multiline':False]['text':' Freeze node to set stepdown wait.','line_number':7236,'multiline':False]['text':' This test exists to ensure we do not resolve multiprimary states via heartbeats in PV1.','line_number':7349,'multiline':False]['text':' If the other PRIMARY falls down, this node should set its primaryIndex to itself.','line_number':7365,'multiline':False]['text':' In this test, the Topology coordinator sees a PRIMARY ("host2") and then sees a higher','line_number':7374,'multiline':False]['text':' priority and stale node ("host3"). It responds with NoAction, as it should in all','line_number':7375,'multiline':False]['text':' multiprimary states in PV1.','line_number':7376,'multiline':False]['text':' In this test, the Topology coordinator becomes PRIMARY and then sees a higher priority','line_number':7407,'multiline':False]['text':' and stale node ("host3"). It responds with NoAction, as it should in all','line_number':7408,'multiline':False]['text':' multiprimary states in PV1.','line_number':7409,'multiline':False]['text':' In this test, the Topology coordinator becomes PRIMARY and then sees a higher priority','line_number':7437,'multiline':False]['text':' and equally fresh node ("host3"). It responds with NoAction, as it should in all','line_number':7438,'multiline':False]['text':' multiprimary states in PV1.','line_number':7439,'multiline':False]['text':' In this test, the Topology coordinator sees a PRIMARY ("host2") and then sees a higher','line_number':7468,'multiline':False]['text':' priority and similarly fresh node ("host3"). It responds with NoAction, as it should','line_number':7469,'multiline':False]['text':' in all multiprimary states in PV1.','line_number':7470,'multiline':False]['text':' Verify that transition to primary is OK.','line_number':7527,'multiline':False]['text':' Now mark ourselves as mid-stepdown, as if we had heard about a new term.','line_number':7530,'multiline':False]['text':' Verify that the transition to primary can still complete.','line_number':7533,'multiline':False]['text':' Second primary does not change primary index.','line_number':7552,'multiline':False]['text':' Second primary does not change primary index.','line_number':7573,'multiline':False]['text':' Confirm that the topology coordinator does not schedule an immediate heartbeat retry','line_number':7593,'multiline':False]['text':' if the heartbeat timeout period expired before the initial request completed.','line_number':7594,'multiline':False]['text':' Initial heartbeat request prepared, at t + 0.','line_number':7599,'multiline':False]['text':' 5 seconds to successfully complete the heartbeat before the timeout expires.','line_number':7602,'multiline':False]['text':' Initial heartbeat request fails at t + 5000ms','line_number':7605,'multiline':False]['text':' Entire heartbeat period elapsed;','line_number':7607,'multiline':False]['text':' no retry allowed.','line_number':7608,'multiline':False]['text':' Spent 4.99 of the 5 seconds in the network.','line_number':7609,'multiline':False]['text':' Because the heartbeat timed out, we'll retry sooner.','line_number':7615,'multiline':False]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away','line_number':7622,'multiline':False]['text':' from "host2" and to "host3" despite "host2" being more than maxSyncSourceLagSecs(30) behind','line_number':7623,'multiline':False]['text':' "host3", since "host3" does not build indexes','line_number':7624,'multiline':False]['text':' Our last op time fetched must be behind host2, or we'll hit the case where we change','line_number':7626,'multiline':False]['text':' sync sources due to the sync source being behind, without a sync source, and not primary.','line_number':7627,'multiline':False]['text':' ahead by more than maxSyncSourceLagSecs (30)','line_number':7630,'multiline':False]['text':' set up complete, time for actual check','line_number':7650,'multiline':False]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away','line_number':7659,'multiline':False]['text':' from "host2" and to "host3" despite "host2" being more than maxSyncSourceLagSecs(30) behind','line_number':7660,'multiline':False]['text':' "host3", since "host3" is in a non-readable mode (RS_ROLLBACK)','line_number':7661,'multiline':False]['text':' Our last op time fetched must be behind host2, or we'll hit the case where we change','line_number':7663,'multiline':False]['text':' sync sources due to the sync source being behind, without a sync source, and not primary.','line_number':7664,'multiline':False]['text':' ahead by more than maxSyncSourceLagSecs (30)','line_number':7667,'multiline':False]['text':' set up complete, time for actual check','line_number':7674,'multiline':False]['text':' In this test, the TopologyCoordinator should not tell us to change sync sources away from','line_number':7683,'multiline':False]['text':' "host2" because it has a different config version.','line_number':7684,'multiline':False]['text':' Our last op time fetched must be behind host2, or we'll hit the case where we change','line_number':7686,'multiline':False]['text':' sync sources due to the sync source being behind, without a sync source, and not primary.','line_number':7687,'multiline':False]['text':' Update the config version to 7.','line_number':7691,'multiline':False]['text':' We should not want to change our sync source from "host2" even though it has a different','line_number':7701,'multiline':False]['text':' config version.','line_number':7702,'multiline':False]['text':' isPrimary ','line_number':7706,'multiline':True]['text':' syncSourceIndex ','line_number':7707,'multiline':True]['text':' different config version ','line_number':7708,'multiline':True]['text':' Bring up the node we are heartbeating.','line_number':7719,'multiline':False]['text':' Time of first request for this heartbeat period','line_number':7730,'multiline':False]['text':' Initial heartbeat attempt prepared, at t + 0.','line_number':7733,'multiline':False]['text':' 5 seconds to successfully complete the heartbeat before the timeout expires.','line_number':7736,'multiline':False]['text':' Initial heartbeat request fails at t + 4000ms','line_number':7739,'multiline':False]['text':' 4 seconds elapsed, retry allowed.','line_number':7741,'multiline':False]['text':' Spent 3.99 of the 4 seconds in the network.','line_number':7742,'multiline':False]['text':' We've never applied anything.','line_number':7745,'multiline':False]['text':' Because the heartbeat failed without timing out, we expect to retry immediately.','line_number':7749,'multiline':False]['text':' First heartbeat retry prepared, at t + 4000ms.','line_number':7752,'multiline':False]['text':' One second left to complete the heartbeat.','line_number':7755,'multiline':False]['text':' Ensure a single failed heartbeat did not cause the node to be marked down','line_number':7758,'multiline':False]['text':' Confirm that the topology coordinator does not schedule an second heartbeat retry if','line_number':7795,'multiline':False]['text':' the heartbeat timeout period expired before the first retry completed.','line_number':7796,'multiline':False]['text':' Entire heartbeat period elapsed;','line_number':7798,'multiline':False]['text':' no retry allowed.','line_number':7799,'multiline':False]['text':' Spent 1 of the 1.01 seconds in the network.','line_number':7800,'multiline':False]['text':' We've never applied anything.','line_number':7803,'multiline':False]['text':' Because the heartbeat timed out, we'll retry sooner.','line_number':7807,'multiline':False]['text':' First retry fails at t + 4500ms','line_number':7817,'multiline':False]['text':' 4.5 of the 5 seconds elapsed;','line_number':7819,'multiline':False]['text':' could retry.','line_number':7820,'multiline':False]['text':' Spent 0.4 of the 0.5 seconds in the network.','line_number':7821,'multiline':False]['text':' Because the first retry failed without timing out, we expect to retry immediately.','line_number':7826,'multiline':False]['text':' Second retry prepared at t + 4500ms.','line_number':7829,'multiline':False]['text':' 500ms left to complete the heartbeat.','line_number':7833,'multiline':False]['text':' Ensure a second failed heartbeat did not cause the node to be marked down','line_number':7836,'multiline':False]['text':' Confirm that the topology coordinator attempts to retry a failed heartbeat two times','line_number':7855,'multiline':False]['text':' after initial failure, assuming that the heartbeat timeout (set to 5 seconds in the','line_number':7856,'multiline':False]['text':' fixture) has not expired.','line_number':7857,'multiline':False]['text':'','line_number':7858,'multiline':False]['text':' Failed heartbeats propose taking no action, other than scheduling the next heartbeat.','line_number':7859,'multiline':False]['text':' We can detect a retry vs the next regularly scheduled heartbeat because retries are','line_number':7860,'multiline':False]['text':' scheduled immediately, while subsequent heartbeats are scheduled after the hard-coded','line_number':7861,'multiline':False]['text':' heartbeat interval of 2 seconds.','line_number':7862,'multiline':False]['text':' Second retry fails at t + 4800ms','line_number':7864,'multiline':False]['text':' 4.8 of the 5 seconds elapsed;','line_number':7866,'multiline':False]['text':' could still retry.','line_number':7867,'multiline':False]['text':' Spent 0.1 of the 0.3 seconds in the network.','line_number':7868,'multiline':False]['text':' Because this is the second retry, rather than retry again, we expect to wait for a quarter','line_number':7873,'multiline':False]['text':' of the heartbeat interval to elapse.','line_number':7874,'multiline':False]['text':' Ensure a third failed heartbeat caused the node to be marked down','line_number':7879,'multiline':False]['text':' Confirm that the topology coordinator does not mark a node down on three','line_number':7897,'multiline':False]['text':' nonconsecutive heartbeat failures.','line_number':7898,'multiline':False]['text':' successful response (third response due to the two failures in setUp())','line_number':7904,'multiline':False]['text':' Because the heartbeat succeeded, we'll retry sooner.','line_number':7913,'multiline':False]['text':' request next heartbeat','line_number':7918,'multiline':False]['text':' third failed response','line_number':7921,'multiline':False]['text':' Ensure a third nonconsecutive heartbeat failure did not cause the node to be marked down','line_number':7931,'multiline':False]['text':' set verbosity as high as the highest verbosity log message we'd like to check for','line_number':7950,'multiline':False]['text':' TODO(dannenberg) figure out why this test is useful','line_number':7955,'multiline':False]['text':' request heartbeat','line_number':7959,'multiline':False]['text':' construct a copy of the original config for log message checking later','line_number':7963,'multiline':False]['text':' see HeartbeatResponseTest for the origin of the original config','line_number':7964,'multiline':False]['text':' Time is left.','line_number':7985,'multiline':False]['text':' Spent 0.4 of the 0.5 second in the network.','line_number':7986,'multiline':False]['text':' request heartbeat','line_number':8000,'multiline':False]['text':' Time is left.','line_number':8010,'multiline':False]['text':' Spent 0.4 of the 0.5 second in the network.','line_number':8011,'multiline':False]['text':' namespace','line_number':8019,'multiline':False]['text':' namespace repl','line_number':8020,'multiline':False]['text':' namespace mongo','line_number':8021,'multiline':False]