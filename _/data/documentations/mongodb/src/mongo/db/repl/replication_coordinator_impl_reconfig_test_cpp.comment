['text':'*
 *    Copyright (C) 2018-present MongoDB, Inc.
 *
 *    This program is free software: you can redistribute it and/or modify
 *    it under the terms of the Server Side Public License, version 1,
 *    as published by MongoDB, Inc.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    Server Side Public License for more details.
 *
 *    You should have received a copy of the Server Side Public License
 *    along with this program. If not, see
 *    <http://www.mongodb.com/licensing/server-side-public-license>.
 *
 *    As a special exception, the copyright holders give permission to link the
 *    code of portions of this program with the OpenSSL library under certain
 *    conditions as described in each individual source file and distribute
 *    linked combinations including the program with the OpenSSL library. You
 *    must comply with the Server Side Public License in all respects for
 *    all of the code used other than as permitted herein. If you modify file(s)
 *    with this exception, you may extend this exception to your version of the
 *    file(s), but you are not obligated to do so. If you do not wish to do so,
 *    delete this exception statement from your version. If you delete this
 *    exception statement from all source files in the program, then also delete
 *    it in the license file.
 ','line_number':1,'multiline':True]['text':' IWYU pragma: no_include "cxxabi.h"','line_number':34,'multiline':False]['text':' ReplSetReconfigArgs','line_number':62,'multiline':False]['text':' start up but do not initiate','line_number':102,'multiline':False]['text':' start up, become secondary, receive reconfig','line_number':115,'multiline':False]['text':' Reconfig command first waits for config commitment and will get an error.','line_number':196,'multiline':False]['text':' config term ','line_number':197,'multiline':True]['text':' Trying to wait on a config that has a term lower than the node's installed config','line_number':225,'multiline':False]['text':' term will result in a PrimarySteppedDown error.','line_number':226,'multiline':False]['text':' config term ','line_number':227,'multiline':True]['text':' start up, become primary, receive uninitializable config','line_number':235,'multiline':False]['text':' ErrorCodes::BadValue should be propagated from ReplSetConfig::initialize()','line_number':264,'multiline':False]['text':' start up, become primary, receive config with incorrect replset name','line_number':271,'multiline':False]['text':' start up, become primary, receive config with incorrect replset name','line_number':303,'multiline':False]['text':' start up, become primary, validate fails','line_number':338,'multiline':False]['text':' new config fails to validate because one node is localhost and another is not.','line_number':355,'multiline':False]['text':' Replica set id will be copied from existing configuration.','line_number':394,'multiline':False]['text':' Initiate a config without a term to avoid stepup auto-reconfig.','line_number':408,'multiline':False]['text':' Reconfig with version 3.','line_number':420,'multiline':False]['text':' The config version from the remote is lower, but its term is higher. The quorum checker','line_number':434,'multiline':False]['text':' does not compare config versions or terms of remotes nodes, so this should always','line_number':435,'multiline':False]['text':' succeed.','line_number':436,'multiline':False]['text':' Initiate a config without a term to avoid stepup auto-reconfig.','line_number':449,'multiline':False]['text':' Reconfig with version 3.','line_number':461,'multiline':False]['text':' The config version from the remote is higher, but its term is lower. The quorum checker','line_number':475,'multiline':False]['text':' does not compare config versions or terms of remotes nodes, so this should always','line_number':476,'multiline':False]['text':' succeed.','line_number':477,'multiline':False]['text':' start up, become primary, saving the config fails','line_number':491,'multiline':False]['text':' Advance optimes of secondary so we pass the config oplog commitment check.','line_number':509,'multiline':False]['text':' start up, become primary, reconfig, then before that reconfig concludes, reconfig again','line_number':526,'multiline':False]['text':' first reconfig','line_number':542,'multiline':False]['text':' second reconfig','line_number':548,'multiline':False]['text':' start up, initiate, then before that initiate concludes, reconfig','line_number':568,'multiline':False]['text':' initiate','line_number':575,'multiline':False]['text':' reconfig','line_number':583,'multiline':False]['text':' start up, become primary, reconfig successfully','line_number':603,'multiline':False]['text':' Advance optimes of secondary so we pass the config oplog commitment check.','line_number':622,'multiline':False]['text':' Satisfy quorum check.','line_number':631,'multiline':False]['text':' Receive heartbeat from secondary saying that it has replicated the new config (v: 3, t: 1).','line_number':634,'multiline':False]['text':' This should allow us to finish waiting for the config majority.','line_number':635,'multiline':False]['text':' start up, become primary, reconfig successfully','line_number':660,'multiline':False]['text':' Since we have simulated one election, term should be 1.','line_number':673,'multiline':False]['text':' Advance optimes of secondary so we pass the config oplog commitment check.','line_number':679,'multiline':False]['text':' Term is 1, but pass an invalid term, 50, to the reconfig command. The reconfig should still','line_number':685,'multiline':False]['text':' succeed because we will override 50 with 1.','line_number':686,'multiline':False]['text':' incorrect term ','line_number':688,'multiline':True]['text':' Satisfy quorum check.','line_number':690,'multiline':False]['text':' Satisfy config replication check.','line_number':692,'multiline':False]['text':' After the reconfig, the config term should be 1, not 50.','line_number':716,'multiline':False]['text':' start up, become primary, receive reconfig via heartbeat, then a second one','line_number':723,'multiline':False]['text':' from reconfig','line_number':724,'multiline':False]['text':' hb reconfig','line_number':741,'multiline':False]['text':' run until we've sent a heartbeat request','line_number':761,'multiline':False]['text':' reconfig','line_number':767,'multiline':False]['text':' start up, become primary, reconfig, while reconfigging receive reconfig via heartbeat','line_number':780,'multiline':False]['text':' start reconfigThread','line_number':795,'multiline':False]['text':' wait for reconfigThread to create network requests to ensure the replication coordinator','line_number':800,'multiline':False]['text':' is in state kConfigReconfiguring','line_number':801,'multiline':False]['text':' schedule hb reconfig','line_number':806,'multiline':False]['text':' run until we've sent a heartbeat request','line_number':807,'multiline':False]['text':' execute hb reconfig, which should fail with a log message; confirmed at end of test','line_number':831,'multiline':False]['text':' respond to reconfig's quorum check so that we can join that thread and exit cleanly','line_number':833,'multiline':False]['text':' start up, become a secondary, receive a forced reconfig','line_number':845,'multiline':False]['text':' fail before forced','line_number':859,'multiline':False]['text':' forced should succeed','line_number':874,'multiline':False]['text':' ensure forced reconfig results in a random larger version','line_number':879,'multiline':False]['text':' Adding an arbiter would change the default write concern from {w: majority} to {w: 1}.','line_number':901,'multiline':False]['text':' Removing an arbiter would change the default write concern from {w: 1} to {w: majority}.','line_number':939,'multiline':False]['text':' It's not safe to assert from any other thread other than the main thread in our unit tests.','line_number':976,'multiline':False]['text':' Doing so can prevent other tests in the suite from running. As a result, we define','line_number':977,'multiline':False]['text':' 'status' here, and check its value after the reconfig thread has finished.','line_number':978,'multiline':False]['text':' As we have set the cluster-wide write concern, the reconfig should succeed.','line_number':1010,'multiline':False]['text':' It's not safe to assert from any other thread other than the main thread in our unit tests.','line_number':1040,'multiline':False]['text':' Doing so can prevent other tests in the suite from running. As a result, we define','line_number':1041,'multiline':False]['text':' 'status' here, and check its value after the reconfig thread has finished.','line_number':1042,'multiline':False]['text':' As we have set the cluster-wide write concern, the reconfig should succeed.','line_number':1071,'multiline':False]['text':' It's not safe to assert from any other thread other than the main thread in our unit tests.','line_number':1096,'multiline':False]['text':' Doing so can prevent other tests in the suite from running. As a result, we define','line_number':1097,'multiline':False]['text':' 'status' here, and check its value after the reconfig thread has finished.','line_number':1098,'multiline':False]['text':' Adding another arbiter would keep the default write concern at {w: 1}.','line_number':1104,'multiline':False]['text':' It's not safe to assert from any other thread other than the main thread in our unit tests.','line_number':1158,'multiline':False]['text':' Doing so can prevent other tests in the suite from running. As a result, we define','line_number':1159,'multiline':False]['text':' 'status' here, and check its value after the reconfig thread has finished.','line_number':1160,'multiline':False]['text':' Adding another data-bearing node would keep the default write concern at {w: majority}.','line_number':1166,'multiline':False]['text':' Secondaries learn of the config version and term immediately.','line_number':1225,'multiline':False]['text':' 'newlyAdded' should only be set to true if the repl set goes through reconfig.','line_number':1253,'multiline':False]['text':' Simulate application of one oplog entry.','line_number':1257,'multiline':False]['text':' Get elected primary.','line_number':1260,'multiline':False]['text':' Advance your optime.','line_number':1265,'multiline':False]['text':' Satisfy quorum check with heartbeats.','line_number':1338,'multiline':False]['text':' Consume any outstanding heartbeats that were scheduled after reconfig finished.','line_number':1345,'multiline':False]['text':' Start up as a secondary and then get elected.','line_number':1359,'multiline':False]['text':' We only check for ourselves if the config contents actually change.','line_number':1362,'multiline':False]['text':' bypass quickfind','line_number':1377,'multiline':False]['text':' We must be present in the new config. Must hold for both safe and force reconfig.','line_number':1396,'multiline':False]['text':' We must be electable in the new config. Only required for safe reconfig.','line_number':1408,'multiline':False]['text':' h3 has priority 0 (unelectable).','line_number':1410,'multiline':False]['text':' Start up as a secondary and then get elected.','line_number':1424,'multiline':False]['text':' We only check for ourselves if the config contents actually change.','line_number':1427,'multiline':False]['text':' Satisfy the quorum check.','line_number':1471,'multiline':False]['text':' Verify an heartbeat to each of the recipient members has been scheduled at the end of','line_number':1481,'multiline':False]['text':' reconfig to inform them of the new split config.','line_number':1482,'multiline':False]['text':' Start up as a secondary.','line_number':1503,'multiline':False]['text':' Simulate application of one oplog entry.','line_number':1513,'multiline':False]['text':' Get elected primary.','line_number':1516,'multiline':False]['text':' Advance the commit point by simulating optime reports from nodes.','line_number':1521,'multiline':False]['text':' An initial reconfig should succeed, since there is no config prior to the initial config.','line_number':1529,'multiline':False]['text':' Consume all remaining heartbeat requests.','line_number':1538,'multiline':False]['text':' Satisfy the quorum check.','line_number':1552,'multiline':False]['text':' Satisfy config replication check.','line_number':1558,'multiline':False]['text':' Satisfy oplog commitment wait.','line_number':1564,'multiline':False]['text':' The initial reconfig should succeed, since there is no config prior to the initial','line_number':1568,'multiline':False]['text':' config.','line_number':1569,'multiline':False]['text':' Start out in config version 2 to simulate case where a node that already has a non-initial','line_number':1576,'multiline':False]['text':' config.','line_number':1577,'multiline':False]['text':' Simulate application of one oplog entry.','line_number':1585,'multiline':False]['text':' Get elected primary.','line_number':1588,'multiline':False]['text':' Write one new oplog entry.','line_number':1593,'multiline':False]['text':' Do a reconfig that should fail the oplog commitment pre-condition check.','line_number':1598,'multiline':False]['text':' Consume all remaining heartbeat requests.','line_number':1604,'multiline':False]['text':' Reconfig should now succeed after advancing optime of other node.','line_number':1621,'multiline':False]['text':' Satisfy the quorum check.','line_number':1628,'multiline':False]['text':' Satisfy config replication check.','line_number':1633,'multiline':False]['text':' Start out in a non-initial config version.','line_number':1643,'multiline':False]['text':' Startup, simulate application of one oplog entry and get elected.','line_number':1649,'multiline':False]['text':' Write and commit one new oplog entry, and consume any heartbeats.','line_number':1657,'multiline':False]['text':' Do a first reconfig that should succeed since the current config is committed.','line_number':1663,'multiline':False]['text':' quorumHbs ','line_number':1667,'multiline':True]['text':' config term ','line_number':1671,'multiline':True]['text':' Run clock past the deadline.','line_number':1674,'multiline':False]['text':' Start out in a non-initial config version.','line_number':1684,'multiline':False]['text':' Startup, simulate application of one oplog entry and get elected.','line_number':1690,'multiline':False]['text':' Write and commit one new oplog entry, and consume any heartbeats.','line_number':1698,'multiline':False]['text':' Do a first reconfig that should succeed since the current config is committed.','line_number':1704,'multiline':False]['text':' quorumHbs ','line_number':1707,'multiline':True]['text':' Replicate op to ensure config is committed.','line_number':1709,'multiline':False]['text':' config term ','line_number':1711,'multiline':True]['text':' Start out in a non-initial config version.','line_number':1716,'multiline':False]['text':' Startup, simulate application of one oplog entry and get elected.','line_number':1722,'multiline':False]['text':' Write and commit one new oplog entry, and consume any heartbeats.','line_number':1730,'multiline':False]['text':' Do a first reconfig that should succeed since the current config is committed.','line_number':1737,'multiline':False]['text':' quorumHbs ','line_number':1739,'multiline':True]['text':' Try to reconfig out of Cb which should fail.','line_number':1741,'multiline':False]['text':' quorumHbs ','line_number':1743,'multiline':True]['text':' Catch up node and try reconfig again.','line_number':1746,'multiline':False]['text':' quorumHbs ','line_number':1748,'multiline':True]['text':' Start out in a non-initial config version.','line_number':1753,'multiline':False]['text':' Start up, simulate application of one oplog entry and get elected.','line_number':1761,'multiline':False]['text':' Write and commit one new oplog entry, and consume any heartbeats.','line_number':1769,'multiline':False]['text':' Do a first reconfig that should succeed since the current config is committed.','line_number':1777,'multiline':False]['text':' quorumHbs ','line_number':1779,'multiline':True]['text':' Try to reconfig out of Cb which should fail.','line_number':1781,'multiline':False]['text':' quorumHbs ','line_number':1783,'multiline':True]['text':' Catch up node and try reconfig again.','line_number':1786,'multiline':False]['text':' quorumHbs ','line_number':1788,'multiline':True]['text':' Start out in a non-initial config version.','line_number':1793,'multiline':False]['text':' Start up, simulate application of one oplog entry and get elected.','line_number':1799,'multiline':False]['text':' Write and commit one new oplog entry, and consume any heartbeats. We replicate the op to node','line_number':1807,'multiline':False]['text':' 3, which will be removed from the config.','line_number':1808,'multiline':False]['text':' Do a first reconfig that should succeed since the current config is committed.','line_number':1816,'multiline':False]['text':' quorumHbs ','line_number':1818,'multiline':True]['text':' Try to reconfig out of Cb which should fail.','line_number':1820,'multiline':False]['text':' quorumHbs ','line_number':1822,'multiline':True]['text':' Catch up node and try reconfig again.','line_number':1825,'multiline':False]['text':' quorumHbs ','line_number':1827,'multiline':True]['text':' Start out in a non-initial config version.','line_number':1832,'multiline':False]['text':' Start up, simulate application of one oplog entry and get elected.','line_number':1840,'multiline':False]['text':' Write and commit one new oplog entry, and consume any heartbeats. We replicate the op to','line_number':1848,'multiline':False]['text':' nodes 4 and 5, one of which will be removed from the config.','line_number':1849,'multiline':False]['text':' Do a first reconfig that should succeed since the current config is committed.','line_number':1858,'multiline':False]['text':' quorumHbs ','line_number':1860,'multiline':True]['text':' Try to reconfig out of Cb which should fail.','line_number':1862,'multiline':False]['text':' quorumHbs ','line_number':1864,'multiline':True]['text':' Catch up node and try reconfig again.','line_number':1867,'multiline':False]['text':' quorumHbs ','line_number':1869,'multiline':True]['text':' Start out in config version 2 to simulate case where a node that already has a non-initial','line_number':1874,'multiline':False]['text':' config.','line_number':1875,'multiline':False]['text':' Simulate application of one oplog entry.','line_number':1883,'multiline':False]['text':' Get elected primary.','line_number':1886,'multiline':False]['text':' Advance your optime.','line_number':1891,'multiline':False]['text':' Do a force reconfig that should succeed even though oplog commitment pre-condition check is','line_number':1894,'multiline':False]['text':' not satisfied.','line_number':1895,'multiline':False]['text':' Start out in a non-initial config version.','line_number':1914,'multiline':False]['text':' Simulate application of one oplog entry.','line_number':1924,'multiline':False]['text':' Get elected primary.','line_number':1927,'multiline':False]['text':' Advance your optime.','line_number':1932,'multiline':False]['text':' Respond to heartbeats before reconfig.','line_number':1937,'multiline':False]['text':' Do a reconfig that should fail due to stepdown.','line_number':1940,'multiline':False]['text':' Turn on a reconfig hang to ensure that the reconfig thread will be scheduled before the node','line_number':1946,'multiline':False]['text':' is stepped down. If the node is stepped down before reconfig is initiated, the reconfig will','line_number':1947,'multiline':False]['text':' fail with a different reason than expected.','line_number':1948,'multiline':False]['text':' Ensure the reconfig thread has started before stepping down as primary.','line_number':1959,'multiline':False]['text':' The failpoint should be released now. We run the clock forward so that the reconfig can','line_number':1963,'multiline':False]['text':' continue.','line_number':1964,'multiline':False]['text':' Step down due to a higher term.','line_number':1969,'multiline':False]['text':' Respond to quorum check to resume the reconfig. We keep responding until the reconfig thread','line_number':1976,'multiline':False]['text':' finishes.','line_number':1977,'multiline':False]['text':' Start up as a secondary.','line_number':1988,'multiline':False]['text':' Simulate application of one oplog entry.','line_number':1996,'multiline':False]['text':' Construct the new config of single node replset.','line_number':1999,'multiline':False]['text':' Do a reconfig that adds new nodes to the repl set.','line_number':2019,'multiline':False]['text':' quorumHbs ','line_number':2023,'multiline':True]['text':' Verify that the newly added node has the flag set to true.','line_number':2031,'multiline':False]['text':' Verify that a log message was created for adding the 'newlyAdded' field.','line_number':2034,'multiline':False]['text':' Do a reconfig that adds a new node with 'votes: 0'.','line_number':2044,'multiline':False]['text':' quorumHbs ','line_number':2052,'multiline':True]['text':' Verify that the new node with 'votes: 0' does not have the 'newlyAdded' field set.','line_number':2060,'multiline':False]['text':' Verify that a log message was not created, since we did not add a 'newlyAdded' field.','line_number':2063,'multiline':False]['text':' quorumHbs ','line_number':2076,'multiline':True]['text':' Verify that the renamed node is not considered newly added, since the _id field remained the','line_number':2083,'multiline':False]['text':' same.','line_number':2084,'multiline':False]['text':' Verify that a log message was not created, since we did not add a 'newlyAdded' field.','line_number':2087,'multiline':False]['text':' Do a reconfig that changes the order but not the ids of the members.','line_number':2097,'multiline':False]['text':' quorumHbs ','line_number':2101,'multiline':True]['text':' Verify that neither of the nodes are considered newly added.','line_number':2106,'multiline':False]['text':' Verify that a log message was not created, since we did not add a 'newlyAdded' field.','line_number':2110,'multiline':False]['text':' Do a reconfig that adds a new member, giving it the 'newlyAdded' field.','line_number':2120,'multiline':False]['text':' quorumHbs ','line_number':2124,'multiline':True]['text':' Verify that the new member has its 'newlyAdded' field set.','line_number':2130,'multiline':False]['text':' The new member should not be considered as a voting node while its 'newlyAdded' field is set.','line_number':2133,'multiline':False]['text':' Verify that a log message was created for adding the 'newlyAdded' field.','line_number':2136,'multiline':False]['text':' Advance the commit point on all nodes.','line_number':2141,'multiline':False]['text':' Do a force reconfig that only changes the order of the members.','line_number':2148,'multiline':False]['text':' Verify that the new member does not have its 'newlyAdded' field set.','line_number':2162,'multiline':False]['text':' Verify that the new member is now considered to be a voting node.','line_number':2165,'multiline':False]['text':' Verify that a log message was not created for adding the 'newlyAdded' field.','line_number':2168,'multiline':False]['text':' Do a force reconfig that adds a new voting member to the repl set.','line_number':2181,'multiline':False]['text':' Verify that the new member does not have its 'newlyAdded' field set.','line_number':2191,'multiline':False]['text':' Verify that a log message was not created for adding the 'newlyAdded' field.','line_number':2194,'multiline':False]['text':' Do a force reconfig that includes a member that has a 'newlyAdded' field set to true.','line_number':2207,'multiline':False]['text':' Do a force reconfig that includes a member that has a 'newlyAdded' field set to false.','line_number':2227,'multiline':False]['text':' Do a reconfig that tries to add a new member with 'newlyAdded' field passed in.','line_number':2244,'multiline':False]['text':' quorumHbs ','line_number':2251,'multiline':True]['text':' Verify that an error message was created when the user provides a 'newlyAdded' field during a','line_number':2256,'multiline':False]['text':' non-force reconfig.','line_number':2257,'multiline':False]['text':' Verify that a log message was not created for rewritting the new config, since we did not add','line_number':2262,'multiline':False]['text':' a 'newlyAdded' field.','line_number':2263,'multiline':False]['text':' Do a reconfig that adds a new member.','line_number':2273,'multiline':False]['text':' quorumHbs ','line_number':2278,'multiline':True]['text':' Verify that the 'newlyAdded' field was added to the node.','line_number':2283,'multiline':False]['text':' Advance the commit point on all nodes.','line_number':2290,'multiline':False]['text':' Do a reconfig that only changes the order of the nodes.','line_number':2297,'multiline':False]['text':' quorumHbs ','line_number':2301,'multiline':True]['text':' Verify that the 'newlyAdded' field persisted on the node.','line_number':2306,'multiline':False]['text':' Verify that a log message was created for adding the 'newlyAdded' field.','line_number':2309,'multiline':False]['text':' Do a reconfig that adds a new member.','line_number':2319,'multiline':False]['text':' quorumHbs ','line_number':2324,'multiline':True]['text':' Verify that the 'newlyAdded' field was added to the node.','line_number':2329,'multiline':False]['text':' Advance the commit point on all nodes.','line_number':2336,'multiline':False]['text':' Add another new member to the set.','line_number':2343,'multiline':False]['text':' quorumHbs ','line_number':2349,'multiline':True]['text':' Verify that the 'newlyAdded' field persisted on the node added in the first reconfig.','line_number':2354,'multiline':False]['text':' Verify that the 'newlyAdded' field was set on the node added in the second reconfig.','line_number':2356,'multiline':False]['text':' Verify that a log message was created for adding the 'newlyAdded' field.','line_number':2359,'multiline':False]['text':' Do a reconfig that adds a new member.','line_number':2369,'multiline':False]['text':' quorumHbs ','line_number':2373,'multiline':True]['text':' Verify that the newly added node is not considered a voting node.','line_number':2384,'multiline':False]['text':' Verify that the rest of the majorities and counts were updated correctly.','line_number':2387,'multiline':False]['text':' Do a reconfig that adds a new member.','line_number':2397,'multiline':False]['text':' quorumHbs ','line_number':2405,'multiline':True]['text':' Verify that the first newly added node has effective priority 0.','line_number':2416,'multiline':False]['text':' Advance the commit point on all nodes.','line_number':2419,'multiline':False]['text':' Do another reconfig that adds a new member.','line_number':2426,'multiline':False]['text':' quorumHbs ','line_number':2437,'multiline':True]['text':' Verify that the first newly added node is still has effective priority 0.','line_number':2450,'multiline':False]['text':' Verify that the second newly added node also has effective priority 0.','line_number':2453,'multiline':False]['text':' Do a reconfig that adds a new arbiter.','line_number':2467,'multiline':False]['text':' quorumHbs ','line_number':2474,'multiline':True]['text':' Verify that the node did not have 'newlyAdded' set.','line_number':2480,'multiline':False]['text':' Verify that the node is a voting member.','line_number':2483,'multiline':False]['text':' Verify that a log message was not created for adding the 'newlyAdded' field.','line_number':2486,'multiline':False]['text':' Do a force reconfig that tries to add an arbiter with 'newlyAdded: true'.','line_number':2499,'multiline':False]['text':' Win election but don't exit drain mode.','line_number':2538,'multiline':False]['text':' Receive a heartbeat that should NOT schedule a new heartbeat to fetch a newer config.','line_number':2543,'multiline':False]['text':' simulate a newer config version.','line_number':2546,'multiline':False]['text':' No requests should have been scheduled.','line_number':2557,'multiline':False]['text':' Receive a heartbeat that schedules a new heartbeat to fetch a newer config. We simulate a','line_number':2562,'multiline':False]['text':' newer config version and an uninitialized term, so that a heartbeat will be scheduled to','line_number':2563,'multiline':False]['text':' fetch a new config. When we mock the heartbeat response below, we will respond with a','line_number':2564,'multiline':False]['text':' non-force config, which is to test the case where the sending node installed a non force','line_number':2565,'multiline':False]['text':' config after we scheduled a heartbeat to it to fetch a force config. For safety, the','line_number':2566,'multiline':False]['text':' important aspect is that we don't accept/install configs during drain mode, even if we try to','line_number':2567,'multiline':False]['text':' fetch them.','line_number':2568,'multiline':False]['text':' Schedule a response with a newer config.','line_number':2579,'multiline':False]['text':' Make sure the heartbeat reconfig has not been scheduled.','line_number':2612,'multiline':False]['text':' Let drain mode complete.','line_number':2615,'multiline':False]['text':' We should have moved to a new term in the election, and our config should have the same term.','line_number':2618,'multiline':False]['text':' Win election but don't exit drain mode.','line_number':2639,'multiline':False]['text':' Receive a heartbeat that schedules a new heartbeat to fetch a newer config.','line_number':2644,'multiline':False]['text':' simulate a newer config version.','line_number':2647,'multiline':False]['text':' force config.','line_number':2648,'multiline':False]['text':' Schedule a response with a newer config.','line_number':2658,'multiline':False]['text':' Prevent the heartbeat reconfig from completing.','line_number':2690,'multiline':False]['text':' Let the heartbeat reconfig begin.','line_number':2693,'multiline':False]['text':' For force reconfigs, we do allow them to proceed even if we are in drain mode, so make','line_number':2698,'multiline':False]['text':' sure it is in progress, stuck at the failpoint before completion.','line_number':2699,'multiline':False]['text':' At this point the heartbeat reconfig should be in progress but blocked from completion by','line_number':2702,'multiline':False]['text':' the failpoint. We now let drain mode complete. The step up reconfig should be interrupted','line_number':2703,'multiline':False]['text':' by the in progress heartbeat reconfig.','line_number':2704,'multiline':False]['text':' The failpoint should be released now, allowing the heartbeat reconfig to complete. We run the','line_number':2708,'multiline':False]['text':' clock forward so the re-scheduled heartbeat reconfig will complete.','line_number':2709,'multiline':False]['text':' We should have moved to a new term in the election, but our config should have the term from','line_number':2714,'multiline':False]['text':' the force config.','line_number':2715,'multiline':False]['text':' Reconfig to add third member.','line_number':2734,'multiline':False]['text':' Satisfy the quorum check.','line_number':2755,'multiline':False]['text':' Satisfy config replication check.','line_number':2760,'multiline':False]['text':' Reconfig to add third member.','line_number':2787,'multiline':False]['text':' Reconfig to add third member.','line_number':2821,'multiline':False]['text':' Satisfy the quorum check.','line_number':2843,'multiline':False]['text':' Satisfy config replication check.','line_number':2848,'multiline':False]['text':' anonymous namespace','line_number':2861,'multiline':False]['text':' namespace repl','line_number':2862,'multiline':False]['text':' namespace mongo','line_number':2863,'multiline':False]