['text':'*
 *    Copyright (C) 2018-present MongoDB, Inc.
 *
 *    This program is free software: you can redistribute it and/or modify
 *    it under the terms of the Server Side Public License, version 1,
 *    as published by MongoDB, Inc.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    Server Side Public License for more details.
 *
 *    You should have received a copy of the Server Side Public License
 *    along with this program. If not, see
 *    <http://www.mongodb.com/licensing/server-side-public-license>.
 *
 *    As a special exception, the copyright holders give permission to link the
 *    code of portions of this program with the OpenSSL library under certain
 *    conditions as described in each individual source file and distribute
 *    linked combinations including the program with the OpenSSL library. You
 *    must comply with the Server Side Public License in all respects for
 *    all of the code used other than as permitted herein. If you modify file(s)
 *    with this exception, you may extend this exception to your version of the
 *    file(s), but you are not obligated to do so. If you do not wish to do so,
 *    delete this exception statement from your version. If you delete this
 *    exception statement from all source files in the program, then also delete
 *    it in the license file.
 ','line_number':1,'multiline':True]['text':' Heartbeat default behavior.','line_number':136,'multiline':False]['text':' Verify for numerous rounds of random number generation.','line_number':186,'multiline':False]['text':' Make sure that an election timeout of 1ms doesn't make the random number','line_number':209,'multiline':False]['text':' generator attempt to divide by zero.','line_number':210,'multiline':False]['text':' ElectionState::start is called when election timeout expires, so election','line_number':259,'multiline':False]['text':' finished event has been set.','line_number':260,'multiline':False]['text':' Since we're still in drain mode, expect that we report isWritablePrimary:false,','line_number':271,'multiline':False]['text':' issecondary:true.','line_number':272,'multiline':False]['text':' Since we're still in drain mode, expect that we report isWritablePrimary:false,','line_number':329,'multiline':False]['text':' issecondary:true.','line_number':330,'multiline':False]['text':' Check that only the 'numCatchUpsSkipped' primary catchup conclusion reason was incremented.','line_number':341,'multiline':False]['text':' Check last vote','line_number':379,'multiline':False]['text':' Check that the numElectionTimeoutsCalled and the numElectionTimeoutsSuccessful election','line_number':388,'multiline':False]['text':' metrics have been incremented, and that none of the metrics that track the number of','line_number':389,'multiline':False]['text':' elections called or successful for other reasons has been incremented.','line_number':390,'multiline':False]['text':' Check last vote','line_number':435,'multiline':False]['text':' This is to demonstrate the unit testing mock framework. The logic is the same as the original','line_number':445,'multiline':False]['text':' test.','line_number':446,'multiline':False]['text':' Check that the node's election candidate metrics are unset before it becomes primary.','line_number':450,'multiline':False]['text':' Trigger election.','line_number':466,'multiline':False]['text':' Check that the node's election candidate metrics have been cleared, since it lost the dry-run','line_number':475,'multiline':False]['text':' election and will not become primary.','line_number':476,'multiline':False]['text':' This is to showcase the mock's behavior when we have extraneous, unsatisfied expectations.','line_number':481,'multiline':False]['text':' Check that the node's election candidate metrics are unset before it becomes primary.','line_number':486,'multiline':False]['text':' This will be satisfied.','line_number':496,'multiline':False]['text':' This will NOT be satisfied.','line_number':503,'multiline':False]['text':' Trigger election. This will also satisfy our original expectation.','line_number':506,'multiline':False]['text':' This will throw, as we have an unsatisfied expectation.','line_number':509,'multiline':False]['text':' Clear expectations so we can end the test.','line_number':512,'multiline':False]['text':' (You should normally aim to meet all of your expectations.)','line_number':513,'multiline':False]['text':' Alternatively, calling this first will hang until everything has been satisfied.','line_number':516,'multiline':False]['text':' In our case, this will trivially succeed as we cleared all expectations above.','line_number':517,'multiline':False]['text':' Check that the node's election candidate metrics have been cleared, since it lost the dry-run','line_number':525,'multiline':False]['text':' election and will not become primary.','line_number':526,'multiline':False]['text':' Check that the node's election candidate metrics are unset before it becomes primary.','line_number':553,'multiline':False]['text':' The heartbeat has been consumed.','line_number':578,'multiline':False]['text':' Check that the node's election candidate metrics are not set if a dry run fails.','line_number':587,'multiline':False]['text':' Check that the node's election candidate metrics have been cleared, since it lost the dry-run','line_number':602,'multiline':False]['text':' election and will not become primary.','line_number':603,'multiline':False]['text':' The heartbeat has been consumed.','line_number':651,'multiline':False]['text':' candidateIndex ','line_number':687,'multiline':True]['text':' term ','line_number':688,'multiline':True]['text':' primaryIndex ','line_number':691,'multiline':True]['text':' start up, receive reconfig via heartbeat while at the same time, become candidate.','line_number':722,'multiline':False]['text':' candidate state should be cleared.','line_number':723,'multiline':False]['text':' hb reconfig','line_number':745,'multiline':False]['text':' run until we've sent a heartbeat request','line_number':763,'multiline':False]['text':' prepare candidacy','line_number':769,'multiline':False]['text':' receive sufficient heartbeats to allow the node to see a majority.','line_number':786,'multiline':False]['text':' Advance the simulator clock sufficiently to trigger an election.','line_number':820,'multiline':False]['text':' Black hole all requests other than heartbeats including vote requests.','line_number':835,'multiline':False]['text':' ensure node does not stand for election','line_number':842,'multiline':False]['text':' We must take the RSTL in mode X before transitioning to RS_ROLLBACK.','line_number':923,'multiline':False]['text':' We do not need to respond to any pending network operations because setFollowerMode() will','line_number':932,'multiline':False]['text':' cancel the freshness checker and election command runner.','line_number':933,'multiline':False]['text':' Check that the node's election candidate metrics are unset before it becomes primary.','line_number':956,'multiline':False]['text':' Check that the node's election candidate metrics are set once it has called an election.','line_number':963,'multiline':False]['text':' Check that the node's election candidate metrics have been cleared, since it lost the actual','line_number':996,'multiline':False]['text':' election and will not become primary.','line_number':997,'multiline':False]['text':' Update to a future term before dry run completes.','line_number':1026,'multiline':False]['text':' update to a future term before the election completes','line_number':1064,'multiline':False]['text':' Initialize my last applied, so that the node is electable.','line_number':1103,'multiline':False]['text':' Oplog applier attempts to transition the state to Secondary, which triggers','line_number':1109,'multiline':False]['text':' election on single node.','line_number':1110,'multiline':False]['text':' Run pending election operations on executor.','line_number':1112,'multiline':False]['text':' Initialize my last applied, so that the node is electable.','line_number':1123,'multiline':False]['text':' Oplog applier attempts to transition the state to Secondary, which triggers','line_number':1127,'multiline':False]['text':' election on single node.','line_number':1128,'multiline':False]['text':' Run pending election operations on executor.','line_number':1131,'multiline':False]['text':'
     * Verify that a given priority takeover delay is valid. Takeover delays are
     * verified in terms of bounds since the delay value is randomized.
     ','line_number':1140,'multiline':True]['text':'
     * Processes and mocks responses to any pending PV1 heartbeat requests that have been
     * scheduled at or before 'until'. For any such scheduled heartbeat requests, the
     * heartbeat responses will be mocked at the same time the request was made. So,
     * for a heartbeat request made at time 't', the response will be mocked as
     * occurring at time 't'. This function will always run the clock forward to time
     * 'until'.
     *
     * The applied & durable optimes of the mocked response will be set to
     * 'otherNodesOpTime', and the primary set as 'primaryHostAndPort'.
     *
     * Returns the time that it ran until, which should always be equal to 'until'.
     ','line_number':1164,'multiline':True]['text':' If 'until' is equal to net->now(), process any currently queued requests and return,','line_number':1185,'multiline':False]['text':' without running the clock.','line_number':1186,'multiline':False]['text':' Otherwise, run clock and process heartbeats along the way.','line_number':1190,'multiline':False]['text':' Run clock forward to time 'until', or until the time of the next queued request.','line_number':1192,'multiline':False]['text':' Check last vote','line_number':1217,'multiline':False]['text':'
     * Processes and schedules mock responses to any PV1 heartbeat requests scheduled at or
     * before the current time. Assumes that the caller has already entered the network with
     * 'enterNetwork()'. It does not run the virtual clock.
     *
     * Intended as a helper function only.
     ','line_number':1232,'multiline':True]['text':' Process all requests queued at the present time.','line_number':1246,'multiline':False]['text':' If we see that the next request isn't for a heartbeat, exit the function.','line_number':1249,'multiline':False]['text':' This allows us to mock heartbeat responses with whatever info we want','line_number':1250,'multiline':False]['text':' right up until another event happens (like an election). This is','line_number':1251,'multiline':False]['text':' particularly important for simulating a catchup takeover because','line_number':1252,'multiline':False]['text':' we need to know specific info about the primary.','line_number':1253,'multiline':False]['text':' Make sure the heartbeat request is valid.','line_number':1269,'multiline':False]['text':' Build the mock heartbeat response.','line_number':1273,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover has been scheduled yet.','line_number':1323,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough','line_number':1327,'multiline':False]['text':' information to know that we are fresher than the current primary.','line_number':1328,'multiline':False]['text':' Make sure that the catchup takeover was not scheduled.','line_number':1331,'multiline':False]['text':' Update the current term to simulate a scenario where an election has occured','line_number':1353,'multiline':False]['text':' and some other node became the new primary. Once you hear about a primary election','line_number':1354,'multiline':False]['text':' in term 1, your term will be increased.','line_number':1355,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover has been scheduled yet.','line_number':1361,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':1365,'multiline':False]['text':' that we are fresher than the current primary, prompting the scheduling of a catchup','line_number':1366,'multiline':False]['text':' takeover.','line_number':1367,'multiline':False]['text':' Make sure that the catchup takeover has actually been scheduled and at the','line_number':1370,'multiline':False]['text':' correct time.','line_number':1371,'multiline':False]['text':' Update the current term to simulate a scenario where an election has occured','line_number':1398,'multiline':False]['text':' and some other node became the new primary. Once you hear about a primary election','line_number':1399,'multiline':False]['text':' in term 1, your term will be increased.','line_number':1400,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover has been scheduled.','line_number':1406,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':1410,'multiline':False]['text':' that we are fresher than the current primary, prompting the scheduling of a catchup','line_number':1411,'multiline':False]['text':' takeover.','line_number':1412,'multiline':False]['text':' Make sure that the catchup takeover has actually been scheduled at the','line_number':1415,'multiline':False]['text':' correct time and that a priority takeover has not been scheduled.','line_number':1416,'multiline':False]['text':' Update the current term to simulate a scenario where an election has occured','line_number':1448,'multiline':False]['text':' and some other node became the new primary. Once you hear about a primary election','line_number':1449,'multiline':False]['text':' in term 1, your term will be increased.','line_number':1450,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover has been scheduled.','line_number':1456,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':1460,'multiline':False]['text':' that we are fresher than the current primary, prompting the scheduling of a takeover.','line_number':1461,'multiline':False]['text':' Assert that a priority takeover has been scheduled and that a catchup takeover has not','line_number':1464,'multiline':False]['text':' been scheduled.','line_number':1465,'multiline':False]['text':' Update the current term to simulate a scenario where an election has occured','line_number':1494,'multiline':False]['text':' and some other node became the new primary. Once you hear about a primary election','line_number':1495,'multiline':False]['text':' in term 1, your term will be increased.','line_number':1496,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover has been scheduled.','line_number':1502,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':1506,'multiline':False]['text':' that we are fresher than the current primary, prompting the scheduling of a catchup','line_number':1507,'multiline':False]['text':' takeover.','line_number':1508,'multiline':False]['text':' Make sure that the catchup takeover has actually been scheduled and at the','line_number':1511,'multiline':False]['text':' correct time.','line_number':1512,'multiline':False]['text':' Mock another round of heartbeat responses','line_number':1520,'multiline':False]['text':' Make sure another catchup takeover wasn't scheduled','line_number':1524,'multiline':False]['text':' In order for node 1 to first schedule a catchup takeover, then a priority takeover','line_number':1542,'multiline':False]['text':' once the first gets canceled, it must have a higher priority than the current primary','line_number':1543,'multiline':False]['text':' (node 2). But, it must not have the highest priority in the replica set. Otherwise,','line_number':1544,'multiline':False]['text':' it will schedule a priority takeover from the start.','line_number':1545,'multiline':False]['text':' Update the current term to simulate a scenario where an election has occured','line_number':1553,'multiline':False]['text':' and some other node became the new primary. Once you hear about a primary election','line_number':1554,'multiline':False]['text':' in term 1, your term will be increased.','line_number':1555,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover has been scheduled.','line_number':1561,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':1565,'multiline':False]['text':' that we are fresher than the current primary, prompting the scheduling of a catchup','line_number':1566,'multiline':False]['text':' takeover.','line_number':1567,'multiline':False]['text':' Make sure that the catchup takeover has actually been scheduled and at the','line_number':1570,'multiline':False]['text':' correct time.','line_number':1571,'multiline':False]['text':' Create a new OpTime so that the primary's last applied OpTime will be in the current term.','line_number':1577,'multiline':False]['text':' Mock another heartbeat where the primary is now up to date.','line_number':1579,'multiline':False]['text':' Since the primary has caught up, we cancel the scheduled catchup takeover.','line_number':1583,'multiline':False]['text':' But we are still higher priority than the primary, so after the heartbeat','line_number':1584,'multiline':False]['text':' we will schedule a priority takeover.','line_number':1585,'multiline':False]['text':' Force election timeouts to be exact, with no randomized offset, so that when the election','line_number':1602,'multiline':False]['text':' timeout fires below we still think we can see a majority.','line_number':1603,'multiline':False]['text':' Update the current term to simulate a scenario where an election has occured','line_number':1610,'multiline':False]['text':' and some other node became the new primary. Once you hear about a primary election','line_number':1611,'multiline':False]['text':' in term 1, your term will be increased.','line_number':1612,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover has been scheduled.','line_number':1618,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':1624,'multiline':False]['text':' that we are fresher than the current primary, prompting the scheduling of a catchup','line_number':1625,'multiline':False]['text':' takeover.','line_number':1626,'multiline':False]['text':' Make sure that the catchup takeover has actually been scheduled and at the','line_number':1629,'multiline':False]['text':' correct time.','line_number':1630,'multiline':False]['text':' Fast forward clock to after electionTimeout and black hole all','line_number':1636,'multiline':False]['text':' heartbeat requests to make sure the election timeout runs.','line_number':1637,'multiline':False]['text':' Make sure catchup takeover never happend and CatchupTakeover callback was canceled.','line_number':1656,'multiline':False]['text':' Update the current term to simulate a scenario where an election has occured','line_number':1682,'multiline':False]['text':' and some other node became the new primary. Once you hear about a primary election','line_number':1683,'multiline':False]['text':' in term 1, your term will be increased.','line_number':1684,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover has been scheduled.','line_number':1690,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':1696,'multiline':False]['text':' that we are fresher than the current primary, prompting the scheduling of a catchup','line_number':1697,'multiline':False]['text':' takeover.','line_number':1698,'multiline':False]['text':' Make sure that the catchup takeover has actually been scheduled and at the','line_number':1701,'multiline':False]['text':' correct time.','line_number':1702,'multiline':False]['text':' We must take the RSTL in mode X before transitioning to RS_ROLLBACK.','line_number':1708,'multiline':False]['text':' Transitioning to rollback state should cancel the takeover','line_number':1712,'multiline':False]['text':' Make sure catchup takeover never happend and CatchupTakeover callback was canceled.','line_number':1718,'multiline':False]['text':' Update the term so that the current term is ahead of the term of','line_number':1749,'multiline':False]['text':' the last applied op time. This means that the primary is still in','line_number':1750,'multiline':False]['text':' catchup mode since it hasn't written anything this term.','line_number':1751,'multiline':False]['text':' Make sure we're secondary and that no takeover has been scheduled.','line_number':1760,'multiline':False]['text':' Mock a first round of heartbeat responses.','line_number':1764,'multiline':False]['text':' Make sure that the catchup takeover has actually been scheduled and at the','line_number':1767,'multiline':False]['text':' correct time.','line_number':1768,'multiline':False]['text':' The catchup takeover will be scheduled at a time later than one election','line_number':1776,'multiline':False]['text':' timeout after our initial heartbeat responses, so mock a few rounds of','line_number':1777,'multiline':False]['text':' heartbeat responses to prevent a normal election timeout.','line_number':1778,'multiline':False]['text':' Since the heartbeats go through the catchupTakeoverTimeout, this log','line_number':1783,'multiline':False]['text':' message happens already (otherwise it would happen in performSuccessfulTakeover).','line_number':1784,'multiline':False]['text':' Check that the numCatchUpTakeoversCalled and the numCatchUpTakeoversSuccessful election','line_number':1799,'multiline':False]['text':' metrics have been incremented, and that none of the metrics that track the number of','line_number':1800,'multiline':False]['text':' elections called or successful for other reasons has been incremented.','line_number':1801,'multiline':False]['text':' Update the term so that the current term is ahead of the term of','line_number':1845,'multiline':False]['text':' the last applied op time. This means that the primary is still in','line_number':1846,'multiline':False]['text':' catchup mode since it hasn't written anything this term.','line_number':1847,'multiline':False]['text':' Make sure we're secondary and that no takeover has been scheduled.','line_number':1856,'multiline':False]['text':' Mock a first round of heartbeat responses.','line_number':1860,'multiline':False]['text':' Make sure that the catchup takeover has actually been scheduled and at the','line_number':1863,'multiline':False]['text':' correct time.','line_number':1864,'multiline':False]['text':' The catchup takeover will be scheduled at a time later than one election','line_number':1870,'multiline':False]['text':' timeout after our initial heartbeat responses, so mock a few rounds of','line_number':1871,'multiline':False]['text':' heartbeat responses to prevent a normal election timeout.','line_number':1872,'multiline':False]['text':' Simulate a dry run where the primary has caught up and is now ahead of the','line_number':1879,'multiline':False]['text':' node trying to do the catchup takeover. All the secondary nodes respond','line_number':1880,'multiline':False]['text':' first so that it tests that we require the primary vote even when we've','line_number':1881,'multiline':False]['text':' received a majority of the votes. Then the primary responds no to the vote','line_number':1882,'multiline':False]['text':' request and as a result the dry run fails.','line_number':1883,'multiline':False]['text':' Make sure an election wasn't called for and that we are still secondary.','line_number':1927,'multiline':False]['text':' Update the term so that the current term is ahead of the term of','line_number':1956,'multiline':False]['text':' the last applied op time.','line_number':1957,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover has been scheduled.','line_number':1966,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':1972,'multiline':False]['text':' that we are fresher than the current primary, prompting the scheduling of a catchup','line_number':1973,'multiline':False]['text':' takeover.','line_number':1974,'multiline':False]['text':' Make sure that the catchup takeover has actually been scheduled and at the','line_number':1977,'multiline':False]['text':' correct time.','line_number':1978,'multiline':False]['text':' Mock another heartbeat where the primary is now up to date','line_number':1984,'multiline':False]['text':' and run time through when catchup takeover was supposed to happen.','line_number':1985,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover election happened.','line_number':1991,'multiline':False]['text':' Update the term so that the current term is ahead of the term of','line_number':2022,'multiline':False]['text':' the last applied op time.','line_number':2023,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover has been scheduled.','line_number':2032,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':2038,'multiline':False]['text':' that we are fresher than the current primary, prompting the scheduling of a catchup','line_number':2039,'multiline':False]['text':' takeover.','line_number':2040,'multiline':False]['text':' Make sure that the catchup takeover has actually been scheduled and at the','line_number':2043,'multiline':False]['text':' correct time.','line_number':2044,'multiline':False]['text':' Mock another heartbeat where the primary is now up to date','line_number':2050,'multiline':False]['text':' and run time through when catchup takeover was supposed to happen.','line_number':2051,'multiline':False]['text':' Make sure we're secondary and that no catchup takeover election happens.','line_number':2057,'multiline':False]['text':' Make sure that the priority takeover has now been scheduled and at the','line_number':2063,'multiline':False]['text':' correct time.','line_number':2064,'multiline':False]['text':' Node 1 schedules the priority takeover, and since it has the second highest','line_number':2069,'multiline':False]['text':' priority in the replica set, it will schedule in 20 seconds. We must increase','line_number':2070,'multiline':False]['text':' the election timeout so that the priority takeover will actually be executed.','line_number':2071,'multiline':False]['text':' Mock another round of heartbeat responses to prevent a normal election timeout.','line_number':2072,'multiline':False]['text':' Make sure we're secondary and that no priority takeover has been scheduled.','line_number':2111,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':2115,'multiline':False]['text':' that we supersede priorities of all other nodes, prompting the scheduling of a priority','line_number':2116,'multiline':False]['text':' takeover.','line_number':2117,'multiline':False]['text':' Make sure that the priority takeover has actually been scheduled and at the','line_number':2120,'multiline':False]['text':' correct time.','line_number':2121,'multiline':False]['text':' Also make sure that updating the term cancels the scheduled priority takeover.','line_number':2126,'multiline':False]['text':' Make sure we're secondary and that no priority takeover has been scheduled.','line_number':2159,'multiline':False]['text':' Mock a first round of heartbeat responses, which should give us enough information to know','line_number':2163,'multiline':False]['text':' that we supersede priorities of all other nodes, prompting the scheduling of a priority','line_number':2164,'multiline':False]['text':' takeover.','line_number':2165,'multiline':False]['text':' Make sure that the priority takeover has actually been scheduled and at the','line_number':2168,'multiline':False]['text':' correct time.','line_number':2169,'multiline':False]['text':' The priority takeover might be scheduled at a time later than one election','line_number':2174,'multiline':False]['text':' timeout after our initial heartbeat responses, so mock another round of','line_number':2175,'multiline':False]['text':' heartbeat responses to prevent a normal election timeout.','line_number':2176,'multiline':False]['text':' Check that the numPriorityTakeoversCalled and the numPriorityTakeoversSuccessful election','line_number':2192,'multiline':False]['text':' metrics have been incremented, and that none of the metrics that track the number of','line_number':2193,'multiline':False]['text':' elections called or successful for other reasons has been incremented.','line_number':2194,'multiline':False]['text':' Make sure we're secondary and that no priority takeover has been scheduled.','line_number':2235,'multiline':False]['text':' Mock a first round of heartbeat responses.','line_number':2239,'multiline':False]['text':' Make sure that the priority takeover has actually been scheduled and at the','line_number':2242,'multiline':False]['text':' correct time.','line_number':2243,'multiline':False]['text':' At this point the other nodes are all ahead of the current node, so it can't call for','line_number':2248,'multiline':False]['text':' priority takeover.','line_number':2249,'multiline':False]['text':' Mock another round of heartbeat responses that occur after the previous','line_number':2264,'multiline':False]['text':' 'priorityTakeoverTime', which should schedule a new priority takeover','line_number':2265,'multiline':False]['text':' Run clock forward to the time of the next queued heartbeat request.','line_number':2267,'multiline':False]['text':' Make sure that a new priority takeover has been scheduled and at the','line_number':2273,'multiline':False]['text':' correct time.','line_number':2274,'multiline':False]['text':' Now make us caught up enough to call for priority takeover to succeed.','line_number':2279,'multiline':False]['text':' The priority takeover might have been scheduled at a time later than one election','line_number':2285,'multiline':False]['text':' timeout after our initial heartbeat responses, so mock another round of','line_number':2286,'multiline':False]['text':' heartbeat responses to prevent a normal election timeout.','line_number':2287,'multiline':False]['text':' Make sure we're secondary and that no priority takeover has been scheduled.','line_number':2329,'multiline':False]['text':' Make sure that the priority takeover has actually been scheduled and at the','line_number':2336,'multiline':False]['text':' correct time.','line_number':2337,'multiline':False]['text':' At this point the other nodes are all ahead of the current node, so it can't call for','line_number':2342,'multiline':False]['text':' priority takeover.','line_number':2343,'multiline':False]['text':' Mock another round of heartbeat responses that occur after the previous','line_number':2358,'multiline':False]['text':' 'priorityTakeoverTime', which should schedule a new priority takeover','line_number':2359,'multiline':False]['text':' Run clock forward to the time of the next queued heartbeat request.','line_number':2361,'multiline':False]['text':' Make sure that a new priority takeover has been scheduled and at the','line_number':2367,'multiline':False]['text':' correct time.','line_number':2368,'multiline':False]['text':' Now make us caught up enough to call for priority takeover to succeed.','line_number':2373,'multiline':False]['text':' The priority takeover might have been scheduled at a time later than one election','line_number':2379,'multiline':False]['text':' timeout after our initial heartbeat responses, so mock another round of','line_number':2380,'multiline':False]['text':' heartbeat responses to prevent a normal election timeout.','line_number':2381,'multiline':False]['text':' Start up and become electable.','line_number':2399,'multiline':False]['text':' Advance to dry run vote request phase.','line_number':2416,'multiline':False]['text':' Consume the heartbeat or black hole it.','line_number':2425,'multiline':False]['text':' Submit a reconfig and confirm it cancels the election.','line_number':2433,'multiline':False]['text':' Wait until election cancels.','line_number':2447,'multiline':False]['text':' Start up and become electable.','line_number':2455,'multiline':False]['text':' Submit a reconfig and confirm it cancels the election.','line_number':2474,'multiline':False]['text':' Wait until election cancels.','line_number':2488,'multiline':False]['text':' Start up and become electable.','line_number':2496,'multiline':False]['text':' Set a failpoint to hang after checking the results for the dry run but before we initiate the','line_number':2512,'multiline':False]['text':' vote request for the real election.','line_number':2513,'multiline':False]['text':' Wait to hit the failpoint.','line_number':2518,'multiline':False]['text':' Cancel the election after the dry-run has already completed but before we create a new','line_number':2522,'multiline':False]['text':' VoteRequester.','line_number':2523,'multiline':False]['text':' Finish the election. We will receive the requested votes, but the election should still be','line_number':2529,'multiline':False]['text':' canceled.','line_number':2530,'multiline':False]['text':' Respond to heartbeat requests. This should update memberData for all nodes.','line_number':2581,'multiline':False]['text':' Verify that all other nodes were updated since restart.','line_number':2585,'multiline':False]['text':' We should not have updated our own memberData.','line_number':2588,'multiline':False]['text':' Advance clock time so that heartbeat requests are in SENT state.','line_number':2598,'multiline':False]['text':' Since the heartbeat requests are in SENT state, we will black hole them here to avoid','line_number':2610,'multiline':False]['text':' responding to them.','line_number':2611,'multiline':False]['text':' Verify that the memberData for every node has not been updated since becoming primary. This','line_number':2627,'multiline':False]['text':' can only happen if all heartbeat requests are restarted after the election, not just','line_number':2628,'multiline':False]['text':' heartbeats in SCHEDULED state.','line_number':2629,'multiline':False]['text':' Process requests until we're primary but leave the heartbeats for the notification','line_number':2665,'multiline':False]['text':' of election win. Exit immediately on unexpected requests.','line_number':2666,'multiline':False]['text':' Peek the next request, don't consume it yet.','line_number':2675,'multiline':False]['text':' Stop the loop and let the caller handle unexpected requests.','line_number':2696,'multiline':False]['text':' OpTime part of replSetGetStatus.','line_number':2736,'multiline':False]['text':' Response heartbeats with opTime until the given time. Exit if it sees any other request.','line_number':2765,'multiline':False]['text':' Peek the next request','line_number':2771,'multiline':False]['text':' Consume the next request','line_number':2780,'multiline':False]['text':' Cannot consume other requests than heartbeats.','line_number':2783,'multiline':False]['text':' Simulate the work done by bgsync and applier threads. setMyLastAppliedOpTime() will signal','line_number':2793,'multiline':False]['text':' the optime waiter.','line_number':2794,'multiline':False]['text':' The first round of heartbeats indicates we are the most up-to-date.','line_number':2803,'multiline':False]['text':' The old primary accepted one more op and all nodes caught up after voting for me.','line_number':2813,'multiline':False]['text':' Get 2 heartbeats from secondaries.','line_number':2817,'multiline':False]['text':' Check that the number of elections requiring primary catchup was not incremented.','line_number':2830,'multiline':False]['text':' Check that only the 'numCatchUpsAlreadyCaughtUp' primary catchup conclusion reason was','line_number':2833,'multiline':False]['text':' incremented.','line_number':2834,'multiline':False]['text':' Check that the targetCatchupOpTime metric was not set.','line_number':2845,'multiline':False]['text':' Heartbeats set a future target OpTime and we reached that successfully.','line_number':2850,'multiline':False]['text':' Check that the targetCatchupOpTime metric is unset before the target opTime for catchup is','line_number':2858,'multiline':False]['text':' set.','line_number':2859,'multiline':False]['text':' The old primary accepted one more op and all nodes caught up after voting for me.','line_number':2865,'multiline':False]['text':' Check that the targetCatchupOpTime metric was set correctly when heartbeats updated the','line_number':2869,'multiline':False]['text':' target opTime for catchup.','line_number':2870,'multiline':False]['text':' Check that the number of elections requiring primary catchup was incremented.','line_number':2886,'multiline':False]['text':' Check that only the 'numCatchUpsSucceeded' primary catchup conclusion reason was incremented.','line_number':2889,'multiline':False]['text':' Other nodes are ahead of me.','line_number':2909,'multiline':False]['text':' Check that the number of elections requiring primary catchup was incremented.','line_number':2921,'multiline':False]['text':' Check that only the 'numCatchUpsTimedOut' primary catchup conclusion reason was incremented.','line_number':2924,'multiline':False]['text':' We should get caught up by the timeout time.','line_number':2941,'multiline':False]['text':' Check that the number of elections requiring primary catchup was not incremented.','line_number':2963,'multiline':False]['text':' Check that only the 'numCatchUpsAlreadyCaughtUp' primary catchup conclusion reason was','line_number':2966,'multiline':False]['text':' incremented.','line_number':2967,'multiline':False]['text':' We should get caught up by the timeout time.','line_number':2984,'multiline':False]['text':' Check that the number of elections requiring primary catchup was not incremented.','line_number':3008,'multiline':False]['text':' Check that only the 'numCatchUpsAlreadyCaughtUp' primary catchup conclusion reason was','line_number':3011,'multiline':False]['text':' incremented.','line_number':3012,'multiline':False]['text':' Step down immediately.','line_number':3030,'multiline':False]['text':' Check that the number of elections requiring primary catchup was not incremented.','line_number':3047,'multiline':False]['text':' Since the primary stepped down in catchup mode because it saw a higher term, check that only','line_number':3050,'multiline':False]['text':' the 'numCatchUpsFailedWithNewTerm' primary catchup conclusion reason was incremented.','line_number':3051,'multiline':False]['text':' Step down in the middle of catchup.','line_number':3069,'multiline':False]['text':' Other nodes are ahead of me.','line_number':3072,'multiline':False]['text':'    replyHeartbeatsAndRunUntil(getNet()->now() + config.getCatchUpTimeoutPeriod());','line_number':3085,'multiline':False]['text':' Check that the number of elections requiring primary catchup was incremented.','line_number':3096,'multiline':False]['text':' Since the primary stepped down in catchup mode because it saw a higher term, check that only','line_number':3099,'multiline':False]['text':' the 'numCatchUpsFailedWithNewTerm' primary catchup conclusion reason was incremented.','line_number':3100,'multiline':False]['text':' Check that the targetCatchupOpTime metric was cleared when the node stepped down.','line_number':3111,'multiline':False]['text':' The old primary accepted one more op and all nodes caught up after voting for me.','line_number':3125,'multiline':False]['text':' Check that the number of elections requiring primary catchup was incremented.','line_number':3135,'multiline':False]['text':' Check that only the 'numCatchUpsSucceeded' primary catchup conclusion reason was incremented.','line_number':3139,'multiline':False]['text':' Step down during drain mode.','line_number':3150,'multiline':False]['text':' Step up again','line_number':3157,'multiline':False]['text':' No need to catch up, so we enter drain mode.','line_number':3162,'multiline':False]['text':' Check that the number of elections requiring primary catchup was not incremented again.','line_number':3179,'multiline':False]['text':' Check that only the 'numCatchUpsAlreadyCaughtUp' primary catchup conclusion reason was','line_number':3182,'multiline':False]['text':' incremented.','line_number':3183,'multiline':False]['text':' 1) The primary is at time 1 at the beginning.','line_number':3201,'multiline':False]['text':' 2) It cannot see all nodes. It learns of time 3 from one node, but the other isn't available.','line_number':3204,'multiline':False]['text':'    So the target optime is time 3.','line_number':3205,'multiline':False]['text':' The node is still in catchup mode, but the target optime has been set.','line_number':3217,'multiline':False]['text':' 3) Advancing its applied optime to time 2 isn't enough.','line_number':3224,'multiline':False]['text':' 4) After a while, the other node at time 4 becomes available. Time 4 becomes the new target.','line_number':3228,'multiline':False]['text':' The node is still in catchup mode, but the target optime has been updated.','line_number':3239,'multiline':False]['text':' 5) Advancing to time 3 isn't enough now.','line_number':3246,'multiline':False]['text':' 6) The node catches up time 4 eventually.','line_number':3250,'multiline':False]['text':' Check that the number of elections requiring primary catchup was incremented.','line_number':3262,'multiline':False]['text':' Check that only the 'numCatchUpsSucceeded' primary catchup conclusion reason was incremented.','line_number':3265,'multiline':False]['text':' Run time far forward and ensure we are still in catchup mode.','line_number':3285,'multiline':False]['text':' This is an arbitrary time 'far' into the future.','line_number':3286,'multiline':False]['text':' Other nodes are ahead of me.','line_number':3289,'multiline':False]['text':' Simulate the heartbeats from secondaries to primary to update liveness info.','line_number':3292,'multiline':False]['text':' TODO(sz): Remove this after merging liveness info and heartbeats.','line_number':3293,'multiline':False]['text':' Simulate a user initiated abort.','line_number':3308,'multiline':False]['text':' Check that the number of elections requiring primary catchup was incremented.','line_number':3324,'multiline':False]['text':' Check that only the 'numCatchUpsFailedWithReplSetAbortPrimaryCatchUpCmd' primary catchup','line_number':3327,'multiline':False]['text':' conclusion reason was incremented.','line_number':3328,'multiline':False]['text':' Check that the number of elections requiring primary catchup was not incremented.','line_number':3354,'multiline':False]['text':' Check that only the 'numCatchUpsSkipped' primary catchup conclusion reason was incremented.','line_number':3357,'multiline':False]['text':' Step down in the middle of catchup.','line_number':3375,'multiline':False]['text':' Other nodes are ahead of me.','line_number':3378,'multiline':False]['text':' Check that the number of elections requiring primary catchup was incremented.','line_number':3393,'multiline':False]['text':' Check that only the 'numCatchUpsFailedWithError' primary catchup conclusion reason was','line_number':3396,'multiline':False]['text':' incremented.','line_number':3397,'multiline':False]['text':' namespace','line_number':3409,'multiline':False]['text':' namespace repl','line_number':3410,'multiline':False]['text':' namespace mongo','line_number':3411,'multiline':False]