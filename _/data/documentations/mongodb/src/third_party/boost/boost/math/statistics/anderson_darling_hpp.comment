['text':'
 * Copyright Nick Thompson, 2019
 * Use, modification and distribution are subject to the
 * Boost Software License, Version 1.0. (See accompanying file
 * LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
 ','line_number':1,'multiline':True]['text':' This is where Knuth's literate programming could really come in handy!','line_number':40,'multiline':False]['text':' I need some LaTeX. The idea is that before any observation, the ecdf is identically zero.','line_number':41,'multiline':False]['text':' So we need to compute:','line_number':42,'multiline':False]['text':' \int_{-\infty}^{v_0} \frac{F(x)F'(x)}{1- F(x)} \, \mathrm{d}x, where F(x) := \frac{1}{2}[1+\erf(\frac{x-\mu}{\sigma \sqrt{2}})]','line_number':43,'multiline':False]['text':' Astonishingly, there is an analytic evaluation to this integral, as you can validate with the following Mathematica command:','line_number':44,'multiline':False]['text':' Integrate[(1/2 (1 + Erf[(x - mu)/Sqrt[2*sigma^2]])*Exp[-(x - mu)^2/(2*sigma^2)]*1/Sqrt[2*\[Pi]*sigma^2])/(1 - 1/2 (1 + Erf[(x - mu)/Sqrt[2*sigma^2]])),','line_number':45,'multiline':False]['text':' {x, -Infinity, x0}, Assumptions -> {x0 \[Element] Reals && mu \[Element] Reals && sigma > 0}]','line_number':46,'multiline':False]['text':' This gives (for s = x-mu/sqrt(2sigma^2))','line_number':47,'multiline':False]['text':' -1/2 + erf(s) + log(2/(1+erf(s)))','line_number':48,'multiline':False]['text':' Note that if erfcs0 == 0, then left_tail = inf (numerically), and hence the entire integral is numerically infinite:','line_number':54,'multiline':False]['text':' Note that we're going to add erfcs0/2 when we compute the integral over [x_0, x_1], so drop it here:','line_number':59,'multiline':False]['text':' For the right tail, the ecdf is identically 1.','line_number':63,'multiline':False]['text':' Hence we need the integral:','line_number':64,'multiline':False]['text':' \int_{v_{n-1}}^{\infty} \frac{(1-F(x))F'(x)}{F(x)} \, \mathrm{d}x','line_number':65,'multiline':False]['text':' This also has an analytic evaluation! It can be found via the following Mathematica command:','line_number':66,'multiline':False]['text':' Integrate[(E^(-(z^2/2)) *(1 - 1/2 (1 + Erf[z/Sqrt[2]])))/(Sqrt[2 \[Pi]] (1/2 (1 + Erf[z/Sqrt[2]]))),','line_number':67,'multiline':False]['text':' {z, zn, \[Infinity]}, Assumptions -> {zn \[Element] Reals && mu \[Element] Reals}]','line_number':68,'multiline':False]['text':' This gives (for sf = xf-mu/sqrt(2sigma^2))','line_number':69,'multiline':False]['text':' -1/2 + erf(sf)/2 + 2log(2/(1+erf(sf)))','line_number':70,'multiline':False]['text':'Real erfcsf = erfc<Real>(sf, no_promote_policy());','line_number':73,'multiline':False]['text':' This is the actual value of the tail integral. However, the -erfcsf/2 cancels from the integral over [v_{n-2}, v_{n-1}]:','line_number':74,'multiline':False]['text':'Real right_tail = -erfcsf/2 + log(Real(2)) - log(2-erfcsf);','line_number':75,'multiline':False]['text':' Use erfc(-x) = 2 - erfc(x)','line_number':77,'multiline':False]['text':' Again if this is precisely zero then the integral is numerically infinite:','line_number':79,'multiline':False]['text':' Now we need each integral:','line_number':85,'multiline':False]['text':' \int_{v_i}^{v_{i+1}} \frac{(i+1/n - F(x))^2F'(x)}{F(x)(1-F(x))}  \, \mathrm{d}x','line_number':86,'multiline':False]['text':' Again we get an analytical evaluation via the following Mathematica command:','line_number':87,'multiline':False]['text':' Integrate[((E^(-(z^2/2))/Sqrt[2 \[Pi]])*(k1 - F[z])^2)/(F[z]*(1 - F[z])),','line_number':88,'multiline':False]['text':' {z, z1, z2}, Assumptions -> {z1 \[Element] Reals && z2 \[Element] Reals &&k1 \[Element] Reals}] // FullSimplify','line_number':89,'multiline':False]