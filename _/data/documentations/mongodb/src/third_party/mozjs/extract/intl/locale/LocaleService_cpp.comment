['text':' -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- ','line_number':1,'multiline':True]['text':' This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. ','line_number':2,'multiline':True]['text':'*
 * This function splits an input string by `,` delimiter, sanitizes the result
 * language tags and returns them to the caller.
 ','line_number':40,'multiline':True]['text':' We handle three scenarios here:','line_number':62,'multiline':False]['text':'','line_number':63,'multiline':False]['text':' 1) The pref is not set - use default locale','line_number':64,'multiline':False]['text':' 2) The pref is set to "" - use OS locales','line_number':65,'multiline':False]['text':' 3) The pref is set to a value - parse the locale list and use it','line_number':66,'multiline':False]['text':' If the pref string is empty, we'll take requested locales','line_number':69,'multiline':False]['text':' from the OS.','line_number':70,'multiline':False]['text':' This will happen when either the pref is not set,','line_number':77,'multiline':False]['text':' or parsing of the pref didn't produce any usable','line_number':78,'multiline':False]['text':' result.','line_number':79,'multiline':False]['text':'*
 * This function performs the actual language negotiation for the API.
 *
 * Currently it collects the locale ID used by nsChromeRegistry and
 * adds hardcoded default locale as a fallback.
 ','line_number':99,'multiline':True]['text':' This part is used in one of the two scenarios:','line_number':122,'multiline':False]['text':'','line_number':123,'multiline':False]['text':' a) We're in a client mode, and no locale has been set yet,','line_number':124,'multiline':False]['text':'    so we need to return last fallback locale temporarily.','line_number':125,'multiline':False]['text':' b) We're in a server mode, and the last fallback locale was excluded','line_number':126,'multiline':False]['text':'    when negotiating against the requested locales.','line_number':127,'multiline':False]['text':'    Since we currently package it as a last fallback at build','line_number':128,'multiline':False]['text':'    time, we should also add it at the end of the list at','line_number':129,'multiline':False]['text':'    runtime.','line_number':130,'multiline':False]['text':' We're going to observe for requested languages changes which come','line_number':140,'multiline':False]['text':' from prefs.','line_number':141,'multiline':False]['text':' DOM might use ICUUtils and LocaleService during UnbindFromTree by','line_number':153,'multiline':False]['text':' final cycle collection.','line_number':154,'multiline':False]['text':' if mAppLocales has not been initialized yet, just return','line_number':224,'multiline':False]['text':' Next, check if there is a pseudo locale `bidi` set.','line_number':246,'multiline':False]['text':' At the moment the only thing we're observing are settings indicating','line_number':274,'multiline':False]['text':' user requested locales.','line_number':275,'multiline':False]['text':' Look for the requested file in omnijar.','line_number':296,'multiline':False]['text':' If we didn't have an omnijar (i.e. we're running a non-packaged','line_number':307,'multiline':False]['text':' build), then look in the GRE directory.','line_number':308,'multiline':False]['text':' This is a small file, only used once, so it's not worth doing some fancy','line_number':322,'multiline':False]['text':' off-main-thread file I/O or whatever. Just read it.','line_number':323,'multiline':False]['text':' This should never be empty in a correctly-built product.','line_number':346,'multiline':False]['text':' Last resort in case of broken build','line_number':351,'multiline':False]['text':'*
 * mozILocaleService methods
 ','line_number':359,'multiline':True]['text':' We don't allow this to change during a session (it's set at build/package','line_number':365,'multiline':False]['text':' time), so we cache the result the first time we're called.','line_number':366,'multiline':False]['text':' Try to get the package locale from update.locale in omnijar. If the','line_number':369,'multiline':False]['text':' update.locale file is not found, item.len will remain 0 and we'll','line_number':370,'multiline':False]['text':' just use our hard-coded default below.','line_number':371,'multiline':False]['text':' This should never be empty.','line_number':375,'multiline':False]['text':' Hard-coded fallback to allow us to survive even if update.locale was','line_number':382,'multiline':False]['text':' missing/broken in some way.','line_number':383,'multiline':False]['text':' If the user specified that they want to use OS Regional Preferences','line_number':448,'multiline':False]['text':' locales, try to retrieve them and use.','line_number':449,'multiline':False]['text':' If we fail to retrieve them, return the app locales.','line_number':456,'multiline':False]['text':' Otherwise, fetch OS Regional Preferences locales and compare the first one','line_number':461,'multiline':False]['text':' to the app locale. If the language subtag matches, we can safely use','line_number':462,'multiline':False]['text':' the OS Regional Preferences locale.','line_number':463,'multiline':False]['text':'','line_number':464,'multiline':False]['text':' This facilitates scenarios such as Firefox in "en-US" and User sets','line_number':465,'multiline':False]['text':' regional prefs to "en-GB".','line_number':466,'multiline':False]['text':' Otherwise use the app locales.','line_number':482,'multiline':False]['text':' If there are no available locales set, it means that L10nRegistry','line_number':597,'multiline':False]['text':' did not register its locale pool yet. The best course of action','line_number':598,'multiline':False]['text':' is to use packaged locales until that happens.','line_number':599,'multiline':False]