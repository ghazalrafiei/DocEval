['text':' -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- ','line_number':1,'multiline':True]['text':' This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. ','line_number':2,'multiline':True]['text':' Try to get the jarfile's nsZipArchive, find the relevant item, and return','line_number':34,'multiline':False]['text':' a pointer to its data provided it is stored uncompressed.','line_number':35,'multiline':False]['text':' We do NOT own this data, but it won't go away until the omnijar','line_number':55,'multiline':False]['text':' file is closed during shutdown.','line_number':56,'multiline':False]['text':' The shm-related calls here are not expected to fail, but if they do,','line_number':98,'multiline':False]['text':' we'll just return null (as if the resource was unavailable) and proceed','line_number':99,'multiline':False]['text':' without hyphenation.','line_number':100,'multiline':False]['text':' Check size, bail out if it is excessively large (the largest of the','line_number':137,'multiline':False]['text':' hyphenation files currently shipped with Firefox is around 1MB','line_number':138,'multiline':False]['text':' uncompressed).','line_number':139,'multiline':False]['text':' Read from the URI into a temporary buffer, compile it, then copy the','line_number':178,'multiline':False]['text':' compiled resource to a shared memory region.','line_number':179,'multiline':False]['text':' Files with extension ".hyf" are expected to be precompiled mapped_hyph','line_number':201,'multiline':False]['text':' tables; we also support uncompiled ".dic" files, but they are more','line_number':202,'multiline':False]['text':' expensive to process on first load.','line_number':203,'multiline':False]['text':' Content processes don't do compilation; they depend on the parent giving','line_number':208,'multiline':False]['text':' them a compiled version of the resource, so that we only pay the cost of','line_number':209,'multiline':False]['text':' compilation once per language per session.','line_number':210,'multiline':False]['text':' We don't need to validate mDict because the parent process','line_number':215,'multiline':False]['text':' will have done so.','line_number':216,'multiline':False]['text':' This gives us a raw pointer into the omnijar's data (if uncompressed);','line_number':225,'multiline':False]['text':' we do not own it and must not attempt to free it!','line_number':226,'multiline':False]['text':' The data should be directly usable by mapped_hyph; validate that it','line_number':231,'multiline':False]['text':' looks correct, and save the pointer.','line_number':232,'multiline':False]['text':' The data is an uncompiled pattern file, so we need to compile it.','line_number':240,'multiline':False]['text':' We then move it to shared memory so we can expose it to content','line_number':241,'multiline':False]['text':' processes.','line_number':242,'multiline':False]['text':' Omnijar must be compressed (currently this is the case on Android).','line_number':256,'multiline':False]['text':' If we're the parent process, decompress the resource into a shmem','line_number':257,'multiline':False]['text':' buffer; if we're a child, send a request to the parent for the','line_number':258,'multiline':False]['text':' shared-memory copy (which it will load if not already available).','line_number':259,'multiline':False]['text':' We don't need to validate mDict because the parent process','line_number':272,'multiline':False]['text':' will have done so.','line_number':273,'multiline':False]['text':' We get file:// URIs when running an unpackaged build; they could also','line_number':282,'multiline':False]['text':' occur if we support adding hyphenation dictionaries by putting files in','line_number':283,'multiline':False]['text':' a directory of the profile, for example.','line_number':284,'multiline':False]['text':' Ask the Rust lib to mmap the file. In this case our mDictSize field','line_number':286,'multiline':False]['text':' remains zero; mDict is not a pointer to the raw data but an opaque','line_number':287,'multiline':False]['text':' reference to a Rust object, and can only be freed by passing it to','line_number':288,'multiline':False]['text':' mapped_hyph_free_dictionary().','line_number':289,'multiline':False]['text':' (This case occurs in unpackaged developer builds.)','line_number':290,'multiline':False]['text':' GetFilePath returns the path with an unexpected leading slash (like','line_number':292,'multiline':False]['text':' "/c:/path/to/firefox/...") that may prevent it being found if it's an','line_number':293,'multiline':False]['text':' absolute Windows path starting with a drive letter.','line_number':294,'multiline':False]['text':' So check for this case and strip the slash.','line_number':295,'multiline':False]['text':' If the file is compiled, we can just map it directly.','line_number':301,'multiline':False]['text':' For an uncompiled .dic file, the parent process is responsible for','line_number':308,'multiline':False]['text':' compiling it and storing the result in a shmem block that can be','line_number':309,'multiline':False]['text':' shared to content processes.','line_number':310,'multiline':False]['text':' Each loading branch above will return if successful. So if we get here,','line_number':326,'multiline':False]['text':' whichever load type we attempted must have failed because something about','line_number':327,'multiline':False]['text':' the resource is broken.','line_number':328,'multiline':False]['text':' Convert word from aStart and aLimit in aString to utf-8 for mapped_hyph,','line_number':388,'multiline':False]['text':' lowercasing it as we go so that it will match the (lowercased) patterns','line_number':389,'multiline':False]['text':' (bug 1105644).','line_number':390,'multiline':False]['text':' unpaired surrogate: bail out, don't hyphenate broken text','line_number':402,'multiline':False]['text':' unpaired surrogate','line_number':405,'multiline':False]['text':' XXX What about language-specific casing? Consider Turkish I/i...','line_number':408,'multiline':False]['text':' In practice, it looks like the current patterns will not be','line_number':409,'multiline':False]['text':' affected by this, as they treat dotted and undotted i similarly.','line_number':410,'multiline':False]['text':' Avoid hyphenating capitalized words (bug 1550532) unless explicitly','line_number':415,'multiline':False]['text':' allowed by prefs for the language in use.','line_number':416,'multiline':False]['text':' Also never auto-hyphenate a word that has internal caps, as it may','line_number':417,'multiline':False]['text':' well be an all-caps acronym or a quirky name like iTunes.','line_number':418,'multiline':False]['text':' U+0000 - U+007F','line_number':425,'multiline':False]['text':' U+0100 - U+07FF','line_number':427,'multiline':False]['text':' U+0800 - U+D7FF,U+E000 - U+FFFF','line_number':430,'multiline':False]['text':' We need to convert UTF-8 indexing as used by the hyphenation lib into','line_number':462,'multiline':False]['text':' UTF-16 indexing of the aHyphens[] array for Gecko.','line_number':463,'multiline':False]['text':' We know utf8 is valid, so we only need to look at the first byte of','line_number':466,'multiline':False]['text':' each character to determine its length and the corresponding UTF-16','line_number':467,'multiline':False]['text':' length to add to utf16index.','line_number':468,'multiline':False]['text':' The hyphenation value of interest is the one for the last code unit','line_number':479,'multiline':False]['text':' of the utf-8 character, and is recorded on the last code unit of the','line_number':480,'multiline':False]['text':' utf-16 character (in the case of a surrogate pair).','line_number':481,'multiline':False]['text':' If the resource is invalid, or if we fail to share it to the child','line_number':493,'multiline':False]['text':' process, we'll just bail out and continue without hyphenation; no need','line_number':494,'multiline':False]['text':' for this to be a fatal error.','line_number':495,'multiline':False]