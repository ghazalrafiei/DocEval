['text':'!/usr/bin/env bash','line_number':1,'multiline':False]['text':'#############################################################################################','line_number':2,'multiline':False]['text':' Check branches to ensure forward/backward compatibility, including some upgrade/downgrade testing.','line_number':3,'multiline':False]['text':'#############################################################################################','line_number':4,'multiline':False]['text':'############################################################','line_number':9,'multiline':False]['text':' bflag:','line_number':10,'multiline':False]['text':'       arg1: branch name','line_number':11,'multiline':False]['text':'############################################################','line_number':12,'multiline':False]['text':' Return if the branch's format command takes the -B flag for backward compatibility.','line_number':15,'multiline':False]['text':'############################################################','line_number':24,'multiline':False]['text':' get_prev_version:','line_number':25,'multiline':False]['text':'       arg1: branch name','line_number':26,'multiline':False]['text':'############################################################','line_number':27,'multiline':False]['text':' Sort the list of WiredTiger tags numerically, then pick out the argument number of releases','line_number':30,'multiline':False]['text':' from the end of the list. That is, get a list of releases in numeric order, then pick out','line_number':31,'multiline':False]['text':' the last release (argument "1"), the next-to-last release (argument "2") and so on. Assumes','line_number':32,'multiline':False]['text':' WiredTiger releases are tagged with just numbers and decimal points.','line_number':33,'multiline':False]['text':'############################################################','line_number':37,'multiline':False]['text':' pick_a_version:','line_number':38,'multiline':False]['text':'       arg1: branch name','line_number':39,'multiline':False]['text':'############################################################','line_number':40,'multiline':False]['text':' Query out all released patch versions for a given release branch using "git tag"','line_number':45,'multiline':False]['text':' Avoid picking below types of versions:','line_number':48,'multiline':False]['text':'   - release candidates (rc)','line_number':49,'multiline':False]['text':'   - alpha releases (alpha)','line_number':50,'multiline':False]['text':'   - mongodb-4.4.0 through mongodb-4.4.6 (4.4.[0-6]$) as they are not compatible with Doxygen','line_number':51,'multiline':False]['text':'     version 1.8.17 (installed on the build hosts). WT-7437 was introduced since 4.4.7.','line_number':52,'multiline':False]['text':'versions[@]}','line_number':55,'multiline':False]['text':' Randomly pick a version from the array of patch versions','line_number':57,'multiline':False]['text':'############################################################','line_number':63,'multiline':False]['text':' build_branch:','line_number':64,'multiline':False]['text':'       arg1: branch name','line_number':65,'multiline':False]['text':'############################################################','line_number':66,'multiline':False]['text':' Check if the branch directory exists, if not then clone','line_number':73,'multiline':False]['text':' If the branch is in gittags, look up the required branch, tag or commit hash,','line_number':79,'multiline':False]['text':' Otherwise, use the branch itself for the checkout.','line_number':80,'multiline':False]['text':' Check out the required branch, tag or commit hash','line_number':86,'multiline':False]['text':' Need to disable configs since WT-9455 enabled additional items by default.','line_number':94,'multiline':False]['text':' Old releases didn't have these enabled, need to make it consistent.','line_number':95,'multiline':False]['text':' Use the stable MongoDB toolchain for this build.','line_number':98,'multiline':False]['text':' Disable cppsuite - not all versions build with the toolchain','line_number':100,'multiline':False]['text':' Check if the build directory already exists, if so recompile the code without remaking the directory','line_number':109,'multiline':False]['text':' Copy out the extension modules to their parent directory. This is done to maintain uniformity between','line_number':112,'multiline':False]['text':' autoconf and CMake build directories, where relative module paths can possibly be cached when running verify/upgrade_downgrade','line_number':113,'multiline':False]['text':' tests between branch directories i.e. in the connection configuration.','line_number':114,'multiline':False]['text':'############################################################','line_number':122,'multiline':False]['text':' get_config_file_name:','line_number':123,'multiline':False]['text':'       arg1: branch name','line_number':124,'multiline':False]['text':'############################################################','line_number':125,'multiline':False]['text':'############################################################','line_number':141,'multiline':False]['text':' create_configs:','line_number':142,'multiline':False]['text':'       arg1: branch name','line_number':143,'multiline':False]['text':'############################################################','line_number':144,'multiline':False]['text':' WT-7379 - Temporarily disable column store tests','line_number':156,'multiline':False]['text':' WT-7579 - Prefix testing isn't portable between releases','line_number':157,'multiline':False]['text':' Medium cache so there's eviction','line_number':158,'multiline':False]['text':' WT-7851 Fix illegal checksum configuration','line_number':159,'multiline':False]['text':' Force periodic writes','line_number':160,'multiline':False]['text':' We only build with snappy, force the choice','line_number':161,'multiline':False]['text':' WT-10594 - Not supported by older releases','line_number':163,'multiline':False]['text':' WT-10434 - Not supported by older releases','line_number':164,'multiline':False]['text':' WT-10111 - Not supported by older releases','line_number':165,'multiline':False]['text':' WT-6893 - Not supported by newer releases','line_number':166,'multiline':False]['text':' Interested in the on-disk format','line_number':167,'multiline':False]['text':' Faster runs','line_number':168,'multiline':False]['text':' Test log compatibility','line_number':169,'multiline':False]['text':' We only built with snappy, force the choice','line_number':170,'multiline':False]['text':' Faster runs','line_number':172,'multiline':False]['text':' Faster runs','line_number':173,'multiline':False]['text':' WT-8601 has not been backported to 4.2 and transactions are expected to be timestamped.','line_number':176,'multiline':False]['text':' WT-7545 - Older releases can't do non-timestamp transactions','line_number':178,'multiline':False]['text':' WT-8601 - Timestamps do not work with logged tables','line_number':180,'multiline':False]['text':' Append older release configs for newer compatibility release test','line_number':183,'multiline':False]['text':' WT-7545 - Older releases can't do lower isolation levels','line_number':188,'multiline':False]['text':'############################################################','line_number':196,'multiline':False]['text':' create_default_configs:','line_number':197,'multiline':False]['text':' This function will create the default configs for older and standalone','line_number':198,'multiline':False]['text':' release branches.','line_number':199,'multiline':False]['text':'############################################################','line_number':200,'multiline':False]['text':' Iterate over the release branches and create configuration files','line_number':203,'multiline':False]['text':'############################################################','line_number':214,'multiline':False]['text':' create_configs_for_newer_release_branches:','line_number':215,'multiline':False]['text':'############################################################','line_number':216,'multiline':False]['text':' Create configs for all the newer releases','line_number':219,'multiline':False]['text':' Copy per-release configs in the newer release branches','line_number':224,'multiline':False]['text':' Delete configs from the top folder','line_number':230,'multiline':False]['text':'############################################################','line_number':234,'multiline':False]['text':' run_format:','line_number':235,'multiline':False]['text':'       arg1: branch name','line_number':236,'multiline':False]['text':'       arg2: access methods list','line_number':237,'multiline':False]['text':'############################################################','line_number':238,'multiline':False]['text':' Compatibility test for newer releases will have CONFIG file for each release','line_number':252,'multiline':False]['text':' branches for the upgrade/downgrade testing.','line_number':253,'multiline':False]['text':'','line_number':254,'multiline':False]['text':' Compatibility test for older and standalone releases will have the default config.','line_number':255,'multiline':False]['text':' Remove the version string from the base configuration file. (MongoDB does not create','line_number':267,'multiline':False]['text':' a base configuration file, but format does, so we need to remove its version string','line_number':268,'multiline':False]['text':' to allow backward compatibility testing.)','line_number':269,'multiline':False]['text':'############################################################','line_number':276,'multiline':False]['text':' is_test_checkpoint_recovery_supported:','line_number':277,'multiline':False]['text':'       arg1: branch name','line_number':278,'multiline':False]['text':'############################################################','line_number':279,'multiline':False]['text':'','line_number':284,'multiline':False]['text':' The test_checkpoint recovery change WT-7958 are included in mongo','line_number':285,'multiline':False]['text':' 4.4.9 and 5.0.3 (and newer) versions.','line_number':286,'multiline':False]['text':'','line_number':287,'multiline':False]['text':' There's no much value to run test_checkpoint for earlier versions.','line_number':288,'multiline':False]['text':'','line_number':289,'multiline':False]['text':' Exclude mongodb-4.4.10+ and mongodb-5.0.10+ versions.','line_number':290,'multiline':False]['text':'','line_number':291,'multiline':False]['text':' Exclude mongodb-4.4 and mongodb-5.0 and they represent latest code','line_number':292,'multiline':False]['text':' of the corresponding release branches, which have WT-7958 included.','line_number':293,'multiline':False]['text':'','line_number':294,'multiline':False]['text':'############################################################','line_number':310,'multiline':False]['text':' run_test_checkpoint:','line_number':311,'multiline':False]['text':'       arg1: branch name','line_number':312,'multiline':False]['text':'       arg2: access methods list','line_number':313,'multiline':False]['text':'############################################################','line_number':314,'multiline':False]['text':' With the timestamp and prepare transactions configuration, this test','line_number':332,'multiline':False]['text':' can produce a scenario where the on-disk tables have more data than','line_number':333,'multiline':False]['text':' the checkpoint can see.','line_number':334,'multiline':False]['text':'','line_number':335,'multiline':False]['text':' During the verification stage, rollback to stable has to be performed','line_number':336,'multiline':False]['text':' with the checkpoint snapshot to achieve the consistency.','line_number':337,'multiline':False]['text':'############################################################','line_number':354,'multiline':False]['text':' run_tests:','line_number':355,'multiline':False]['text':'       arg1: branch name','line_number':356,'multiline':False]['text':'       arg2: access methods list','line_number':357,'multiline':False]['text':'############################################################','line_number':358,'multiline':False]['text':'############################################################','line_number':371,'multiline':False]['text':' verify_test_format:','line_number':372,'multiline':False]['text':'       arg1: branch name #1','line_number':373,'multiline':False]['text':'       arg2: branch name #2','line_number':374,'multiline':False]['text':'       arg3: access methods list','line_number':375,'multiline':False]['text':'       arg4: backward compatibility','line_number':376,'multiline':False]['text':'############################################################','line_number':377,'multiline':False]['text':'############################################################','line_number':402,'multiline':False]['text':' verify_test_checkpoint:','line_number':403,'multiline':False]['text':'       arg1: branch name #1','line_number':404,'multiline':False]['text':'       arg2: branch name #2','line_number':405,'multiline':False]['text':'       arg3: access methods list','line_number':406,'multiline':False]['text':'############################################################','line_number':407,'multiline':False]['text':'############################################################','line_number':440,'multiline':False]['text':' verify_branches:','line_number':441,'multiline':False]['text':'       arg1: branch name #1','line_number':442,'multiline':False]['text':'       arg2: branch name #2','line_number':443,'multiline':False]['text':'       arg3: access methods list','line_number':444,'multiline':False]['text':'       arg4: backward compatibility','line_number':445,'multiline':False]['text':'############################################################','line_number':446,'multiline':False]['text':'############################################################','line_number':453,'multiline':False]['text':' upgrade_downgrade:','line_number':454,'multiline':False]['text':'       arg1: branch name #1','line_number':455,'multiline':False]['text':'       arg2: branch name #2','line_number':456,'multiline':False]['text':'       arg3: access methods list','line_number':457,'multiline':False]['text':'############################################################','line_number':458,'multiline':False]['text':' Alternate running each branch format test program on the second branch's build.','line_number':468,'multiline':False]['text':' Loop twice, that is, run format twice using each branch.','line_number':469,'multiline':False]['text':' In order to be able to test against 4.2, we need to have timestamped transactions. Those','line_number':474,'multiline':False]['text':' are incompatible with implicit transactions. Adjust the config temporarily.','line_number':475,'multiline':False]['text':' Revert to the original config.','line_number':486,'multiline':False]['text':'############################################################','line_number':500,'multiline':False]['text':' test_upgrade_to_branch:','line_number':501,'multiline':False]['text':'       arg1: release branch name','line_number':502,'multiline':False]['text':'       arg2: path to test data folder','line_number':503,'multiline':False]['text':'############################################################','line_number':504,'multiline':False]['text':' Run actual test.','line_number':517,'multiline':False]['text':' Disable exit on non 0','line_number':521,'multiline':False]['text':' Enable exit on non 0','line_number':527,'multiline':False]['text':' Validate test result.','line_number':530,'multiline':False]['text':'############################################################','line_number':549,'multiline':False]['text':' prepare_test_data_wt_8395:','line_number':550,'multiline':False]['text':'############################################################','line_number':551,'multiline':False]['text':'############################################################','line_number':564,'multiline':False]['text':' create_file:','line_number':565,'multiline':False]['text':'       arg1: branch','line_number':566,'multiline':False]['text':'       arg2: file','line_number':567,'multiline':False]['text':'############################################################','line_number':568,'multiline':False]['text':' Make the home directory.','line_number':579,'multiline':False]['text':' Create the file and populate with a few key/values.','line_number':582,'multiline':False]['text':'############################################################','line_number':587,'multiline':False]['text':' import_file:','line_number':588,'multiline':False]['text':'       arg1: source branch','line_number':589,'multiline':False]['text':'       arg2: dest branch','line_number':590,'multiline':False]['text':'       arg3: file','line_number':591,'multiline':False]['text':'############################################################','line_number':592,'multiline':False]['text':' Move the file across to the destination branch's home directory.','line_number':603,'multiline':False]['text':' Run import via the wt tool.','line_number':607,'multiline':False]['text':'############################################################','line_number':612,'multiline':False]['text':' verify_file:','line_number':613,'multiline':False]['text':'       arg1: branch','line_number':614,'multiline':False]['text':'       arg2: file','line_number':615,'multiline':False]['text':'############################################################','line_number':616,'multiline':False]['text':'############################################################','line_number':630,'multiline':False]['text':' cleanup_branch:','line_number':631,'multiline':False]['text':'       arg1: branch','line_number':632,'multiline':False]['text':'############################################################','line_number':633,'multiline':False]['text':'############################################################','line_number':642,'multiline':False]['text':' import_compatibility_test:','line_number':643,'multiline':False]['text':'       arg1: older branch','line_number':644,'multiline':False]['text':'       arg2: newer branch','line_number':645,'multiline':False]['text':'############################################################','line_number':646,'multiline':False]['text':' Remove any leftover data files.','line_number':653,'multiline':False]['text':' Create a file in the older branch.','line_number':657,'multiline':False]['text':' Now import it into the newer branch and verify.','line_number':660,'multiline':False]['text':' Now downgrade by running wt from the older branch and dumping the table contents.','line_number':664,'multiline':False]['text':'','line_number':665,'multiline':False]['text':' Before trying this, we must remove the base configuration. The wt tool produces this file','line_number':666,'multiline':False]['text':' however MongoDB will not so we should emulate this.','line_number':667,'multiline':False]['text':' Only one of below flags will be set by the 1st argument of the script.','line_number':672,'multiline':False]['text':' Map branch names to Github branches, tags, or commit hashes','line_number':680,'multiline':False]['text':' First define the standard values for each build branch','line_number':681,'multiline':False]['text':' Note: If a branch name is not stored in gittags,','line_number':682,'multiline':False]['text':' then the branch name itself will be used for the checkout','line_number':683,'multiline':False]['text':' Then, optionally, replace one or more tags with a particular branch or commit hash where required for testing','line_number':691,'multiline':False]['text':' For example, this set of commit hashes will reproduce the bug in WT-9795','line_number':692,'multiline':False]['text':'gittags['develop']="d031f0af518c9b5f15dc586de4ae55d6867f423b"','line_number':693,'multiline':False]['text':'gittags['mongodb-6.0']="58159b1a09bc045ab956b40675212e01d91fa7c0"','line_number':694,'multiline':False]['text':'gittags['mongodb-5.0']="ce1d1e58ba35166710552e3aaa1c426ddba513fd"','line_number':695,'multiline':False]['text':'gittags['mongodb-4.4']="ec742d6807b943cd6f2baf1a55853d296eb5b5c6"','line_number':696,'multiline':False]['text':' This array is used to configure the release branches we'd like to use for testing the importing','line_number':698,'multiline':False]['text':' of files created in previous versions of WiredTiger. Go all the way back to mongodb-4.2 since','line_number':699,'multiline':False]['text':' that's the first release where we don't support live import.','line_number':700,'multiline':False]['text':' Branches in below 2 arrays should be put in newer-to-older order.','line_number':703,'multiline':False]['text':'','line_number':704,'multiline':False]['text':' An overlap (last element of the 1st array & first element of the 2nd array)','line_number':705,'multiline':False]['text':' is expected to avoid missing the edge testing coverage.','line_number':706,'multiline':False]['text':'','line_number':707,'multiline':False]['text':' The 2 arrays should be adjusted over time when newer branches are created,','line_number':708,'multiline':False]['text':' or older branches are EOL.','line_number':709,'multiline':False]['text':' This array is used to generate compatible configuration files between releases, because','line_number':713,'multiline':False]['text':' upgrade/downgrade test runs each build's format test program on the second build's','line_number':714,'multiline':False]['text':' configuration file.','line_number':715,'multiline':False]['text':' This array is used to configure the release branches we'd like to run patch version','line_number':718,'multiline':False]['text':' upgrade/downgrade test.','line_number':719,'multiline':False]['text':' This array is used to configure the release branches we'd like to run test checkpoint','line_number':722,'multiline':False]['text':' upgrade/downgrade test.','line_number':723,'multiline':False]['text':' This array is used to configure the release branches we'd like to run upgrade to latest test.','line_number':726,'multiline':False]['text':'############################################################','line_number':738,'multiline':False]['text':' Retrieve the build system used by a particular release,','line_number':739,'multiline':False]['text':' since WiredTiger switched from autoconf to cmake.','line_number':740,'multiline':False]['text':'       arg1: branch name to check against','line_number':741,'multiline':False]['text':'       output: string as name of build system','line_number':742,'multiline':False]['text':'############################################################','line_number':743,'multiline':False]['text':' Default to cmake.','line_number':747,'multiline':False]['text':' As of MongoDB 6.0, WiredTiger standalone builds switched to CMake.','line_number':750,'multiline':False]['text':' Check for WiredTiger standalone branch names. They are of the form 10.0.0 - figure out','line_number':757,'multiline':False]['text':' if the first element is numerical, and use that to decide.','line_number':758,'multiline':False]['text':' The 11.0.0 version of WiredTiger is where cmake became the default','line_number':767,'multiline':False]['text':'############################################################','line_number':776,'multiline':False]['text':' usage string','line_number':777,'multiline':False]['text':'############################################################','line_number':778,'multiline':False]['text':' -lt 1 ]; then','line_number':792,'multiline':False]['text':' Script argument processing','line_number':796,'multiline':False]['text':' Create a directory in which to do the work.','line_number':847,'multiline':False]['text':' Import compatibility testing.','line_number':852,'multiline':False]['text':' MongoDB v4.2 doesn't support live import so it should only ever be used as the "older" branch','line_number':861,'multiline':False]['text':' that we're importing from.','line_number':862,'multiline':False]['text':' prepare test data and test upgrade to the branch b.','line_number':878,'multiline':False]['text':' cleanup.','line_number':883,'multiline':False]['text':' Check if the 2 given versions support test checkpoint with recovery','line_number':890,'multiline':False]['text':' Build the branches','line_number':903,'multiline':False]['text':' Run test for both branches to generate data files','line_number':907,'multiline':False]['text':' Use one version binary to verify data files generated by the other version','line_number':911,'multiline':False]['text':' Build the tip of the release branch and run test to generate data files','line_number':920,'multiline':False]['text':' Pick a patch version from the list of patch versions for the release branch','line_number':924,'multiline':False]['text':' A null string from the $pv variable indicates the release branch (e.g. mongodb-6.0)','line_number':927,'multiline':False]['text':' has not yet got a GA version (e.g. 6.0.0, 6.0.1) tagged. Skip running and verifiying','line_number':928,'multiline':False]['text':' test checkpoint in that case.','line_number':929,'multiline':False]['text':' Only run verify if the picked version supports test checkpoint recovery','line_number':935,'multiline':False]['text':' Apply patch fix from WT-8708 to already released compatible versions to avoid','line_number':938,'multiline':False]['text':' test/checkpoint setting commit timestamp less than stable timestamp','line_number':939,'multiline':False]['text':' Use one version binary to verify data files generated by the other version','line_number':950,'multiline':False]['text':' Build the branches.','line_number':960,'multiline':False]['text':' Get the names of the last two WiredTiger releases, wt1 is the most recent release, wt2 is the','line_number':973,'multiline':False]['text':' release before that. Minor trickiness, we depend on the "develop" directory already existing','line_number':974,'multiline':False]['text':' so we have a source in which to do git commands.','line_number':975,'multiline':False]['text':' Run format in each branch for supported access methods.','line_number':990,'multiline':False]['text':' FLCS scenarios are not added as they only work from 6.0+. This should be updated when the','line_number':1002,'multiline':False]['text':' tested older branches support FLCS.','line_number':1003,'multiline':False]['text':' Verify backward compatibility for supported access methods.','line_number':1013,'multiline':False]['text':'','line_number':1014,'multiline':False]['text':' The branch array includes a list of branches in newer-to-older order.','line_number':1015,'multiline':False]['text':' For backport compatibility, the binary of the newer branch should','line_number':1016,'multiline':False]['text':' be used to verify the data files generated by the older branch.','line_number':1017,'multiline':False]['text':' e.g. (verify_branches mongodb-4.4 mongodb-4.2 "row")','line_number':1018,'multiline':False]['text':'newer_release_branches[@]} ]] && \','line_number':1021,'multiline':False]['text':'test_checkpoint_release_branches[@]} ]] && \','line_number':1025,'multiline':False]['text':' FLCS scenarios are not added as they only work from 6.0+. This should be updated when the','line_number':1032,'multiline':False]['text':' tested older branches support FLCS.','line_number':1033,'multiline':False]['text':'older_release_branches[@]} ]] && \','line_number':1034,'multiline':False]['text':' Verify forward compatibility for supported access methods.','line_number':1044,'multiline':False]['text':'','line_number':1045,'multiline':False]['text':' The branch array includes a list of branches in newer-to-older order.','line_number':1046,'multiline':False]['text':' For forward compatibility, the binary of the older branch should','line_number':1047,'multiline':False]['text':' be used to verify the data files generated by the newer branch.','line_number':1048,'multiline':False]['text':' e.g. (verify_branches mongodb-4.2 mongodb-4.4 "row")','line_number':1049,'multiline':False]['text':'newer_release_branches[@]} ]] && \','line_number':1052,'multiline':False]['text':' Upgrade/downgrade testing for supported access methods.','line_number':1057,'multiline':False]['text':'newer_release_branches[@]} ]] && \','line_number':1060,'multiline':False]