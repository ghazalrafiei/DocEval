['text':' Copyright 2020 MongoDB Inc.','line_number':1,'multiline':False]['text':'','line_number':2,'multiline':False]['text':' Permission is hereby granted, free of charge, to any person obtaining','line_number':3,'multiline':False]['text':' a copy of this software and associated documentation files (the','line_number':4,'multiline':False]['text':' "Software"), to deal in the Software without restriction, including','line_number':5,'multiline':False]['text':' without limitation the rights to use, copy, modify, merge, publish,','line_number':6,'multiline':False]['text':' distribute, sublicense, and/or sell copies of the Software, and to','line_number':7,'multiline':False]['text':' permit persons to whom the Software is furnished to do so, subject to','line_number':8,'multiline':False]['text':' the following conditions:','line_number':9,'multiline':False]['text':'','line_number':10,'multiline':False]['text':' The above copyright notice and this permission notice shall be included','line_number':11,'multiline':False]['text':' in all copies or substantial portions of the Software.','line_number':12,'multiline':False]['text':'','line_number':13,'multiline':False]['text':' THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY','line_number':14,'multiline':False]['text':' KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE','line_number':15,'multiline':False]['text':' WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND','line_number':16,'multiline':False]['text':' NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE','line_number':17,'multiline':False]['text':' LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION','line_number':18,'multiline':False]['text':' OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION','line_number':19,'multiline':False]['text':' WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.','line_number':20,'multiline':False]['text':'','line_number':21,'multiline':False]['text':' How to locate the Merge Modules path is described in:','line_number':36,'multiline':False]['text':'','line_number':37,'multiline':False]['text':' - VS2019: https://docs.microsoft.com/en-us/visualstudio/releases/2019/redistribution#visual-c-runtime-files','line_number':38,'multiline':False]['text':' - VS2017: https://docs.microsoft.com/en-us/visualstudio/productinfo/2017-redistribution-vs#visual-c-runtime-files','line_number':39,'multiline':False]['text':' - VS2015: https://docs.microsoft.com/en-us/visualstudio/productinfo/2015-redistribution-vs#visual-c-runtime','line_number':40,'multiline':False]['text':'','line_number':41,'multiline':False]['text':' However, please note that for VS2017 an VS2019, the documented paths are incorrect, per this','line_number':42,'multiline':False]['text':' discussion:','line_number':43,'multiline':False]['text':'','line_number':44,'multiline':False]['text':' - https://developercommunity.visualstudio.com/content/problem/828060/what-are-the-correct-location-to-search-for-vc-crt.html','line_number':45,'multiline':False]['text':'','line_number':46,'multiline':False]['text':' This tool uses the currently undocumented but correct paths.','line_number':47,'multiline':False]['text':' The keys are the values SCons accepts for TARGET_ARCH to name','line_number':49,'multiline':False]['text':' different windows targets, the values are the tag that VS uses','line_number':50,'multiline':False]['text':' for the associated redistributable for that platform.','line_number':51,'multiline':False]['text':'','line_number':52,'multiline':False]['text':' TODO: Expand this map as needed.','line_number':53,'multiline':False]['text':' When we run this under cygwin, the environment is broken, fall','line_number':67,'multiline':False]['text':' back to hard coded C:\Program Files (x86)','line_number':68,'multiline':False]['text':' Obtain the major and minor versions of the curently configured MSVC','line_number':94,'multiline':False]['text':' and ensure that we are using a VC 14 based toolchain.','line_number':95,'multiline':False]['text':'','line_number':96,'multiline':False]['text':' Please see','line_number':97,'multiline':False]['text':' https://en.wikipedia.org/wiki/Microsoft_Visual_C%2B%2B#Internal_version_numbering','line_number':98,'multiline':False]['text':' for details on the various version numbers in play for','line_number':99,'multiline':False]['text':' the Microsoft toolchain.','line_number':100,'multiline':False]['text':' We may or may not need to figure out the path to Program files,','line_number':105,'multiline':False]['text':' depending on the various paths we take throught this logic.','line_number':106,'multiline':False]['text':' TODO: Getting this path is a start, but we should later provide','line_number':109,'multiline':False]['text':' an abstraction over the names of the merge modules','line_number':110,'multiline':False]['text':' themselves. They seem to have the form','line_number':111,'multiline':False]['text':' Microsoft_VC{msvc_major}{msvc_minor}_{Feature}_{target_arch}.msm. It','line_number':112,'multiline':False]['text':' would be useful to provide an env.MergeModuleNameFor('feature')','line_number':113,'multiline':False]['text':' that consulted the values we have found here and used','line_number':114,'multiline':False]['text':' TARGET_ARCH (normalized somehow) to select the right one.','line_number':115,'multiline':False]['text':' On VS2015 the merge modules are in the program files directory,','line_number':118,'multiline':False]['text':' not under the VS install dir.','line_number':119,'multiline':False]['text':' Compute a VS version based on the VC version. VC 14.0 is VS 2015, VC','line_number':133,'multiline':False]['text':' 14.1 is VS 2017. Also compute the next theoretical version by','line_number':134,'multiline':False]['text':' incrementing the major version by 1. Then form a range from this','line_number':135,'multiline':False]['text':' that we can use as an argument to the -version flag to vswhere.','line_number':136,'multiline':False]['text':' Use vswhere (it has a fixed stable path) to query where Visual Studio is installed.','line_number':147,'multiline':False]['text':' Combine and set the full merge module path','line_number':164,'multiline':False]['text':' Check the registry key that has the runtime lib version','line_number':170,'multiline':False]['text':' TOOO: This x64 needs to be abstracted away. Is it the host','line_number':172,'multiline':False]['text':' arch, or the target arch? My guess is host.','line_number':173,'multiline':False]['text':' Fallback to directory search if we don't find the expected version','line_number':181,'multiline':False]['text':' Keep these in preference order. The way with the {} in between','line_number':202,'multiline':False]['text':' the dots appears to be the more modern form, but we select the','line_number':203,'multiline':False]['text':' older one when available to minimize disruption to existing','line_number':204,'multiline':False]['text':' automation that expects the redist executable embedded in our','line_number':205,'multiline':False]['text':' packages to have this shape. Some architectures, like arm64,','line_number':206,'multiline':False]['text':' don't appear to be provided under that syntax though, so we','line_number':207,'multiline':False]['text':' include the newer form for that purpose. If Microsoft ever stops','line_number':208,'multiline':False]['text':' providing the old form, we will automatically roll forward to','line_number':209,'multiline':False]['text':' the new form.','line_number':210,'multiline':False]