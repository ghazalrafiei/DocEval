['text':'---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------','line_number':1,'multiline':True]['text':' Listen to `beforeUnload` to support to veto','line_number':37,'multiline':False]['text':' Listen to `pagehide` to support orderly shutdown','line_number':40,'multiline':False]['text':' We explicitly do not listen to `unload` event','line_number':41,'multiline':False]['text':' which would disable certain browser caching.','line_number':42,'multiline':False]['text':' We currently do not handle the `persisted` property','line_number':43,'multiline':False]['text':' (https://github.com/microsoft/vscode/issues/136216)','line_number':44,'multiline':False]['text':' Before unload ignored (once)','line_number':50,'multiline':False]['text':' Before unload with veto support','line_number':57,'multiline':False]['text':' Standard shutdown','line_number':74,'multiline':False]['text':' Ensure UI state is persisted','line_number':78,'multiline':False]['text':' Before unload handling ignored for duration of callback','line_number':82,'multiline':False]['text':' An explicit shutdown renders our unload','line_number':96,'multiline':False]['text':' event handlers disabled, so dispose them.','line_number':97,'multiline':False]['text':' Ensure UI state is persisted','line_number':101,'multiline':False]['text':' Handle shutdown without veto support','line_number':104,'multiline':False]['text':' Optimistically trigger a UI state flush','line_number':111,'multiline':False]['text':' without waiting for it. The browser does','line_number':112,'multiline':False]['text':' not guarantee that this is being executed','line_number':113,'multiline':False]['text':' but if a dialog opens, we have a chance','line_number':114,'multiline':False]['text':' to succeed.','line_number':115,'multiline':False]['text':' veto handling disabled','line_number':122,'multiline':False]['text':' implicitly vetos since we cannot handle promises in web','line_number':128,'multiline':False]['text':' Before Shutdown','line_number':138,'multiline':False]['text':' in browser, trigger instantly because we do not support async anyway','line_number':145,'multiline':False]['text':' Veto: handle if provided','line_number':149,'multiline':False]['text':' No veto, continue to shutdown','line_number':154,'multiline':False]['text':' only once','line_number':160,'multiline':False]['text':' Register a late `pageshow` listener specifically on unload','line_number':165,'multiline':False]['text':' First indicate will-shutdown','line_number':168,'multiline':False]['text':' Unsupported in web','line_number':172,'multiline':False]['text':' Unsupported in web','line_number':173,'multiline':False]['text':' No-Op in web ','line_number':177,'multiline':True]['text':' Finally end with did-shutdown','line_number':180,'multiline':False]['text':' We only really care about page-show events','line_number':186,'multiline':False]['text':' where the browser indicates to us that the','line_number':187,'multiline':False]['text':' page was restored from cache and not freshly','line_number':188,'multiline':False]['text':' loaded.','line_number':189,'multiline':False]['text':' At this point, we know that the page was restored from','line_number':195,'multiline':False]['text':' cache even though it was unloaded before,','line_number':196,'multiline':False]['text':' so in order to get back to a functional workbench, we','line_number':197,'multiline':False]['text':' currently can only reload the window','line_number':198,'multiline':False]['text':' Docs: https://web.dev/bfcache/#optimize-your-pages-for-bfcache','line_number':199,'multiline':False]['text':' Refs: https://github.com/microsoft/vscode/issues/136035','line_number':200,'multiline':False]