['text':'---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------','line_number':1,'multiline':True]['text':'#region decorations','line_number':84,'multiline':False]['text':' Text file model decorations','line_number':88,'multiline':False]['text':' Creates','line_number':104,'multiline':False]['text':' Removals: once a text file model is no longer','line_number':111,'multiline':False]['text':' under our control, make sure to signal this as','line_number':112,'multiline':False]['text':' decoration change because from this point on we','line_number':113,'multiline':False]['text':' have no way of updating the decoration anymore.','line_number':114,'multiline':False]['text':' Changes','line_number':117,'multiline':False]['text':' Readonly + Orphaned','line_number':131,'multiline':False]['text':' Readonly','line_number':141,'multiline':False]['text':' Orphaned','line_number':149,'multiline':False]['text':'#endregin','line_number':165,'multiline':False]['text':'#region text file read / write / create','line_number':167,'multiline':False]['text':' optimization: since we know that the caller does not','line_number':182,'multiline':False]['text':' care about buffering, we indicate this to the reader.','line_number':183,'multiline':False]['text':' this reduces all the overhead the buffered reading','line_number':184,'multiline':False]['text':' has (open, read, close) if the provider supports','line_number':185,'multiline':False]['text':' unbuffered reading.','line_number':186,'multiline':False]['text':' read stream raw (either buffered or unbuffered)','line_number':210,'multiline':False]['text':' read through encoding library','line_number':222,'multiline':False]['text':' Make sure to cancel reading on error to','line_number':229,'multiline':False]['text':' stop file service activity as soon as','line_number':230,'multiline':False]['text':' possible. When for example a large binary','line_number':231,'multiline':False]['text':' file is read we want to cancel the read','line_number':232,'multiline':False]['text':' instantly.','line_number':233,'multiline':False]['text':' Refs:','line_number':234,'multiline':False]['text':' - https://github.com/microsoft/vscode/issues/138805','line_number':235,'multiline':False]['text':' - https://github.com/microsoft/vscode/issues/132771','line_number':236,'multiline':False]['text':' special treatment for streams that are binary','line_number':239,'multiline':False]['text':' re-throw any other error as it is','line_number':244,'multiline':False]['text':' check for encoding','line_number':282,'multiline':False]['text':' when encoding is standard skip encoding step','line_number':285,'multiline':False]['text':' otherwise create encoded readable','line_number':292,'multiline':False]['text':' read through encoding library','line_number':304,'multiline':False]['text':'#endregion','line_number':316,'multiline':False]['text':'#region save','line_number':319,'multiline':False]['text':' Untitled','line_number':323,'multiline':False]['text':' Untitled with associated file path don't need to prompt','line_number':329,'multiline':False]['text':' Otherwise ask user','line_number':334,'multiline':False]['text':' Save as if target provided','line_number':339,'multiline':False]['text':' File','line_number':346,'multiline':False]['text':' Get to target resource','line_number':359,'multiline':False]['text':' user canceled','line_number':365,'multiline':False]['text':' Ensure target is not marked as readonly and prompt otherwise','line_number':368,'multiline':False]['text':' Just save if target is same as models own resource','line_number':378,'multiline':False]['text':' force to save, even if not dirty (https://github.com/microsoft/vscode/issues/99619) ','line_number':380,'multiline':True]['text':' If the target is different but of same identity, we','line_number':383,'multiline':False]['text':' move the source to the target, knowing that the','line_number':384,'multiline':False]['text':' underlying file system cannot have both and then save.','line_number':385,'multiline':False]['text':' However, this will only work if the source exists','line_number':386,'multiline':False]['text':' and is not orphaned, so we need to check that too.','line_number':387,'multiline':False]['text':' At this point we don't know whether we have a','line_number':391,'multiline':False]['text':' model for the source or the target URI so we','line_number':392,'multiline':False]['text':' simply try to save with both resources.','line_number':393,'multiline':False]['text':' Do it','line_number':402,'multiline':False]['text':' If the source is an existing text file model, we can directly','line_number':409,'multiline':False]['text':' use that model to copy the contents to the target destination','line_number':410,'multiline':False]['text':' Otherwise if the source can be handled by the file service','line_number':416,'multiline':False]['text':' we can simply invoke the copy() function to save as','line_number':417,'multiline':False]['text':' Finally we simply check if we can find a editor model that','line_number':424,'multiline':False]['text':' would give us access to the contents.','line_number':425,'multiline':False]['text':' Revert the source','line_number':437,'multiline':False]['text':' It is possible that reverting the source fails, for example','line_number':442,'multiline':False]['text':' when a remote is disconnected and we cannot read it anymore.','line_number':443,'multiline':False]['text':' However, this should not interrupt the "Save As" flow, so','line_number':444,'multiline':False]['text':' we gracefully catch the error and just log it.','line_number':445,'multiline':False]['text':' Find source encoding if any','line_number':455,'multiline':False]['text':' Prefer an existing model if it is already resolved for the given target resource','line_number':462,'multiline':False]['text':' Otherwise create the target file empty if it does not exist already and resolve it from there','line_number':469,'multiline':False]['text':' create target file adhoc if it does not exist yet','line_number':473,'multiline':False]['text':' if the target already exists and was not created by us, it is possible','line_number':481,'multiline':False]['text':' that we cannot resolve the target as text model if it is binary or too','line_number':482,'multiline':False]['text':' large. in that case we have to delete the target file first and then','line_number':483,'multiline':False]['text':' re-run the operation.','line_number':484,'multiline':False]['text':' Confirm to overwrite if we have an untitled file with associated file where','line_number':500,'multiline':False]['text':' the file actually exists on disk and we are instructed to save to that file','line_number':501,'multiline':False]['text':' path. This can happen if the file was created after the untitled file was opened.','line_number':502,'multiline':False]['text':' See https://github.com/microsoft/vscode/issues/67946','line_number':503,'multiline':False]['text':' take over model value, encoding and language (only if more specific) from source model','line_number':529,'multiline':False]['text':' encoding','line_number':532,'multiline':False]['text':' content','line_number':535,'multiline':False]['text':' language','line_number':538,'multiline':False]['text':' only use if more specific than plain/text','line_number':542,'multiline':False]['text':' transient properties','line_number':545,'multiline':False]['text':' set source options depending on target exists or not','line_number':554,'multiline':False]['text':' save model','line_number':562,'multiline':False]['text':' Just take the resource as is if the file service can handle it','line_number':590,'multiline':False]['text':' Otherwise try to suggest a path that can be saved','line_number':598,'multiline':False]['text':' Untitled with associated file path','line_number':604,'multiline':False]['text':' Untitled without associated file path: use name','line_number':609,'multiline':False]['text':' of untitled model if it is a valid path name and','line_number':610,'multiline':False]['text':' figure out the file extension from the mode if any.','line_number':611,'multiline':False]['text':' Fallback to basename of resource','line_number':629,'multiline':False]['text':' Try to place where last active file was if any','line_number':634,'multiline':False]['text':' Otherwise fallback to user home','line_number':635,'multiline':False]['text':' unknown language, so we cannot suggest a better name','line_number':642,'multiline':False]['text':' preserve extension if it is compatible with the mode','line_number':649,'multiline':False]['text':' preserve name if it is compatible with the mode','line_number':663,'multiline':False]['text':'#endregion','line_number':669,'multiline':False]['text':'#region revert','line_number':671,'multiline':False]['text':' Untitled','line_number':675,'multiline':False]['text':' File','line_number':683,'multiline':False]['text':'#endregion','line_number':692,'multiline':False]['text':'#region dirty','line_number':694,'multiline':False]['text':'#endregion','line_number':705,'multiline':False]['text':' Workspace Folder Change','line_number':735,'multiline':False]['text':' Global settings','line_number':742,'multiline':False]['text':' Workspace files (via extension and via untitled workspaces location)','line_number':745,'multiline':False]['text':' Folder Settings','line_number':749,'multiline':False]['text':' enforce BOM for certain encodings','line_number':768,'multiline':False]['text':' Encoding passed in as option','line_number':775,'multiline':False]['text':' indicate the file has BOM if we are to resolve with UTF 8','line_number':778,'multiline':False]['text':' give passed in encoding highest priority','line_number':780,'multiline':False]['text':' Encoding detected','line_number':784,'multiline':False]['text':' Encoding configured','line_number':789,'multiline':False]['text':' if we did not detect UTF 8 BOM before, this can only be UTF 8 then','line_number':791,'multiline':False]['text':' enforce BOM for certain encodings','line_number':798,'multiline':False]['text':' encoding override always wins','line_number':807,'multiline':False]['text':' preferred encoding comes second','line_number':809,'multiline':False]['text':' and last we check for settings','line_number':811,'multiline':False]['text':' the default is UTF-8','line_number':816,'multiline':False]['text':' check if the resource is child of encoding override path','line_number':827,'multiline':False]['text':' check if the resource extension is equal to encoding override','line_number':832,'multiline':False]