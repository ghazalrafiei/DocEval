['text':'---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------','line_number':1,'multiline':True]['text':'*
 * The working copy backup tracker deals with:
 * - restoring backups that exist
 * - creating backups for modified working copies
 * - deleting backups for saved working copies
 * - handling backups on shutdown
 ','line_number':21,'multiline':True]['text':' Fill in initial modified working copies','line_number':42,'multiline':False]['text':' Working Copy events','line_number':52,'multiline':False]['text':' Lifecycle','line_number':58,'multiline':False]['text':' Once a handler registers, restore backups','line_number':62,'multiline':False]['text':' Here we know that we will shutdown. Any backup operation that is','line_number':70,'multiline':False]['text':' already scheduled or being scheduled from this moment on runs','line_number':71,'multiline':False]['text':' at the risk of corrupting a backup because the backup operation','line_number':72,'multiline':False]['text':' might terminate at any given time now. As such, we need to disable','line_number':73,'multiline':False]['text':' this tracker from performing more backups by cancelling pending','line_number':74,'multiline':False]['text':' operations and suspending the tracker without resuming.','line_number':75,'multiline':False]['text':'#region Backup Creator','line_number':82,'multiline':False]['text':' Delay creation of backups when content changes to avoid too much','line_number':84,'multiline':False]['text':' load on the backup service when the user is typing into the editor','line_number':85,'multiline':False]['text':' Since we always schedule a backup, even when auto save is on, we','line_number':86,'multiline':False]['text':' have different scheduling delays based on auto save. This helps to','line_number':87,'multiline':False]['text':' avoid a (not critical but also not really wanted) race between saving','line_number':88,'multiline':False]['text':' (after 1s per default) and making a backup of the working copy.','line_number':89,'multiline':False]['text':' explicitly higher to prevent races','line_number':94,'multiline':False]['text':' A map from working copy to a version ID we compute on each content','line_number':98,'multiline':False]['text':' change. This version ID allows to e.g. ask if a backup for a specific','line_number':99,'multiline':False]['text':' content has been made before closing.','line_number':100,'multiline':False]['text':' A map of scheduled pending backup operations for working copies','line_number':103,'multiline':False]['text':' Given https://github.com/microsoft/vscode/issues/158038, we explicitly','line_number':104,'multiline':False]['text':' do not store `IWorkingCopy` but the identifier in the map, since it','line_number':105,'multiline':False]['text':' looks like GC is not running for the working copy otherwise.','line_number':106,'multiline':False]['text':' Remove from content version map','line_number':124,'multiline':False]['text':' Check suspended','line_number':127,'multiline':False]['text':' Discard backup','line_number':133,'multiline':False]['text':' Increment content version ID','line_number':152,'multiline':False]['text':' Check suspended','line_number':156,'multiline':False]['text':' Schedule backup for modified working copies','line_number':162,'multiline':False]['text':' this listener will make sure that the backup is','line_number':164,'multiline':False]['text':' pushed out for as long as the user is still changing','line_number':165,'multiline':False]['text':' the content of the working copy.','line_number':166,'multiline':False]['text':' Clear any running backup operation','line_number':173,'multiline':False]['text':' Schedule new backup','line_number':178,'multiline':False]['text':' Backup if modified','line_number':186,'multiline':False]['text':' Clear disposable unless we got canceled which would','line_number':206,'multiline':False]['text':' indicate another operation has started meanwhile','line_number':207,'multiline':False]['text':' Keep in map for disposal as needed','line_number':213,'multiline':False]['text':' respect working copy override','line_number':229,'multiline':False]['text':' auto-save is never on for untitled working copies','line_number':234,'multiline':False]['text':' Clear any running backup operation','line_number':248,'multiline':False]['text':' Schedule backup discard asap','line_number':251,'multiline':False]['text':' Keep in map for disposal as needed','line_number':256,'multiline':False]['text':' Discard backup','line_number':270,'multiline':False]['text':' Clear disposable unless we got canceled which would','line_number':277,'multiline':False]['text':' indicate another operation has started meanwhile','line_number':278,'multiline':False]['text':' Given a working copy we want to find the matching','line_number':286,'multiline':False]['text':' identifier in our pending operations map because','line_number':287,'multiline':False]['text':' we cannot use the working copy directly, as the','line_number':288,'multiline':False]['text':' identifier might have different object identity.','line_number':289,'multiline':False]['text':'#endregion','line_number':334,'multiline':False]['text':'#region Backup Restorer','line_number':337,'multiline':False]['text':' Wait for resolving backups until we are restored to reduce startup pressure','line_number':347,'multiline':False]['text':' Remember each backup that needs to restore','line_number':350,'multiline':False]['text':' Wait for backups to be resolved','line_number':360,'multiline':False]['text':' Figure out already opened editors for backups vs','line_number':363,'multiline':False]['text':' non-opened.','line_number':364,'multiline':False]['text':' Ensure each backup that can be handled has an','line_number':368,'multiline':False]['text':' associated editor.','line_number':369,'multiline':False]['text':' Collect already opened editors for backup','line_number':377,'multiline':False]['text':' Otherwise, make sure to create at least one editor','line_number':387,'multiline':False]['text':' for the backup to show','line_number':388,'multiline':False]['text':' Remember as (potentially) restored','line_number':393,'multiline':False]['text':' Ensure editors are opened for each backup without editor','line_number':397,'multiline':False]['text':' in the background without stealing focus','line_number':398,'multiline':False]['text':' Then, resolve each opened editor to make sure the working copy','line_number':414,'multiline':False]['text':' is loaded and the modified editor appears properly.','line_number':415,'multiline':False]['text':' We only do that for editors that are not active in a group','line_number':416,'multiline':False]['text':' already to prevent calling `resolve` twice!','line_number':417,'multiline':False]['text':' Finally, remove all handled backups from the list','line_number':426,'multiline':False]['text':'#endregion','line_number':432,'multiline':False]