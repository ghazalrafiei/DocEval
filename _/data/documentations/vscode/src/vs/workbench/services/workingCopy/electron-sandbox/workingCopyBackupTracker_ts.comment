['text':'---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------','line_number':1,'multiline':True]['text':' Important: we are about to shutdown and handle modified working copies','line_number':52,'multiline':False]['text':' and backups. We do not want any pending backup ops to interfer with','line_number':53,'multiline':False]['text':' this because there is a risk of a backup being scheduled after we have','line_number':54,'multiline':False]['text':' acknowledged to shutdown and then might end up with partial backups','line_number':55,'multiline':False]['text':' written to disk, or even empty backups or deletes after writes.','line_number':56,'multiline':False]['text':' (https://github.com/microsoft/vscode/issues/138055)','line_number':57,'multiline':False]['text':' For the duration of the shutdown handling, suspend backup operations','line_number':61,'multiline':False]['text':' and only resume after we have handled backups. Similar to above, we','line_number':62,'multiline':False]['text':' do not want to trigger backup tracking during our shutdown handling','line_number':63,'multiline':False]['text':' but we must resume, in case of a veto afterwards.','line_number':64,'multiline':False]['text':' Modified working copies need treatment on shutdown','line_number':70,'multiline':False]['text':' No modified working copies','line_number':76,'multiline':False]['text':' If auto save is enabled, save all non-untitled working copies','line_number':87,'multiline':False]['text':' and then check again for modified copies','line_number':88,'multiline':False]['text':' Save all modified working copies that can be auto-saved','line_number':93,'multiline':False]['text':' guard against misbehaving saves, we handle remaining modified below','line_number':97,'multiline':False]['text':' If we still have modified working copies, we either have untitled ones or working copies that cannot be saved','line_number':100,'multiline':False]['text':' no veto (modified auto-saved)','line_number':106,'multiline':False]['text':' Auto save is not enabled','line_number':109,'multiline':False]['text':' Trigger backup if configured and enabled for shutdown reason','line_number':115,'multiline':False]['text':' no veto (backup was successful for all working copies)','line_number':126,'multiline':False]['text':' We ran a backup but received an error that we show to the user','line_number':135,'multiline':False]['text':' do not block shutdown during extension development (https://github.com/microsoft/vscode/issues/115028)','line_number':140,'multiline':False]['text':' veto (the backup failed)','line_number':145,'multiline':False]['text':' Since a backup did not happen, we have to confirm for','line_number':148,'multiline':False]['text':' the working copies that did not successfully backup','line_number':149,'multiline':False]['text':' do not block shutdown during extension development (https://github.com/microsoft/vscode/issues/115028)','line_number':157,'multiline':False]['text':' veto (save or revert failed)','line_number':162,'multiline':False]['text':' never backup when hot exit is disabled via settings','line_number':168,'multiline':False]['text':' always backup closing extension development window without asking to speed up debugging','line_number':172,'multiline':False]['text':' Window Close','line_number':177,'multiline':False]['text':' backup if a workspace/folder is open and onExitAndWindowClose is configured','line_number':180,'multiline':False]['text':' backup scratchpads automatically to avoid user confirmation','line_number':185,'multiline':False]['text':' do not backup if a window is closed that does not cause quitting of the application','line_number':188,'multiline':False]['text':' backup if last window is closed on win/linux where the application quits right after','line_number':191,'multiline':False]['text':' Application Quit','line_number':193,'multiline':False]['text':' backup because next start we restore all backups','line_number':195,'multiline':False]['text':' Window Reload','line_number':197,'multiline':False]['text':' backup because after window reload, backups restore','line_number':199,'multiline':False]['text':' Workspace Change','line_number':201,'multiline':False]['text':' backup if a workspace/folder is open and onExitAndWindowClose is configured','line_number':205,'multiline':False]['text':' backup scratchpads automatically to avoid user confirmation','line_number':208,'multiline':False]['text':' do not backup because we are switching contexts with no workspace/folder open','line_number':211,'multiline':False]['text':' Perform a backup of all modified working copies unless a backup already exists','line_number':234,'multiline':False]['text':' Backup exists','line_number':238,'multiline':False]['text':' Backup does not exist','line_number':244,'multiline':False]['text':' Save','line_number':272,'multiline':False]['text':' guard against misbehaving saves, we handle remaining modified below','line_number':280,'multiline':False]['text':' veto (save failed or was canceled)','line_number':285,'multiline':False]['text':' no veto (modified saved)','line_number':288,'multiline':False]['text':' Don't Save','line_number':291,'multiline':False]['text':' do not block the shutdown on errors from revert','line_number':296,'multiline':False]['text':' no veto (modified reverted)','line_number':299,'multiline':False]['text':' Cancel','line_number':302,'multiline':False]['text':' veto (user canceled)','line_number':303,'multiline':False]['text':' Skip save participants on shutdown for performance reasons','line_number':309,'multiline':False]['text':' First save through the editor service if we save all to benefit','line_number':312,'multiline':False]['text':' from some extras like switching to untitled modified editors before saving.','line_number':313,'multiline':False]['text':' If we still have modified working copies, save those directly','line_number':322,'multiline':False]['text':' unless the save was not successful (e.g. cancelled)','line_number':323,'multiline':False]['text':' Soft revert is good enough on shutdown','line_number':333,'multiline':False]['text':' First revert through the editor service if we revert all','line_number':336,'multiline':False]['text':' If we still have modified working copies, revert those directly','line_number':341,'multiline':False]['text':' We are about to shutdown without modified editors','line_number':348,'multiline':False]['text':' and will discard any backups that are still','line_number':349,'multiline':False]['text':' around that have not been handled depending','line_number':350,'multiline':False]['text':' on the window state.','line_number':351,'multiline':False]['text':'','line_number':352,'multiline':False]['text':' Empty window: discard even unrestored backups to','line_number':353,'multiline':False]['text':' prevent empty windows from restoring that cannot','line_number':354,'multiline':False]['text':' be closed (workaround for not having implemented','line_number':355,'multiline':False]['text':' https://github.com/microsoft/vscode/issues/127163','line_number':356,'multiline':False]['text':' and a fix for what users have reported in issue','line_number':357,'multiline':False]['text':' https://github.com/microsoft/vscode/issues/126725)','line_number':358,'multiline':False]['text':'','line_number':359,'multiline':False]['text':' Workspace/Folder window: do not discard unrestored','line_number':360,'multiline':False]['text':' backups to give a chance to restore them in the','line_number':361,'multiline':False]['text':' future. Since we do not restore workspace/folder','line_number':362,'multiline':False]['text':' windows with backups, this is fine.','line_number':363,'multiline':False]['text':' Discard backups from working copies the','line_number':372,'multiline':False]['text':' user either saved or reverted','line_number':373,'multiline':False]['text':' no veto (no modified)','line_number':377,'multiline':False]['text':' We never discard any backups before we are ready','line_number':385,'multiline':False]['text':' and have resolved all backups that exist. This','line_number':386,'multiline':False]['text':' is important to not loose backups that have not','line_number':387,'multiline':False]['text':' been handled.','line_number':388,'multiline':False]['text':' When we shutdown either with no modified working copies left','line_number':396,'multiline':False]['text':' or with some handled, we start to discard these backups','line_number':397,'multiline':False]['text':' to free them up. This helps to get rid of stale backups','line_number':398,'multiline':False]['text':' as reported in https://github.com/microsoft/vscode/issues/92962','line_number':399,'multiline':False]['text':'','line_number':400,'multiline':False]['text':' However, we never want to discard backups that we know','line_number':401,'multiline':False]['text':' were not restored in the session.','line_number':402,'multiline':False]['text':' use a dialog to prevent the user from making any more changes now (https://github.com/microsoft/vscode/issues/122774)','line_number':420,'multiline':False]['text':' allow to cancel (https://github.com/microsoft/vscode/issues/112278)','line_number':421,'multiline':False]['text':' delay so that it only appears when operation takes a long time','line_number':422,'multiline':False]