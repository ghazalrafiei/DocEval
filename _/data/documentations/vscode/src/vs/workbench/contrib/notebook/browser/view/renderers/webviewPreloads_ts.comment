['text':'---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------','line_number':1,'multiline':True]['text':' !! IMPORTANT !! ----------------------------------------------------------------------------------','line_number':13,'multiline':False]['text':' import { RenderOutputType } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';','line_number':14,'multiline':False]['text':' We can ONLY IMPORT as type in this module. This also applies to const enums that would evaporate','line_number':15,'multiline':False]['text':' in normal compiles but remain a dependency in transpile-only compiles','line_number':16,'multiline':False]['text':' !! IMPORTANT !! ----------------------------------------------------------------------------------','line_number':17,'multiline':False]['text':' !! IMPORTANT !! everything must be in-line within the webviewPreloads','line_number':19,'multiline':False]['text':' function. Imports are not allowed. This is stringified and injected into','line_number':20,'multiline':False]['text':' the webview.','line_number':21,'multiline':False]['text':' eslint-disable-next-line no-restricted-globals','line_number':92,'multiline':False]['text':' one frame at 64fps','line_number':115,'multiline':False]['text':' check if an input element is focused within the output element','line_number':147,'multiline':False]['text':' Scrolling to location within current doc','line_number':193,'multiline':False]['text':' Check outer document first','line_number':202,'multiline':False]['text':' Fallback to checking preview shadow doms','line_number':206,'multiline':False]['text':' markup, update directly','line_number':384,'multiline':False]['text':' Do not update dimension in resize observer','line_number':395,'multiline':False]['text':' Debounce this callback to only happen after','line_number':430,'multiline':False]['text':' 250 ms. Don't need resize events that often.','line_number':431,'multiline':False]['text':' scroll up','line_number':448,'multiline':False]['text':' there is still some content to scroll','line_number':450,'multiline':False]['text':' scroll down','line_number':454,'multiline':False]['text':' per https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight','line_number':456,'multiline':False]['text':' scrollTop is not rounded but scrollHeight and clientHeight are','line_number':457,'multiline':False]['text':' so we need to check if the difference is less than some threshold','line_number':458,'multiline':False]['text':' if the node is not scrollable, we can continue. We don't check the computed style always as it's expensive','line_number':463,'multiline':False]['text':' derived from https://github.com/Treora/dom-highlight-range/blob/master/highlight-range.js','line_number':528,'multiline':False]['text':' Return an array of the text nodes in the range. Split the start and end nodes if required.','line_number':530,'multiline':False]['text':' If the start or end node is a text node and only partly in the range, split it.','line_number':536,'multiline':False]['text':' (this may get lost when the splitting the node)','line_number':539,'multiline':False]['text':' If the end was in the same container, it will now be in the newly created node.','line_number':542,'multiline':False]['text':' Collect the text nodes.','line_number':556,'multiline':False]['text':' // Optimise by skipping nodes that are explicitly outside the range.','line_number':565,'multiline':False]['text':' const NodeTypesWithCharacterOffset = [','line_number':566,'multiline':False]['text':'  Node.TEXT_NODE,','line_number':567,'multiline':False]['text':'  Node.PROCESSING_INSTRUCTION_NODE,','line_number':568,'multiline':False]['text':'  Node.COMMENT_NODE,','line_number':569,'multiline':False]['text':' ];','line_number':570,'multiline':False]['text':' if (!NodeTypesWithCharacterOffset.includes(range.startContainer.nodeType)) {','line_number':571,'multiline':False]['text':'   if (range.startOffset < range.startContainer.childNodes.length) {','line_number':572,'multiline':False]['text':'     walker.currentNode = range.startContainer.childNodes[range.startOffset];','line_number':573,'multiline':False]['text':'   } else {','line_number':574,'multiline':False]['text':'     walker.nextSibling(); // TODO verify this is correct.','line_number':575,'multiline':False]['text':'   }','line_number':576,'multiline':False]['text':' }','line_number':577,'multiline':False]['text':' Replace [node] with <tagName ...attributes>[node]</tagName>','line_number':593,'multiline':False]['text':' First put all nodes in an array (splits start and end nodes if needed)','line_number':612,'multiline':False]['text':' Highlight each node','line_number':615,'multiline':False]['text':' Remove a highlight element created with wrapNodeInHighlight.','line_number':622,'multiline':False]['text':' If the highlight somehow contains multiple nodes now, move them all.','line_number':627,'multiline':False]['text':' Return a function that cleans up the highlightElements.','line_number':635,'multiline':False]['text':' Remove each of the created highlightElements.','line_number':637,'multiline':False]['text':'requestId','line_number':795,'multiline':True]['text':'mime','line_number':885,'multiline':True]['text':' CodeQL [SM03712] The rendered content is provided by renderer extensions, which are responsible for sanitizing their content themselves. The notebook webview is also sandboxed.','line_number':914,'multiline':False]['text':' CodeQL [SM03712] The rendered content is provided by renderer extensions, which are responsible for sanitizing their content themselves. The notebook webview is also sandboxed.','line_number':915,'multiline':False]['text':' for performance reasons, only update the full list of highlights when we need to','line_number':1063,'multiline':False]['text':' we need to keep a reference to the old selection range to re-apply later','line_number':1153,'multiline':False]['text':' use selection API to modify selection to get entire line (the first line if multi-select)','line_number':1157,'multiline':False]['text':' collapse selection to start so that the cursor position is at beginning of match','line_number':1159,'multiline':False]['text':' extend selection in both directions to select the line','line_number':1162,'multiline':False]['text':' using the original range and the new range, we can find the offset of the match from the line start.','line_number':1168,'multiline':False]['text':' line range for match','line_number':1171,'multiline':False]['text':' re-add the old range so that the selection is restored','line_number':1177,'multiline':False]['text':' sometimes, the old and new range are in different DOM elements (ie: when the match is inside of <b></b>)','line_number':1185,'multiline':False]['text':' so we need to find the first common ancestor DOM element and find the positions of the old and new range relative to that.','line_number':1186,'multiline':False]['text':' modified from https://stackoverflow.com/a/68583466/16253823','line_number':1194,'multiline':False]['text':' modified from https://stackoverflow.com/a/48812529/16253823','line_number':1216,'multiline':False]['text':' count the number of chars before the current dom elem and the start of the dom','line_number':1228,'multiline':False]['text':' caseSensitive','line_number':1254,'multiline':True]['text':' backwards','line_number':1255,'multiline':True]['text':' wrapAround','line_number':1256,'multiline':True]['text':' wholeWord ','line_number':1257,'multiline':True]['text':' searchInFrames','line_number':1258,'multiline':True]['text':' Markdown preview are rendered in a shadow DOM.','line_number':1268,'multiline':False]['text':' markdown preview container','line_number':1271,'multiline':False]['text':' find the match in the shadow dom by checking the selection inside the shadow dom','line_number':1275,'multiline':False]['text':' Outputs might be rendered inside a shadow DOM.','line_number':1289,'multiline':False]['text':' output container','line_number':1292,'multiline':False]['text':' Optimization: avoid searching for the output container','line_number':1315,'multiline':False]['text':' Traverse up the DOM to find the container','line_number':1328,'multiline':False]['text':' inside output','line_number':1335,'multiline':False]['text':' copyImage can be called from outside of the webview, which means this function may be running whilst the webview is gaining focus.','line_number':1386,'multiline':False]['text':' Since navigator.clipboard.write requires the document to be focused, we need to wait for focus.','line_number':1387,'multiline':False]['text':' We cannot use a listener, as there is a high chance the focus is gained during the setup of the listener resulting in us missing it.','line_number':1388,'multiline':False]['text':' cancel the idle callback if it exists','line_number':1469,'multiline':False]['text':' cancel the idle callback if it exists','line_number':1474,'multiline':False]['text':' const date = new Date();','line_number':1482,'multiline':False]['text':' console.log('----- will scroll ----  ', date.getMinutes() + ':' + date.getSeconds() + ':' + date.getMilliseconds());','line_number':1483,'multiline':False]['text':' Don't remove properties that the webview might have added separately','line_number':1569,'multiline':False]['text':' Re-add new properties','line_number':1575,'multiline':False]['text':'* Inner function cached in the _loadPromise(). ','line_number':1718,'multiline':True]['text':' Preloads need to be loaded before loading renderers.','line_number':1723,'multiline':False]['text':' Load all renderers that extend this renderer','line_number':1744,'multiline':False]['text':' Squash any errors extends errors. They won't prevent the renderer','line_number':1754,'multiline':False]['text':' itself from working, so just log them.','line_number':1755,'multiline':False]['text':' uri ','line_number':1778,'multiline':True]['text':'*
		 * Returns a promise that resolves when the given preload is activated.
		 ','line_number':1780,'multiline':True]['text':'*
		 * Loads a preload.
		 * @param uri URI to load from
		 * @param originalUri URI to show in an error message if the preload is invalid.
		 ','line_number':1787,'multiline':True]['text':'*
		 * Returns a promise that waits for all currently-registered preloads to
		 * activate before resolving.
		 ','line_number':1802,'multiline':True]['text':'*
		 * Pushes the action onto the list of actions for the given output ID,
		 * ensuring that it's run in-order.
		 ','line_number':1814,'multiline':True]['text':'*
		 * Cancels the rendering of all outputs.
		 ','line_number':1845,'multiline':True]['text':' Delete all pending idle requests','line_number':1849,'multiline':False]['text':'*
		 * Cancels any ongoing rendering out an output.
		 ','line_number':1859,'multiline':True]['text':' Delete the pending idle request if it exists','line_number':1863,'multiline':False]['text':' id ','line_number':1876,'multiline':True]['text':' Try primary renderer first','line_number':1950,'multiline':False]['text':' Primary renderer failed in an expected way. Fallback to render the next mime types','line_number':1955,'multiline':False]['text':' We rendered successfully','line_number':1970,'multiline':False]['text':' All renderers have failed and there is nothing left to fallback to','line_number':1976,'multiline':False]['text':' We rendered successfully','line_number':1984,'multiline':False]['text':' Bail and let callers handle unknown errors','line_number':1993,'multiline':False]['text':' De-prioritize built-in renderers','line_number':2009,'multiline':False]['text':' Use first renderer we find in sorted list','line_number':2012,'multiline':False]['text':'/ Internal field that holds text content','line_number':2243,'multiline':False]['text':' not worth sending over since it will be stripped before rendering','line_number':2395,'multiline':False]['text':'outputId','line_number':2463,'multiline':True]['text':'* outputNode ','line_number':2505,'multiline':True]['text':' don't hide until after this step so that the height is right','line_number':2508,'multiline':False]['text':'* outputNode ','line_number':2509,'multiline':True]['text':' TODO @rebornix @mjbvz, there is a misalignment here.','line_number':2557,'multiline':False]['text':' We set output visibility on cell container, other than output container or output node itself.','line_number':2558,'multiline':False]['text':' RenderOutputType.Html ','line_number':2686,'multiline':True]['text':' CodeQL [SM03712] The content comes from renderer extensions, not from direct user input.','line_number':2687,'multiline':False]['text':' Abort rendering if caller aborts','line_number':2698,'multiline':False]['text':' we set padding to zero if the output height is zero (then we can have a zero-height output DOM node)','line_number':2718,'multiline':False]['text':' thus we need to ensure the padding is accounted when updating the init height of the output','line_number':2719,'multiline':False]['text':' Transparent overlay that prevents elements from inside the webview from eating','line_number':2754,'multiline':False]['text':' drag events.','line_number':2755,'multiline':False]['text':' Allow dropping dragged markup cells','line_number':2760,'multiline':False]['text':' Continuously send updates while dragging instead of relying on `updateDrag`.','line_number':2813,'multiline':False]['text':' This lets us scroll the list based on drag position.','line_number':2814,'multiline':False]['text':' TS will try compiling `import()` in webviewPreloads, so use a helper function instead','line_number':2864,'multiline':False]['text':' of using `import(...)` directly','line_number':2865,'multiline':False]['text':'# sourceURL=notebookWebviewPreloads.js\n`;','line_number':2870,'multiline':False]