['text':' Copyright 2021 The Bazel Authors. All rights reserved.','line_number':1,'multiline':False]['text':'','line_number':2,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':3,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':4,'multiline':False]['text':' You may obtain a copy of the License at','line_number':5,'multiline':False]['text':'','line_number':6,'multiline':False]['text':'    http://www.apache.org/licenses/LICENSE-2.0','line_number':7,'multiline':False]['text':'','line_number':8,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':9,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':10,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':11,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':12,'multiline':False]['text':' limitations under the License.','line_number':13,'multiline':False]['text':' Port used to relay sleep call back messages.','line_number':26,'multiline':False]['text':' This needs to be handled to allow sleep.','line_number':35,'multiline':False]['text':' This needs to be acknowledged to allow sleep.','line_number':42,'multiline':False]['text':' Note that Macs have a "Dark Wake" mode (also known as PowerNap) which','line_number':47,'multiline':False]['text':' can have the processors (and disk and network) turn on.','line_number':48,'multiline':False]['text':' (https://support.apple.com/en-us/HT204032). Dark Wake does NOT','line_number':49,'multiline':False]['text':' trigger PowerOn messages through our sleep callbacks, but can allow','line_number':50,'multiline':False]['text':' builds to proceed for a considerable amount of time (for example if','line_number':51,'multiline':False]['text':' Time Machine is performing a back up).','line_number':52,'multiline':False]['text':' There is currently a race condition where a build may finish','line_number':53,'multiline':False]['text':' between the time we receive the kIOMessageSystemWillSleep and the','line_number':54,'multiline':False]['text':' machine actually goes to sleep (roughly 20 seconds in my experiments).','line_number':55,'multiline':False]['text':' This will result in us reporting that the build was suspended when it','line_number':56,'multiline':False]['text':' wasn't. I haven't come up with an smart way of avoiding this issue, but','line_number':57,'multiline':False]['text':' I don't think we really care. Over reporting "suspensions" is better','line_number':58,'multiline':False]['text':' than under reporting them.','line_number':59,'multiline':False]['text':' We don't handle will not sleep. This can only occur is somebody else','line_number':66,'multiline':False]['text':' cancels the sleep, and will never occur AFTER a','line_number':67,'multiline':False]['text':' kIOMessageSystemWillSleep.','line_number':68,'multiline':False]['text':' We don't handle will power on, we only care when it HAS powered on.','line_number':69,'multiline':False]['text':' Register to receive system sleep notifications.','line_number':83,'multiline':False]['text':' Testing needs to be done manually. Use the logging to verify','line_number':84,'multiline':False]['text':' that sleeps are being caught here.','line_number':85,'multiline':False]['text':' Register to deal with SIGCONT.','line_number':91,'multiline':False]['text':' We register for SIGCONT because we can't catch SIGSTOP.','line_number':92,'multiline':False]['text':' We do have the potential of "over counting" suspensions if you send','line_number':93,'multiline':False]['text':' multiple SIGCONTs to a process without a previous SIGSTOP/SIGTSTP,','line_number':94,'multiline':False]['text':' but there is no reason to send a SIGCONT without a SIGSTOP/SIGTSTP, and','line_number':95,'multiline':False]['text':' having this functionality gives us some ability to unit test suspension','line_number':96,'multiline':False]['text':' counts.','line_number':97,'multiline':False]['text':' namespace blaze_jni','line_number':119,'multiline':False]