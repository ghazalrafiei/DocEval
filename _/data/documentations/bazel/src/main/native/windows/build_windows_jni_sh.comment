['text':'!/bin/bash -eu','line_number':1,'multiline':False]['text':' Copyright 2016 The Bazel Authors. All rights reserved.','line_number':3,'multiline':False]['text':'','line_number':4,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':5,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':6,'multiline':False]['text':' You may obtain a copy of the License at','line_number':7,'multiline':False]['text':'','line_number':8,'multiline':False]['text':'    http://www.apache.org/licenses/LICENSE-2.0','line_number':9,'multiline':False]['text':'','line_number':10,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':11,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':12,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':13,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':14,'multiline':False]['text':' limitations under the License.','line_number':15,'multiline':False]['text':' It's not a good idea to link an MSYS dynamic library into a native Windows','line_number':17,'multiline':False]['text':' JVM, so we need to build it with Visual Studio. However, Bazel doesn't','line_number':18,'multiline':False]['text':' support multiple compilers in the same build yet, so we need to hack around','line_number':19,'multiline':False]['text':' this limitation using a genrule.','line_number':20,'multiline':False]['text':' Ensure the PATH is set up correctly.','line_number':30,'multiline':False]['text':' Create a temp directory. It will used for the batch file we generate soon and','line_number':37,'multiline':False]['text':' as the temp directory for CL.EXE .','line_number':38,'multiline':False]['text':' Visual Studio or Visual C++ Build Tools might not be installed at default','line_number':43,'multiline':False]['text':' location. Check BAZEL_VS and BAZEL_VC first.','line_number':44,'multiline':False]['text':' Check if BAZEL_VC points to Visual C++ Build Tools 2019','line_number':47,'multiline':False]['text':' Find Visual Studio. We don't have any regular environment variables','line_number':52,'multiline':False]['text':' available so this is the best we can do.','line_number':53,'multiline':False]['text':' Check if Visual Studio 2019 is installed. Look for it at the default','line_number':64,'multiline':False]['text':' locations.','line_number':65,'multiline':False]['text':' Find Java. $(JAVA) in the BUILD file points to external/local_jdk/...,','line_number':87,'multiline':False]['text':' which is not very useful for anything not MSYS-based.','line_number':88,'multiline':False]['text':' Convert all compilation units to Windows paths.','line_number':94,'multiline':False]['text':' Copy jni headers to src/main/native folder','line_number':102,'multiline':False]['text':' Mimic genrule //src/main/native:copy_link_jni_md_header and //src/main/native:copy_link_jni_header','line_number':103,'multiline':False]['text':' CL.EXE needs a bunch of environment variables whose official location is a','line_number':109,'multiline':False]['text':' batch file. We can't make that have an effect on a bash instance, so','line_number':110,'multiline':False]['text':' generate a batch file that invokes it.','line_number':111,'multiline':False]['text':' As for `abs_pwd` and `pwd_drive`: in cmd.exe, it's not enough to `cd` into a','line_number':112,'multiline':False]['text':' directory. You must also change to its drive to truly set the cwd to that','line_number':113,'multiline':False]['text':' directory. See https://github.com/bazelbuild/bazel/issues/3906','line_number':114,'multiline':False]['text':' Invoke the file and hopefully generate the .DLL .','line_number':126,'multiline':False]