['text':' Owner(s): ["oncall: distributed"]','line_number':1,'multiline':False]['text':' We enable momentum so that after the first iteration, the optimizer state is added','line_number':122,'multiline':False]['text':' to the total memory used.','line_number':123,'multiline':False]['text':' results of memory stats','line_number':127,'multiline':False]['text':' It is important to use `set_to_none` below, not optimizer.zero_grad() to reclaim memory.','line_number':144,'multiline':False]['text':' allow 1MB rounding differences','line_number':153,'multiline':False]['text':' hidden_dim 128: model size ~4MB','line_number':163,'multiline':False]['text':' We have observed that sometimes after 3rd iteration, 4th one can fail (not on this','line_number':174,'multiline':False]['text':' test but on much bigger scale tests). We run 4 iterations here just in case it happens.','line_number':175,'multiline':False]['text':' sharded model size + 1MB temp memory','line_number':182,'multiline':False]['text':' it is hard to calculate this memory size, get it from printed memory usage','line_number':184,'multiline':False]['text':' sharded model size + sharded grad size + 1M temp memory','line_number':191,'multiline':False]['text':' after optimizer step in the first iteration, memory usage increased by','line_number':194,'multiline':False]['text':' sharded_model_size_mb because of increased optimizer states memory usage','line_number':195,'multiline':False]['text':' sharded model size + sharded grad size + optimizer states + 1M temp memory','line_number':213,'multiline':False]['text':' grad memory is claimed after setting grad = None','line_number':215,'multiline':False]['text':' sharded model size + optimizer states + 1M temp memory','line_number':216,'multiline':False]['text':' Get the fsdp and checkpoint flags.','line_number':219,'multiline':False]