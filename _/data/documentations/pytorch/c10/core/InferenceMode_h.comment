['text':' A RAII, thread local (!) guard that enables or disables inference mode upon','line_number':9,'multiline':False]['text':' construction, and sets it back to the original value upon destruction.','line_number':10,'multiline':False]['text':' Note [Expected TLS state in InferenceMode]:','line_number':12,'multiline':False]['text':'   InferenceMode: ADInplaceOrView not in','line_number':13,'multiline':False]['text':'   raw_local_dispatch_key_set.included(),','line_number':14,'multiline':False]['text':'                  Autograd in raw_local_dispatch_key_set.excluded()','line_number':15,'multiline':False]['text':'                  GradMode is disabled.','line_number':16,'multiline':False]['text':'   NormalMode: ADInplaceOrView in raw_local_dispatch_key_set.included(),','line_number':17,'multiline':False]['text':'               Autograd not in raw_local_dispatch_key_set.excluded()','line_number':18,'multiline':False]['text':'               GradMode is enabled by default unless toggled manually','line_number':19,'multiline':False]['text':'               through other APIs, e.g. NoGradGuard.','line_number':20,'multiline':False]['text':'','line_number':21,'multiline':False]['text':' Invariant:','line_number':22,'multiline':False]['text':' - ADInplaceOrView is never in the excluded set','line_number':23,'multiline':False]['text':' - Autograd is never in the included set','line_number':24,'multiline':False]['text':' - Setting InferenceMode will set GradMode accordingly, but not vice versa.','line_number':25,'multiline':False]['text':'','line_number':26,'multiline':False]['text':'  1. Why do we put ADInplaceOrView in included set outside InferenceMode?','line_number':27,'multiline':False]['text':'','line_number':28,'multiline':False]['text':'     Inplace update to inference tensor outside InferenceMode is not','line_number':29,'multiline':False]['text':'     allowed. See Note [Inplace update inference tensor] for more details.','line_number':30,'multiline':False]['text':'     Without going through ADInplaceOrView kernel, we cannot throw error','line_number':31,'multiline':False]['text':'     for `inference_tensor.add_(1)` case.','line_number':32,'multiline':False]['text':'','line_number':33,'multiline':False]['text':' 2. Why not put ADInplaceOrView in the excluded set inside InferenceMode?','line_number':34,'multiline':False]['text':'','line_number':35,'multiline':False]['text':'    For example:','line_number':36,'multiline':False]['text':'    torch::Tensor a = torch::ones({1, 2, 3}).set_requires_grad(true);','line_number':37,'multiline':False]['text':'    torch::Tensor k = a + 2;','line_number':38,'multiline':False]['text':'    {','line_number':39,'multiline':False]['text':'      c10::InferenceMode guard(true);','line_number':40,'multiline':False]['text':'      k.add_(2);','line_number':41,'multiline':False]['text':'    }','line_number':42,'multiline':False]['text':'    `k.add_(2)` still need to go through ADInplaceOrView kernel so that it's','line_number':43,'multiline':False]['text':'    prepared for future autograd.','line_number':44,'multiline':False]['text':'','line_number':45,'multiline':False]['text':' 3. Why does setting InferenceMode also set GradMode?','line_number':46,'multiline':False]['text':'','line_number':47,'multiline':False]['text':'    This is required since InferenceMode is a faster and more restrictive','line_number':48,'multiline':False]['text':'    version of NoGradGuard. All runtime checks using GradMode::is_enabled()','line_number':49,'multiline':False]['text':'    are applicable to InferenceMode as well, e.g.','line_number':50,'multiline':False]['text':'    `tensorTypeInCurrentExecutionContext` in interpreter.cpp.','line_number':51,'multiline':False]['text':' Enabling inference mode means disabling grad modes','line_number':55,'multiline':False]['text':' And disabling inference mode means enabling grad modes','line_number':56,'multiline':False]['text':' grad_mode ','line_number':58,'multiline':True]['text':' inference_mode ','line_number':59,'multiline':True]['text':' fw_grad_mode ','line_number':60,'multiline':True]['text':' multithreading_enabled','line_number':61,'multiline':True]['text':' namespace c10','line_number':84,'multiline':False]