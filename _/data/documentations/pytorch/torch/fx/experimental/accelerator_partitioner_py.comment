['text':' Go through all nodes in a partition.','line_number':99,'multiline':False]['text':' If a node's user is in other partition,','line_number':100,'multiline':False]['text':' then the other partition is this partition's children.','line_number':101,'multiline':False]['text':' This partition is the other partition's parent','line_number':102,'multiline':False]['text':' For each node in the current partition, find its users','line_number':108,'multiline':False]['text':' Find which the partition the user node belongs to.','line_number':111,'multiline':False]['text':' Note that if the node itself is also belongs to that partition,','line_number':112,'multiline':False]['text':' that partition is not the child of the current partition','line_number':113,'multiline':False]['text':' Rearrange partition ids','line_number':125,'multiline':False]['text':' If a partition has no parent, it should be in root level','line_number':139,'multiline':False]['text':' bfs','line_number':144,'multiline':False]['text':' logical id to device','line_number':185,'multiline':False]['text':' Track partitions on device','line_number':187,'multiline':False]['text':' Track device's left mem size','line_number':189,'multiline':False]['text':' Deal with the partitions that already have a device','line_number':195,'multiline':False]['text':' and also collect all partitions without a device (no_device_partitions)','line_number':196,'multiline':False]['text':' Find devices for all the partitions without a device','line_number':259,'multiline':False]['text':' Tag the size in bytes to all nodes in the graph_module.','line_number':317,'multiline':False]['text':' Check if there are op nodes in the fx module','line_number':319,'multiline':False]['text':' Calculate total size of the fx module','line_number':323,'multiline':False]['text':' Find the device with the max mem size','line_number':329,'multiline':False]['text':' AOT based partition','line_number':331,'multiline':False]['text':' Single partition if the whole module can be fit into one device','line_number':337,'multiline':False]['text':' Sparse nn based partition','line_number':345,'multiline':False]['text':' sparse_nn_partition only support same memory size','line_number':353,'multiline':False]['text':' TODO: add different size support for sparse_nn_partition','line_number':354,'multiline':False]['text':' Cost aware partition','line_number':356,'multiline':False]['text':' KL based partition','line_number':362,'multiline':False]['text':' Saturate host if possible.','line_number':371,'multiline':False]['text':' Partition the graph module based on the partition assignment.','line_number':375,'multiline':False]['text':' The DAG contains DAGNodes with info of each partition's input nodes, output nodes','line_number':378,'multiline':False]['text':' and how partitions are connected.','line_number':379,'multiline':False]['text':' Skip the output node, but there can','line_number':391,'multiline':False]['text':' be nodes after the output in certain cases.','line_number':392,'multiline':False]['text':' Get the node to partition mapping','line_number':397,'multiline':False]['text':' Track partition and its left mem size','line_number':434,'multiline':False]['text':' Track all the devices that have been used','line_number':436,'multiline':False]['text':' Check if there are devices left','line_number':441,'multiline':False]['text':' Check if the current partition is the very first partition','line_number':444,'multiline':False]['text':' Find a device to fit the first node, return available mem size','line_number':446,'multiline':False]['text':' Update partition and its left mem size','line_number':449,'multiline':False]['text':' Update available mem for the current partition','line_number':453,'multiline':False]['text':' The current partition is not the first partition','line_number':456,'multiline':False]['text':' Check if the current node can fit into current partition','line_number':457,'multiline':False]['text':' Check if no device is left','line_number':462,'multiline':False]['text':' No device is left','line_number':464,'multiline':False]['text':' Put the previous partitions into a list (non_single_node_partitions)','line_number':465,'multiline':False]['text':' Create the first single node partition for the current node','line_number':467,'multiline':False]['text':' Some devices are still left','line_number':470,'multiline':False]['text':' Create a new partition with a mem size that is enough for the current node','line_number':471,'multiline':False]['text':' Create single node partitions if no device is left','line_number':483,'multiline':False]['text':' Get the node to partition mapping','line_number':487,'multiline':False]['text':' Mapping all partitions into device','line_number':489,'multiline':False]['text':' Devices that hold partitions','line_number':515,'multiline':False]['text':' Track replicates of the assigned devices','line_number':517,'multiline':False]['text':' Success flag for this round','line_number':523,'multiline':False]['text':' Devices that have not been assigned','line_number':525,'multiline':False]['text':' Temporary mapping from replicated device to original device','line_number':531,'multiline':False]['text':' Find a new device to replicate all partitions on an used device','line_number':534,'multiline':False]['text':' Idle devices that have enough memory','line_number':536,'multiline':False]['text':' Update logical device IDs assigned to the partitions','line_number':555,'multiline':False]['text':' When a node has two or more output nodes,','line_number':588,'multiline':False]['text':' it outputs its result to 'getitem' nodes.','line_number':589,'multiline':False]['text':' Those 'getitem' nodes are the output node for this node.','line_number':590,'multiline':False]['text':' Otherwise, the output node is this node itself.','line_number':591,'multiline':False]['text':' Sort partitions based on memory size','line_number':654,'multiline':False]['text':' Mark bfs level','line_number':656,'multiline':False]['text':' Calculate how many bytes needed if combined','line_number':683,'multiline':False]['text':' Track embedding partitions and non-embedding partitions separately','line_number':722,'multiline':False]['text':' A Flag to check the boundary','line_number':725,'multiline':False]['text':' Check if crossing the boundary between embedding nodes and non embedding nodes','line_number':730,'multiline':False]['text':' Crossing the boundary','line_number':732,'multiline':False]['text':' Check if the current partition is an empty partition','line_number':733,'multiline':False]['text':' The current partition isn't an empty partition. Create a new one.','line_number':735,'multiline':False]['text':' Set parents and children for partitions','line_number':751,'multiline':False]['text':' Combining non-embedding partitions','line_number':753,'multiline':False]['text':' Combining embedding partitions','line_number':755,'multiline':False]['text':' Check if devices are enough for all partitions','line_number':760,'multiline':False]['text':' Check if all non-embedding partitions can fit into embedding partition devices','line_number':772,'multiline':False]['text':' Add logical device to the partition','line_number':783,'multiline':False]['text':' Add logical devices to the non_embedding_partitions','line_number':786,'multiline':False]['text':' Get the node to partition mapping','line_number':789,'multiline':False]['text':' Check if a circular dependency exists after combining','line_number':829,'multiline':False]['text':' Check if the modified partition list can be mapped to devices after combination','line_number':832,'multiline':False]['text':' Calculate the new cost','line_number':839,'multiline':False]['text':' If two partition can not be combined, the cost is inf','line_number':849,'multiline':False]['text':' Try to combine the partition pair','line_number':877,'multiline':False]['text':' and see the new cost after combination','line_number':878,'multiline':False]['text':' If a partition pair is found, combine them','line_number':884,'multiline':False]['text':' Set up parent partitions and children partitions for each partition','line_number':897,'multiline':False]['text':' Get bfs level for each partition','line_number':899,'multiline':False]['text':' Search for a pair partition to generate the minimum new cost,','line_number':903,'multiline':False]['text':' then combine them','line_number':904,'multiline':False]['text':' Make sure all partitions are set up correctly','line_number':908,'multiline':False]['text':' Set up node to partition mapping','line_number':910,'multiline':False]['text':' Either n0 or n1 could be None','line_number':939,'multiline':False]['text':' That means we simply move the node','line_number':940,'multiline':False]['text':' to another partition','line_number':941,'multiline':False]['text':' Reorganize partitions after swapping','line_number':954,'multiline':False]['text':' Check if there is a circular dependency after swapping','line_number':956,'multiline':False]['text':' Check if all partitions can be mapped to logical devices after swapping','line_number':962,'multiline':False]['text':' Swap back and reset all partitions back to original','line_number':974,'multiline':False]['text':' Ignore the node if it is not a op node','line_number':991,'multiline':False]['text':' Try swapping node in p0 with n1 in p1','line_number':994,'multiline':False]['text':' First use size_base_partition','line_number':1003,'multiline':False]['text':' Calculate the cost of the partitions','line_number':1008,'multiline':False]['text':' Keep tracking the node pair that shows the better cost','line_number':1012,'multiline':False]['text':' Keep tracking the partition pair of node pair','line_number':1014,'multiline':False]['text':' Collect all the op nodes from the graph','line_number':1016,'multiline':False]['text':' Find which partition the current node belongs','line_number':1022,'multiline':False]['text':' Go through all the other partitions to swap','line_number':1025,'multiline':False]['text':' with other nodes from those partitions','line_number':1026,'multiline':False]['text':' Update the cost','line_number':1037,'multiline':False]['text':' Track the swapped node pair and their partitions','line_number':1038,'multiline':False]['text':' Do the swapping after trying all the nodes from a partition','line_number':1043,'multiline':False]['text':' Mapping the device to the partition','line_number':1051,'multiline':False]['text':' If the requested partition has not been created, create the partition','line_number':1065,'multiline':False]['text':' Add the current node into the partition','line_number':1077,'multiline':False]