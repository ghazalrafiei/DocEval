['text':' NOTE: [forward-mode AD decompositions mechanism]','line_number':14,'multiline':False]['text':'','line_number':15,'multiline':False]['text':' The mechanism is in VariableType,','line_number':16,'multiline':False]['text':'   IF any inputs have forward grad','line_number':17,'multiline':False]['text':'      AND there is no forward AD formula implemented','line_number':18,'multiline':False]['text':'      AND the functions is actually differentiable','line_number':19,'multiline':False]['text':'   run the decomposition','line_number':20,'multiline':False]['text':'      See run_jit_decomposition_with_args_for_jvp','line_number':21,'multiline':False]['text':'      We currently use python decompositions that we torchscript.','line_number':22,'multiline':False]['text':'','line_number':23,'multiline':False]['text':' Note that we would be building the backward graph at the decomposed level','line_number':24,'multiline':False]['text':' too, but that is OK, because we would've errored out otherwise anyway.','line_number':25,'multiline':False]['text':'','line_number':26,'multiline':False]['text':' TODO: The mechanism we are using to register decompositions doesn't','line_number':27,'multiline':False]['text':' seem to be exclusively used for jvp. So open question here is whether','line_number':28,'multiline':False]['text':' torch/csrc/jit/runtime/decomposition_registry.cpp is being used for other things.','line_number':29,'multiline':False]['text':' If that is the case, we may go down the decomposition path unexpectedly','line_number':30,'multiline':False]['text':' (and possibly produce an unintelligible error) vs erroring out earlier and','line_number':31,'multiline':False]['text':' printing that the forward AD formula is not implemented.','line_number':32,'multiline':False]['text':'','line_number':33,'multiline':False]['text':' The solution to this may be to have a explicitly white list control when','line_number':34,'multiline':False]['text':' to enable the decomposition.','line_number':35,'multiline':False]['text':' Functions where we need a special decomposition for jvp but there's another version that','line_number':48,'multiline':False]['text':' should be used more generally (ex. for jvp we need to recompute the mean and variance for','line_number':49,'multiline':False]['text':' the backwards of a normalization function. Without jvp, it should use the saved value)','line_number':50,'multiline':False]['text':' `out_wrapper` extends a decompositions signature with','line_number':67,'multiline':False]['text':' an `out` parameter. However jit will use the unwrapped function's','line_number':68,'multiline':False]['text':' signature instead so we need to unwrap here to prevent an error','line_number':69,'multiline':False]['text':' Create a string wrapping the function from the signature','line_number':76,'multiline':False]['text':' example output:','line_number':77,'multiline':False]['text':' def wrapped_decomp(x: torch.Tensor, y: int, z: int):','line_number':78,'multiline':False]['text':'   return decomp_fn(x, y, z)','line_number':79,'multiline':False]['text':' Thanks copilot!','line_number':80,'multiline':False]['text':' The only decompositions here are temporary or hacks for the purposes of jvp','line_number':94,'multiline':False]['text':' TODO: do these also belong here?','line_number':97,'multiline':False]['text':' for most norm decompositions, it will be the same as the core version except for here.','line_number':117,'multiline':False]['text':' We recompute the mean and variance so that they track gradients through input','line_number':118,'multiline':False]['text':' this makes me so sad inside','line_number':122,'multiline':False]['text':' should be None but doesn't work with vjp','line_number':178,'multiline':False]['text':' should be None but doesn't work with vjp','line_number':188,'multiline':False]['text':' should be None but doesn't work with vjp','line_number':190,'multiline':False]['text':' should be None but doesn't work with vjp','line_number':198,'multiline':False]['text':' should be None but doesn't work with vjp','line_number':200,'multiline':False]['text':' type: ignore[arg-type]','line_number':230,'multiline':False]['text':' for typing','line_number':239,'multiline':False]['text':' should be None but doesn't work with vjp','line_number':280,'multiline':False]['text':' should be None but doesn't work with vjp','line_number':282,'multiline':False]['text':' should be None but doesn't work with vjp','line_number':289,'multiline':False]