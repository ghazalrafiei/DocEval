['text':' TODO(crcrpar): Add `n>5` for `low prec params & their higher prec copy`','line_number':17,'multiline':False]['text':' TensorListMetadata has to be < 4KB - the limit for kernel launch argument','line_number':18,'multiline':False]['text':' note(mkozuki): `n` of 1&2 violate the limit of cuda kernel argument size of','line_number':59,'multiline':False]['text':' 4kb with `c10::complex<double>`','line_number':60,'multiline':False]['text':' NOTE(crcrpar): This is a conservative resolution to handle `state_steps`','line_number':85,'multiline':False]['text':' whose each element is `at::Tensor` of 1 element representing the number of','line_number':86,'multiline':False]['text':' `step`s called so far.','line_number':87,'multiline':False]['text':' Hand the chunk information to the user-supplied functor to process however','line_number':104,'multiline':False]['text':' it likes.','line_number':105,'multiline':False]['text':' namespace','line_number':109,'multiline':False]['text':' multi_tensor_apply enables horizontal fusion across lists of tensors.','line_number':111,'multiline':False]['text':' For example, whereas you once had a for-loop of a + b = c, where a, b,','line_number':112,'multiline':False]['text':' and c are individual tensors in lists as, bs, and cs, you can now with','line_number':113,'multiline':False]['text':' fewer kernel launches compute as + bs = cs.','line_number':114,'multiline':False]['text':'','line_number':115,'multiline':False]['text':' You can also imagine bs to be a scalar list vs a tensor list.','line_number':116,'multiline':False]['text':'','line_number':117,'multiline':False]['text':' The function below takes in tensor lists, scalars, and a callable and','line_number':118,'multiline':False]['text':' chunks up the computation to launch as few kernels as possible by iterating','line_number':119,'multiline':False]['text':' through every "chunk" in every tensor (thus the nested for loops). In the','line_number':120,'multiline':False]['text':' simplest case, everything gets bundled into just one kernel launch, but','line_number':121,'multiline':False]['text':' due to blocksize constraints, we may need to launch multiple kernels.','line_number':122,'multiline':False]['text':' Each kernel launch is defined by one tensorListMeta construct, which we','line_number':123,'multiline':False]['text':' use to track and reset the necessary metadata for each launch.','line_number':124,'multiline':False]['text':' short-circuit to avoid adding empty tensors to tensorListMeta','line_number':141,'multiline':False]['text':' now we enter [chunking territory].','line_number':154,'multiline':False]['text':' we will launch a kernel when EITHER the blocks get filled up OR','line_number':155,'multiline':False]['text':' the tensors get filled up. There will always be at least one block','line_number':156,'multiline':False]['text':' per tensor since the zero-sized ones will not enter the loop, so','line_number':157,'multiline':False]['text':' the nested forloop within represents iterating through the chunks','line_number':158,'multiline':False]['text':' of a single tensor.','line_number':159,'multiline':False]['text':' a tensor is not considered full unless all its chunks have been','line_number':167,'multiline':False]['text':' processed','line_number':168,'multiline':False]['text':' Reset.','line_number':184,'multiline':False]['text':' all chunks have already been handled in the kernel','line_number':186,'multiline':False]['text':' blocks were full and tensor chunks remain','line_number':189,'multiline':False]['text':' note: [finishing what we started]','line_number':204,'multiline':False]['text':' if there's remaining work to be done but the tensors/blocks aren't full','line_number':205,'multiline':False]['text':' yet we are at the end, submit the kernel to do the work!','line_number':206,'multiline':False]['text':' short-circuit to avoid adding empty tensors to tensorListMeta','line_number':232,'multiline':False]['text':' see note: [chunking territory].','line_number':244,'multiline':False]['text':' Reset.','line_number':267,'multiline':False]['text':' see note: [finishing what we started]','line_number':286,'multiline':False]['text':' short-circuit to avoid adding empty tensors to tensorListMeta','line_number':312,'multiline':False]['text':' see above note: [chunking territory]','line_number':326,'multiline':False]['text':' Reset.','line_number':349,'multiline':False]['text':' see above note: [finishing what we've started]','line_number':368,'multiline':False]['text':' namespace at::native','line_number':379,'multiline':False]