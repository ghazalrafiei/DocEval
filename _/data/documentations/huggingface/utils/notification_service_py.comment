['text':' Copyright 2020 The HuggingFace Team. All rights reserved.','line_number':1,'multiline':False]['text':'','line_number':2,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':3,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':4,'multiline':False]['text':' You may obtain a copy of the License at','line_number':5,'multiline':False]['text':'','line_number':6,'multiline':False]['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':7,'multiline':False]['text':'','line_number':8,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':9,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':10,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':11,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':12,'multiline':False]['text':' limitations under the License.','line_number':13,'multiline':False]['text':' When the output is short enough, the output is surrounded by = signs: "== OUTPUT =="','line_number':55,'multiline':False]['text':' When it is too long, those signs are not present.','line_number':56,'multiline':False]['text':' These files should follow the following architecture:','line_number':69,'multiline':False]['text':' === FAILURES ===','line_number':70,'multiline':False]['text':' <path>:<line>: Error ...','line_number':71,'multiline':False]['text':' <path>:<line>: Error ...','line_number':72,'multiline':False]['text':' <empty line>','line_number':73,'multiline':False]['text':' Convert each dictionary to counter','line_number':95,'multiline':False]['text':' Sum all the counters','line_number':97,'multiline':False]['text':' Failures and success of the modeling tests','line_number':114,'multiline':False]['text':' Some suites do not have a distinction between single and multi GPU.','line_number':119,'multiline':False]['text':' Failures and success of the additional tests','line_number':125,'multiline':False]['text':' `dicts_to_sum` uses `dicts_to_sum` which requires a non empty dictionary. Let's just add an empty entry.','line_number':129,'multiline':False]['text':' Results','line_number':145,'multiline':False]['text':' Time can be formatted as xx:xx:xx, as .xx, or as x.xx if the time spent was less than a minute.','line_number':170,'multiline':False]['text':' If something goes wrong, let's avoid the CI report failing to be sent.','line_number':226,'multiline':False]['text':' Use the workflow run link','line_number':228,'multiline':False]['text':' Use the actual job link','line_number':232,'multiline':False]['text':' noqa','line_number':294,'multiline':False]['text':' Remove the leading and training parts that don't contain failure count information.','line_number':295,'multiline':False]['text':' Obtain per-model failures','line_number':333,'multiline':False]['text':' (Possibly truncated) reports for the current workflow run - to be sent to Slack channels','line_number':388,'multiline':False]['text':' To be sent to Slack channels','line_number':401,'multiline':False]['text':' Save the complete (i.e. no truncation) failure tables (of the current workflow run)','line_number':407,'multiline':False]['text':' (to be uploaded as artifacts)','line_number':408,'multiline':False]['text':' if the last run produces artifact named `prev_ci_results`','line_number':431,'multiline':False]['text':' Compute the difference of the previous/current (model failure) table','line_number':436,'multiline':False]['text':' Save the complete difference','line_number':440,'multiline':False]['text':' To be sent to Slack channels','line_number':451,'multiline':False]['text':' `text` must be less than 3001 characters in Slack SDK','line_number':598,'multiline':False]['text':' keep some room for adding "[Truncated]" when necessary','line_number':599,'multiline':False]['text':' `failure_text` here has length <= 3000','line_number':606,'multiline':False]['text':' `failure_text` here has length <= MAX_ERROR_TEXT','line_number':609,'multiline':False]['text':' TODO: Make sure we always have a valid job link (or at least a way not to break the report sending)','line_number':618,'multiline':False]['text':' Currently we get the device from a job's artifact name.','line_number':619,'multiline':False]['text':' If a device is found, the job name should contain the device type, for example, `XXX (single-gpu)`.','line_number':620,'multiline':False]['text':' This could be done by adding `machine_type` in a job's `strategy`.','line_number':621,'multiline':False]['text':' (If `job_result["job_link"][device]` is `None`, we get an error: `... [ERROR] must provide a string ...`)','line_number':622,'multiline':False]['text':' `failure_text` here has length <= 3000','line_number':679,'multiline':False]['text':' `failure_text` here has length <= MAX_ERROR_TEXT','line_number':682,'multiline':False]['text':' `text` must be less than 3001 characters in Slack SDK','line_number':839,'multiline':False]['text':' keep some room for adding "[Truncated]" when necessary','line_number':840,'multiline':False]['text':' `report` here has length <= 3000','line_number':846,'multiline':False]['text':' runner_status = os.environ.get("RUNNER_STATUS")','line_number':855,'multiline':False]['text':' runner_env_status = os.environ.get("RUNNER_ENV_STATUS")','line_number':856,'multiline':False]['text':' runner_not_available = True if runner_status is not None and runner_status != "success" else False','line_number':859,'multiline':False]['text':' runner_failed = True if runner_env_status is not None and runner_env_status != "success" else False','line_number':860,'multiline':False]['text':' Let's keep the lines regardig runners' status (we might be able to use them again in the future)','line_number':861,'multiline':False]['text':' This env. variable is set in workflow file (under the job `send_results`).','line_number':870,'multiline':False]['text':' To find the PR number in a commit title, for example, `Add AwesomeFormer model (#99999)`','line_number':873,'multiline':False]['text':' Add Commit/PR title with a link for push CI','line_number':877,'multiline':False]['text':' (check the title in 2 env. variables - depending on the CI is triggered via `push` or `workflow_run` event)','line_number':878,'multiline':False]['text':' Retrieve the PR title and author login to complete the report','line_number':898,'multiline':False]['text':' Find the PR number (if any) and change the url to the actual PR page.','line_number':905,'multiline':False]['text':' Need to change from elements like `models/bert` to `models_bert` (the ones used as artifact names).','line_number':935,'multiline':False]['text':' This dict will contain all the information relative to each model:','line_number':958,'multiline':False]['text':' - Failures: the total, as well as the number of failures per-category defined above','line_number':959,'multiline':False]['text':' - Success: total','line_number':960,'multiline':False]['text':' - Time spent: as a comma-separated list of elapsed time','line_number':961,'multiline':False]['text':' - Failures: as a line-break separated list of errors','line_number':962,'multiline':False]['text':' This prefix is used to get job links below. For past CI, we use `workflow_call`, which changes the job names from','line_number':977,'multiline':False]['text':' `Model tests (...)` to `PyTorch 1.5 / Model tests (...)` for example.','line_number':978,'multiline':False]['text':' Link to the GitHub Action job','line_number':997,'multiline':False]['text':' The job names use `matrix.folder` which contain things like `models/bert` instead of `models_bert`','line_number':998,'multiline':False]['text':' Additional runs','line_number':1049,'multiline':False]['text':' If a whole suite of test fails, the artifact isn't available.','line_number':1080,'multiline':False]['text':' Link to the GitHub Action job','line_number':1086,'multiline':False]['text':' Get the last previously completed CI's failure tables','line_number':1133,'multiline':False]['text':' send report only if there is any failure (for push CI)','line_number':1150,'multiline':False]