['text':' coding=utf-8','line_number':1,'multiline':False]['text':' Copyright 2020 The HuggingFace Team Inc.','line_number':2,'multiline':False]['text':'','line_number':3,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':4,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':5,'multiline':False]['text':' You may obtain a clone of the License at','line_number':6,'multiline':False]['text':'','line_number':7,'multiline':False]['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':8,'multiline':False]['text':'','line_number':9,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':10,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':11,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':12,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':13,'multiline':False]['text':' limitations under the License.','line_number':14,'multiline':False]['text':' check that min length is applied at length 5','line_number':66,'multiline':False]['text':' check that min length is not applied anymore at length 15','line_number':73,'multiline':False]['text':' tweak scores to not be uniform anymore','line_number':88,'multiline':False]['text':' peak, 1st batch','line_number':90,'multiline':False]['text':' valley, 1st batch','line_number':91,'multiline':False]['text':' compute softmax','line_number':94,'multiline':False]['text':' uniform distribution stays uniform','line_number':106,'multiline':False]['text':' sharp peaks get higher, valleys get lower','line_number':110,'multiline':False]['text':' smooth peaks get lower, valleys get higher','line_number':114,'multiline':False]['text':' check that values were correctly changed (negative scores for used tokens should increase, others','line_number':138,'multiline':False]['text':' should decrease)','line_number':139,'multiline':False]['text':' unused tokens should see no change','line_number':142,'multiline':False]['text':' unused tokens should see no change','line_number':146,'multiline':False]['text':' create ramp distribution','line_number':155,'multiline':False]['text':' check that correct tokens are filtered','line_number':165,'multiline':False]['text':' check special cases','line_number':169,'multiline':False]['text':' uniform dist is not changed','line_number':178,'multiline':False]['text':' min_tokens overwrites k: 3 tokens are kept => 2 tokens are nullified','line_number':184,'multiline':False]['text':' create distribution and take log (inverse to Softmax as taken in TFTopPLogitsWarper)','line_number':194,'multiline':False]['text':' top_p should have been 0.8 to test the edge case of top_p being exactly equal to sum of some token prob','line_number':197,'multiline':False]['text':' However, due to the numerical instability of softmax in TF we choose this as the edge case','line_number':198,'multiline':False]['text':' top_p as 0.8 passes when use_xla is True and fails when False. Refer PR #18984.','line_number':199,'multiline':False]['text':' dist should be filtered to keep min num values so that sum is >= top_p','line_number':205,'multiline':False]['text':' exp (-inf) => 0','line_number':206,'multiline':False]['text':' check edge cases with negative and extreme logits','line_number':210,'multiline':False]['text':' make ramp_logits more extreme','line_number':215,'multiline':False]['text':' make sure at least 2 tokens are kept','line_number':218,'multiline':False]['text':' first batch should keep three tokens, second batch would keep only 1, but due to `min_tokens_to_keep=2` keeps','line_number':224,'multiline':False]['text':' 2.','line_number':225,'multiline':False]['text':' 2-gram would forbid 2nd and 3rd token (1,2) at 1st batch and 1st token (0) at 2nd batch','line_number':246,'multiline':False]['text':' 3-gram would forbid no token at 1st batch and 1st token (0) at 2nd batch','line_number':251,'multiline':False]['text':' batch 1: 1st, 2nd, and 4th (0, 1, 3) token are forbidden','line_number':275,'multiline':False]['text':' batch 2: 1st, 2nd, and 3rd (0, 1, 2) token are forbidden','line_number':276,'multiline':False]['text':' check that all scores are -inf except the bos_token_id score','line_number':292,'multiline':False]['text':' score for bos_token_id shold be zero','line_number':300,'multiline':False]['text':' check that bos_token_id is not forced if current length is greater than 1','line_number':302,'multiline':False]['text':' check that all scores are -inf except the eos_token_id when max_length-1 is reached','line_number':320,'multiline':False]['text':' score for eos_token_id should be zero','line_number':330,'multiline':False]['text':' check that eos_token_id is not forced if max_length-1 is not reached','line_number':332,'multiline':False]['text':' Check that no scores are suppressed if begin_index is not reached','line_number':353,'multiline':False]['text':' Check that scores are suppressed if begin_index is reached','line_number':360,'multiline':False]['text':' Check that suppress_tokens are suppressed and others are not','line_number':379,'multiline':False]['text':' check that if the cur_len is contained in the force_token_map, the logits are the same','line_number':398,'multiline':False]['text':' for all tokens except the one the force_token_map points to','line_number':399,'multiline':False]['text':' check that if the cur_len is not contained in the force_token_map, the logits are not modified','line_number':412,'multiline':False]['text':' TODO (Joao): reintroduce TFNoRepeatNGramLogitsProcessor when it gets compatible with XLA','line_number':421,'multiline':False]['text':' dummy input_ids and scores','line_number':427,'multiline':False]['text':' instantiate all dist processors','line_number':434,'multiline':False]['text':' no_repeat_proc = TFNoRepeatNGramLogitsProcessor(2)','line_number':440,'multiline':False]['text':' no_repeat_proc = tf.function(no_repeat_proc, jit_compile=True)','line_number':448,'multiline':False]['text':' no processor list','line_number':451,'multiline':False]['text':' scores = no_repeat_proc(input_ids, scores, cur_len)','line_number':457,'multiline':False]['text':' with processor list','line_number':460,'multiline':False]['text':' no_repeat_proc,','line_number':468,'multiline':False]['text':' remove inf','line_number':474,'multiline':False]['text':' scores should be equal','line_number':478,'multiline':False]['text':' input_ids should never be changed','line_number':481,'multiline':False]