['text':' coding=utf-8','line_number':1,'multiline':False]['text':' Copyright 2020 The HuggingFace Team Inc.','line_number':2,'multiline':False]['text':'','line_number':3,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':4,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':5,'multiline':False]['text':' You may obtain a clone of the License at','line_number':6,'multiline':False]['text':'','line_number':7,'multiline':False]['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':8,'multiline':False]['text':'','line_number':9,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':10,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':11,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':12,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':13,'multiline':False]['text':' limitations under the License.','line_number':14,'multiline':False]['text':' cannot be randomly generated','line_number':62,'multiline':False]['text':' check that correct number of beam hypotheses is set in beam scorer','line_number':83,'multiline':False]['text':' check correct type','line_number':89,'multiline':False]['text':' check that num_beams is correctly set','line_number':92,'multiline':False]['text':' check for early stopping deactivated','line_number':95,'multiline':False]['text':' if early stopping True -> score does not matter','line_number':99,'multiline':False]['text':' re-init','line_number':102,'multiline':False]['text':' add `num_beams + 1` beams to change `worst_score`','line_number':106,'multiline':False]['text':' -10.0 is removed => -9.0 is worst score','line_number':110,'multiline':False]['text':' -5.0 is better than worst score => should not be finished','line_number':113,'multiline':False]['text':' -20.0 is worse than worst score => should be finished','line_number':116,'multiline':False]['text':' check too many eos tokens','line_number':120,'multiline':False]['text':' check all batches are done','line_number':129,'multiline':False]['text':' beam scorer should be done','line_number':139,'multiline':False]['text':' check','line_number':142,'multiline':False]['text':' check all outptus','line_number':157,'multiline':False]['text':' cut out id of eos token and take best `num_beams` outputs','line_number':158,'multiline':False]['text':' add num_beams * batch_idx','line_number':162,'multiline':False]['text':' make sure ids of eos token are correctly saved in beam_hyps of beam scorer','line_number':172,'multiline':False]['text':' max_length should be only one more than current input_ids to check that eos is correctly appended','line_number':185,'multiline':False]['text':' update beams and append to input_ids','line_number':189,'multiline':False]['text':' first batch, first output has to finish with eos token id since scores are correctly sorted','line_number':191,'multiline':False]['text':' make sure corresponding score is as good as possible to surely be picked first','line_number':193,'multiline':False]['text':' finalize','line_number':204,'multiline':False]['text':' since `num_beam_hyps_to_keep` = 1 => only return `batch_size` x `max_length`','line_number':221,'multiline':False]['text':' check sequence_scores','line_number':225,'multiline':False]['text':' first batch has to finish with eos_token','line_number':228,'multiline':False]['text':' other batches cannot finish with eos token','line_number':231,'multiline':False]['text':' now test that if `num_beam_hyps_to_keep` is 3 => all beams are returned','line_number':235,'multiline':False]['text':' cannot be randomly generated','line_number':286,'multiline':False]['text':' check that correct number of beam hypotheses is set in beam scorer','line_number':311,'multiline':False]['text':' check correct type','line_number':317,'multiline':False]['text':' check that num_beams is correctly set','line_number':320,'multiline':False]['text':' check for early stopping deactivated','line_number':323,'multiline':False]['text':' if early stopping True -> score does not matter','line_number':327,'multiline':False]['text':' re-init','line_number':330,'multiline':False]['text':' add `num_beams + 1` beams to change `worst_score`','line_number':334,'multiline':False]['text':' -10.0 is removed => -9.0 is worst score','line_number':338,'multiline':False]['text':' -5.0 is better than worst score => should not be finished','line_number':341,'multiline':False]['text':' -20.0 is worse than worst score => should be finished','line_number':344,'multiline':False]['text':' check too many eos tokens','line_number':350,'multiline':False]['text':' check all batches are done','line_number':370,'multiline':False]['text':' beam scorer should be done','line_number':378,'multiline':False]['text':' check','line_number':381,'multiline':False]['text':' check all outptus','line_number':396,'multiline':False]['text':' cut out id of eos token and take best `num_beams` outputs','line_number':397,'multiline':False]['text':' add num_beams * batch_idx','line_number':401,'multiline':False]['text':' make sure ids of eos token are correctly saved in beam_hyps of beam scorer','line_number':411,'multiline':False]['text':' max_length should be only one more than current input_ids to check that eos is correctly appended','line_number':421,'multiline':False]['text':' for testing finalize, we do want to have fulfilled constraints','line_number':424,'multiline':False]['text':' update beams and append to input_ids','line_number':441,'multiline':False]['text':' first batch, first output has to finish with eos token id since scores are correctly sorted','line_number':443,'multiline':False]['text':' make sure corresponding score is as good as possible to surely be picked first','line_number':445,'multiline':False]['text':' finalize','line_number':456,'multiline':False]['text':' since `num_beam_hyps_to_keep` = 1 => only return `batch_size` x `max_length`','line_number':470,'multiline':False]['text':' check sequence_scores','line_number':474,'multiline':False]['text':' first batch has to finish with eos_token','line_number':477,'multiline':False]['text':' other batches cannot finish with eos token','line_number':480,'multiline':False]['text':' test that the constraint is indeed fulfilled','line_number':484,'multiline':False]['text':' disjunctive case','line_number':488,'multiline':False]['text':' now test that if `num_beam_hyps_to_keep` is 3 => all beams are returned','line_number':498,'multiline':False]['text':' constrained_beam_scorer.num_beam_hyps_to_keep = self.num_beams','line_number':500,'multiline':False]['text':' check if tensor_1 inside tensor_2 or tensor_2 inside tensor_1.','line_number':521,'multiline':False]['text':' set to same device. we don't care what device.','line_number':522,'multiline':False]