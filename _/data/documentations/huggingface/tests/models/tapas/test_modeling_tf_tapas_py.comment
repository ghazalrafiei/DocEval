['text':' coding=utf-8','line_number':1,'multiline':False]['text':' Copyright 2021 The HuggingFace Inc. team. All rights reserved.','line_number':2,'multiline':False]['text':'','line_number':3,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':4,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':5,'multiline':False]['text':' You may obtain a copy of the License at','line_number':6,'multiline':False]['text':'','line_number':7,'multiline':False]['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':8,'multiline':False]['text':'','line_number':9,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':10,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':11,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':12,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':13,'multiline':False]['text':' limitations under the License.','line_number':14,'multiline':False]['text':' inference: without aggregation head (SQA). Model only returns logits','line_number':333,'multiline':False]['text':' inference: with aggregation head (WTQ, WikiSQL-supervised). Model returns logits and aggregation logits','line_number':347,'multiline':False]['text':' training: can happen in 3 main ways','line_number':358,'multiline':False]['text':' case 1: conversational (SQA)','line_number':359,'multiline':False]['text':' case 2: weak supervision for aggregation (WTQ)','line_number':371,'multiline':False]['text':' case 3: strong supervision for aggregation (WikiSQL-supervised)','line_number':387,'multiline':False]['text':' TODO: Fix the failed tests','line_number':448,'multiline':False]['text':' Here we prepare a single table-question pair to test TAPAS inference on:','line_number':533,'multiline':False]['text':' Here we prepare a batch of 2 table-question pairs to test TAPAS inference on:','line_number':545,'multiline':False]['text':' Here we prepare a DIFFERENT batch of 2 table-question pairs to test TAPAS training on:','line_number':558,'multiline':False]['text':' ideally we want to test this with the weights of tapas_inter_masklm_base_reset,','line_number':583,'multiline':False]['text':' but since it's not straightforward to do this with the TF 1 implementation, we test it with','line_number':584,'multiline':False]['text':' the weights of the WTQ base model (i.e. tapas_wtq_wikisql_sqa_inter_masklm_base_reset)','line_number':585,'multiline':False]['text':' test the sequence output','line_number':592,'multiline':False]['text':' test the pooled output','line_number':604,'multiline':False]['text':' TapasForQuestionAnswering has 3 possible ways of being fine-tuned:','line_number':613,'multiline':False]['text':' - conversational set-up (SQA)','line_number':614,'multiline':False]['text':' - weak supervision for aggregation (WTQ, WikiSQL)','line_number':615,'multiline':False]['text':' - strong supervision for aggregation (WikiSQL-supervised)','line_number':616,'multiline':False]['text':' We test all of them:','line_number':617,'multiline':False]['text':' note that google/tapas-base-finetuned-sqa should correspond to tapas_sqa_inter_masklm_base_reset','line_number':620,'multiline':False]['text':' test the logits','line_number':627,'multiline':False]['text':' note that google/tapas-small-finetuned-sqa should correspond to tapas_sqa_inter_masklm_small_reset','line_number':664,'multiline':False]['text':' however here we test the version with absolute position embeddings','line_number':665,'multiline':False]['text':' test the logits','line_number':672,'multiline':False]['text':' note that google/tapas-base-finetuned-wtq should correspond to tapas_wtq_wikisql_sqa_inter_masklm_base_reset','line_number':709,'multiline':False]['text':' let's test on a batch','line_number':713,'multiline':False]['text':' test the logits','line_number':718,'multiline':False]['text':' test the aggregation logits','line_number':732,'multiline':False]['text':' test the predicted answer coordinates and aggregation indices','line_number':741,'multiline':False]['text':' note that google/tapas-base-finetuned-wtq should correspond to tapas_wtq_wikisql_sqa_inter_masklm_base_reset','line_number':753,'multiline':False]['text':' let's test on a batch','line_number':756,'multiline':False]['text':' the answer should be prepared by the user','line_number':766,'multiline':False]['text':' test the loss','line_number':778,'multiline':False]['text':' test the logits on the first example','line_number':783,'multiline':False]['text':' test the aggregation logits on the second example','line_number':802,'multiline':False]['text':' note that google/tapas-base-finetuned-wikisql-supervised should correspond to tapas_wikisql_sqa_inter_masklm_base_reset','line_number':811,'multiline':False]['text':' test the logits','line_number':819,'multiline':False]['text':' test the aggregation logits','line_number':852,'multiline':False]['text':' note that google/tapas-base-finetuned-tabfact should correspond to tapas_tabfact_inter_masklm_base_reset','line_number':861,'multiline':False]['text':' test the classification logits','line_number':869,'multiline':False]['text':' Below: tests for Tapas utilities which are defined in modeling_tf_tapas.py.','line_number':877,'multiline':False]['text':' These are based on segmented_tensor_test.py of the original implementation.','line_number':878,'multiline':False]['text':' URL: https://github.com/google-research/tapas/blob/master/tapas/models/segmented_tensor_test.py','line_number':879,'multiline':False]['text':' Projections should give back the original indices.','line_number':928,'multiline':False]['text':' we use np.testing.assert_array_equal rather than Tensorflow's assertAllEqual','line_number':929,'multiline':False]['text':' We use np.testing.assert_array_equal rather than Tensorflow's assertAllEqual','line_number':933,'multiline':False]['text':' The first and second "column" are identified in the first table.','line_number':937,'multiline':False]['text':' All rows are distinct in the first table.','line_number':942,'multiline':False]['text':' All cells are distinct in the second table.','line_number':948,'multiline':False]['text':' We use np.testing.assert_array_equal rather than Tensorflow's assertAllEqual','line_number':963,'multiline':False]['text':' We use np.testing.assert_array_equal rather than Tensorflow's assertAllEqual','line_number':981,'multiline':False]['text':' We use np.testing.assert_array_equal rather than Tensorflow's assertAllEqual','line_number':985,'multiline':False]['text':' We use np.testing.assert_allclose rather than Tensorflow's assertAllClose','line_number':995,'multiline':False]['text':' We use np.testing.assert_allclose rather than Tensorflow's assertAllClose','line_number':1010,'multiline':False]['text':' We use np.testing.assert_array_equal rather than Tensorflow's assertAllEqual','line_number':1028,'multiline':False]['text':' We use np.testing.assert_allclose rather than Tensorflow's assertAllClose','line_number':1036,'multiline':False]['text':' We use np.testing.assert_array_equal rather than Tensorflow's assertAllEqual','line_number':1038,'multiline':False]['text':' Compute sums and then gather. The result should have the same shape as','line_number':1047,'multiline':False]['text':' the original table and each element should contain the sum the values in','line_number':1048,'multiline':False]['text':' its cell.','line_number':1049,'multiline':False]['text':' We use np.testing.assert_array_equal rather than Tensorflow's assertAllEqual','line_number':1054,'multiline':False]['text':' We use np.testing.assert_array_equal rather than Tensorflow's assertAllEqual','line_number':1065,'multiline':False]