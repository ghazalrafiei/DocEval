['text':' coding=utf-8','line_number':1,'multiline':False]['text':' Copyright 2023 HuggingFace Inc.','line_number':2,'multiline':False]['text':'','line_number':3,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':4,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':5,'multiline':False]['text':' You may obtain a copy of the License at','line_number':6,'multiline':False]['text':'','line_number':7,'multiline':False]['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':8,'multiline':False]['text':'','line_number':9,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':10,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':11,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':12,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':13,'multiline':False]['text':' limitations under the License.','line_number':14,'multiline':False]['text':' Creates a new cache with 10 layers in both formats','line_number':35,'multiline':False]['text':' Sanity check 1: they must have the same shapes','line_number':42,'multiline':False]['text':' Sanity check 2: we can get the sequence length in multiple ways with DynamicCache, and they return the','line_number':51,'multiline':False]['text':' expected value','line_number':52,'multiline':False]['text':' Sanity check 3: they must be equal, and both support indexing','line_number':55,'multiline':False]['text':' Test 1: We can convert from legacy to new with no changes','line_number':62,'multiline':False]['text':' Test 2: We can convert from new to legacy with no changes','line_number':70,'multiline':False]['text':' An example of a legacy `_reorder_cache` function','line_number':80,'multiline':False]['text':' Creates a new cache with 10 layers in both formats','line_number':85,'multiline':False]['text':' Let's create some dummy beam indices. From the shape above, it is equivalent to the case where num_beams=4','line_number':92,'multiline':False]['text':' and batch_size=1','line_number':93,'multiline':False]['text':' Let's check that the results are the same','line_number':99,'multiline':False]['text':' DynamicCache and the legacy cache format should be equivalent','line_number':119,'multiline':False]['text':' Set up the SinkCache. Using a small window length to contain computational complexity. If this example is run','line_number':184,'multiline':False]['text':' without a SinkCache, the last few tokens are gibberish (ends in "of the of the of a of a of")','line_number':185,'multiline':False]['text':' Prepare generation settings','line_number':202,'multiline':False]['text':' Tokenize the prompt with the correct chat template','line_number':206,'multiline':False]['text':' Perform the generation','line_number':213,'multiline':False]['text':' We went well beyond the cache length','line_number':219,'multiline':False]['text':' And it still produces a coherent english','line_number':222,'multiline':False]