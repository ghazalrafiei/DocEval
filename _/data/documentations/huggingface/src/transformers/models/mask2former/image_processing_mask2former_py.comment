['text':' coding=utf-8','line_number':1,'multiline':False]['text':' Copyright 2022 The HuggingFace Inc. team. All rights reserved.','line_number':2,'multiline':False]['text':'','line_number':3,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':4,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':5,'multiline':False]['text':' You may obtain a copy of the License at','line_number':6,'multiline':False]['text':'','line_number':7,'multiline':False]['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':8,'multiline':False]['text':'','line_number':9,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':10,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':11,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':12,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':13,'multiline':False]['text':' limitations under the License.','line_number':14,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.max_across_indices','line_number':61,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.get_max_height_width','line_number':69,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.make_pixel_mask','line_number':88,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.binary_mask_to_rle','line_number':107,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.convert_segmentation_to_rle','line_number':130,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.remove_low_and_no_objects','line_number':152,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.check_segment_validity','line_number':181,'multiline':False]['text':' Get the mask associated with the k class','line_number':183,'multiline':False]['text':' Compute the area of all the stuff in query k','line_number':187,'multiline':False]['text':' Eliminate disconnected tiny segments','line_number':191,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.compute_segments','line_number':200,'multiline':False]['text':' Weigh each mask by its prediction score','line_number':223,'multiline':False]['text':' [height, width]','line_number':225,'multiline':False]['text':' Keep track of instances of each class','line_number':227,'multiline':False]['text':' Check if mask exists and large enough to be a segment','line_number':233,'multiline':False]['text':' Add current object segment to final segmentation map','line_number':244,'multiline':False]['text':' TODO: (Amy) Move to image_transforms','line_number':261,'multiline':False]['text':' Copied from transformers.models.maskformer.image_processing_maskformer.convert_segmentation_map_to_binary_masks','line_number':262,'multiline':False]['text':' Get unique ids (class or instance ids based on input)','line_number':275,'multiline':False]['text':' Drop background label if applicable','line_number':278,'multiline':False]['text':' Generate a binary mask for each object instance','line_number':282,'multiline':False]['text':' (num_labels, height, width)','line_number':284,'multiline':False]['text':' Convert instance ids to class ids','line_number':286,'multiline':False]['text':' Copied from transformers.models.maskformer.image_processing_maskformer.get_maskformer_resize_output_image_size with maskformer->mask2former','line_number':299,'multiline':False]['text':' We make max_size a private attribute so we can pass it as a default value in the preprocess method whilst','line_number':420,'multiline':False]['text':' `size` can still be pass in as an int','line_number':421,'multiline':False]['text':' Copied from transformers.models.maskformer.image_processing_maskformer.MaskFormerImageProcessor.resize with get_maskformer_resize_output_image_size->get_mask2former_resize_output_image_size','line_number':455,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.DetrImageProcessor.rescale','line_number':518,'multiline':False]['text':' Copied from transformers.models.maskformer.image_processing_maskformer.MaskFormerImageProcessor.convert_segmentation_map_to_binary_masks','line_number':547,'multiline':False]['text':' All transformations expect numpy arrays.','line_number':607,'multiline':False]['text':' Add channel dimension if missing - needed for certain transformations','line_number':643,'multiline':False]['text':' TODO: (Amy)','line_number':652,'multiline':False]['text':' Remork segmentation map processing to include reducing labels and resizing which doesn't','line_number':653,'multiline':False]['text':' drop segment IDs > 255.','line_number':654,'multiline':False]['text':' Remove extra channel dimension if added for processing','line_number':665,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.DetrImageProcessor._pad_image','line_number':774,'multiline':False]['text':' Copied from transformers.models.detr.image_processing_detr.DetrImageProcessor.pad','line_number':802,'multiline':False]['text':' Convert to list of binary masks and labels','line_number':934,'multiline':False]['text':' Use instance2class_id mapping per image','line_number':941,'multiline':False]['text':' We add an axis to make them compatible with the transformations library','line_number':945,'multiline':False]['text':' this will be removed in the future','line_number':946,'multiline':False]['text':' we cannot batch them since they don't share a common class size','line_number':955,'multiline':False]['text':' [batch_size, num_queries, num_classes+1]','line_number':980,'multiline':False]['text':' [batch_size, num_queries, height, width]','line_number':981,'multiline':False]['text':' Scale back to preprocessed image size - (384, 384) for all models','line_number':983,'multiline':False]['text':' Remove the null class `[..., :-1]`','line_number':988,'multiline':False]['text':' [batch_size, num_queries, height, width]','line_number':990,'multiline':False]['text':' Semantic segmentation logits of shape (batch_size, num_classes, height, width)','line_number':992,'multiline':False]['text':' Resize logits and compute semantic segmentation maps','line_number':996,'multiline':False]['text':' [batch_size, num_queries, num_classes+1]','line_number':1061,'multiline':False]['text':' [batch_size, num_queries, height, width]','line_number':1063,'multiline':False]['text':' Scale back to preprocessed image size - (384, 384) for all models','line_number':1066,'multiline':False]['text':' Loop over items in batch size','line_number':1075,'multiline':False]['text':' Calculate average mask prob','line_number':1092,'multiline':False]['text':' Return segmentation map in run-length encoding (RLE) format','line_number':1124,'multiline':False]['text':' Return a concatenated tensor of binary instance maps','line_number':1128,'multiline':False]['text':' [batch_size, num_queries, num_classes+1]','line_number':1184,'multiline':False]['text':' [batch_size, num_queries, height, width]','line_number':1185,'multiline':False]['text':' Scale back to preprocessed image size - (384, 384) for all models','line_number':1187,'multiline':False]['text':' [batch_size, num_queries, height, width]','line_number':1195,'multiline':False]['text':' Predicted label and score of each query (batch_size, num_queries)','line_number':1197,'multiline':False]['text':' Loop over items in batch size','line_number':1200,'multiline':False]['text':' No mask found','line_number':1208,'multiline':False]['text':' Get segmentation map and segment information of batch item','line_number':1215,'multiline':False]