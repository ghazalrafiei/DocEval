['text':' coding=utf-8','line_number':1,'multiline':False]['text':' Copyright 2023 HuggingFace Inc. team and MosaicML NLP team.','line_number':2,'multiline':False]['text':'','line_number':3,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':4,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':5,'multiline':False]['text':' You may obtain a copy of the License at','line_number':6,'multiline':False]['text':'','line_number':7,'multiline':False]['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':8,'multiline':False]['text':'','line_number':9,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':10,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':11,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':12,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':13,'multiline':False]['text':' limitations under the License.','line_number':14,'multiline':False]['text':' See all MPT models at https://huggingface.co/models?filter=mpt','line_number':55,'multiline':False]['text':' (batch_size, n_heads, seq_length, key_length)','line_number':143,'multiline':False]['text':' backward compatibility with weights on the Hub','line_number':181,'multiline':False]['text':' backward compatibility with weights on the Hub','line_number':188,'multiline':False]['text':' hidden_states: [batch_size, seq_length, hidden_size]','line_number':205,'multiline':False]['text':' Layer norm at the beginning of the transformer layer.','line_number':206,'multiline':False]['text':' Self attention.','line_number':211,'multiline':False]['text':' Get residual','line_number':223,'multiline':False]['text':' MLP.','line_number':226,'multiline':False]['text':' hidden_states, present, attentions','line_number':236,'multiline':False]['text':' Slightly different from the TF version which uses truncated_normal for initialization','line_number':252,'multiline':False]['text':' cf https://github.com/pytorch/pytorch/pull/5617','line_number':253,'multiline':False]['text':' key:  [batch_size, num_heads, head_dim, seq_length] -> [batch_size * num_heads, head_dim, seq_length]','line_number':275,'multiline':False]['text':' value: [batch_size, num_heads, seq_length, head_dim] -> [batch_size * num_heads, seq_length, head_dim]','line_number':276,'multiline':False]['text':' Embedding + LN Embedding','line_number':362,'multiline':False]['text':' Transformer blocks','line_number':365,'multiline':False]['text':' Final Layer Norm','line_number':368,'multiline':False]['text':' backward compatibility with weights on the Hub','line_number':370,'multiline':False]['text':' Initialize weights and apply final processing','line_number':375,'multiline':False]['text':' Compute alibi tensor: check build_alibi_tensor documentation','line_number':439,'multiline':False]['text':' Add last hidden state','line_number':488,'multiline':False]['text':' Initialize weights and apply final processing','line_number':520,'multiline':False]['text':' only last tokens for input_ids if past is not None','line_number':538,'multiline':False]['text':' Some generation methods already pass only the last input ID','line_number':542,'multiline':False]['text':' Default to old behavior: keep only final ID','line_number':546,'multiline':False]['text':' if `inputs_embeds` are passed, we only want to use them in the 1st generation step','line_number':551,'multiline':False]['text':' NITS should it be layer_past?','line_number':559,'multiline':False]['text':' move labels to correct device to enable model parallelism','line_number':608,'multiline':False]['text':' Shift so that tokens < n predict n','line_number':610,'multiline':False]['text':' Flatten the tokens','line_number':614,'multiline':False]['text':' Get a copy of `beam_idx` on all the devices where we need those indices.','line_number':642,'multiline':False]['text':' Initialize weights and apply final processing','line_number':678,'multiline':False]['text':' Initialize weights and apply final processing','line_number':799,'multiline':False]['text':' move labels to correct device to enable model parallelism','line_number':846,'multiline':False]['text':' Initialize weights and apply final processing','line_number':879,'multiline':False]['text':' If we are on multi-GPU, split add a dimension','line_number':924,'multiline':False]['text':' sometimes the start/end positions are outside our model inputs, we ignore these terms','line_number':929,'multiline':False]