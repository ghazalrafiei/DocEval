['text':' SPDX-License-Identifier: MPL-2.0 ','line_number':1,'multiline':True]['text':'  Create a publisher','line_number':10,'multiline':False]['text':'  Create a subscriber','line_number':17,'multiline':False]['text':'  Subscribe for A','line_number':21,'multiline':False]['text':' Receive subscriptions from subscriber','line_number':25,'multiline':False]['text':' Subscribe socket for B instead','line_number':28,'multiline':False]['text':' Sending A message and B Message','line_number':31,'multiline':False]['text':'  Clean up.','line_number':37,'multiline':False]['text':'  Create a publisher','line_number':44,'multiline':False]['text':'  set pub socket options','line_number':48,'multiline':False]['text':'  Create a subscriber','line_number':53,'multiline':False]['text':'  Subscribe for A','line_number':57,'multiline':False]['text':'  Subscribe for B','line_number':61,'multiline':False]['text':' Receive subscription "A" from subscriber','line_number':67,'multiline':False]['text':' Subscribe socket for XA instead','line_number':70,'multiline':False]['text':' Receive subscription "B" from subscriber','line_number':73,'multiline':False]['text':' Subscribe socket for XB instead','line_number':76,'multiline':False]['text':'  Unsubscribe from A','line_number':79,'multiline':False]['text':' Receive unsubscription "A" from subscriber','line_number':83,'multiline':False]['text':' Unsubscribe socket from XA instead','line_number':86,'multiline':False]['text':' Sending messages XA, XB','line_number':89,'multiline':False]['text':' Subscriber should receive XB only','line_number':93,'multiline':False]['text':' Close subscriber','line_number':96,'multiline':False]['text':' Receive unsubscription "B"','line_number':99,'multiline':False]['text':' Unsubscribe socket from XB instead','line_number':107,'multiline':False]['text':'  Clean up.','line_number':110,'multiline':False]['text':' proxy frontend','line_number':124,'multiline':False]['text':' proxy backend','line_number':129,'multiline':False]['text':' publisher','line_number':136,'multiline':False]['text':' first subscriber subscribes','line_number':140,'multiline':False]['text':' wait','line_number':146,'multiline':False]['text':' proxy reroutes and confirms subscriptions','line_number':149,'multiline':False]['text':' second subscriber subscribes','line_number':156,'multiline':False]['text':' wait','line_number':162,'multiline':False]['text':' proxy reroutes','line_number':165,'multiline':False]['text':' wait','line_number':171,'multiline':False]['text':' let publisher send a msg','line_number':174,'multiline':False]['text':' wait','line_number':178,'multiline':False]['text':' proxy reroutes data messages to subscribers','line_number':181,'multiline':False]['text':' send 2 messages','line_number':185,'multiline':False]['text':' wait','line_number':191,'multiline':False]['text':' sub2 will get 2 messages because the last subscription is sub2.','line_number':194,'multiline':False]['text':'  Disconnect both subscribers','line_number':203,'multiline':False]['text':' wait','line_number':207,'multiline':False]['text':' unsubscribe messages are passed from proxy to publisher','line_number':210,'multiline':False]['text':' should receive another unsubscribe msg','line_number':217,'multiline':False]['text':' wait','line_number':223,'multiline':False]['text':' let publisher send a msg','line_number':226,'multiline':False]['text':' wait','line_number':230,'multiline':False]['text':' nothing should come to the proxy','line_number':233,'multiline':False]['text':' proxy frontend','line_number':254,'multiline':False]['text':' proxy backend','line_number':259,'multiline':False]['text':' publisher','line_number':266,'multiline':False]['text':' Here's the problem: because subscribers subscribe in quick succession,','line_number':270,'multiline':False]['text':' the proxy is unable to confirm the first subscription before receiving','line_number':271,'multiline':False]['text':' the second. This causes the first subscription to get lost.','line_number':272,'multiline':False]['text':' first subscriber','line_number':274,'multiline':False]['text':' wait','line_number':279,'multiline':False]['text':' proxy now reroutes and confirms subscriptions','line_number':282,'multiline':False]['text':' second subscriber','line_number':289,'multiline':False]['text':' wait','line_number':294,'multiline':False]['text':' proxy now reroutes and confirms subscriptions','line_number':297,'multiline':False]['text':' wait','line_number':304,'multiline':False]['text':' let publisher send 2 msgs, each with its own topic_buff','line_number':307,'multiline':False]['text':' wait','line_number':313,'multiline':False]['text':' proxy reroutes data messages to subscribers','line_number':316,'multiline':False]['text':' wait','line_number':327,'multiline':False]['text':' only sub2 should now get a message','line_number':330,'multiline':False]['text':'recv_string_expect_success (sub1, topic1, ZMQ_DONTWAIT);','line_number':334,'multiline':False]['text':'recv_string_expect_success (sub1, payload, ZMQ_DONTWAIT);','line_number':335,'multiline':False]['text':'  Clean up','line_number':337,'multiline':False]['text':'  Create a publisher','line_number':349,'multiline':False]['text':'  Create a subscriber','line_number':356,'multiline':False]['text':'  Subscribe for A','line_number':360,'multiline':False]['text':' Receive subscriptions from subscriber','line_number':365,'multiline':False]['text':' send 2 messages','line_number':369,'multiline':False]['text':' receive the single message','line_number':373,'multiline':False]['text':' should be nothing left in the queue','line_number':376,'multiline':False]['text':' close the socket','line_number':381,'multiline':False]['text':' closing the socket will result in an unsubscribe event','line_number':384,'multiline':False]['text':' this doesn't really do anything','line_number':388,'multiline':False]['text':' there is no last_pipe set it will just fail silently','line_number':389,'multiline':False]['text':' reconnect','line_number':392,'multiline':False]['text':' send a subscription for B','line_number':396,'multiline':False]['text':' receive the subscription, overwrite it to XB','line_number':400,'multiline':False]['text':' send 2 messages','line_number':404,'multiline':False]['text':' receive the single message','line_number':408,'multiline':False]['text':' should be nothing left in the queue','line_number':411,'multiline':False]['text':'  Clean up.','line_number':415,'multiline':False]['text':'  Create a publisher','line_number':422,'multiline':False]['text':'  set pub socket options','line_number':428,'multiline':False]['text':'  Create a subscriber','line_number':435,'multiline':False]['text':'  Create another subscriber','line_number':439,'multiline':False]['text':'  Subscribe for "A".','line_number':443,'multiline':False]['text':'  we must wait for the subscription to be processed here, otherwise some','line_number':447,'multiline':False]['text':'  or all published messages might be lost','line_number':448,'multiline':False]['text':'  manual subscribe message','line_number':451,'multiline':False]['text':'  Subscribe for "A".','line_number':456,'multiline':False]['text':'  sub won't get a message because the last subscription pipe is sub2.','line_number':464,'multiline':False]['text':'  Clean up.','line_number':468,'multiline':False]