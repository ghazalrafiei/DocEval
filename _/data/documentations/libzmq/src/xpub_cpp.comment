['text':' SPDX-License-Identifier: MPL-2.0 ','line_number':1,'multiline':True]['text':'  If subscribe_to_all_ is specified, the caller would like to subscribe','line_number':51,'multiline':False]['text':'  to all data on this pipe, implicitly.','line_number':52,'multiline':False]['text':' if welcome message exists, send a copy of it','line_number':56,'multiline':False]['text':'  The pipe is active when attached. Let's read the subscriptions from','line_number':67,'multiline':False]['text':'  it, if any.','line_number':68,'multiline':False]['text':'  There are some subscriptions waiting. Let's process them.','line_number':74,'multiline':False]['text':'  Apply the subscription to the trie','line_number':89,'multiline':False]['text':' Store manual subscription to use on termination','line_number':109,'multiline':False]['text':'  TODO reconsider what to do if rm_result == mtrie_t::not_found','line_number':120,'multiline':False]['text':'  If the request was a new subscription, or the subscription','line_number':130,'multiline':False]['text':'  was removed, or verbose mode or manual mode are enabled, store it','line_number':131,'multiline':False]['text':'  so that it can be passed to the user on next recv call.','line_number':132,'multiline':False]['text':'  ZMTP 3.1 hack: we need to support sub/cancel commands, but','line_number':134,'multiline':False]['text':'  we can't give them back to userspace as it would be an API','line_number':135,'multiline':False]['text':'  breakage since the payload of the message is completely','line_number':136,'multiline':False]['text':'  different. Manually craft an old-style message instead.','line_number':137,'multiline':False]['text':'  Although with other transports it would be possible to simply','line_number':138,'multiline':False]['text':'  reuse the same buffer and prefix a 0/1 byte to the topic, with','line_number':139,'multiline':False]['text':'  inproc the subscribe/cancel command string is not present in','line_number':140,'multiline':False]['text':'  the message, so this optimization is not possible.','line_number':141,'multiline':False]['text':'  The pushback makes a copy of the data array anyway, so the','line_number':142,'multiline':False]['text':'  number of buffer copies does not change.','line_number':143,'multiline':False]['text':'  Process user message coming upstream from xsub socket,','line_number':158,'multiline':False]['text':'  but not if the type is PUB, which never processes user','line_number':159,'multiline':False]['text':'  messages','line_number':160,'multiline':False]['text':' make sure to use a multi-thread safe function to avoid race conditions with I/O threads','line_number':234,'multiline':False]['text':' where subscriptions are processed:','line_number':235,'multiline':False]['text':' room for future options here','line_number':240,'multiline':False]['text':'  Remove the pipe from the trie and send corresponding manual','line_number':256,'multiline':False]['text':'  unsubscriptions upstream.','line_number':257,'multiline':False]['text':'  Remove pipe without actually sending the message as it was taken','line_number':259,'multiline':False]['text':'  care of by the manual call above. subscriptions is the real mtrie,','line_number':260,'multiline':False]['text':'  so the pipe must be removed from there or it will be left over.','line_number':261,'multiline':False]['text':' In case the pipe is currently set as last we must clear it to prevent','line_number':264,'multiline':False]['text':' subscriptions from being re-added.','line_number':265,'multiline':False]['text':'  Remove the pipe from the trie. If there are topics that nobody','line_number':270,'multiline':False]['text':'  is interested in anymore, send corresponding unsubscriptions','line_number':271,'multiline':False]['text':'  upstream.','line_number':272,'multiline':False]['text':'  For the first part of multi-part message, find the matching pipes.','line_number':294,'multiline':False]['text':' Ensure nothing from previous failed attempt to send is left matched','line_number':296,'multiline':False]['text':' If inverted matching is used, reverse the selection now','line_number':307,'multiline':False]['text':'  Assume we fail','line_number':313,'multiline':False]['text':'  If we are at the end of multi-part message we can mark','line_number':316,'multiline':False]['text':'  all the pipes as non-matching.','line_number':317,'multiline':False]['text':'  Yay, sent successfully','line_number':321,'multiline':False]['text':'  If there is at least one','line_number':335,'multiline':False]['text':' User is reading a message, set last_pipe and remove it from the deque','line_number':341,'multiline':False]['text':' If the distributor doesn't know about this pipe it must have already','line_number':346,'multiline':False]['text':' been terminated and thus we can't allow manual subscriptions.','line_number':347,'multiline':False]['text':' set metadata only if there is some','line_number':360,'multiline':False]['text':' Remove ref corresponding to vector placement','line_number':363,'multiline':False]['text':'  Place the unsubscription to the queue of pending (un)subscriptions','line_number':384,'multiline':False]['text':'  to be retrieved by the user later on.','line_number':385,'multiline':False]