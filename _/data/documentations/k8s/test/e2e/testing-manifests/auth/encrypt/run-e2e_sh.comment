['text':'!/usr/bin/env bash','line_number':1,'multiline':False]['text':' Copyright 2023 The Kubernetes Authors.','line_number':3,'multiline':False]['text':'','line_number':4,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':5,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':6,'multiline':False]['text':' You may obtain a copy of the License at','line_number':7,'multiline':False]['text':'','line_number':8,'multiline':False]['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':9,'multiline':False]['text':'','line_number':10,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':11,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':12,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':13,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':14,'multiline':False]['text':' limitations under the License.','line_number':15,'multiline':False]['text':' This script does following:','line_number':17,'multiline':False]['text':' 1. Creates local registry if not already present. This registry is used to push the kms mock plugin image.','line_number':18,'multiline':False]['text':' 2. Build and push the kms mock plugin image to the local registry.','line_number':19,'multiline':False]['text':' 3. Connect local registry to kind network so that kind cluster created using kubetest2 in prow CI job can pull the kms mock plugin image.','line_number':20,'multiline':False]['text':' 4. Create kind cluster using kubetest2 and run e2e tests.','line_number':21,'multiline':False]['text':' 5. Collect logs and metrics from kind cluster.','line_number':22,'multiline':False]['text':' build_and_push_mock_plugin builds and pushes the kms mock plugin image to the local registry.','line_number':32,'multiline':False]['text':' create_registry creates local registry if not already present.','line_number':45,'multiline':False]['text':' connect_registry connects local registry to kind network.','line_number':58,'multiline':False]['text':' wait for the kind network to exist','line_number':60,'multiline':False]['text':' infinite loop here is fine because kubetest2 will timeout if kind cluster creation fails and that will terminate the CI job','line_number':61,'multiline':False]['text':' create_cluster_and_run_test creates a kind cluster using kubetest2 and runs e2e tests.','line_number':87,'multiline':False]['text':' (--use-built-binaries) use the kubectl, e2e.test, and ginkgo binaries built during --build as opposed to from a GCS release tarball','line_number':93,'multiline':False]['text':' shellcheck disable=SC2086','line_number':99,'multiline':False]['text':' CLUSTER_CREATE_ATTEMPTED is true once we run kubetest2 kind --up','line_number':109,'multiline':False]['text':' collect logs and metrics','line_number':112,'multiline':False]['text':' delete cluster','line_number':126,'multiline':False]['text':' ensure artifacts (results) directory exists when not in CI','line_number':135,'multiline':False]['text':' The build e2e.test, ginkgo and kubectl binaries + copy to dockerized dir is','line_number':145,'multiline':False]['text':' because of https://github.com/kubernetes-sigs/kubetest2/issues/184','line_number':146,'multiline':False]