['text':'!/usr/bin/env bash','line_number':1,'multiline':False]['text':' Copyright 2021 The Kubernetes Authors.','line_number':3,'multiline':False]['text':'','line_number':4,'multiline':False]['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':5,'multiline':False]['text':' you may not use this file except in compliance with the License.','line_number':6,'multiline':False]['text':' You may obtain a copy of the License at','line_number':7,'multiline':False]['text':'','line_number':8,'multiline':False]['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':9,'multiline':False]['text':'','line_number':10,'multiline':False]['text':' Unless required by applicable law or agreed to in writing, software','line_number':11,'multiline':False]['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':12,'multiline':False]['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':13,'multiline':False]['text':' See the License for the specific language governing permissions and','line_number':14,'multiline':False]['text':' limitations under the License.','line_number':15,'multiline':False]['text':' This script validates that only a restricted set of packages are importing','line_number':17,'multiline':False]['text':' github.com/prometheus/*','line_number':18,'multiline':False]['text':' NOTE: this is not the same as verify-imports which can only verify','line_number':20,'multiline':False]['text':' that within a particular package the imports made are allowed.','line_number':21,'multiline':False]['text':'','line_number':22,'multiline':False]['text':' This is also not the same thing as verify-import-boss, which is pretty','line_number':23,'multiline':False]['text':' powerful for specifying restricted imports but does not scale to checking','line_number':24,'multiline':False]['text':' the entire source tree well and is only enabled for specific packages.','line_number':25,'multiline':False]['text':'','line_number':26,'multiline':False]['text':' See: https://github.com/kubernetes/kubernetes/issues/99876','line_number':27,'multiline':False]['text':' See: https://github.com/kubernetes/kubernetes/issues/89267','line_number':37,'multiline':False]['text':' Go imports always involve a double quoted string of the package path','line_number':82,'multiline':False]['text':' https://golang.org/ref/spec#Import_declarations','line_number':83,'multiline':False]['text':'','line_number':84,'multiline':False]['text':' If you *really* need a string literal that looks like "github.com/prometheus/.*"','line_number':85,'multiline':False]['text':' somewhere else that actually isn't an import, you can use backticks / a raw','line_number':86,'multiline':False]['text':' string literal instead (which cannot be used in imports, only double quotes).','line_number':87,'multiline':False]['text':'','line_number':88,'multiline':False]['text':' NOTE: we previously had an implementation that checked for an actual import','line_number':89,'multiline':False]['text':' as a post-processing step on the matching files, which is cheap enough and','line_number':90,'multiline':False]['text':' accurate, except that it's difficult to guarantee we check for all supported','line_number':91,'multiline':False]['text':' GOOS, GOARCH, and other build tags, and we want to prevent all imports.','line_number':92,'multiline':False]['text':' So we dropped this, in favor of only the grep call.','line_number':93,'multiline':False]['text':' See: https://github.com/kubernetes/kubernetes/pull/100552','line_number':94,'multiline':False]['text':' convert from file to package, and only insert unique results','line_number':98,'multiline':False]['text':' we want to minimize the amount of `go list` calls we need to make','line_number':99,'multiline':False]['text':' record a failure if not','line_number':101,'multiline':False]['text':' check for any files we're allowing to fail that are no longer failing, so we','line_number':113,'multiline':False]['text':' can enforce that the list shrinks','line_number':114,'multiline':False]['text':' we will exit with this at the end of the script depending on the checks below','line_number':122,'multiline':False]['text':' check for files we've allow-listed that no longer need to be','line_number':125,'multiline':False]['text':' check for files that fail but are not allow-listed','line_number':138,'multiline':False]