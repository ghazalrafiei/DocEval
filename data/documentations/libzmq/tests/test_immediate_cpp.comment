['text':' SPDX-License-Identifier: MPL-2.0 ','line_number':1,'multiline':True]
['text':' TEST 1.','line_number':15,'multiline':False]
['text':' First we're going to attempt to send messages to two','line_number':16,'multiline':False]
['text':' pipes, one connected, the other not. We should see','line_number':17,'multiline':False]
['text':' the PUSH load balancing to both pipes, and hence half','line_number':18,'multiline':False]
['text':' of the messages getting queued, as connect() creates a','line_number':19,'multiline':False]
['text':' pipe immediately.','line_number':20,'multiline':False]
['text':' Bind the one valid receiver','line_number':24,'multiline':False]
['text':' Create a socket pushing to two endpoints - only 1 message should arrive.','line_number':30,'multiline':False]
['text':' This pipe will not connect (provided the ephemeral port is not 5556)','line_number':36,'multiline':False]
['text':' This pipe will','line_number':38,'multiline':False]
['text':' We send 10 messages, 5 should just get stuck in the queue','line_number':43,'multiline':False]
['text':' for the not-yet-connected pipe','line_number':44,'multiline':False]
['text':' We now consume from the connected pipe','line_number':49,'multiline':False]
['text':' - we should see just 5','line_number':50,'multiline':False]
['text':'  Break when we didn't get a message','line_number':59,'multiline':False]
['text':' TODO: this fails ~1% of the runs on OBS but it does not seem to be reproducible anywhere else','line_number':62,'multiline':False]
['text':' This time we will do the same thing, connect two pipes,','line_number':75,'multiline':False]
['text':' one of which will succeed in connecting to a bound','line_number':76,'multiline':False]
['text':' receiver, the other of which will fail. However, we will','line_number':77,'multiline':False]
['text':' also set the delay attach on connect flag, which should','line_number':78,'multiline':False]
['text':' cause the pipe attachment to be delayed until the connection','line_number':79,'multiline':False]
['text':' succeeds.','line_number':80,'multiline':False]
['text':' Bind the valid socket','line_number':82,'multiline':False]
['text':' Create a socket pushing to two endpoints - all messages should arrive.','line_number':92,'multiline':False]
['text':' Set the key flag','line_number':99,'multiline':False]
['text':' Connect to the invalid socket','line_number':104,'multiline':False]
['text':' Connect to the valid socket','line_number':106,'multiline':False]
['text':' Send 10 messages, all should be routed to the connected pipe','line_number':109,'multiline':False]
['text':'  Break when we didn't get a message','line_number':122,'multiline':False]
['text':' This time we want to validate that the same blocking behaviour','line_number':133,'multiline':False]
['text':' occurs with an existing connection that is broken. We will send','line_number':134,'multiline':False]
['text':' messages to a connected pipe, disconnect and verify the messages','line_number':135,'multiline':False]
['text':' block. Then we reconnect and verify messages flow again.','line_number':136,'multiline':False]
['text':'  Frontend connects to backend using IMMEDIATE','line_number':146,'multiline':False]
['text':'  Ping backend to frontend so we know when the connection is up','line_number':157,'multiline':False]
['text':' Send message from frontend to backend','line_number':161,'multiline':False]
['text':'  Give time to process disconnect','line_number':166,'multiline':False]
['text':' Send a message, should fail','line_number':169,'multiline':False]
['text':'  Recreate backend socket','line_number':173,'multiline':False]
['text':'  Ping backend to frontend so we know when the connection is up','line_number':179,'multiline':False]
['text':' After the reconnect, should succeed','line_number':183,'multiline':False]
