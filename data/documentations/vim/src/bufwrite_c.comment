['text':' vi:set ts=8 sts=4 sw=4 noet:
 *
 * VIM - Vi IMproved	by Bram Moolenaar
 *
 * Do ":help uganda"  in Vim to read copying and usage conditions.
 * Do ":help credits" in Vim to see a list of people who contributed.
 * See README.txt for an overview of the Vim source code.
 ','line_number':1,'multiline':True]
['text':'
 * bufwrite.c: functions for writing a buffer
 ','line_number':10,'multiline':True]
['text':' for struct utimbuf','line_number':17,'multiline':False]
['text':' size of emergency write buffer','line_number':20,'multiline':False]
['text':'
 * Structure to pass arguments from buf_write() to buf_write_bytes().
 ','line_number':22,'multiline':True]
['text':' file descriptor','line_number':27,'multiline':False]
['text':' buffer with data to be written','line_number':28,'multiline':False]
['text':' length of data','line_number':29,'multiline':False]
['text':' FIO_ flags','line_number':30,'multiline':False]
['text':' buffer being written','line_number':32,'multiline':False]
['text':' finish encrypting','line_number':33,'multiline':False]
['text':' not converted bytes','line_number':35,'multiline':False]
['text':' nr of bytes in bw_rest[]','line_number':36,'multiline':False]
['text':' first write call','line_number':37,'multiline':False]
['text':' buffer for writing converted chars','line_number':38,'multiline':False]
['text':' size of bw_conv_buf','line_number':39,'multiline':False]
['text':' set for conversion error','line_number':40,'multiline':False]
['text':' first line with error or zero','line_number':41,'multiline':False]
['text':' line number at start of buffer','line_number':42,'multiline':False]
['text':' descriptor for iconv() or -1','line_number':44,'multiline':False]
['text':'
 * Convert a Unicode character to bytes.
 * Return TRUE for an error, FALSE when it's OK.
 ','line_number':48,'multiline':True]
['text':' in: character','line_number':54,'multiline':False]
['text':' in/out: pointer to result','line_number':55,'multiline':False]
['text':' FIO_ flags','line_number':56,'multiline':False]
['text':' Make two words, ten bits of the character in each.  First','line_number':86,'multiline':False]
['text':' word is 0xd800 - 0xdbff, second one 0xdc00 - 0xdfff','line_number':87,'multiline':False]
['text':' Latin1','line_number':118,'multiline':False]
['text':'
 * Call write() to write a number of bytes to the file.
 * Handles encryption and 'encoding' conversion.
 *
 * Return FAIL for failure, OK otherwise.
 ','line_number':133,'multiline':True]
['text':' data to write','line_number':143,'multiline':False]
['text':' length of data','line_number':144,'multiline':False]
['text':' extra flags','line_number':145,'multiline':False]
['text':' Skip conversion when writing the crypt magic number or the BOM.','line_number':147,'multiline':False]
['text':' Convert latin1 in the buffer to UTF-8 in the file.','line_number':156,'multiline':False]
['text':' translate to buffer','line_number':157,'multiline':False]
['text':' Convert UTF-8 bytes in the buffer to UCS-2, UCS-4, UTF-16 or','line_number':165,'multiline':False]
['text':' Latin1 chars in the file.','line_number':166,'multiline':False]
['text':' translate in-place (can only get shorter)','line_number':168,'multiline':False]
['text':' translate to buffer','line_number':170,'multiline':False]
['text':' Use remainder of previous call.  Append the start of','line_number':177,'multiline':False]
['text':' buf[] to get a full sequence.  Might still be too','line_number':178,'multiline':False]
['text':' short!','line_number':179,'multiline':False]
['text':' We have an incomplete byte sequence at the end to','line_number':187,'multiline':False]
['text':' be written.  We can't convert it without the','line_number':188,'multiline':False]
['text':' remaining bytes.  Keep them for the next call.','line_number':189,'multiline':False]
['text':' We have an incomplete byte sequence at the end to','line_number':217,'multiline':False]
['text':' be written.  We can't convert it without the','line_number':218,'multiline':False]
['text':' remaining bytes.  Keep them for the next call.','line_number':219,'multiline':False]
['text':' Convert UTF-8 or codepage to UCS-2 and then to MS-Windows','line_number':253,'multiline':False]
['text':' codepage.','line_number':254,'multiline':False]
['text':' Need to concatenate the remainder of the previous call and','line_number':264,'multiline':False]
['text':' the bytes of the current call.  Use the end of the','line_number':265,'multiline':False]
['text':' conversion buffer for this.','line_number':266,'multiline':False]
['text':' Convert from UTF-8 to UCS-2, to the start of the buffer.','line_number':281,'multiline':False]
['text':' The buffer has been allocated to be big enough.','line_number':282,'multiline':False]
['text':' incomplete byte sequence','line_number':286,'multiline':False]
['text':' Copy remainder to ip->bw_rest[] to be used for the next','line_number':295,'multiline':False]
['text':' call.','line_number':296,'multiline':False]
['text':' weird overlong sequence','line_number':299,'multiline':False]
['text':' Convert from enc_codepage to UCS-2, to the start of the','line_number':308,'multiline':False]
['text':' buffer.  The buffer has been allocated to be big enough.','line_number':309,'multiline':False]
['text':' When conversion fails there may be a trailing byte.','line_number':316,'multiline':False]
['text':' Conversion doesn't work.','line_number':322,'multiline':False]
['text':' Save the trailing byte for the next call.','line_number':326,'multiline':False]
['text':' Safety check: Conversion doesn't work.','line_number':335,'multiline':False]
['text':' VC 4.1 doesn't define CP_UTF8','line_number':344,'multiline':False]
['text':' Convert from UCS-2 to UTF-8, using the remainder of the','line_number':347,'multiline':False]
['text':' conversion buffer.  Fails when out of space.','line_number':348,'multiline':False]
['text':' Convert from UCS-2 to the codepage, using the remainder of','line_number':365,'multiline':False]
['text':' the conversion buffer.  If the conversion uses the default','line_number':366,'multiline':False]
['text':' character "0", the data doesn't fit in this encoding, so','line_number':367,'multiline':False]
['text':' fail.','line_number':368,'multiline':False]
['text':' Convert UTF-8 or latin1 to Apple MacRoman.','line_number':385,'multiline':False]
['text':' Need to concatenate the remainder of the previous call and','line_number':391,'multiline':False]
['text':' the bytes of the current call.  Use the end of the','line_number':392,'multiline':False]
['text':' conversion buffer for this.','line_number':393,'multiline':False]
['text':' Convert with iconv().','line_number':424,'multiline':False]
['text':' Need to concatenate the remainder of the previous call and','line_number':429,'multiline':False]
['text':' the bytes of the current call.  Use the end of the','line_number':430,'multiline':False]
['text':' conversion buffer for this.','line_number':431,'multiline':False]
['text':' output the initial shift state sequence','line_number':451,'multiline':False]
['text':' There is a bug in iconv() on Linux (which appears to be','line_number':454,'multiline':False]
['text':' wide-spread) which sets "to" to NULL and messes up "tolen".','line_number':455,'multiline':False]
['text':' If iconv() has an error or there is not enough room, fail.','line_number':464,'multiline':False]
['text':' copy remainder to ip->bw_rest[] to be used for the next call.','line_number':473,'multiline':False]
['text':' Only checking conversion, which is OK if we get here.','line_number':485,'multiline':False]
['text':' Encrypt the data. Do it in-place if possible, otherwise use an','line_number':491,'multiline':False]
['text':' allocated buffer.','line_number':492,'multiline':False]
['text':' Crypt layer is buffering, will flush later.','line_number':508,'multiline':False]
['text':'
 * Check modification time of file, before writing to it.
 * The size isn't checked, because using a tool like "gzip" takes care of
 * using the same timestamp but can't set the size.
 ','line_number':521,'multiline':True]
['text':' don't overwrite messages here','line_number':532,'multiline':False]
['text':' must give this prompt','line_number':533,'multiline':False]
['text':' don't use emsg() here, don't want to flush the buffers','line_number':534,'multiline':False]
['text':' always overwrite the file message now','line_number':540,'multiline':False]
['text':'
 * Generate a BOM in "buf[4]" for encoding "name".
 * Return the length of the BOM (zero when no BOM).
 ','line_number':545,'multiline':True]
['text':' Can't put a BOM in a non-Unicode file.','line_number':557,'multiline':False]
['text':' UTF-8','line_number':561,'multiline':False]
['text':' access time','line_number':577,'multiline':False]
['text':' modification time','line_number':578,'multiline':False]
['text':' UNIX','line_number':602,'multiline':False]
['text':'
 * buf_write() - write to file "fname" lines "start" through "end"
 *
 * We do our own buffering here because fwrite() is so slow.
 *
 * If "forceit" is true, we don't care for errors when attempting backups.
 * In case of an error everything possible is done to restore the original
 * file.  But when "forceit" is TRUE, we risk losing it.
 *
 * When "reset_changed" is TRUE and "append" == FALSE and "start" == 1 and
 * "end" == curbuf->b_ml.ml_line_count, reset curbuf->b_changed.
 *
 * This function must NOT use NameBuff (because it's called by autowrite()).
 *
 * return FAIL for failure, OK otherwise
 ','line_number':610,'multiline':True]
['text':' for forced 'ff' and 'fenc', can be','line_number':633,'multiline':False]
['text':' NULL!','line_number':634,'multiline':False]
['text':' append to the file','line_number':635,'multiline':False]
['text':' copy the original file?','line_number':642,'multiline':False]
['text':' name of file to write to','line_number':645,'multiline':False]
['text':' file permissions','line_number':659,'multiline':False]
['text':' TRUE if file doesn't exist yet','line_number':661,'multiline':False]
['text':' TRUE if writing over original','line_number':663,'multiline':False]
['text':' no end-of-line written','line_number':664,'multiline':False]
['text':' writing to a device','line_number':665,'multiline':False]
['text':' overwritten file is read-only','line_number':669,'multiline':False]
['text':' XXX fix me sometime?','line_number':670,'multiline':False]
['text':' 'w' bit has been set','line_number':671,'multiline':False]
['text':' writing everything','line_number':673,'multiline':False]
['text':' info for buf_write_bytes()','line_number':679,'multiline':False]
['text':' effective 'fileencoding'','line_number':682,'multiline':False]
['text':' allocated "fenc"','line_number':683,'multiline':False]
['text':' ACL copied from original file to','line_number':686,'multiline':False]
['text':' backup or new file','line_number':687,'multiline':False]
['text':' safety check','line_number':697,'multiline':False]
['text':' This can happen during startup when there is a stray "w" in the','line_number':701,'multiline':False]
['text':' vimrc file.','line_number':702,'multiline':False]
['text':' Disallow writing from .exrc and .vimrc in current directory for','line_number':707,'multiline':False]
['text':' security reasons.','line_number':708,'multiline':False]
['text':' Avoid a crash for a long name.','line_number':712,'multiline':False]
['text':' must init bw_conv_buf and bw_iconv_fd before jumping to "fail"','line_number':719,'multiline':False]
['text':' After writing a file changedtick changes but we don't want to display','line_number':732,'multiline':False]
['text':' the line.','line_number':733,'multiline':False]
['text':' If there is no file name yet, use the one for the written file.','line_number':736,'multiline':False]
['text':' BF_NOTEDITED is set to reflect this (in case the write fails).','line_number':737,'multiline':False]
['text':' Don't do this when the write is for a filter command.','line_number':738,'multiline':False]
['text':' Don't do this when appending.','line_number':739,'multiline':False]
['text':' Only do this when 'cpoptions' contains the 'F' flag.','line_number':740,'multiline':False]
['text':' just in case autocmds made "buf" invalid','line_number':752,'multiline':False]
['text':' For Unix: Use the short file name whenever possible.','line_number':757,'multiline':False]
['text':' Avoids problems with networks and when directory names are changed.','line_number':758,'multiline':False]
['text':' Don't do this for MS-DOS, a "cd" in a sub-shell may have moved us to','line_number':759,'multiline':False]
['text':' another directory, which we don't detect','line_number':760,'multiline':False]
['text':' remember full fname','line_number':761,'multiline':False]
['text':' when exiting allow typeahead now','line_number':772,'multiline':False]
['text':' don't wait for return yet','line_number':774,'multiline':False]
['text':' Set '[ and '] marks to the lines to be written.','line_number':776,'multiline':False]
['text':' Apply PRE autocommands.','line_number':793,'multiline':False]
['text':' Set curbuf to the buffer to be written.','line_number':794,'multiline':False]
['text':' Careful: The autocommands may call buf_write() recursively!','line_number':795,'multiline':False]
['text':' Set curwin/curbuf to buf and save a few things.','line_number':805,'multiline':False]
['text':' Could not find a window for "buf".  Doing more might cause','line_number':809,'multiline':False]
['text':' problems, better bail out.','line_number':810,'multiline':False]
['text':' Written everything correctly and BufWriteCmd has reset','line_number':843,'multiline':False]
['text':' 'modified': Correct the undo information so that an','line_number':844,'multiline':False]
['text':' undo now sets 'modified'.','line_number':845,'multiline':False]
['text':' restore curwin/curbuf and a few other things','line_number':872,'multiline':False]
['text':' In three situations we return here and don't write the file:','line_number':875,'multiline':False]
['text':' 1. the autocommands deleted or unloaded the buffer.','line_number':876,'multiline':False]
['text':' 2. The autocommands abort script processing.','line_number':877,'multiline':False]
['text':' 3. If one of the "Cmd" autocommands was executed.','line_number':878,'multiline':False]
['text':' restore the original '[ and '] positions','line_number':890,'multiline':False]
['text':' An aborting error, interrupt or exception in the','line_number':906,'multiline':False]
['text':' autocommands.','line_number':907,'multiline':False]
['text':' The buffer was deleted.  We assume it was written','line_number':912,'multiline':False]
['text':' (can't retry anyway).','line_number':913,'multiline':False]
['text':' Assume the buffer was written, update the timestamp.','line_number':917,'multiline':False]
['text':' Buffer still changed, the autocommands didn't work','line_number':926,'multiline':False]
['text':' properly.','line_number':927,'multiline':False]
['text':' The autocommands may have changed the number of lines in the file.','line_number':938,'multiline':False]
['text':' When writing the whole file, adjust the end.','line_number':939,'multiline':False]
['text':' When writing part of the file, assume that the autocommands only','line_number':940,'multiline':False]
['text':' changed the number of lines that are to be written (tricky!).','line_number':941,'multiline':False]
['text':' write all','line_number':944,'multiline':False]
['text':' more lines','line_number':946,'multiline':False]
['text':' less lines','line_number':948,'multiline':False]
['text':' The autocommands may have changed the name of the buffer, which may','line_number':961,'multiline':False]
['text':' be kept in fname, ffname and sfname.','line_number':962,'multiline':False]
['text':' restore the original '[ and '] positions','line_number':975,'multiline':False]
['text':' b_changed can be 0 after an undo, but we still need to write','line_number':985,'multiline':False]
['text':' the buffer to NetBeans.','line_number':986,'multiline':False]
['text':' may wait for return now','line_number':989,'multiline':False]
['text':' no error checking...','line_number':991,'multiline':False]
['text':' overwrite previous file message','line_number':1013,'multiline':False]
['text':' don't overwrite previous file message','line_number':1015,'multiline':False]
['text':' show that we are busy','line_number':1023,'multiline':False]
['text':' always overwrite the file message now','line_number':1024,'multiline':False]
['text':' can't allocate big buffer, use small','line_number':1027,'multiline':False]
['text':' one (to be able to write when out of','line_number':1028,'multiline':False]
['text':' memory)','line_number':1029,'multiline':False]
['text':' Get information about original file (if there is one).','line_number':1037,'multiline':False]
['text':' not a file','line_number':1047,'multiline':False]
['text':' It's a device of some kind (or a fifo) which we can write to','line_number':1061,'multiline':False]
['text':' but for which we can't make a backup.','line_number':1062,'multiline':False]
['text':' !UNIX','line_number':1068,'multiline':False]
['text':' Check for a writable device name.','line_number':1069,'multiline':False]
['text':' MS-Windows allows opening a device, but we will probably get stuck','line_number':1080,'multiline':False]
['text':' trying to write to it.','line_number':1081,'multiline':False]
['text':' !UNIX','line_number':1107,'multiline':False]
['text':' Check if the file is really writable (when renaming the file to','line_number':1111,'multiline':False]
['text':' make a backup we won't discover it later).','line_number':1112,'multiline':False]
['text':' Check if the timestamp hasn't changed since reading the file.','line_number':1130,'multiline':False]
['text':' For systems that support ACL: get the ACL from the original file.','line_number':1140,'multiline':False]
['text':' If 'backupskip' is not empty, don't make a backup for some files.','line_number':1145,'multiline':False]
['text':' Save the value of got_int and reset it.  We don't want a previous','line_number':1150,'multiline':False]
['text':' interruption cancel writing, only hitting CTRL-C while writing should','line_number':1151,'multiline':False]
['text':' abort it.','line_number':1152,'multiline':False]
['text':' Mark the buffer as 'being saved' to prevent changed buffer warnings','line_number':1156,'multiline':False]
['text':' If we are not appending or filtering, the file exists, and the','line_number':1159,'multiline':False]
['text':' 'writebackup', 'backup' or 'patchmode' option is set, need a backup.','line_number':1160,'multiline':False]
['text':' When 'patchmode' is set also make a backup when appending.','line_number':1161,'multiline':False]
['text':'','line_number':1162,'multiline':False]
['text':' Do not make any backup, if 'writebackup' and 'backup' are both switched','line_number':1163,'multiline':False]
['text':' off.  This helps when editing large files on almost-full disks.','line_number':1164,'multiline':False]
['text':' "yes"','line_number':1171,'multiline':False]
['text':' "auto"','line_number':1174,'multiline':False]
['text':' Don't rename the file when:','line_number':1179,'multiline':False]
['text':' - it's a hard link','line_number':1180,'multiline':False]
['text':' - it's a symbolic link','line_number':1181,'multiline':False]
['text':' - we don't have write permission in the directory','line_number':1182,'multiline':False]
['text':' - we can't set the owner/group of the new file','line_number':1183,'multiline':False]
['text':' On NTFS file systems hard links are possible.','line_number':1197,'multiline':False]
['text':' Check if we can create a file and set the owner/group to','line_number':1204,'multiline':False]
['text':' the ones from the original file.','line_number':1205,'multiline':False]
['text':' First find a file name that doesn't exist yet (use some','line_number':1206,'multiline':False]
['text':' arbitrary numbers).','line_number':1207,'multiline':False]
['text':' If the same file name is created by another','line_number':1218,'multiline':False]
['text':' process between lstat() and open(), find another','line_number':1219,'multiline':False]
['text':' name.','line_number':1220,'multiline':False]
['text':' can't write in directory','line_number':1225,'multiline':False]
['text':' Close the file before removing it, on MS-Windows we','line_number':1239,'multiline':False]
['text':' can't delete an open file.','line_number':1240,'multiline':False]
['text':' MS-Windows may trigger a virus scanner to open the','line_number':1244,'multiline':False]
['text':' file, we can't delete it then.  Keep trying for half a','line_number':1245,'multiline':False]
['text':' second.','line_number':1246,'multiline':False]
['text':' wait 50 msec','line_number':1254,'multiline':False]
['text':' Break symlinks and/or hardlinks if we've been asked to.','line_number':1263,'multiline':False]
['text':' Symlinks.','line_number':1271,'multiline':False]
['text':' Hardlinks.','line_number':1277,'multiline':False]
['text':' Symlinks.','line_number':1284,'multiline':False]
['text':' Hardlinks.','line_number':1288,'multiline':False]
['text':' make sure we have a valid backup extension to use','line_number':1297,'multiline':False]
['text':' out of memory','line_number':1323,'multiline':False]
['text':' Try to make the backup in each directory in the 'bdir' option.','line_number':1327,'multiline':False]
['text':'','line_number':1328,'multiline':False]
['text':' Unix semantics has it, that we may have a writable file,','line_number':1329,'multiline':False]
['text':' that cannot be recreated with a simple open(..., O_CREAT, ) e.g:','line_number':1330,'multiline':False]
['text':'  - the directory is not writable,','line_number':1331,'multiline':False]
['text':'  - the file may be a symbolic link,','line_number':1332,'multiline':False]
['text':'  - the file may belong to another user/group, etc.','line_number':1333,'multiline':False]
['text':'','line_number':1334,'multiline':False]
['text':' For these reasons, the existing writable file must be truncated','line_number':1335,'multiline':False]
['text':' and reused. Creation of a backup COPY will be attempted.','line_number':1336,'multiline':False]
['text':' Isolate one directory name, using an entry in 'bdir'.','line_number':1346,'multiline':False]
['text':' Ends with '//', use full path','line_number':1352,'multiline':False]
['text':' out of memory','line_number':1362,'multiline':False]
['text':' May try twice if 'shortname' not set.','line_number':1370,'multiline':False]
['text':' Make the backup file name.','line_number':1373,'multiline':False]
['text':' out of memory','line_number':1380,'multiline':False]
['text':' Check if backup file already exists.','line_number':1384,'multiline':False]
['text':' Check if backup file is same as original file.','line_number':1388,'multiline':False]
['text':' May happen when modname() gave the same file back.','line_number':1389,'multiline':False]
['text':' E.g. silly link, or file name-length reached.','line_number':1390,'multiline':False]
['text':' If we don't check here, we either ruin the file','line_number':1391,'multiline':False]
['text':' when copying or erase it after writing. jw.','line_number':1392,'multiline':False]
['text':' no backup file to delete','line_number':1396,'multiline':False]
['text':' may try again with 'shortname' set','line_number':1397,'multiline':False]
['text':' setting shortname didn't help','line_number':1404,'multiline':False]
['text':' If we are not going to keep the backup file, don't','line_number':1411,'multiline':False]
['text':' delete an existing one, try to use another name.','line_number':1412,'multiline':False]
['text':' Change one character, just before the extension.','line_number':1413,'multiline':False]
['text':' empty file name ???','line_number':1418,'multiline':False]
['text':' They all exist??? Must be something wrong.','line_number':1424,'multiline':False]
['text':' Try to create the backup file','line_number':1433,'multiline':False]
['text':' remove old backup, if present','line_number':1436,'multiline':False]
['text':' Open with O_EXCL to avoid the file being created while','line_number':1438,'multiline':False]
['text':' we were sleeping (symlink hacker attack?). Reset umask','line_number':1439,'multiline':False]
['text':' if possible to avoid mch_setperm() below.','line_number':1440,'multiline':False]
['text':' Set file protection same as original file, but','line_number':1454,'multiline':False]
['text':' strip s-bit.  Only needed if umask() wasn't used','line_number':1455,'multiline':False]
['text':' above.','line_number':1456,'multiline':False]
['text':' Try to set the group of the backup same as the','line_number':1460,'multiline':False]
['text':' original file. If this fails, set the protection','line_number':1461,'multiline':False]
['text':' bits for the group same as the protection bits for','line_number':1462,'multiline':False]
['text':' others.','line_number':1463,'multiline':False]
['text':' sequent-ptx lacks fchown()','line_number':1465,'multiline':False]
['text':' copy the file.','line_number':1479,'multiline':False]
['text':' ignore errors for closing read file','line_number':1523,'multiline':False]
['text':' ignore errors when forceit is TRUE','line_number':1528,'multiline':False]
['text':' Make a backup by renaming the original file.','line_number':1542,'multiline':False]
['text':' If 'cpoptions' includes the "W" flag, we don't want to','line_number':1544,'multiline':False]
['text':' overwrite a read-only file.  But rename may be possible','line_number':1545,'multiline':False]
['text':' anyway, thus we need an extra check here.','line_number':1546,'multiline':False]
['text':' Form the backup file name - change path/fo.o.h to','line_number':1554,'multiline':False]
['text':' path/fo.o.h.bak Try all directories in 'backupdir', first one','line_number':1555,'multiline':False]
['text':' that works is used.','line_number':1556,'multiline':False]
['text':' Isolate one directory name and make the backup file name.','line_number':1560,'multiline':False]
['text':' path ends with '//', use full path','line_number':1566,'multiline':False]
['text':' If we are not going to keep the backup file, don't','line_number':1589,'multiline':False]
['text':' delete an existing one, try to use another name.','line_number':1590,'multiline':False]
['text':' Change one character, just before the extension.','line_number':1591,'multiline':False]
['text':' empty file name ???','line_number':1595,'multiline':False]
['text':' They all exist??? Must be something wrong!','line_number':1600,'multiline':False]
['text':' Delete any existing backup and move the current version','line_number':1607,'multiline':False]
['text':' to the backup.	For safety, we don't remove the backup','line_number':1608,'multiline':False]
['text':' until the write has finished successfully. And if the','line_number':1609,'multiline':False]
['text':' 'backup' option is set, leave it around.','line_number':1610,'multiline':False]
['text':' If the renaming of the original file to the backup file','line_number':1612,'multiline':False]
['text':' works, quit here.','line_number':1613,'multiline':False]
['text':' don't do the rename below','line_number':1617,'multiline':False]
['text':' When using ":w!" and the file was read-only: make it writable','line_number':1629,'multiline':False]
['text':' When using ":w!" and writing to the current file, 'readonly' makes no','line_number':1639,'multiline':False]
['text':' sense, reset it, unless 'Z' appears in 'cpoptions'.','line_number':1640,'multiline':False]
['text':' set window title later','line_number':1644,'multiline':False]
['text':' redraw status lines later','line_number':1645,'multiline':False]
['text':' If the original file is being overwritten, there is a small chance that','line_number':1653,'multiline':False]
['text':' we crash in the middle of writing. Therefore the file is preserved now.','line_number':1654,'multiline':False]
['text':' This makes all block numbers positive so that recovery does not need','line_number':1655,'multiline':False]
['text':' the original file.','line_number':1656,'multiline':False]
['text':' Don't do this if there is a backup file and we are exiting.','line_number':1657,'multiline':False]
['text':' remove version','line_number':1670,'multiline':False]
['text':' Default: write the file directly.  May write to a temp file for','line_number':1672,'multiline':False]
['text':' multi-byte conversion.','line_number':1673,'multiline':False]
['text':' Check for forced 'fileencoding' from "++opt=val" argument.','line_number':1676,'multiline':False]
['text':' Check if the file needs to be converted.','line_number':1686,'multiline':False]
['text':' Check if UTF-8 to UCS-2/4 or Latin1 conversion needs to be done.  Or','line_number':1689,'multiline':False]
['text':' Latin1 to Unicode conversion.  This is handled in buf_write_bytes().','line_number':1690,'multiline':False]
['text':' Prepare the flags for it and allocate bw_conv_buf when needed.','line_number':1691,'multiline':False]
['text':' Need to allocate a buffer to translate into.','line_number':1697,'multiline':False]
['text':' FIO_UCS4','line_number':1700,'multiline':False]
['text':' Convert UTF-8 -> UCS-2 and UCS-2 -> DBCS.  Worst-case * 4:','line_number':1711,'multiline':False]
['text':' Use iconv() conversion when conversion is needed and it's not done','line_number':1733,'multiline':False]
['text':' internally.','line_number':1734,'multiline':False]
['text':' We're going to use iconv(), allocate a buffer to convert in.','line_number':1739,'multiline':False]
['text':' When the file needs to be converted with 'charconvert' after','line_number':1752,'multiline':False]
['text':' writing, write to a temp file instead and let the conversion','line_number':1753,'multiline':False]
['text':' overwrite the original file.','line_number':1754,'multiline':False]
['text':' Can't write without a tempfile!','line_number':1758,'multiline':False]
['text':' If conversion is taking place, we may first pretend to write and check','line_number':1784,'multiline':False]
['text':' for conversion errors.  Then loop again to write for real.','line_number':1785,'multiline':False]
['text':' When not doing conversion this writes for real right away.','line_number':1786,'multiline':False]
['text':' There is no need to check conversion when:','line_number':1789,'multiline':False]
['text':' - there is no conversion','line_number':1790,'multiline':False]
['text':' - we make a backup file, that can be restored in case of conversion','line_number':1791,'multiline':False]
['text':'   failure.','line_number':1792,'multiline':False]
['text':' Make sure we don't write anything.','line_number':1798,'multiline':False]
['text':' Open the file "wfname" for writing.','line_number':1809,'multiline':False]
['text':' We may try to open the file twice: If we can't write to the file','line_number':1810,'multiline':False]
['text':' and forceit is TRUE we delete the existing file and try to','line_number':1811,'multiline':False]
['text':' create a new one. If this still fails we may have lost the','line_number':1812,'multiline':False]
['text':' original file!  (this may happen when the user reached his','line_number':1813,'multiline':False]
['text':' quotum for number of files).','line_number':1814,'multiline':False]
['text':' Appending will fail if the file does not exist and forceit is','line_number':1815,'multiline':False]
['text':' FALSE.','line_number':1816,'multiline':False]
['text':' A forced write will try to create a new file if the old one','line_number':1822,'multiline':False]
['text':' is still readonly. This may also happen when the directory','line_number':1823,'multiline':False]
['text':' is read-only. In that case the mch_remove() will fail.','line_number':1824,'multiline':False]
['text':' Don't delete the file when it's a hard or symbolic link.','line_number':1830,'multiline':False]
['text':' we write to the file, thus it should be marked','line_number':1845,'multiline':False]
['text':' writable after all','line_number':1846,'multiline':False]
['text':' don't remove when appending','line_number':1854,'multiline':False]
['text':' If we failed to open the file, we don't need a backup.','line_number':1865,'multiline':False]
['text':' Throw it away.  If we moved or removed the original file','line_number':1866,'multiline':False]
['text':' try to put the backup in its place.','line_number':1867,'multiline':False]
['text':' There is a small chance that we removed the','line_number':1872,'multiline':False]
['text':' original, try to move the copy in its place.','line_number':1873,'multiline':False]
['text':' This may not work if the vim_rename() fails.','line_number':1874,'multiline':False]
['text':' In that case we leave the copy around.','line_number':1875,'multiline':False]
['text':' If file does not exist, put the copy in its','line_number':1877,'multiline':False]
['text':' place','line_number':1878,'multiline':False]
['text':' if original file does exist throw away the copy','line_number':1881,'multiline':False]
['text':' try to put the original file back','line_number':1887,'multiline':False]
['text':' if original file no longer exists give an extra warning','line_number':1892,'multiline':False]
['text':' Double check we are writing the intended file before making','line_number':1907,'multiline':False]
['text':' any changes.','line_number':1908,'multiline':False]
['text':' Should copy resource fork','line_number':1935,'multiline':False]
['text':' Write magic number, so that Vim knows how this file is','line_number':1952,'multiline':False]
['text':' encrypted when reading it back.','line_number':1953,'multiline':False]
['text':' use "++bin", "++nobin" or 'binary'','line_number':1970,'multiline':False]
['text':' The BOM is written just after the encryption magic number.','line_number':1976,'multiline':False]
['text':' Skip it when appending and the file already existed, the BOM only','line_number':1977,'multiline':False]
['text':' makes sense at the start of the file.','line_number':1978,'multiline':False]
['text':' don't convert, do encryption','line_number':1984,'multiline':False]
['text':' writing undo file requires','line_number':2000,'multiline':False]
['text':' crypt_encode_inplace()','line_number':2001,'multiline':False]
['text':' remove undo file if encrypting it is not possible','line_number':2008,'multiline':False]
['text':' Prepare for computing the hash value of the text.','line_number':2019,'multiline':False]
['text':' The next while loop is done once for each character written.','line_number':2030,'multiline':False]
['text':' Keep it fast!','line_number':2031,'multiline':False]
['text':' replace newlines with NULs','line_number':2041,'multiline':False]
['text':' Mac: replace CRs with NLs','line_number':2043,'multiline':False]
['text':' write error: break loop','line_number':2058,'multiline':False]
['text':' write failed or last line has no EOL: stop here','line_number':2066,'multiline':False]
['text':' written the line, count it','line_number':2074,'multiline':False]
['text':' EOL_MAC or EOL_DOS: write CR','line_number':2082,'multiline':False]
['text':' write CR-NL','line_number':2083,'multiline':False]
['text':' write error: break loop','line_number':2089,'multiline':False]
['text':' write error: break loop','line_number':2103,'multiline':False]
['text':' Interrupted, break loop','line_number':2113,'multiline':False]
['text':' On VMS there is a problem: newlines get added when writing','line_number':2118,'multiline':False]
['text':' blocks at a time. Fix it by writing a line at a time.','line_number':2119,'multiline':False]
['text':' This is much slower!','line_number':2120,'multiline':False]
['text':' Explanation: VAX/DECC RTL insists that records in some RMS','line_number':2121,'multiline':False]
['text':' structures end with a newline (carriage return) character, and','line_number':2122,'multiline':False]
['text':' if they don't it adds one.','line_number':2123,'multiline':False]
['text':' With other RMS structures it works perfect without this fix.','line_number':2124,'multiline':False]
['text':' Older DECC compiler for VAX doesn't define MIN()','line_number':2126,'multiline':False]
['text':' write error','line_number':2166,'multiline':False]
['text':' write trailing CTRL-Z','line_number':2172,'multiline':False]
['text':' Stop when writing done or an error was encountered.','line_number':2177,'multiline':False]
['text':' If no error happened until now, writing should be ok, so loop to','line_number':2181,'multiline':False]
['text':' really write the buffer.','line_number':2182,'multiline':False]
['text':' If we started writing, finish writing. Also when an error was','line_number':2185,'multiline':False]
['text':' encountered.','line_number':2186,'multiline':False]
['text':' On many journaling file systems there is a bug that causes both the','line_number':2190,'multiline':False]
['text':' original and the backup file to be lost when halting the system','line_number':2191,'multiline':False]
['text':' right after writing the file.  That's because only the meta-data is','line_number':2192,'multiline':False]
['text':' journalled.  Syncing the file slows down the system, but assures it','line_number':2193,'multiline':False]
['text':' has been written to disk and we don't lose it.','line_number':2194,'multiline':False]
['text':' For a device do try the fsync() but don't complain if it does not','line_number':2195,'multiline':False]
['text':' work (could be a pipe).','line_number':2196,'multiline':False]
['text':' If the 'fsync' option is FALSE, don't fsync().  Useful for laptops.','line_number':2197,'multiline':False]
['text':' Probably need to set the security context.','line_number':2206,'multiline':False]
['text':' When creating a new file, set its owner/group to that of the','line_number':2219,'multiline':False]
['text':' original file.  Get the new device and inode number.','line_number':2220,'multiline':False]
['text':' Don't change the owner when it's already OK, some systems remove','line_number':2226,'multiline':False]
['text':' permission or ACL stuff.','line_number':2227,'multiline':False]
['text':' changing owner might not be possible','line_number':2232,'multiline':False]
['text':' if changing group fails clear the group permissions','line_number':2234,'multiline':False]
['text':' Set the inode when creating a new file.','line_number':2242,'multiline':False]
['text':' reset 'w' bit for security reasons','line_number':2248,'multiline':False]
['text':' set permission of new file same as old file','line_number':2251,'multiline':False]
['text':' set permission of new file same as old file','line_number':2262,'multiline':False]
['text':' Probably need to set the ACL before changing the user (can't set the','line_number':2267,'multiline':False]
['text':' ACL on a file the user doesn't own).','line_number':2268,'multiline':False]
['text':' On Solaris, with ZFS and the aclmode property set to "discard" (the','line_number':2269,'multiline':False]
['text':' default), chmod() discards all part of a file's ACL that don't','line_number':2270,'multiline':False]
['text':' represent the mode of the file.  It's non-trivial for us to discover','line_number':2271,'multiline':False]
['text':' whether we're in that situation, so we simply always re-set the ACL.','line_number':2272,'multiline':False]
['text':' The file was written to a temp file, now it needs to be','line_number':2289,'multiline':False]
['text':' converted with 'charconvert' to (overwrite) the output file.','line_number':2290,'multiline':False]
['text':' Error encountered.','line_number':2308,'multiline':False]
['text':' If we have a backup file, try to put it in place of the new file,','line_number':2329,'multiline':False]
['text':' because the new file is probably corrupt.  This avoids losing the','line_number':2330,'multiline':False]
['text':' original file when trying to make a backup when writing the file a','line_number':2331,'multiline':False]
['text':' second time.','line_number':2332,'multiline':False]
['text':' When "backup_copy" is set we need to copy the backup over the new','line_number':2333,'multiline':False]
['text':' file.  Otherwise rename the backup file.','line_number':2334,'multiline':False]
['text':' If this is OK, don't give the extra warning message.','line_number':2335,'multiline':False]
['text':' This may take a while, if we were interrupted let the user','line_number':2340,'multiline':False]
['text':' know we got the message.','line_number':2341,'multiline':False]
['text':' copy the file.','line_number':2353,'multiline':False]
['text':' success','line_number':2363,'multiline':False]
['text':' ignore errors for closing read file','line_number':2365,'multiline':False]
['text':' compute number of written lines','line_number':2377,'multiline':False]
['text':' may wait for return now','line_number':2378,'multiline':False]
['text':' use shortname now, for the messages','line_number':2381,'multiline':False]
['text':' put fname in IObuff with quotes','line_number':2385,'multiline':False]
['text':' may add [unix/dos/mac]','line_number':2420,'multiline':False]
['text':' add line/char count','line_number':2430,'multiline':False]
['text':' When written everything correctly: reset 'modified'.  Unless not','line_number':2442,'multiline':False]
['text':' writing to the original file and '+' is not in 'cpoptions'.','line_number':2443,'multiline':False]
['text':' b:changedtick may be incremented in unchanged() but that should not','line_number':2449,'multiline':False]
['text':' trigger a TextChanged event.','line_number':2450,'multiline':False]
['text':' If written to the current file, update the timestamp of the swap file','line_number':2457,'multiline':False]
['text':' and reset the BF_WRITE_MASK flags. Also sets buf->b_mtime.','line_number':2458,'multiline':False]
['text':' If we kept a backup until now, and we are in patch mode, then we make','line_number':2468,'multiline':False]
['text':' the backup file our 'original' file.','line_number':2469,'multiline':False]
['text':' If the original file does not exist yet','line_number':2479,'multiline':False]
['text':' the current backup file becomes the original file','line_number':2480,'multiline':False]
['text':' don't delete the file','line_number':2486,'multiline':False]
['text':' If there is no backup file, remember that a (new) file was','line_number':2492,'multiline':False]
['text':' created.','line_number':2493,'multiline':False]
['text':' Remove the backup unless 'backup' option is set or there was a','line_number':2513,'multiline':False]
['text':' conversion error.','line_number':2514,'multiline':False]
['text':' Finish up.  We get here either after failure or success.','line_number':2521,'multiline':False]
['text':' may wait for return now','line_number':2523,'multiline':False]
['text':' Done saving, we accept changed buffer warnings again','line_number':2526,'multiline':False]
['text':' set highlight for error messages','line_number':2549,'multiline':False]
['text':' put file name in IObuff with quotes','line_number':2556,'multiline':False]
['text':' If the error message has the form "is ...", put the error number in','line_number':2559,'multiline':False]
['text':' front of the file name.','line_number':2560,'multiline':False]
['text':' Update the timestamp to avoid an "overwrite changed file"','line_number':2579,'multiline':False]
['text':' prompt when writing again.','line_number':2580,'multiline':False]
['text':' When writing the whole file and 'undofile' is set, also write the undo','line_number':2592,'multiline':False]
['text':' file.','line_number':2593,'multiline':False]
['text':' in case it was set by the previous read','line_number':2611,'multiline':False]
['text':' Apply POST autocommands.','line_number':2613,'multiline':False]
['text':' Careful: The autocommands may call buf_write() recursively!','line_number':2614,'multiline':False]
['text':' Only do this when a window was found for "buf".','line_number':2615,'multiline':False]
['text':' restore curwin/curbuf and a few other things','line_number':2632,'multiline':False]
['text':' autocmds may abort script processing','line_number':2637,'multiline':False]
['text':' Make sure marks will be written out to the viminfo file later, even when','line_number':2643,'multiline':False]
['text':' the file is new.','line_number':2644,'multiline':False]
