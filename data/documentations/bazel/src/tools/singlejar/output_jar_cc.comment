['text':' Copyright 2016 The Bazel Authors. All rights reserved.','line_number':1,'multiline':False]
['text':'','line_number':2,'multiline':False]
['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':3,'multiline':False]
['text':' you may not use this file except in compliance with the License.','line_number':4,'multiline':False]
['text':' You may obtain a copy of the License at','line_number':5,'multiline':False]
['text':'','line_number':6,'multiline':False]
['text':'    http://www.apache.org/licenses/LICENSE-2.0','line_number':7,'multiline':False]
['text':'','line_number':8,'multiline':False]
['text':' Unless required by applicable law or agreed to in writing, software','line_number':9,'multiline':False]
['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':10,'multiline':False]
['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':11,'multiline':False]
['text':' See the License for the specific language governing permissions and','line_number':12,'multiline':False]
['text':' limitations under the License.','line_number':13,'multiline':False]
['text':'
 * The implementation of the OutputJar methods.
 ','line_number':15,'multiline':True]
['text':' WIN32_LEAN_AND_MEAN','line_number':33,'multiline':False]
['text':' _WIN32','line_number':36,'multiline':False]
['text':' Register the handler for the build-data.properties file unless','line_number':92,'multiline':False]
['text':' --exclude_build_data is present. Otherwise we do not generate this file,','line_number':93,'multiline':False]
['text':' and it will be copied from the first source archive containing it.','line_number':94,'multiline':False]
['text':' Populate the manifest file.','line_number':100,'multiline':False]
['text':' TODO(b/28294322): remove fallback to output_jar','line_number':104,'multiline':False]
['text':' Copy launcher if it is set.','line_number':126,'multiline':False]
['text':' Copy CDS archive file (.jsa) if it is set. Page aligned start offset','line_number':136,'multiline':False]
['text':' is required.','line_number':137,'multiline':False]
['text':' Copy JDK lib/modules if set. Page aligned start offset is required for','line_number':145,'multiline':False]
['text':' the file.','line_number':146,'multiline':False]
['text':' TODO(asmundak): this isn't right, we should parse properties file.','line_number':181,'multiline':False]
['text':' A resource description is either NAME or PATH:NAME','line_number':200,'multiline':False]
['text':' Find the last ':' instead of the first because Windows uses ':' as volume','line_number':201,'multiline':False]
['text':' separator in absolute path.','line_number':202,'multiline':False]
['text':' If colon points to volume separator, don't split.','line_number':210,'multiline':False]
['text':' Ready to write zip entries. Decide whether created entries should be','line_number':222,'multiline':False]
['text':' compressed.','line_number':223,'multiline':False]
['text':' First, write a directory entry for the META-INF, followed by the manifest','line_number':225,'multiline':False]
['text':' file, followed by the build properties file.','line_number':226,'multiline':False]
['text':' Then classpath resources.','line_number':233,'multiline':False]
['text':' Add parent directory entries.','line_number':248,'multiline':False]
['text':' Then copy source files' contents.','line_number':261,'multiline':False]
['text':' All entries written, write Central Directory and close.','line_number':268,'multiline':False]
['text':' Try to perform I/O in units of this size.','line_number':279,'multiline':False]
['text':' (128KB is the default max request size for fuse filesystems.)','line_number':280,'multiline':False]
['text':' Must share for reading, otherwise','line_number':301,'multiline':False]
['text':' symlink-following file existence checks (e.g.','line_number':302,'multiline':False]
['text':' java.nio.file.Files.exists()) fail.','line_number':303,'multiline':False]
['text':' Make sure output file is in binary mode, or \r\n will be converted to \n.','line_number':311,'multiline':False]
['text':' Set execute bits since we may produce an executable output file.','line_number':315,'multiline':False]
['text':' January 1, 2010 as a DOS date','line_number':338,'multiline':False]
['text':' Special files that cannot be handled by looking up known_members_ map:','line_number':362,'multiline':False]
['text':' * ignore *.SF, *.RSA, *.DSA','line_number':363,'multiline':False]
['text':'   (TODO(asmundak): should this be done only in META-INF?','line_number':364,'multiline':False]
['text':'','line_number':365,'multiline':False]
['text':' The contents of the META-INF/services/<SERVICE> on the output is the','line_number':389,'multiline':False]
['text':' concatenation of the META-INF/services/<SERVICE> files from all inputs.','line_number':390,'multiline':False]
['text':' Create a concatenator and add it to the known_members_ map.','line_number':393,'multiline':False]
['text':' The call to Merge() below will then take care of the rest.','line_number':394,'multiline':False]
['text':' Install a new entry unless it is already present. All the plain (non-dir)','line_number':410,'multiline':False]
['text':' entries that require a combiner have been already installed, so the call','line_number':411,'multiline':False]
['text':' will add either a directory entry whose handler will ignore subsequent','line_number':412,'multiline':False]
['text':' duplicates, or an ordinary plain entry, for which we save the index of','line_number':413,'multiline':False]
['text':' the first input jar (in order to provide diagnostics on duplicate).','line_number':414,'multiline':False]
['text':' Handle special entries (the ones that have a combiner).','line_number':421,'multiline':False]
['text':' TODO(kmb,asmundak): Should be checking Merge() return value but fails','line_number':423,'multiline':False]
['text':' for build-data.properties when merging deploy jars into deploy jars.','line_number':424,'multiline':False]
['text':' Plain file entry. If duplicates are not allowed, bail out. Otherwise','line_number':429,'multiline':False]
['text':' just ignore this entry.','line_number':430,'multiline':False]
['text':' Add any missing parent directory entries (first) if requested.','line_number':445,'multiline':False]
['text':' Ignore very last character in case this entry is a directory itself.','line_number':447,'multiline':False]
['text':' For the file entries, decide whether output should be compressed.','line_number':459,'multiline':False]
['text':' Now we have to copy:','line_number':487,'multiline':False]
['text':'  local header','line_number':488,'multiline':False]
['text':'  file data','line_number':489,'multiline':False]
['text':'  data descriptor, if present.','line_number':490,'multiline':False]
['text':' When normalize_timestamps is set, entry's timestamp is to be set to','line_number':506,'multiline':False]
['text':' 01/01/2010 00:00:00 (or to 01/01/2010 00:00:02, if an entry is a .class','line_number':507,'multiline':False]
['text':' file). This is somewhat expensive because we have to copy the local','line_number':508,'multiline':False]
['text':' header to memory as input jar is memory mapped as read-only. Try to copy','line_number':509,'multiline':False]
['text':' as little as possible.','line_number':510,'multiline':False]
['text':' Remove Unix timestamp field.','line_number':529,'multiline':False]
['text':' Now write these few bytes and adjust read/write positions accordingly.','line_number':548,'multiline':False]
['text':' Do the actual copy.','line_number':560,'multiline':False]
['text':' You'd think this could be "return ftell(file_);", but that','line_number':578,'multiline':False]
['text':' generates a needless call to lseek.  So instead we cache our','line_number':579,'multiline':False]
['text':' current position in the output.','line_number':580,'multiline':False]
['text':' Writes an entry. The argument is the pointer to the contiguous block of','line_number':584,'multiline':False]
['text':' memory containing Local Header for the entry, immediately followed by','line_number':585,'multiline':False]
['text':' the data. The memory is freed after the data has been written.','line_number':586,'multiline':False]
['text':' Set this entry's timestamp.','line_number':601,'multiline':False]
['text':' MSDOS file timestamp format that Zip uses is described here:','line_number':602,'multiline':False]
['text':' https://msdn.microsoft.com/en-us/library/9kkf9tah.aspx','line_number':603,'multiline':False]
['text':' ("32-Bit Windows Time/Date Formats")','line_number':604,'multiline':False]
['text':' Regular "normalized" timestamp is 01/01/2010 00:00:00, while for the','line_number':606,'multiline':False]
['text':' .class file it is 01/01/2010 00:00:02','line_number':607,'multiline':False]
['text':' Time has 2-second resolution, so round up:','line_number':614,'multiline':False]
['text':' Data written, allocate CDH space and populate CDH.','line_number':630,'multiline':False]
['text':' Space needed for the CDH varies depending on whether output position field','line_number':631,'multiline':False]
['text':' fits into 32 bits (we do not handle compressed/uncompressed entry sizes','line_number':632,'multiline':False]
['text':' exceeding 32 bits at the moment).','line_number':633,'multiline':False]
['text':' Note: do not set the version to Unix 3.0 spec, otherwise','line_number':641,'multiline':False]
['text':' unzip will think that 'external_attributes' field contains access mode','line_number':642,'multiline':False]
['text':' 2.0','line_number':644,'multiline':False]
['text':' Field address argument points to the already existing field,','line_number':663,'multiline':False]
['text':' so the call just updates the length.','line_number':664,'multiline':False]
['text':' META_INF/ is always the first entry, and as such it should have an extra','line_number':681,'multiline':False]
['text':' field with the tag 0xCAFE and zero bytes of data. This is not the part of','line_number':682,'multiline':False]
['text':' the jar file spec, but Unix 'file' utility relies on it to distiguish jar','line_number':683,'multiline':False]
['text':' file from zip file. See https://bugs.openjdk.java.net/browse/JDK-6808540','line_number':684,'multiline':False]
['text':' Writes a directory entry with the given name and extra fields.','line_number':691,'multiline':False]
['text':' 2.0','line_number':698,'multiline':False]
['text':' TODO(asmundak): should I set UTF8 flag?','line_number':699,'multiline':False]
['text':' Create output Central Directory entry for the input jar entry.','line_number':710,'multiline':False]
['text':' While copying from the input CDH pointed to by 'cdh', we may need to drop','line_number':714,'multiline':False]
['text':' Unix timestamp extra field, and we might need to change the number of','line_number':715,'multiline':False]
['text':' attributes of the Zip64 extra field, or create it, or destroy it if entry's','line_number':716,'multiline':False]
['text':' position relative to 4G boundary changes.','line_number':717,'multiline':False]
['text':' The rest of the input CDH is copied.','line_number':718,'multiline':False]
['text':' 1. Decide if we need to drop UnixTime.','line_number':720,'multiline':False]
['text':' 2. Figure out how many attributes input entry has and how many','line_number':729,'multiline':False]
['text':' the output entry is going to have.','line_number':730,'multiline':False]
['text':' The number of attributes may remain the same, or it may increase or','line_number':737,'multiline':False]
['text':' decrease by 1, depending on local_header_offset value.','line_number':738,'multiline':False]
['text':' Allocate output CDH and copy everything but extra fields.','line_number':754,'multiline':False]
['text':' Calculate ExtraFields boundaries in the input and output entries.','line_number':762,'multiline':False]
['text':' Copy [cdh..ef_begin) -> [out_cdh..out_ef_begin)','line_number':766,'multiline':False]
['text':' Copy [ef_end..cdh_end) -> [out_ef_end..out_cdh_end)','line_number':774,'multiline':False]
['text':' Copy extra fields, dropping Zip64 and possibly UnixTime fields.','line_number':778,'multiline':False]
['text':' Skip this one.','line_number':782,'multiline':False]
['text':' Set up Zip64 extra field if necessary.','line_number':790,'multiline':False]
['text':' Set 64-bit local_header_offset if necessary. It's always the last','line_number':804,'multiline':False]
['text':' attribute.','line_number':805,'multiline':False]
['text':' Write out combined jar.','line_number':836,'multiline':False]
['text':' TODO(asmundak): handle manifest;','line_number':851,'multiline':False]
['text':' Save it before ReserveCdh updates it.','line_number':856,'multiline':False]
['text':' Unix, version 3.0','line_number':862,'multiline':False]
['text':' 4.5 (Zip64 support)','line_number':863,'multiline':False]
['text':' Java Compiler (javac) uses its own "optimized" Zip handler (see','line_number':881,'multiline':False]
['text':' https://bugs.openjdk.java.net/browse/JDK-7018859) which may fail','line_number':882,'multiline':False]
['text':' to handle 0xFFFFFFFF in the CEN size and CEN offset fields. Try','line_number':883,'multiline':False]
['text':' to use 32-bit values here, too. Hopefully by the time we need to','line_number':884,'multiline':False]
['text':' handle really large archives, this is fixes upstream. Note that this','line_number':885,'multiline':False]
['text':' affects javac and javah only, 'jar' experiences no problems.','line_number':886,'multiline':False]
['text':' Save Central Directory and wrap up.','line_number':900,'multiline':False]
['text':' Free the buffer only after fclose(); stdio may flush data from the','line_number':910,'multiline':False]
['text':' buffer on close.','line_number':911,'multiline':False]
['text':' TODO(asmundak): this mimics old behaviour. Confirm that unless','line_number':941,'multiline':False]
['text':' we run with --warn_duplicate_resources, the output zip file contains','line_number':942,'multiline':False]
['text':' the concatenated contents of the all the resources with the same name.','line_number':943,'multiline':False]
['text':' add an empty entry for the directory so its path ends up in the','line_number':956,'multiline':False]
['text':' manifest','line_number':957,'multiline':False]
['text':' _WIN32','line_number':1006,'multiline':False]
['text':' TODO(asmundak):  Consider going back to sendfile() or reflink','line_number':1017,'multiline':False]
['text':' (BTRFS_IOC_CLONE/XFS_IOC_CLONE) here.  The launcher preamble can','line_number':1018,'multiline':False]
['text':' be very large for targets with many native deps.','line_number':1019,'multiline':False]
['text':' Align the file start offset at page boundary.','line_number':1038,'multiline':False]
['text':' Copy file','line_number':1062,'multiline':False]
['text':' Align the shared archive start offset at page alignment, which is','line_number':1073,'multiline':False]
['text':' required by mmap.','line_number':1074,'multiline':False]
['text':' Write the start offset of the copied content as a manifest attribute.','line_number':1078,'multiline':False]
['text':' NOLINT(runtime/int,','line_number':1082,'multiline':False]
['text':' google-runtime-int)','line_number':1083,'multiline':False]
['text':' Write the size of the copied content as a manifest attribute if the','line_number':1086,'multiline':False]
['text':' size_manifest_attr_name is not NULL.','line_number':1087,'multiline':False]
['text':' NOLINT(runtime/int,','line_number':1092,'multiline':False]
['text':' google-runtime-int)','line_number':1093,'multiline':False]
['text':' Add to build_properties.','line_number':1098,'multiline':False]
