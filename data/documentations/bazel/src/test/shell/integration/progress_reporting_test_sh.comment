['text':'!/bin/bash','line_number':1,'multiline':False]
['text':'','line_number':2,'multiline':False]
['text':' Copyright 2016 The Bazel Authors. All rights reserved.','line_number':3,'multiline':False]
['text':'','line_number':4,'multiline':False]
['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':5,'multiline':False]
['text':' you may not use this file except in compliance with the License.','line_number':6,'multiline':False]
['text':' You may obtain a copy of the License at','line_number':7,'multiline':False]
['text':'','line_number':8,'multiline':False]
['text':'    http://www.apache.org/licenses/LICENSE-2.0','line_number':9,'multiline':False]
['text':'','line_number':10,'multiline':False]
['text':' Unless required by applicable law or agreed to in writing, software','line_number':11,'multiline':False]
['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':12,'multiline':False]
['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':13,'multiline':False]
['text':' See the License for the specific language governing permissions and','line_number':14,'multiline':False]
['text':' limitations under the License.','line_number':15,'multiline':False]
['text':'','line_number':16,'multiline':False]
['text':' This test exercises action progress reporting.','line_number':17,'multiline':False]
['text':' --- begin runfiles.bash initialization ---','line_number':19,'multiline':False]
['text':' --- end runfiles.bash initialization ---','line_number':39,'multiline':False]
['text':' Run a command with a timeout, kill it if too slow or hanging.','line_number':68,'multiline':False]
['text':'','line_number':69,'multiline':False]
['text':' To avoid timing out in the case of blocking commands that never return, this','line_number':70,'multiline':False]
['text':' wrapper will start the command, wait the specified number of seconds, and','line_number':71,'multiline':False]
['text':' then kill the command and return an error. The caller can then fail the test.','line_number':72,'multiline':False]
['text':'','line_number':73,'multiline':False]
['text':' This function does not fail directly because it would have no effect if run in','line_number':74,'multiline':False]
['text':' a subshell (unless with -e).','line_number':75,'multiline':False]
['text':' kill -0 checks to see if the process is still alive. If it is, kill','line_number':82,'multiline':False]
['text':' succeeds and we sleep. If it's not, kill fails and we return.','line_number':83,'multiline':False]
['text':' A fail() here would not end the script if we are in a subshell, so the','line_number':88,'multiline':False]
['text':' caller must check the return value.','line_number':89,'multiline':False]
['text':' Do not assert exactly how much time elapsed between "Still waiting" messages','line_number':111,'multiline':False]
['text':' or even whether there were more than one at all. Just assert there was at','line_number':112,'multiline':False]
['text':' least one message.','line_number':113,'multiline':False]
['text':' Logging these messages appears to be a low priority process in bazel and','line_number':114,'multiline':False]
['text':' they are not always reported in a timely manner.','line_number':115,'multiline':False]
['text':' Make the workspace_status_command slow, so it will show up in a "Still','line_number':145,'multiline':False]
['text':' waiting" message. Do not modify the workspace status writer action','line_number':146,'multiline':False]
['text':' implementation to have a progress message, because it breaks all kinds of','line_number':147,'multiline':False]
['text':' things.','line_number':148,'multiline':False]
['text':' Wait for an event that never comes, give up after 5 seconds (exits with','line_number':151,'multiline':False]
['text':' nonzero), then "cd ." to reset %ERRORLEVEL%.','line_number':152,'multiline':False]
['text':' We expect a total of 4 actions but only 3 execution messages:','line_number':166,'multiline':False]
['text':' - the 3 genrule actions and their messages','line_number':167,'multiline':False]
['text':' - the workspace status writer action, only counted but not reported as an','line_number':168,'multiline':False]
['text':'   executed action, only as a "Still waiting" one.','line_number':169,'multiline':False]
['text':' The counter should reflect no other actions; if it does, it's probably a','line_number':170,'multiline':False]
['text':' bug.','line_number':171,'multiline':False]
['text':'','line_number':172,'multiline':False]
['text':' This used to be buggy. Prior to the bugfix the counter was accounting for 5','line_number':173,'multiline':False]
['text':' actions, the extra one being the target completion middleman. Since that's','line_number':174,'multiline':False]
['text':' not a real action that the user cares about, we don't want to count it so','line_number':175,'multiline':False]
['text':' the numbers look saner.','line_number':176,'multiline':False]
['text':' It may happen that Skyframe does not discover (enque) the workspace status','line_number':178,'multiline':False]
['text':' writer action immediately, so the counter may initially report 3 total','line_number':179,'multiline':False]
['text':' actions instead of 4.','line_number':180,'multiline':False]
['text':' It's also possible that the workspace status action is done before any other','line_number':181,'multiline':False]
['text':' action, especially in Skymeld mode.','line_number':182,'multiline':False]
['text':' No counter here since there's theoretically no guarantee that that workspace','line_number':189,'multiline':False]
['text':' status action would still be running after the above actions have finished.','line_number':190,'multiline':False]
['text':' This is especially true if we're running in Skymeld mode.','line_number':191,'multiline':False]
['text':' Open-source Bazel calls this file stable-status.txt, Google internal version','line_number':194,'multiline':False]
['text':' calls it build-info.txt.','line_number':195,'multiline':False]
['text':' DO NOT use cmd="touch $@". The genrules would produce empty files, which are','line_number':203,'multiline':False]
['text':' compared by time stamp rather than content (since they are empty), so change','line_number':204,'multiline':False]
['text':' pruning won't kick in and this test won't work.','line_number':205,'multiline':False]
['text':' Run a clean then an incremental build.','line_number':232,'multiline':False]
['text':'','line_number':233,'multiline':False]
['text':' In the first build we should see 9 actions on the right side of the action','line_number':234,'multiline':False]
['text':' counter (8 genrules + 1 workspace status writer), 8 DONE messages, the last','line_number':235,'multiline':False]
['text':' one of which should be target "x".','line_number':236,'multiline':False]
['text':'','line_number':237,'multiline':False]
['text':' In the second build, we should again see 9 actions (9 dirtied) in the','line_number':238,'multiline':False]
['text':' counter, but only two DONE actions (dep1 and x) due to change pruning.','line_number':239,'multiline':False]
['text':' The last action should again be target "x", its completion index 8 or 9 (the','line_number':240,'multiline':False]
['text':' last one might be the workspace status writer action).','line_number':241,'multiline':False]
['text':' The whole test setup relies on bazel running the actions for','line_number':285,'multiline':False]
['text':' :dep and :longrun in parallel. However, bazel normally analyzes','line_number':286,'multiline':False]
['text':' the environment and bases the action scheduling on this; so we','line_number':287,'multiline':False]
['text':' need to tell bazel to (maybe even contrafactually) believe that','line_number':288,'multiline':False]
['text':' there are enough local resources for two genrules to run in parallel.','line_number':289,'multiline':False]
['text':' Give enough head room so that the test won't break again if we tweak','line_number':290,'multiline':False]
['text':' our assumptions about local resource usage.','line_number':291,'multiline':False]
['text':' DO NOT use cmd="touch $@". The genrules would produce empty files, which are','line_number':304,'multiline':False]
['text':' compared by time stamp rather than content (since they are empty), so change','line_number':305,'multiline':False]
['text':' pruning won't kick in and this test won't work.','line_number':306,'multiline':False]
['text':' Run a clean then an incremental build.','line_number':330,'multiline':False]
['text':'','line_number':331,'multiline':False]
['text':' In the first build we should see 9 actions on the right side of the action','line_number':332,'multiline':False]
['text':' counter (8 genrules + 1 workspace status writer action), 8 DONE messages,','line_number':333,'multiline':False]
['text':' the last one of which should be target "x".','line_number':334,'multiline':False]
['text':'','line_number':335,'multiline':False]
['text':' In the second build, we should again see 9 actions (9 dirtied) in the','line_number':336,'multiline':False]
['text':' counter, but only two DONE actions (dep1 and x) due to change pruning.','line_number':337,'multiline':False]
['text':' The last action should again be target "x", its completion index 8 or 9 (the','line_number':338,'multiline':False]
['text':' last one might be the workspace status writer action).','line_number':339,'multiline':False]
['text':' Extract the numbers from the last [123 / 4,567] progress message.','line_number':373,'multiline':False]
