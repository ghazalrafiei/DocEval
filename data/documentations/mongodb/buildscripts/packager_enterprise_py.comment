['text':'!/usr/bin/env python3','line_number':1,'multiline':False]
['text':' This program makes Debian and RPM repositories for MongoDB, by','line_number':4,'multiline':False]
['text':' downloading our tarballs of statically linked executables and','line_number':5,'multiline':False]
['text':' insinuating them into Linux packages.  It must be run on a','line_number':6,'multiline':False]
['text':' Debianoid, since Debian provides tools to make RPMs, but RPM-based','line_number':7,'multiline':False]
['text':' systems don't provide debian packaging crud.','line_number':8,'multiline':False]
['text':' Notes:','line_number':10,'multiline':False]
['text':'','line_number':11,'multiline':False]
['text':' * Almost anything that you want to be able to influence about how a','line_number':12,'multiline':False]
['text':' package construction must be embedded in some file that the','line_number':13,'multiline':False]
['text':' packaging tool uses for input (e.g., debian/rules, debian/control,','line_number':14,'multiline':False]
['text':' debian/changelog; or the RPM specfile), and the precise details are','line_number':15,'multiline':False]
['text':' arbitrary and silly.  So this program generates all the relevant','line_number':16,'multiline':False]
['text':' inputs to the packaging tools.','line_number':17,'multiline':False]
['text':'','line_number':18,'multiline':False]
['text':' * Once a .deb or .rpm package is made, there's a separate layer of','line_number':19,'multiline':False]
['text':' tools that makes a "repository" for use by the apt/yum layers of','line_number':20,'multiline':False]
['text':' package tools.  The layouts of these repositories are arbitrary and','line_number':21,'multiline':False]
['text':' silly, too.','line_number':22,'multiline':False]
['text':'','line_number':23,'multiline':False]
['text':' * Before you run the program on a new host, these are the','line_number':24,'multiline':False]
['text':' prerequisites:','line_number':25,'multiline':False]
['text':'','line_number':26,'multiline':False]
['text':' apt-get install dpkg-dev rpm debhelper fakeroot ia32-libs createrepo git-core','line_number':27,'multiline':False]
['text':' echo "Now put the dist gnupg signing keys in ~root/.gnupg"','line_number':28,'multiline':False]
['text':' pylint: disable=wrong-import-position','line_number':42,'multiline':False]
['text':' The MongoDB names for the architectures we support.','line_number':44,'multiline':False]
['text':' Made up names for the flavors of distribution we package for.','line_number':47,'multiline':False]
['text':' noqa: D406,D407,D412,D413','line_number':65,'multiline':False]
['text':' Where to do all of our work. Use a randomly-created directory if one','line_number':169,'multiline':False]
['text':' is not passed in.','line_number':170,'multiline':False]
['text':' Build a package for each distro/spec/arch tuple, and','line_number':180,'multiline':False]
['text':' accumulate the repository-layout directories.','line_number':181,'multiline':False]
['text':' The setupdir will be a directory containing all inputs to the','line_number':210,'multiline':False]
['text':' distro's packaging tools (e.g., package metadata files, init','line_number':211,'multiline':False]
['text':' scripts, etc, along with the already-built binaries).  In case','line_number':212,'multiline':False]
['text':' the following format string is unclear, an example setupdir','line_number':213,'multiline':False]
['text':' would be dst/x86_64/debian-sysvinit/wheezy/mongodb-org-unstable/','line_number':214,'multiline':False]
['text':' or dst/x86_64/redhat/rhel57/mongodb-org-unstable/','line_number':215,'multiline':False]
['text':' Note: POSIX tar doesn't require support for gtar's "-C" option,','line_number':224,'multiline':False]
['text':' and Python's tarfile module prior to Python 2.7 doesn't have the','line_number':225,'multiline':False]
['text':' features to make this detail easy.  So we'll just do the dumb','line_number':226,'multiline':False]
['text':' thing and chdir into where and run tar there.','line_number':227,'multiline':False]
['text':' Note that the RPM packages get their man pages from the debian','line_number':250,'multiline':False]
['text':' directory, so the debian directory is needed in all cases (and','line_number':251,'multiline':False]
['text':' innocuous in the debianoids' sdirs).','line_number':252,'multiline':False]
['text':' get the original HEAD position of repo','line_number':256,'multiline':False]
['text':' add and commit the uncommited changes','line_number':259,'multiline':False]
['text':' only commit changes if there are any','line_number':262,'multiline':False]
['text':' original command to preserve functionality','line_number':268,'multiline':False]
['text':' FIXME: make consistent with the rest of the code when we have more packaging testing','line_number':269,'multiline':False]
['text':' FIXME: sh-dash-cee is bad. See if tarfile can do this.','line_number':270,'multiline':False]
['text':' reset branch to original state','line_number':278,'multiline':False]
['text':' Splat the binaries under sdir.  The "build" stages of the','line_number':282,'multiline':False]
['text':' packaging infrastructure will move the files to wherever they','line_number':283,'multiline':False]
['text':' need to go.','line_number':284,'multiline':False]
['text':' Note: the Debian repository Packages files must be generated','line_number':302,'multiline':False]
['text':' very carefully in order to be usable.','line_number':303,'multiline':False]
['text':' Notes: the Release{,.gpg} files must live in a special place,','line_number':320,'multiline':False]
['text':' and must be created after all the Packages.gz files have been','line_number':321,'multiline':False]
['text':' done.','line_number':322,'multiline':False]
['text':' Find all the stuff in src/*, move it to a freshly-created','line_number':348,'multiline':False]
['text':' directory beside dst, then play some games with symlinks so that','line_number':349,'multiline':False]
['text':' dst is a name the new stuff and dst+".old" names the previous','line_number':350,'multiline':False]
['text':' one.  This feels like a lot of hooey for something so trivial.','line_number':351,'multiline':False]
['text':' First, make a crispy fresh new directory to put the stuff in.','line_number':353,'multiline':False]
['text':' Put the stuff in our new directory.','line_number':369,'multiline':False]
['text':' Make a symlink to the new directory; the symlink will be renamed','line_number':373,'multiline':False]
['text':' to dst shortly.','line_number':374,'multiline':False]
['text':' as exc: # Python >2.5','line_number':381,'multiline':False]
['text':' Make a symlink to the old directory; this symlink will be','line_number':389,'multiline':False]
['text':' renamed shortly, too.','line_number':390,'multiline':False]
['text':' as exc: # Python >2.5','line_number':399,'multiline':False]
