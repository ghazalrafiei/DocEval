['text':'*
 *    Copyright (C) 2018-present MongoDB, Inc.
 *
 *    This program is free software: you can redistribute it and/or modify
 *    it under the terms of the Server Side Public License, version 1,
 *    as published by MongoDB, Inc.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    Server Side Public License for more details.
 *
 *    You should have received a copy of the Server Side Public License
 *    along with this program. If not, see
 *    <http://www.mongodb.com/licensing/server-side-public-license>.
 *
 *    As a special exception, the copyright holders give permission to link the
 *    code of portions of this program with the OpenSSL library under certain
 *    conditions as described in each individual source file and distribute
 *    linked combinations including the program with the OpenSSL library. You
 *    must comply with the Server Side Public License in all respects for
 *    all of the code used other than as permitted herein. If you modify file(s)
 *    with this exception, you may extend this exception to your version of the
 *    file(s), but you are not obligated to do so. If you do not wish to do so,
 *    delete this exception statement from your version. If you delete this
 *    exception statement from all source files in the program, then also delete
 *    it in the license file.
 ','line_number':1,'multiline':True]
['text':' IWYU pragma: keep','line_number':37,'multiline':False]
['text':' Not included in the indexSpec itself.','line_number':160,'multiline':False]
['text':' Create 'system.views' in a separate WUOW if it does not exist.','line_number':194,'multiline':False]
['text':' This must be checked before we take locks in order to avoid attempting to take multiple locks','line_number':206,'multiline':False]
['text':' on the <db>.system.views namespace: first a IX lock on 'ns' and then a X lock on the database','line_number':207,'multiline':False]
['text':' system.views collection.','line_number':208,'multiline':False]
['text':' Operations all lock system.views in the end to prevent deadlock.','line_number':217,'multiline':False]
['text':' This is a top-level handler for collection creation name conflicts. New commands coming','line_number':230,'multiline':False]
['text':' in, or commands that generated a WriteConflict must return a NamespaceExists error here','line_number':231,'multiline':False]
['text':' on conflict.','line_number':232,'multiline':False]
['text':' If the view creation rolls back, ensure that the Top entry created for the view is','line_number':257,'multiline':False]
['text':' deleted.','line_number':258,'multiline':False]
['text':' Even though 'collectionOptions' is passed by rvalue reference, it is not safe to move','line_number':264,'multiline':False]
['text':' because 'userCreateNS' may throw a WriteConflictException.','line_number':265,'multiline':False]
['text':'createIdIndex=','line_number':266,'multiline':True]
['text':'fromMigrate=','line_number':294,'multiline':True]
['text':' '$jsonSchema' : {','line_number':303,'multiline':False]
['text':'     bsonType: 'object',','line_number':304,'multiline':False]
['text':'     required: ['_id', 'control', 'data'],','line_number':305,'multiline':False]
['text':'     properties: {','line_number':306,'multiline':False]
['text':'         _id: {bsonType: 'objectId'},','line_number':307,'multiline':False]
['text':'         control: {','line_number':308,'multiline':False]
['text':'             bsonType: 'object',','line_number':309,'multiline':False]
['text':'             required: ['version', 'min', 'max'],','line_number':310,'multiline':False]
['text':'             properties: {','line_number':311,'multiline':False]
['text':'                 version: {bsonType: 'number'},','line_number':312,'multiline':False]
['text':'                 min: {','line_number':313,'multiline':False]
['text':'                     bsonType: 'object',','line_number':314,'multiline':False]
['text':'                     required: ['%s'],','line_number':315,'multiline':False]
['text':'                     properties: {'%s': {bsonType: 'date'}}','line_number':316,'multiline':False]
['text':'                 },','line_number':317,'multiline':False]
['text':'                 max: {','line_number':318,'multiline':False]
['text':'                     bsonType: 'object',','line_number':319,'multiline':False]
['text':'                     required: ['%s'],','line_number':320,'multiline':False]
['text':'                     properties: {'%s': {bsonType: 'date'}}','line_number':321,'multiline':False]
['text':'                 },','line_number':322,'multiline':False]
['text':'                 closed: {bsonType: 'bool'},','line_number':323,'multiline':False]
['text':'                 count: {bsonType: 'number', minimum: 1} // only if bucketVersion ==','line_number':324,'multiline':False]
['text':'                 timeseries::kTimeseriesControlCompressedVersion','line_number':325,'multiline':False]
['text':'             },','line_number':326,'multiline':False]
['text':'             additionalProperties: false // only if bucketVersion ==','line_number':327,'multiline':False]
['text':'             timeseries::kTimeseriesControlCompressedVersion','line_number':328,'multiline':False]
['text':'         },','line_number':329,'multiline':False]
['text':'         data: {bsonType: 'object'},','line_number':330,'multiline':False]
['text':'         meta: {}','line_number':331,'multiline':False]
['text':'     },','line_number':332,'multiline':False]
['text':'     additionalProperties: false','line_number':333,'multiline':False]
['text':'   }','line_number':334,'multiline':False]
['text':' This path should only be taken when a user creates a new time-series collection on the','line_number':420,'multiline':False]
['text':' primary. Secondaries replicate individual oplog entries.','line_number':421,'multiline':False]
['text':' Set the validator option to a JSON schema enforcing constraints on bucket documents.','line_number':436,'multiline':False]
['text':' This validation is only structural to prevent accidental corruption by users and','line_number':437,'multiline':False]
['text':' cannot cover all constraints. Leave the validationLevel and validationAction to their','line_number':438,'multiline':False]
['text':' strict/error defaults.','line_number':439,'multiline':False]
['text':' Check if there already exist a Collection on the namespace we will later create a','line_number':451,'multiline':False]
['text':' view on. We're not holding a Collection lock for this Collection so we may only check','line_number':452,'multiline':False]
['text':' if the pointer is null or not. The answer may also change at any point after this','line_number':453,'multiline':False]
['text':' call which is fine as we properly handle an orphaned bucket collection. This check is','line_number':454,'multiline':False]
['text':' just here to prevent it from being created in the common case.','line_number':455,'multiline':False]
['text':' Report the error with the user provided namespace','line_number':463,'multiline':False]
['text':' If the buckets collection and time-series view creation roll back, ensure that their','line_number':480,'multiline':False]
['text':' Top entries are deleted.','line_number':481,'multiline':False]
['text':' Prepare collection option and index spec using the provided options. In case the','line_number':488,'multiline':False]
['text':' collection already exist we use these to validate that they are the same as being','line_number':489,'multiline':False]
['text':' requested here.','line_number':490,'multiline':False]
['text':' Cluster time-series buckets collections by _id.','line_number':494,'multiline':False]
['text':' Compare CollectionOptions and eventual TTL index to see if this bucket collection','line_number':507,'multiline':False]
['text':' may be reused for this request.','line_number':508,'multiline':False]
['text':' We may have a bucket collection created with a previous version of mongod, this','line_number':513,'multiline':False]
['text':' is also OK as we do not convert bucket collections to latest version during','line_number':514,'multiline':False]
['text':' upgrade.','line_number':515,'multiline':False]
['text':' Create the buckets collection that will back the view.','line_number':532,'multiline':False]
['text':' If compatible bucket collection already exists then proceed with creating view defintion.','line_number':543,'multiline':False]
['text':' If the 'temp' flag is true, we are in the $out stage, and should return without creating the','line_number':544,'multiline':False]
['text':' view defintion.','line_number':545,'multiline':False]
['text':' This is a top-level handler for time-series creation name conflicts. New commands coming','line_number':559,'multiline':False]
['text':' in, or commands that generated a WriteConflict must return a NamespaceExists error here','line_number':560,'multiline':False]
['text':' on conflict.','line_number':561,'multiline':False]
['text':' If the buckets collection and time-series view creation roll back, ensure that their','line_number':588,'multiline':False]
['text':' Top entries are deleted.','line_number':589,'multiline':False]
['text':' Create the time-series view.','line_number':614,'multiline':False]
['text':' If a change collection is to be created, that is, the change streams are being enabled','line_number':637,'multiline':False]
['text':' for a tenant, acquire exclusive tenant lock.','line_number':638,'multiline':False]
['text':' database lock mode','line_number':641,'multiline':True]
['text':' This is a top-level handler for collection creation name conflicts. New commands coming','line_number':646,'multiline':False]
['text':' in, or commands that generated a WriteConflict must return a NamespaceExists error here','line_number':647,'multiline':False]
['text':' on conflict.','line_number':648,'multiline':False]
['text':' If the collection creation rolls back, ensure that the Top entry created for the','line_number':703,'multiline':False]
['text':' collection is deleted.','line_number':704,'multiline':False]
['text':' Even though 'collectionOptions' is passed by rvalue reference, it is not safe to move','line_number':710,'multiline':False]
['text':' because 'userCreateNS' may throw a WriteConflictException.','line_number':711,'multiline':False]
['text':'createIdIndex=','line_number':715,'multiline':True]
['text':' Capped, clustered collections differ in behavior significantly from normal','line_number':739,'multiline':False]
['text':' capped collections. Notably, they allow out-of-order insertion.','line_number':740,'multiline':False]
['text':'','line_number':741,'multiline':False]
['text':' Additionally, don't set the collection to be clustered in the default format if it','line_number':742,'multiline':False]
['text':' requires legacy format.','line_number':743,'multiline':False]
['text':'*
 * Shared part of the implementation of the createCollection versions for replicated and regular
 * collection creation.
 ','line_number':749,'multiline':True]
['text':' Skip the first cmdObj element.','line_number':760,'multiline':False]
['text':' Build options object from remaining cmdObj elements.','line_number':764,'multiline':False]
['text':' Views don't have UUIDs so it should always be parsed for command.','line_number':771,'multiline':False]
['text':' namespace','line_number':798,'multiline':False]
['text':' If a UUID is given, see if we need to rename a collection out of the way, and whether the','line_number':849,'multiline':False]
['text':' collection already exists under a different name. If so, rename it into place. As this is','line_number':850,'multiline':False]
['text':' done during replay of the oplog, the operations do not need to be atomic, just idempotent.','line_number':851,'multiline':False]
['text':' We need to do the renaming part in a separate transaction, as we cannot transactionally','line_number':852,'multiline':False]
['text':' create a database, which could result in createCollection failing if the database','line_number':853,'multiline':False]
['text':' does not yet exist.','line_number':854,'multiline':False]
['text':' In the case of oplog replay, a future command may have created or renamed a','line_number':882,'multiline':False]
['text':' collection with that same name. In that case, renaming this future collection to','line_number':883,'multiline':False]
['text':' a random temporary name is correct: once all entries are replayed no temporary','line_number':884,'multiline':False]
['text':' names will remain.','line_number':885,'multiline':False]
['text':' Conflicting on generating a unique temp collection name. Try again.','line_number':913,'multiline':False]
['text':' It is ok to log this because this doesn't happen very frequently.','line_number':917,'multiline':False]
['text':'dropTargetUUID','line_number':935,'multiline':True]
['text':'numRecords','line_number':936,'multiline':True]
['text':'markFromMigrate=','line_number':938,'multiline':True]
['text':' Re-fetch collection after commit to get a valid pointer','line_number':941,'multiline':False]
['text':' Abort any remaining index builds on the temporary collection.','line_number':951,'multiline':False]
['text':' The existing collection has been successfully moved out of the way.','line_number':958,'multiline':False]
['text':' If the collection with the requested UUID already exists, but with a different','line_number':969,'multiline':False]
['text':' name, just rename it to 'newCollName'.','line_number':970,'multiline':False]
['text':'dropTargetUUID','line_number':988,'multiline':True]
['text':'numRecords','line_number':989,'multiline':True]
['text':'markFromMigrate=','line_number':991,'multiline':True]
['text':' A new collection with the specific UUID must be created, so add the UUID to the','line_number':998,'multiline':False]
['text':' creation options. Regular user collection creation commands cannot do this.','line_number':999,'multiline':False]
['text':' system.profile will have new document inserts due to profiling. Inserts aren't supported','line_number':1018,'multiline':False]
['text':' on views.','line_number':1019,'multiline':False]
['text':' system.profile must be a simple collection since new document insertions directly work','line_number':1033,'multiline':False]
['text':' against the usual collection API. See introspect.cpp for more details.','line_number':1034,'multiline':False]
['text':' This helper is designed for user-created time-series collections on primaries. If a','line_number':1038,'multiline':False]
['text':' time-series buckets collection is created explicitly or during replication, treat this as','line_number':1039,'multiline':False]
['text':' a normal collection creation.','line_number':1040,'multiline':False]
['text':' namespace mongo','line_number':1066,'multiline':False]
