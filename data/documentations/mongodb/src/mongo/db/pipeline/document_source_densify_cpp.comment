['text':'*
 *    Copyright (C) 2021-present MongoDB, Inc.
 *
 *    This program is free software: you can redistribute it and/or modify
 *    it under the terms of the Server Side Public License, version 1,
 *    as published by MongoDB, Inc.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    Server Side Public License for more details.
 *
 *    You should have received a copy of the Server Side Public License
 *    along with this program. If not, see
 *    <http://www.mongodb.com/licensing/server-side-public-license>.
 *
 *    As a special exception, the copyright holders give permission to link the
 *    code of portions of this program with the OpenSSL library under certain
 *    conditions as described in each individual source file and distribute
 *    linked combinations including the program with the OpenSSL library. You
 *    must comply with the Server Side Public License in all respects for
 *    all of the code used other than as permitted herein. If you modify file(s)
 *    with this exception, you may extend this exception to your version of the
 *    file(s), but you are not obligated to do so. If you do not wish to do so,
 *    delete this exception statement from your version. If you delete this
 *    exception statement from all source files in the program, then also delete
 *    it in the license file.
 ','line_number':1,'multiline':True]
['text':' IWYU pragma: keep','line_number':52,'multiline':False]
['text':' If these values are types of different sizes, output type may not be','line_number':102,'multiline':False]
['text':' intuitive.','line_number':103,'multiline':False]
['text':' Add partition fields to sort spec.','line_number':194,'multiline':False]
['text':' We do not add partitions to the sort spec if the range is "full".','line_number':196,'multiline':False]
['text':' Add field path to sort spec if it is not yet in the sort spec.','line_number':205,'multiline':False]
['text':' If we're creating an internal stage then we must not desugar and produce a sort stage in','line_number':225,'multiline':False]
['text':' addition.','line_number':226,'multiline':False]
['text':' Constructing resulting stages.','line_number':229,'multiline':False]
['text':' Constructing resulting stages.','line_number':233,'multiline':False]
['text':' namespace document_source_densify','line_number':239,'multiline':False]
['text':' Traverse the preserved fields document to make sure we're not going through an array.','line_number':263,'multiline':False]
['text':' Can't write to a field that has a non-object value as a path-prefix, as that would','line_number':272,'multiline':False]
['text':' overwrite data. We should only have a non-object at the end of the path.','line_number':273,'multiline':False]
['text':' Extra checks for date step + unit.','line_number':293,'multiline':False]
['text':' If _finalDoc is boost::none we can't be in this state.','line_number':311,'multiline':False]
['text':' Assume all types have been checked at this point and we are in a valid state.','line_number':315,'multiline':False]
['text':' Once we have hit an EOF, if the last seen value (_current) plus the step is greater','line_number':340,'multiline':False]
['text':' than or equal to the rangeMax, that means we have finished densifying','line_number':341,'multiline':False]
['text':' over the explicit range so we just return an EOF. Otherwise, we finish','line_number':342,'multiline':False]
['text':' densifying over the rest of the range.','line_number':343,'multiline':False]
['text':' We've seen no documents yet.','line_number':345,'multiline':False]
['text':' All the documents we saw were below the explicit range, so _current is below the range.','line_number':353,'multiline':False]
['text':' Densification starts at the first bounds, so _current is no longer relevant.','line_number':354,'multiline':False]
['text':' _current is somewhere in the middle of the range.','line_number':364,'multiline':False]
['text':' If we are above the range, there must be more left to densify.','line_number':384,'multiline':False]
['text':' Otherwise the state would be kDoneDensify and this function would not be reached.','line_number':385,'multiline':False]
['text':' _current is the last seen value, don't generate it again.','line_number':389,'multiline':False]
['text':' If val is the next value to be generated, just return it.','line_number':392,'multiline':False]
['text':' If the doc generator is done it will be deleted and the state will be kNeedGen.','line_number':409,'multiline':False]
['text':' For the first document in a partition, '_current' is the minimum value - step.','line_number':419,'multiline':False]
['text':'* Checks if the generator is done, changes states accordingly. ','line_number':446,'multiline':True]
['text':' We've already seen the stored value, we want to start generating on the next','line_number':482,'multiline':False]
['text':' one.','line_number':483,'multiline':False]
['text':' If the valToGenerate is > max seen, skip this partition. It is done.','line_number':485,'multiline':False]
['text':' If the valToGenerate is < 'minOverride', use the override instead.','line_number':490,'multiline':False]
['text':' final doc.','line_number':498,'multiline':False]
['text':' Remove this partition from the table, we're done with it.','line_number':500,'multiline':False]
['text':' If the partition map is empty, we're done.','line_number':514,'multiline':False]
['text':' Densify between partitions's last seen value and global max.','line_number':522,'multiline':False]
['text':' Partition bounds don't do any extra work after EOF;','line_number':530,'multiline':False]
['text':' Densify between partitions's last seen value and global max. Use the override for','line_number':535,'multiline':False]
['text':' the global min.','line_number':536,'multiline':False]
['text':' We have already densified up to the last document in each','line_number':554,'multiline':False]
['text':' partition.','line_number':555,'multiline':False]
['text':' If the current value is the next value to be generated, save it as the current (last seen)','line_number':574,'multiline':False]
['text':' value.','line_number':575,'multiline':False]
['text':' If we don't need to create a generator (no intervening documents to generate before','line_number':580,'multiline':False]
['text':' outputting currentDoc), then don't create a generator or update _current.','line_number':581,'multiline':False]
['text':' Falling through the above conditions means the currentDoc is strictly greater than the last','line_number':586,'multiline':False]
['text':' seen document plus the step value.','line_number':587,'multiline':False]
['text':' Documents generated by the generator are always on the step.','line_number':603,'multiline':False]
['text':' If we are partitioned, save the most recent doc.','line_number':605,'multiline':False]
['text':' If we are partitioning other partitions may still need to densify.','line_number':631,'multiline':False]
['text':' Initialize _partitionExpr from _partitions.','line_number':681,'multiline':False]
['text':' We check whether there is anything in _partitions during parsing.','line_number':683,'multiline':False]
['text':' When we return a generated document '_docsGenerated' is incremented. Check that the last','line_number':698,'multiline':False]
['text':' document didn't put us over the limit.','line_number':699,'multiline':False]
['text':' This state represents the first run of doGetNext() or that the value that we last','line_number':708,'multiline':False]
['text':' pulled is below the range.','line_number':709,'multiline':False]
['text':' The densify field is not present or null, let document pass unmodified.','line_number':721,'multiline':False]
['text':' If we have partitions specified, setup the partition expression and table.','line_number':727,'multiline':False]
['text':' The densify field is not present or null, let document pass unmodified.','line_number':765,'multiline':False]
['text':' Keep track of '_globalMax' for later. The latest','line_number':773,'multiline':False]
['text':' document from the source is always the max.','line_number':774,'multiline':False]
['text':' If we haven't seen this partition before, densify','line_number':776,'multiline':False]
['text':' between','line_number':777,'multiline':False]
['text':' '_globalMin' and this value.','line_number':778,'multiline':False]
['text':' _current represents the last value seen. We want to','line_number':782,'multiline':False]
['text':' generate _globalMin, so pretend we've seen the','line_number':783,'multiline':False]
['text':' value before that.','line_number':784,'multiline':False]
['text':' Insert the new partition into the table.','line_number':786,'multiline':False]
['text':' Otherwise densify between the last seen value and this','line_number':790,'multiline':False]
['text':' one.','line_number':791,'multiline':False]
['text':' If we haven't seen this partition before, add it to the','line_number':797,'multiline':False]
['text':' table then return.','line_number':798,'multiline':False]
['text':' Reset current to be the last value in this partition.','line_number':805,'multiline':False]
['text':' If we haven't seen this partition before, add it to the','line_number':811,'multiline':False]
['text':' table then check where it is in the range.','line_number':812,'multiline':False]
['text':' This partition has seen no values.','line_number':817,'multiline':False]
['text':' Otherwise reset current to be the last value in this','line_number':821,'multiline':False]
['text':' partition.','line_number':822,'multiline':False]
['text':' The generator's final document may not be on the','line_number':846,'multiline':False]
['text':' step.','line_number':847,'multiline':False]
['text':' The generator's final document may not be on the','line_number':860,'multiline':False]
['text':' step.','line_number':861,'multiline':False]
['text':' Only want to update the rangeMin if the value -','line_number':871,'multiline':False]
['text':' current is divisible by the step.','line_number':872,'multiline':False]
['text':' In the full range, this should only return EOF.','line_number':889,'multiline':False]
['text':' In the explicit range we finish densifying over the range and any remaining documents','line_number':890,'multiline':False]
['text':' is passed to the next stage.','line_number':891,'multiline':False]
['text':' namespace mongo','line_number':903,'multiline':False]
['text':' Months, quarters and years have variable lengths depending on leap days','line_number':947,'multiline':False]
['text':' and days-in-a-month, so a step is not a constant number of milliseconds','line_number':948,'multiline':False]
['text':' across all dates. For these units, we need to iterate through rather','line_number':949,'multiline':False]
['text':' than performing a calculation with modulo. As long as `baseDate` is not','line_number':950,'multiline':False]
['text':' a large number of steps away from the value we're testing (as is true in','line_number':951,'multiline':False]
['text':' our usage with _current as the base), this should not be a performance','line_number':952,'multiline':False]
['text':' issue.','line_number':953,'multiline':False]
['text':' Steps with units smaller than one month are always constant sized','line_number':963,'multiline':False]
['text':' (because unix time does not have leap seconds), so we can perform','line_number':964,'multiline':False]
['text':' modulo arithmetic.','line_number':965,'multiline':False]
['text':' We can only combine the sorts if we can guarantee the output order will maintain the','line_number':984,'multiline':False]
['text':' sort. Densify changes the sort order if partitions are present and range is type 'full'.','line_number':985,'multiline':False]
['text':' We will not maintain sort order.','line_number':987,'multiline':False]
['text':' If $densify was the first stage in the pipeline, there should be a preceding sort.','line_number':991,'multiline':False]
['text':' Get the spec of the preceding sort stage. Densify always has a preceding sort, unless','line_number':993,'multiline':False]
['text':' the preceding sort was already removed by an earlier stage.','line_number':994,'multiline':False]
['text':' Check that the preceding sort was actually generated by $densify, and not by combining the','line_number':1001,'multiline':False]
['text':' generated sort with a sort earlier in the pipeline.','line_number':1002,'multiline':False]
['text':' Get the spec of the following sort stage, if it exists.','line_number':1011,'multiline':False]
['text':' If there is not a following sort stage, we won't do any optimization. Return the next','line_number':1015,'multiline':False]
['text':' stage in the pipeline.','line_number':1016,'multiline':False]
['text':' We can only combine the sorts if the sorts are compatible. $densify only preserves a sort on','line_number':1021,'multiline':False]
['text':' the fields on which it operates, as any other fields will be missing in generated documents.','line_number':1022,'multiline':False]
['text':' If the post sort is longer, we would have bailed earlier. Remove the sort after the $densify.','line_number':1027,'multiline':False]
['text':' namespace mongo','line_number':1039,'multiline':False]
