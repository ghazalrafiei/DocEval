['text':'*
 *    Copyright (C) 2020-present MongoDB, Inc.
 *
 *    This program is free software: you can redistribute it and/or modify
 *    it under the terms of the Server Side Public License, version 1,
 *    as published by MongoDB, Inc.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    Server Side Public License for more details.
 *
 *    You should have received a copy of the Server Side Public License
 *    along with this program. If not, see
 *    <http://www.mongodb.com/licensing/server-side-public-license>.
 *
 *    As a special exception, the copyright holders give permission to link the
 *    code of portions of this program with the OpenSSL library under certain
 *    conditions as described in each individual source file and distribute
 *    linked combinations including the program with the OpenSSL library. You
 *    must comply with the Server Side Public License in all respects for
 *    all of the code used other than as permitted herein. If you modify file(s)
 *    with this exception, you may extend this exception to your version of the
 *    file(s), but you are not obligated to do so. If you do not wish to do so,
 *    delete this exception statement from your version. If you delete this
 *    exception statement from all source files in the program, then also delete
 *    it in the license file.
 ','line_number':1,'multiline':True]
['text':' Insert the new coordinator document.','line_number':270,'multiline':False]
['text':' Remove the coordinator document.','line_number':275,'multiline':False]
['text':' query','line_number':278,'multiline':False]
['text':' multi','line_number':279,'multiline':False]
['text':' Partially update the coordinator document.','line_number':282,'multiline':False]
['text':' Always update the state field.','line_number':287,'multiline':False]
['text':' If the cloneTimestamp exists, include it in the update.','line_number':292,'multiline':False]
['text':' If the abortReason exists, include it in the update.','line_number':298,'multiline':False]
['text':' If the approxBytesToCopy exists, include it in the update.','line_number':304,'multiline':False]
['text':' If the approxDocumentsToCopy exists, include it in the update.','line_number':311,'multiline':False]
['text':' If the quiescePeriodEnd exists, include it in the update.','line_number':318,'multiline':False]
['text':' upsert','line_number':336,'multiline':False]
['text':' multi','line_number':337,'multiline':False]
['text':' When moving from quiescing to done, we don't have metrics available.','line_number':354,'multiline':False]
['text':'*
 * Creates reshardingFields.recipientFields for the resharding operation. Note: these should not
 * change once the operation has begun.
 ','line_number':361,'multiline':True]
['text':' Append 'reshardingFields' to the config.collections entry for the original nss','line_number':397,'multiline':False]
['text':' Update the config.collections entry for the original nss to reflect the new sharded','line_number':439,'multiline':False]
['text':' collection. Set 'uuid' to the reshardingUUID, 'key' to the new shard key,','line_number':440,'multiline':False]
['text':' 'lastmodEpoch' to newCollectionEpoch, and 'timestamp' to newCollectionTimestamp. Also','line_number':441,'multiline':False]
['text':' update the 'state' field and add the 'recipientFields' to the 'reshardingFields'','line_number':442,'multiline':False]
['text':' section.','line_number':443,'multiline':False]
['text':' Remove 'reshardingFields' from the config.collections entry','line_number':471,'multiline':False]
['text':' Update the 'state' field, and 'abortReason' field if it exists, in the','line_number':479,'multiline':False]
['text':' 'reshardingFields' section.','line_number':480,'multiline':False]
['text':' If the abortReason exists, include it in the update.','line_number':491,'multiline':False]
['text':' query','line_number':525,'multiline':False]
['text':' upsert','line_number':527,'multiline':False]
['text':' multi','line_number':528,'multiline':False]
['text':' expected ','line_number':534,'multiline':True]
['text':' Insert new entry for the temporary nss into config.collections','line_number':548,'multiline':False]
['text':' Update the 'state', 'donorShards', 'approxCopySize', and 'cloneTimestamp' fields','line_number':559,'multiline':False]
['text':' in the 'reshardingFields.recipient' section','line_number':560,'multiline':False]
['text':' upsert','line_number':587,'multiline':False]
['text':' multi','line_number':588,'multiline':False]
['text':' Remove the entry for the temporary nss','line_number':592,'multiline':False]
['text':' multi','line_number':598,'multiline':False]
['text':' Update the 'state' field, and 'abortReason' field if it exists, in the','line_number':601,'multiline':False]
['text':' 'reshardingFields' section.','line_number':602,'multiline':False]
['text':' upsert','line_number':627,'multiline':False]
['text':' multi','line_number':628,'multiline':False]
['text':' TODO SERVER-73304: add the new index collection UUID here if neccessary.','line_number':665,'multiline':False]
['text':' multi','line_number':684,'multiline':False]
['text':' multi','line_number':696,'multiline':False]
['text':' Insert new initial chunk documents for temp nss','line_number':733,'multiline':False]
['text':' Remove tag documents with the specified tagsQuery.','line_number':748,'multiline':False]
['text':' query','line_number':754,'multiline':False]
['text':' multi','line_number':755,'multiline':False]
['text':' hint','line_number':756,'multiline':False]
['text':' Requires that there be no session information on the opCtx.','line_number':761,'multiline':False]
['text':' Remove all chunk documents and specified tag documents.','line_number':765,'multiline':False]
['text':'*
 * Executes metadata changes in a transaction without bumping the collection placement version.
 ','line_number':774,'multiline':True]
['text':' namespace','line_number':801,'multiline':False]
['text':' Remove all chunk documents for the specified collUUID. We do not know how many chunk docs','line_number':841,'multiline':False]
['text':' currently exist, so cannot pass a value for expectedNumModified','line_number':842,'multiline':False]
['text':' No need to bump originalNss version because its epoch will be changed.','line_number':858,'multiline':False]
['text':' Update the config.reshardingOperations entry','line_number':867,'multiline':False]
['text':' Copy the original indexes to the temporary uuid.','line_number':870,'multiline':False]
['text':' Remove the config.collections entry for the temporary collection','line_number':873,'multiline':False]
['text':' Update the config.collections entry for the original namespace to reflect the new','line_number':882,'multiline':False]
['text':' shard key, new epoch, and new UUID','line_number':883,'multiline':False]
['text':' Insert the list of recipient shard IDs (together with the new timestamp and UUID) as','line_number':891,'multiline':False]
['text':' the latest entry in config.placementHistory about the original namespace','line_number':892,'multiline':False]
['text':' Delete all of the config.tags entries for the user collection namespace.','line_number':899,'multiline':False]
['text':' Update all of the config.tags entries for the temporary resharding namespace','line_number':904,'multiline':False]
['text':' to refer to the user collection namespace.','line_number':905,'multiline':False]
['text':' query','line_number':918,'multiline':False]
['text':' update','line_number':921,'multiline':False]
['text':' upsert','line_number':922,'multiline':False]
['text':' multi','line_number':923,'multiline':False]
['text':' hint','line_number':924,'multiline':False]
['text':' Update the 'ns' field to be the original collection namespace for all tags documents that','line_number':927,'multiline':False]
['text':' currently have 'ns' as the temporary collection namespace.','line_number':928,'multiline':False]
['text':' Insert the coordinator document to config.reshardingOperations.','line_number':958,'multiline':False]
['text':' Update the config.collections entry for the original collection to include','line_number':962,'multiline':False]
['text':' 'reshardingFields'','line_number':963,'multiline':False]
['text':' Insert the config.collections entry for the temporary resharding collection. The','line_number':988,'multiline':False]
['text':' chunks all have the same epoch, so picking the last chunk here is arbitrary.','line_number':989,'multiline':False]
['text':' Copy the original indexes to the temporary uuid.','line_number':999,'multiline':False]
['text':' Update on-disk state to reflect latest state transition.','line_number':1001,'multiline':False]
['text':' Run updates to config.reshardingOperations and config.collections in a transaction','line_number':1013,'multiline':False]
['text':' Update the config.reshardingOperations entry','line_number':1026,'multiline':False]
['text':' Update the config.collections entry for the original collection','line_number':1029,'multiline':False]
['text':' Update the config.collections entry for the temporary resharding collection. If','line_number':1033,'multiline':False]
['text':' we've already successfully committed that the operation will succeed, we've','line_number':1034,'multiline':False]
['text':' removed the entry for the temporary collection and updated the entry with','line_number':1035,'multiline':False]
['text':' original namespace to have the new shard key, UUID, and epoch','line_number':1036,'multiline':False]
['text':' Copy the original indexes to the temporary uuid.','line_number':1046,'multiline':False]
['text':' If the coordinator needs to abort and isn't in kInitializing, additional collections need to','line_number':1058,'multiline':False]
['text':' be cleaned up in the final transaction. Otherwise, cleanup for abort and success are the','line_number':1059,'multiline':False]
['text':' same.','line_number':1060,'multiline':False]
['text':' If a user resharding ID was provided, move the coordinator doc to "quiesced" rather than','line_number':1070,'multiline':False]
['text':' "done".','line_number':1071,'multiline':False]
['text':' Once the decision has been persisted, the coordinator would have modified the','line_number':1084,'multiline':False]
['text':' config.chunks and config.collections entry. This means that the UUID of the','line_number':1085,'multiline':False]
['text':' non-temp collection is now the UUID of what was previously the UUID of the temp','line_number':1086,'multiline':False]
['text':' collection. So don't try to call remove as it will end up removing the metadata','line_number':1087,'multiline':False]
['text':' for the real collection.','line_number':1088,'multiline':False]
['text':' Remove entry for this resharding operation from config.reshardingOperations','line_number':1105,'multiline':False]
['text':' Remove the resharding fields from the config.collections entry','line_number':1108,'multiline':False]
['text':' namespace resharding','line_number':1117,'multiline':False]
['text':' The database primary must always be a recipient to ensure it ends up with consistent','line_number':1197,'multiline':False]
['text':' collection metadata.','line_number':1198,'multiline':False]
['text':' Use the provided shardIds from presetReshardedChunks to construct the','line_number':1204,'multiline':False]
['text':' recipient list.','line_number':1205,'multiline':False]
['text':' If shardDistribution is specified with min/max, use ShardDistributionSplitPolicy.','line_number':1240,'multiline':False]
['text':' If shardDistribution is specified with min/max, create chunks based on the shard','line_number':1252,'multiline':False]
['text':' min/max. If not, do sampling based split on limited shards.','line_number':1253,'multiline':False]
['text':'availableShardIds','line_number':1278,'multiline':True]
['text':' Note: The resharding initial split policy doesn't care about what is the real','line_number':1279,'multiline':False]
['text':' primary shard, so just pass in a random shard.','line_number':1280,'multiline':False]
['text':' Instances which have already completed do not conflict with other instances, unless','line_number':1322,'multiline':False]
['text':' their user resharding UUIDs are the same.','line_number':1323,'multiline':False]
['text':' For resharding commands with no UUID provided by the user, we will re-connect to an','line_number':1337,'multiline':False]
['text':' instance with the same NS and resharding key, if that instance was originally started','line_number':1338,'multiline':False]
['text':' with no user-provided UUID. If a UUID is provided by the user, we will connect only','line_number':1339,'multiline':False]
['text':' to the original instance.','line_number':1340,'multiline':False]
['text':' We don't need a unique index on "active" any more since','line_number':1394,'multiline':False]
['text':' checkIfConflictsWithOtherInstances was implemented, and once we allow quiesced','line_number':1395,'multiline':False]
['text':' instances it breaks them, so don't create it.','line_number':1396,'multiline':False]
['text':'','line_number':1397,'multiline':False]
['text':' TODO(SERVER-67712): We create the collection only to make index creation during','line_number':1398,'multiline':False]
['text':' downgrade simpler, so we can remove all of this initialization when the flag is','line_number':1399,'multiline':False]
['text':' removed.','line_number':1400,'multiline':False]
['text':' skip quiesce period ','line_number':1431,'multiline':True]
['text':' If the coordinator is recovering from step-up, make sure to properly initialize the','line_number':1461,'multiline':False]
['text':' promises to reflect the latest state of this resharding operation.','line_number':1462,'multiline':False]
['text':' Ensure the flushes to create participant state machines don't get','line_number':1551,'multiline':False]
['text':' interrupted upon abort.','line_number':1552,'multiline':False]
['text':' Swap back to using operation contexts canceled upon abort until ready to','line_number':1563,'multiline':False]
['text':' persist the decision or unrecoverable error.','line_number':1564,'multiline':False]
['text':' Regardless of error or non-error, guarantee that once the coordinator','line_number':1606,'multiline':False]
['text':' completes its transition to kPreparingToDonate, participants are aware of','line_number':1607,'multiline':False]
['text':' the resharding operation and their state machines are created.','line_number':1608,'multiline':False]
['text':' If the abort cancellation token was triggered, implying that a user ran the abort','line_number':1622,'multiline':False]
['text':' command, override status with a resharding abort error.','line_number':1623,'multiline':False]
['text':'','line_number':1624,'multiline':False]
['text':' Note for debugging purposes: Ensure the original error status is recorded in the','line_number':1625,'multiline':False]
['text':' logs before replacing it.','line_number':1626,'multiline':False]
['text':' Allow abort to continue except when stepped down.','line_number':1637,'multiline':False]
['text':' If we're already quiesced here it means we failed over and need to preserve the','line_number':1640,'multiline':False]
['text':' original abort reason.','line_number':1641,'multiline':False]
['text':' We must return status here, not _originalReshardingStatus, because the latter','line_number':1651,'multiline':False]
['text':' may be Status::OK() and not abort the future flow.','line_number':1652,'multiline':False]
['text':' If the abort cancellation token was triggered, implying that a user ran the abort','line_number':1712,'multiline':False]
['text':' command, override status with a resharding abort error.','line_number':1713,'multiline':False]
['text':' Best-effort attempt to trigger a refresh on the participant shards','line_number':1782,'multiline':False]
['text':' so they see the collection metadata without reshardingFields and','line_number':1783,'multiline':False]
['text':' no longer throw ReshardCollectionInProgress. There is no guarantee','line_number':1784,'multiline':False]
['text':' this logic ever runs if the config server primary steps down after','line_number':1785,'multiline':False]
['text':' having removed the coordinator state document.','line_number':1786,'multiline':False]
['text':' metrics have already been freed ','line_number':1881,'multiline':True]
['text':' No quiesce period is required.','line_number':1899,'multiline':False]
['text':' reportStatus is the status reported back to the caller, which may be','line_number':1928,'multiline':False]
['text':' different than the status if we interrupted the future chain because the','line_number':1929,'multiline':False]
['text':' resharding was already completed on a previous primary.','line_number':1930,'multiline':False]
['text':' Wait for the commit monitor to halt. We ignore any ignores because the','line_number':1955,'multiline':False]
['text':' ReshardingCoordinator instance is already exiting at this point.','line_number':1956,'multiline':False]
['text':' Destroy metrics early so its lifetime will not be tied to the lifetime of this','line_number':1968,'multiline':False]
['text':' state machine. This is because we have future callbacks copy shared pointers to this','line_number':1969,'multiline':False]
['text':' state machine that causes it to live longer than expected and potentially overlap','line_number':1970,'multiline':False]
['text':' with a newer instance when stepping up. The commit monitor also has a shared pointer','line_number':1971,'multiline':False]
['text':' to the metrics, so release this as well.','line_number':1972,'multiline':False]
['text':' Notify metrics as the operation is now complete for external observers.','line_number':2001,'multiline':False]
['text':' The temporary collection and its corresponding entries were never created. Only','line_number':2004,'multiline':False]
['text':' the coordinator document and reshardingFields require cleanup.','line_number':2005,'multiline':False]
['text':' Return back original status.','line_number':2017,'multiline':False]
['text':' Participants should never be waited upon to complete the abort if they were never made aware','line_number':2023,'multiline':False]
['text':' of the resharding operation (the coordinator flushing its state change to','line_number':2024,'multiline':False]
['text':' kPreparingToDonate).','line_number':2025,'multiline':False]
['text':' The coordinator only transitions into kAborting if there are','line_number':2032,'multiline':False]
['text':' participants to wait on before transitioning to kDone.','line_number':2033,'multiline':False]
['text':' Wait for all participants to acknowledge the operation reached an','line_number':2048,'multiline':False]
['text':' unrecoverable error.','line_number':2049,'multiline':False]
['text':' Return back the original status.','line_number':2063,'multiline':False]
['text':' We only check for redundancy when the resharding op first starts as it would be unsafe to','line_number':2121,'multiline':False]
['text':' skip the remainder of the cleanup for the resharding operation if there was a primary','line_number':2122,'multiline':False]
['text':' failover after the CoordinatorStateEnum::kCommitting state had been reached.','line_number':2123,'multiline':False]
['text':' Ensure indexes are loaded in the catalog cache, along with the collection','line_number':2133,'multiline':False]
['text':' placement.','line_number':2134,'multiline':False]
['text':' Verify if the moveCollection is redundant by checking if the operation is','line_number':2153,'multiline':False]
['text':' attempting to move to the same shard.','line_number':2154,'multiline':False]
['text':' Verify if there is any work to be done by the resharding operation by checking','line_number':2163,'multiline':False]
['text':' if the existing shard key matches the desired new shard key.','line_number':2164,'multiline':False]
['text':' If forceRedistribution is true, still do resharding.','line_number':2168,'multiline':False]
['text':' If this is not forced same-key resharding, set forceRedistribution to false so','line_number':2174,'multiline':False]
['text':' we can identify forced same-key resharding by this field later.','line_number':2175,'multiline':False]
['text':' If the abort cancellation token was triggered, implying that a user ran the','line_number':2189,'multiline':False]
['text':' abort command, override status with a resharding abort error.','line_number':2190,'multiline':False]
['text':'','line_number':2191,'multiline':False]
['text':' Note for debugging purposes: Ensure the original error status is recorded in','line_number':2192,'multiline':False]
['text':' the logs before replacing it.','line_number':2193,'multiline':False]
['text':' Force future chain to enter onError flow','line_number':2209,'multiline':False]
['text':' Note: don't put blocking or interruptible code in this block.','line_number':2226,'multiline':False]
['text':' We need to call setIsSameKeyResharding first so the metrics can count same key resharding','line_number':2230,'multiline':False]
['text':' correctly.','line_number':2231,'multiline':False]
['text':' If zones is not provided by the user, we should use the existing zones for','line_number':2246,'multiline':False]
['text':' this resharding operation.','line_number':2247,'multiline':False]
['text':' Remove the presetReshardedChunks and zones from the coordinator document to reduce','line_number':2262,'multiline':False]
['text':' the possibility of the document reaching the BSONObj size constraint.','line_number':2263,'multiline':False]
['text':' Compute the aggregate for the number of documents and bytes to copy.','line_number':2303,'multiline':False]
['text':' Calculate the approximate number of documents and bytes that each recipient will clone.','line_number':2315,'multiline':False]
['text':' The _reshardingCoordinatorObserver->awaitAllRecipientsInStrictConsistency() future is','line_number':2402,'multiline':False]
['text':' used for reporting recipient shard errors encountered during the Applying phase and','line_number':2403,'multiline':False]
['text':' in turn aborting the resharding operation.','line_number':2404,'multiline':False]
['text':' For all other cases, the _canEnterCritical.getFuture() resolves first and the','line_number':2405,'multiline':False]
['text':' operation can then proceed to entering the critical section depending on the status','line_number':2406,'multiline':False]
['text':' returned.','line_number':2407,'multiline':False]
['text':' If in recovery, just return the existing _stateDoc.','line_number':2467,'multiline':False]
['text':' The new epoch and timestamp to use for the resharded collection to indicate that the','line_number':2490,'multiline':False]
['text':' collection is a new incarnation of the namespace','line_number':2491,'multiline':False]
['text':' Retrieve the exact placement of the resharded collection from the routing table.','line_number':2501,'multiline':False]
['text':' The 'recipientShards' field of the coordinator doc cannot be used for this purpose as it','line_number':2502,'multiline':False]
['text':' always includes the primary shard for the parent database (even when it doesn't own any chunk','line_number':2503,'multiline':False]
['text':' under the new key pattern).','line_number':2504,'multiline':False]
['text':' Update the in memory state','line_number':2532,'multiline':False]
['text':' In case the recipient is running a legacy binary, swallow the error.','line_number':2558,'multiline':False]
['text':' We only allow the stepdown token to cancel operations after progressing past','line_number':2584,'multiline':False]
['text':' kCommitting.','line_number':2585,'multiline':False]
['text':' (SERVER-54231) Ensure every catalog entry referring the source uuid is','line_number':2599,'multiline':False]
['text':' cleared out on every shard.','line_number':2600,'multiline':False]
['text':' Notify metrics as the operation is now complete for external observers.','line_number':2620,'multiline':False]
['text':' Build new state doc for coordinator state update','line_number':2633,'multiline':False]
['text':' Update in-memory coordinator doc','line_number':2644,'multiline':False]
['text':' Update in-memory coordinator doc.','line_number':2653,'multiline':False]
['text':' Refresh the temporary namespace if the coordinator is in a state prior to 'kCommitting'.','line_number':2722,'multiline':False]
['text':' A refresh of recipients while in 'kCommitting' should be accompanied by a refresh of','line_number':2723,'multiline':False]
['text':' all participants for the original namespace to ensure correctness.','line_number':2724,'multiline':False]
['text':' namespace mongo','line_number':2885,'multiline':False]
