['text':'*
 * Tests that when RBAC (Role-Based Access Control) is enabled on the cluster, then the user of the
 * root role can issue 'find', 'insert', 'update', 'remove' commands on the
 * 'config.system.change_collection' collection.
 * @tags: [
 *  featureFlagServerlessChangeStreams,
 *  featureFlagSecurityToken,
 *  assumes_read_preference_unchanged,
 *  requires_replication,
 *  requires_fcv_62,
 * ]
 ','line_number':1,'multiline':True]
['text':' Start a replica-set test with one-node and authentication enabled.','line_number':20,'multiline':False]
['text':' A dictionary of users against which authorization of change collection will be verified.','line_number':41,'multiline':False]
['text':' The format of dictionary is:','line_number':42,'multiline':False]
['text':'   <key>: user-name,','line_number':43,'multiline':False]
['text':'   <value>:','line_number':44,'multiline':False]
['text':'     'isTenantUser': Tenant users will authenticate with a SecurityToken.','line_number':45,'multiline':False]
['text':'     'db': Authentication db for the user.','line_number':46,'multiline':False]
['text':'     'roles': Roles assigned to the user.','line_number':47,'multiline':False]
['text':'     'privileges': Privileges assigned to the user (a role with those privileges will be created).','line_number':48,'multiline':False]
['text':'     'testPrivileges': Which privileges we should expect to have when performing tests.','line_number':49,'multiline':False]
['text':' Helper to authenticate and login the user on the provided connection.','line_number':125,'multiline':False]
['text':' User is not attached to a tenant -> use good old auth() on primary.','line_number':130,'multiline':False]
['text':' Otherwise, authenticate using a Security Token (on db: '$external').','line_number':136,'multiline':False]
['text':' Helper to create users from the 'users' dictionary on the provided connection.','line_number':147,'multiline':False]
['text':' A user-creation will happen by 'root' user. If 'userName' is not 'root', then login first','line_number':150,'multiline':False]
['text':' as 'root'.','line_number':151,'multiline':False]
['text':' Must be authenticated as a user with ActionType::useTenant in order to use '$tenant'.','line_number':159,'multiline':False]
['text':' If we have to set privileges for the user, then create first a role with those','line_number':163,'multiline':False]
['text':' privileges, and add it to the user roles.','line_number':164,'multiline':False]
['text':' Verify that the user has been created by logging-in and then logging out.','line_number':180,'multiline':False]
['text':' Create the list of users on the specified connection.','line_number':185,'multiline':False]
['text':' 'root' user will be created first, as it will be used to authenticate to create the remaining','line_number':186,'multiline':False]
['text':' users.','line_number':187,'multiline':False]
['text':' Helper to verify if the logged-in user is authorized to invoke 'actionFunc'.','line_number':196,'multiline':False]
['text':' The parameter 'isAuthorized' determines if the authorization should pass or fail.','line_number':197,'multiline':False]
['text':' Verify if the authorization is expected to pass.','line_number':202,'multiline':False]
['text':' Verify if the authorization is expected to fail.','line_number':205,'multiline':False]
['text':' Verify that the authorization failed with the expected error code.','line_number':208,'multiline':False]
['text':' Helper to verify if the logged-in user is authorized to issue 'find' command.','line_number':218,'multiline':False]
['text':' The parameter 'authDb' is the authentication db for the user, and 'numDocs' determines the','line_number':219,'multiline':False]
['text':' least number of documents to be retrieved.','line_number':220,'multiline':False]
['text':' Helper to verify if the logged-in user is authorized to issue 'insert' command.','line_number':228,'multiline':False]
['text':' The parameter 'authDb' is the authentication db for the user.','line_number':229,'multiline':False]
['text':' numDocs ','line_number':234,'multiline':True]
['text':' Helper to verify if the logged-in user is authorized to issue 'update' command.','line_number':237,'multiline':False]
['text':' The parameter 'authDb' is the authentication db for the user.','line_number':238,'multiline':False]
['text':' numDocs ','line_number':243,'multiline':True]
['text':' Helper to verify if the logged-in user is authorized to issue 'remove' command.','line_number':246,'multiline':False]
['text':' The parameter 'authDb' is the authentication db for the user.','line_number':247,'multiline':False]
['text':' numDocs ','line_number':252,'multiline':True]
['text':' Connect with the 'root' user.','line_number':258,'multiline':False]
['text':' Enable change streams to ensure the creation of change collections.','line_number':261,'multiline':False]
['text':' And logout.','line_number':265,'multiline':False]
['text':' Connect with the 'test' user.','line_number':270,'multiline':False]
['text':' Create a collection, insert a document and logout.','line_number':274,'multiline':False]
['text':' Check that Change Collection was NOT created outside the tenant.','line_number':284,'multiline':False]
['text':' Check that Change Collection was created in the tenant.','line_number':290,'multiline':False]
['text':' Test the privileges for every user and operation in the 'testPrivileges' Map.','line_number':298,'multiline':False]
['text':' If the user is NOT a tenant user (without any associated tenant), we need to specify on','line_number':301,'multiline':False]
['text':' which tenant we are acting; otherwise the tenant of the user will be used.','line_number':302,'multiline':False]
