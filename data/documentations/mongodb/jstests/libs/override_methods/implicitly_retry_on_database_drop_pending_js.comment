['text':'*
 * Loading this file overrides functions on Mongo.prototype so that operations which return a
 * "DatabaseDropPending" error response are automatically retried until they succeed.
 ','line_number':1,'multiline':True]
['text':' We create a copy of 'commandObj' to avoid mutating the parameter the caller specified.','line_number':14,'multiline':False]
['text':' Instead, we use the makeFuncArgs() function to build the array of arguments to 'func' by','line_number':15,'multiline':False]
['text':' giving it the 'commandObj' that should be used. This is done to work around the','line_number':16,'multiline':False]
['text':' difference in the order of parameters for the Mongo.prototype.runCommand() function.','line_number':17,'multiline':False]
['text':' We merge ths statistics returned by the server about the number of documents','line_number':32,'multiline':False]
['text':' inserted and updated.','line_number':33,'multiline':False]
['text':' We make 'commandObj.documents' refer to 'opsToRetry' to consolidate the','line_number':35,'multiline':False]
['text':' logic for how we retry insert and update operations.','line_number':36,'multiline':False]
['text':' We make 'commandObj.updates' refer to 'opsToRetry' to consolidate the','line_number':44,'multiline':False]
['text':' logic for how we retry insert and update operations.','line_number':45,'multiline':False]
['text':' The 'upserted' property isn't defined in the response if there weren't','line_number':49,'multiline':False]
['text':' any documents upserted, but we define it as an empty array for','line_number':50,'multiline':False]
['text':' convenience when merging results from 'resPrevious'.','line_number':51,'multiline':False]
['text':' We translate the 'upsertInfo.index' back to its index in the original','line_number':58,'multiline':False]
['text':' operation that were sent to the server by finding the object's','line_number':59,'multiline':False]
['text':' reference (i.e. using strict-equality) in 'originalOps'.','line_number':60,'multiline':False]
['text':' eslint-disable-next-line ','line_number':62,'multiline':True]
['text':' If the operation succeeded or failed for another reason, then we simply','line_number':71,'multiline':False]
['text':' return and let the caller deal with the response.','line_number':72,'multiline':False]
['text':' If the operation failed for a reason other than a','line_number':78,'multiline':False]
['text':' "DatabaseDropPending" error response, then we simply return and let','line_number':79,'multiline':False]
['text':' the caller deal with the response.','line_number':80,'multiline':False]
['text':' We filter out operations that didn't produce a write error to avoid causing a','line_number':85,'multiline':False]
['text':' duplicate key error when retrying the operations. We cache the error message','line_number':86,'multiline':False]
['text':' for the assertion below to avoid the expense of serializing the server's','line_number':87,'multiline':False]
['text':' response as a JSON string repeatedly. (There may be up to 1000 write errors','line_number':88,'multiline':False]
['text':' in the server's response.)','line_number':89,'multiline':False]
['text':' We intentionally omit the command object in the diagnostic message for','line_number':103,'multiline':False]
['text':' "insert" and "update" commands being retried to avoid printing a large blob','line_number':104,'multiline':False]
['text':' and hurting readability of the logs.','line_number':105,'multiline':False]
['text':' We avoid retrying the "dropDatabase" command when another "dropDatabase"','line_number':113,'multiline':False]
['text':' command was already in progress for the database. This reduces the likelihood','line_number':114,'multiline':False]
['text':' that other clients would observe another DatabaseDropPending error response','line_number':115,'multiline':False]
['text':' when they go to retry, and therefore reduces the risk that repeatedly','line_number':116,'multiline':False]
['text':' retrying an individual operation would take longer than the 'defaultTimeout'','line_number':117,'multiline':False]
['text':' period.','line_number':118,'multiline':False]
