['text':' Run once with {new: false} and once with {new: true} to make sure findAndModify','line_number':213,'multiline':False]
['text':' returns pre and post images correctly','line_number':214,'multiline':False]
['text':' Run once with {new: false} and once with {new: true} to make sure findAndModify','line_number':277,'multiline':False]
['text':' returns pre and post images correctly','line_number':278,'multiline':False]
['text':' Run once with {new: false} and once with {new: true} to make sure findAndModify','line_number':341,'multiline':False]
['text':' returns pre and post images correctly','line_number':342,'multiline':False]
['text':' Shard key updates are allowed in bulk ops if the update doesn't cause the doc to move shards','line_number':524,'multiline':False]
['text':' Update multiple documents on different shards','line_number':531,'multiline':False]
['text':' Check that final doc is correct after doing $inc on doc A and then updating the shard key','line_number':559,'multiline':False]
['text':' for doc A. The outcome should be the same for both ordered and unordered bulk ops because','line_number':560,'multiline':False]
['text':' the doc will not change shards, so both udpates will be targeted to the same shard.','line_number':561,'multiline':False]
['text':' Check that updating the shard key for doc A, then doing $inc on the old doc A does not','line_number':588,'multiline':False]
['text':' inc the field on the final doc. The outcome should be the same for both ordered and','line_number':589,'multiline':False]
['text':' unordered bulk ops because the doc will not change shards, so both udpates will be','line_number':590,'multiline':False]
['text':' targeted to the same shard.','line_number':591,'multiline':False]
['text':' Multiple updates - one updates the shard key and the other updates a different field.','line_number':630,'multiline':False]
['text':' If the batch is unordered and not run in a transaction, only the update that does not','line_number':652,'multiline':False]
['text':' modify the shard key succeeds.','line_number':653,'multiline':False]
['text':' If the batch is ordered or is run in a transaction, the batch fails before the second','line_number':664,'multiline':False]
['text':' write is attempted.','line_number':665,'multiline':False]
['text':' Multiple updates - one updates the shard key and the other updates a different field.','line_number':681,'multiline':False]
['text':' If the batch is not run in a transaction, only the update that does not modify the','line_number':702,'multiline':False]
['text':' shard key succeeds. The first write has already been committed when we fail on the','line_number':703,'multiline':False]
['text':' second.','line_number':704,'multiline':False]
['text':' If the batch is run in a transaction, the first write is not committed because the','line_number':715,'multiline':False]
['text':' transaction is aborted.','line_number':716,'multiline':False]
['text':' Update multiple documents on different shards','line_number':725,'multiline':False]
['text':' The batch will fail on the first write and the second will not be attempted.','line_number':745,'multiline':False]
['text':' Update multiple documents on the same shard','line_number':759,'multiline':False]
['text':' The first write will succeed','line_number':783,'multiline':False]
['text':' Both updates target the same shard, so neither write will be commited when the second','line_number':792,'multiline':False]
['text':' errors.','line_number':793,'multiline':False]
['text':' When a collection has a hashed shard key, we do not know which shards will have which documents','line_number':815,'multiline':False]
['text':' upon insertion. This test inserts some documents, shards a collection using a hashed shard key,','line_number':816,'multiline':False]
['text':' and then checks which of these documents are placed on which shard so that we can craft update','line_number':817,'multiline':False]
['text':' commands that will change the shard key value and cause a document to move to a different shard.','line_number':818,'multiline':False]
['text':' Because this collection is hash sharded, we need to figure out which values of x belong to','line_number':826,'multiline':False]
['text':' which shard.','line_number':827,'multiline':False]
['text':' Since we now know that the value of x in each of docsOnShard0[1] and docsOnShard1[1] will be','line_number':833,'multiline':False]
['text':' hashed to map to shard0 and shard1 respectively, we can delete these documents and then use','line_number':834,'multiline':False]
['text':' them as values to change the shard key to.','line_number':835,'multiline':False]
['text':' Non-upsert case. The first update will move a doc from shard0 to shard1 and the second will','line_number':841,'multiline':False]
['text':' move a doc from shard1 to shard 0.','line_number':842,'multiline':False]
['text':' Op-style modify','line_number':845,'multiline':False]
['text':' Replacement style modify','line_number':850,'multiline':False]
['text':' Upsert case. The first update will initially target shard0, but insert on shard1. The second','line_number':854,'multiline':False]
['text':' will initially target shard1, but insert on shard0.','line_number':855,'multiline':False]
['text':' Remove the docs we know we just inserted and then upsert them','line_number':857,'multiline':False]
['text':' Op-style upsert','line_number':863,'multiline':False]
['text':' Modify style upsert','line_number':868,'multiline':False]
['text':' Because this collection is hash sharded, we need to figure out which values of x belong to','line_number':882,'multiline':False]
['text':' which shard.','line_number':883,'multiline':False]
['text':' Since we now know that the value of x in each of docsOnShard0[1] and docsOnShard1[1] will be','line_number':889,'multiline':False]
['text':' hashed to map to shard0 and shard1 respectively, we can delete these documents and then use','line_number':890,'multiline':False]
['text':' them as values to change the shard key to.','line_number':891,'multiline':False]
['text':' Non-upsert case','line_number':897,'multiline':False]
['text':' Op-style modify','line_number':900,'multiline':False]
['text':' Replacement style modify','line_number':904,'multiline':False]
['text':' Upsert case','line_number':909,'multiline':False]
['text':' Remove the docs we know we just inserted and then upsert them','line_number':911,'multiline':False]
['text':' Op-style upsert','line_number':916,'multiline':False]
['text':' Modify style upsert','line_number':920,'multiline':False]
