['text':' Tests the behavior of a change stream on a whole database in a sharded cluster.','line_number':1,'multiline':False]
['text':' @tags: [','line_number':2,'multiline':False]
['text':'   requires_majority_read_concern,','line_number':3,'multiline':False]
['text':'   uses_change_streams,','line_number':4,'multiline':False]
['text':' ]','line_number':5,'multiline':False]
['text':' Use a higher frequency for periodic noops to speed up the test.','line_number':13,'multiline':False]
['text':' Test that if there are no changes, we return an empty batch.','line_number':24,'multiline':False]
['text':' Test that the change stream returns operations on the unsharded test collection.','line_number':27,'multiline':False]
['text':' Create a new sharded collection.','line_number':37,'multiline':False]
['text':' Shard, split, and move one chunk to shard1.','line_number':41,'multiline':False]
['text':' Write a document to each chunk.','line_number':44,'multiline':False]
['text':' Verify that the change stream returns both inserts.','line_number':48,'multiline':False]
['text':' Now send inserts to both the sharded and unsharded collections, and verify that the change','line_number':65,'multiline':False]
['text':' streams returns them in order.','line_number':66,'multiline':False]
['text':' Verify that the change stream returns both inserts.','line_number':70,'multiline':False]
['text':' Create a third sharded collection with a compound shard key.','line_number':87,'multiline':False]
['text':' Shard, split, and move one chunk to shard1.','line_number':91,'multiline':False]
['text':' Write a document to each chunk.','line_number':98,'multiline':False]
['text':' Verify that the change stream returns both inserts.','line_number':102,'multiline':False]
['text':' Send inserts to all 3 collections and verify that the results contain the correct','line_number':119,'multiline':False]
['text':' documentKeys and are in the correct order.','line_number':120,'multiline':False]
['text':' Verify that the change stream returns both inserts.','line_number':125,'multiline':False]
['text':' Store the resume token of the first insert to use after dropping the collection.','line_number':148,'multiline':False]
['text':' Write one more document to the collection that will be dropped, to be returned after','line_number':151,'multiline':False]
['text':' resuming.','line_number':152,'multiline':False]
['text':' Drop the collection, invalidating the open change stream.','line_number':155,'multiline':False]
['text':' Resume the change stream from before the collection drop, and verify that the documentKey','line_number':158,'multiline':False]
['text':' field contains the extracted shard key from the resume token.','line_number':159,'multiline':False]
