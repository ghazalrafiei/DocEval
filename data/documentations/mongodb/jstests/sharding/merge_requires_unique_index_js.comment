['text':' Tests that the $merge stage enforces that the "on" fields argument can be used to uniquely','line_number':1,'multiline':False]
['text':' identify documents by checking that there is a supporting unique, non-partial,','line_number':2,'multiline':False]
['text':' collator-compatible index in the index catalog. This is meant to test sharding-related','line_number':3,'multiline':False]
['text':' configurations that are not covered by the aggregation passthrough suites.','line_number':4,'multiline':False]
['text':' Enable sharding on the test DB and ensure that shard0 is the primary.','line_number':17,'multiline':False]
['text':' Enable sharding on the foreign DB, except ensure that shard1 is the primary shard.','line_number':21,'multiline':False]
['text':' Increase the log verbosity for sharding, in the hope of getting a clearer picture of the','line_number':28,'multiline':False]
['text':' cluster writer as part of BF-11106. This should be removed once BF-11106 is fixed.','line_number':29,'multiline':False]
['text':' Shard the target collection, and set the unique flag to ensure that there's a unique','line_number':35,'multiline':False]
['text':' index on the shard key.','line_number':36,'multiline':False]
['text':' Not specifying "on" fields should always pass.','line_number':48,'multiline':False]
['text':' Since the target collection is sharded with a unique shard key, specifying "on" fields','line_number':51,'multiline':False]
['text':' that is equal to the shard key should be valid.','line_number':52,'multiline':False]
['text':' Create a compound "on" fields consisting of the shard key and one additional field.','line_number':56,'multiline':False]
['text':' Expect the $merge to fail since we haven't created a unique index on the compound','line_number':60,'multiline':False]
['text':' "on" fields.','line_number':61,'multiline':False]
['text':' Create the unique index and verify that the "on" fields is now valid.','line_number':69,'multiline':False]
['text':' Create a non-unique index and make sure that doesn't work.','line_number':78,'multiline':False]
['text':' Test that a unique, partial index on the "on" fields cannot be used to satisfy the','line_number':88,'multiline':False]
['text':' requirement.','line_number':89,'multiline':False]
['text':' Test that a unique index on the "on" fields cannot be used to satisfy the requirement if','line_number':100,'multiline':False]
['text':' it has a different collation.','line_number':101,'multiline':False]
['text':' Test that a unique index with dotted field names can be used.','line_number':140,'multiline':False]
['text':' No longer a supporting index on the original compound "on" fields.','line_number':145,'multiline':False]
['text':' Test that an embedded object matching the "on" fields is valid.','line_number':153,'multiline':False]
['text':' Test that we cannot use arrays with a dotted path within a $merge.','line_number':162,'multiline':False]
['text':' Test that a unique index that is multikey can still be used.','line_number':189,'multiline':False]
['text':' If whenMatched is "replace" and whenNotMatched is "insert", expect the command to','line_number':197,'multiline':False]
['text':' fail if the "on" fields does not contain _id, since a replacement-style update will fail','line_number':198,'multiline':False]
['text':' if attempting to modify _id.','line_number':199,'multiline':False]
['text':'','line_number':255,'multiline':False]
['text':' Test unsharded source and sharded target collections.','line_number':256,'multiline':False]
['text':'','line_number':257,'multiline':False]
['text':' Test with a shard key that does *not* include _id.','line_number':264,'multiline':False]
['text':'','line_number':269,'multiline':False]
['text':' Test both source and target collections as sharded.','line_number':270,'multiline':False]
['text':'','line_number':271,'multiline':False]
['text':' Re-run the test with a shard key that does *not* include _id.','line_number':279,'multiline':False]
['text':' First test $merge to the same database as the source.','line_number':285,'multiline':False]
['text':' Then test against a foreign database, with the same expected behavior.','line_number':288,'multiline':False]
