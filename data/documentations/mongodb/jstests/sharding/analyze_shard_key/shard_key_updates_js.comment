['text':'*
 * Tests that the analyzeShardKey returns the correct metrics about shard key updates.
 *
 * @tags: [requires_fcv_70]
 ','line_number':1,'multiline':True]
['text':' This command involves running commands outside a session.','line_number':13,'multiline':False]
['text':' Make the periodic jobs for refreshing sample rates and writing sampled queries and diffs have a','line_number':19,'multiline':False]
['text':' period of 1 second to speed up the test.','line_number':20,'multiline':False]
['text':' Make it have three chunks:','line_number':67,'multiline':False]
['text':' shard0: [MinKey, -1000]','line_number':68,'multiline':False]
['text':' shard1: [-1000, 1000]','line_number':69,'multiline':False]
['text':' shard1: [1000, MaxKey]','line_number':70,'multiline':False]
['text':' Test with a mix of modifier, replacement and pipeline updates and findAndModify updates.','line_number':117,'multiline':False]
['text':' Below are shard key updates.','line_number':122,'multiline':False]
['text':' This updates "a.x.i".','line_number':124,'multiline':False]
['text':' preImage:   {_id: 1, a: {x: {i: 1, ii: 1}, y: 1}, b: 1, c: 1}','line_number':125,'multiline':False]
['text':' postImage:  {_id: 1, a: {x: {i: -1, ii: 1}, y: 1}, b: 1, c: 1}','line_number':126,'multiline':False]
['text':' This updates "a.x.i".','line_number':131,'multiline':False]
['text':' preImage:   {_id: 2, a: {x: {i: 2, ii: 2}, y: 2}, b: 2, c: 2}','line_number':132,'multiline':False]
['text':' postImage:  {_id: 2, a: {x: {i: -2, ii: 2}, y: 2}, b: 2, c: 2}','line_number':133,'multiline':False]
['text':' This updates "a.x.i" and "c".','line_number':139,'multiline':False]
['text':' preImage:   {_id: 3, a: {x: {i: 3, ii: 3}, y: 3}, b: 3, c: 3}','line_number':140,'multiline':False]
['text':' postImage:  {_id: 3, a: {x: {i: -3, ii: 3}, y: 3}, b: 3, c: 3}','line_number':141,'multiline':False]
['text':' This updates "b".','line_number':147,'multiline':False]
['text':' preImage:   {_id: 4, a: {x: {i: 4, ii: 4}, y: 4}, b: 4, c: 4}','line_number':148,'multiline':False]
['text':' postImage:  {_id: 4, a: {x: {i: 4, ii: 4}, y: 4}, b: -4, c: 4}','line_number':149,'multiline':False]
['text':' This updates "b".','line_number':154,'multiline':False]
['text':' preImage:   {_id: 5, a: {x: {i: 5, ii: 5}, y: 5}, b: 5, c: 5}','line_number':155,'multiline':False]
['text':' postImage:  {_id: 5, a: {x: {i: 5, ii: 5}, y: 5}, b: 50, c: 5}','line_number':156,'multiline':False]
['text':' This updates "a.x.i" from int to to null.','line_number':161,'multiline':False]
['text':' preImage:   {_id: 6, a: {x: {i: 6, ii: 6}, y: 6}, b: 6, c: 6}','line_number':162,'multiline':False]
['text':' postImage:  {_id: 6, a: {x: {i: null, ii: 6}, y: 6}, b: 6, c: 6}','line_number':163,'multiline':False]
['text':' This updates "a.x.i" from null to int.','line_number':168,'multiline':False]
['text':' preImage:   {_id: 6, a: {x: {i: null, ii: 6}, y: 6}, b: 6, c: 6}','line_number':169,'multiline':False]
['text':' postImage:  {_id: 6, a: {x: {i: 6, ii: 6}, y: 6}, b: 6, c: 6}','line_number':170,'multiline':False]
['text':' This deletes "a.x.i" but keeps "a.x".','line_number':175,'multiline':False]
['text':' preImage:   {_id: 7, a: {x: {i: 7, ii: 7}, y: 7}, b: 7, c: 7}','line_number':176,'multiline':False]
['text':' postImage:  {_id: 7, a: {x: {ii: 7}, y: 7}, b: 7, c: 7}','line_number':177,'multiline':False]
['text':' This deletes "a.x.i" and "a.x" but keeps "a".','line_number':182,'multiline':False]
['text':' preImage:   {_id: 8, a: {x: {i: 8, ii: 8}, y: 8}, b: 8, c: 8}','line_number':183,'multiline':False]
['text':' postImage:  {_id: 8, a: {y: 8}, b: 8, c: 8}','line_number':184,'multiline':False]
['text':' This deletes "a.x.i" and "a.x" and "a".','line_number':189,'multiline':False]
['text':' preImage:   {_id: 9, a: {x: {i: 9, ii: 9}, y: 9}, b: 9, c: 9}','line_number':190,'multiline':False]
['text':' postImage:  {_id: 9, b: 9, c: 9}','line_number':191,'multiline':False]
['text':' This deletes "b".','line_number':196,'multiline':False]
['text':' preImage:   {_id: 10, a: {x: {i: 10, ii: 10}}, b: 10, c: 10}','line_number':197,'multiline':False]
['text':' postImage:  {_id: 10, a: {x: {i: 10, ii: 10}}, c: 10}','line_number':198,'multiline':False]
['text':' This updates "a.x.i". This is a WouldChangeOwningShard update if the collection is sharded.','line_number':204,'multiline':False]
['text':' preImage:   {_id: 100, a: {x: {i: 100, ii: 100}}, b: 100, c: 100}','line_number':205,'multiline':False]
['text':' postImage:  {_id: 100, a: {x: {i: 1100, ii: 100}}, b: 100, c: 100}','line_number':206,'multiline':False]
['text':' This updates "a.x.i" and "b". This is a WouldChangeOwningShard findAndModify if the','line_number':211,'multiline':False]
['text':' collection is sharded.','line_number':212,'multiline':False]
['text':' preImage:   {_id: -100, a: {x: {i: -100, ii: -100}, y: -100}, b: -100, c: -100}','line_number':213,'multiline':False]
['text':' postImage:  {_id: -100, a: {x: {i: -1100, ii: -100}, y: -100}, b: -1000, c: -100}','line_number':214,'multiline':False]
['text':' Turn off query sampling and wait for sampling to become inactive. The wait is necessary for','line_number':220,'multiline':False]
['text':' preventing the internal aggregate commands run by the analyzeShardKey commands below from','line_number':221,'multiline':False]
['text':' getting sampled.','line_number':222,'multiline':False]
['text':' Below are not shard key updates.','line_number':244,'multiline':False]
['text':' This updates "a.x.ii".','line_number':246,'multiline':False]
['text':' preImage:   {_id: 11, a: {x: {i: 11, ii: 11}, y: 11}, b: 11, c: 11}','line_number':247,'multiline':False]
['text':' postImage:  {_id: 11, a: {x: {i: 11, ii: -11}, y: 11}, b: 11, c: 11}','line_number':248,'multiline':False]
['text':' This deletes "a.x.ii".','line_number':252,'multiline':False]
['text':' preImage:   {_id: 12, a: {x: {i: 12, ii: 12}, y: 12}, b: 12, c: 12}','line_number':253,'multiline':False]
['text':' postImage:  {_id: 12, a: {x: {i: 12}, y: 12}, b: 12, c: 12}','line_number':254,'multiline':False]
['text':' This updates "a.y".','line_number':259,'multiline':False]
['text':' preImage:   {_id: 13, a: {x: {i: 13, ii: 13}, y: 13}, b: 13, c: 13}','line_number':260,'multiline':False]
['text':' postImage:  {_id: 13, a: {x: {i: 13, ii: 13}, y: -13}, b: 13, c: 13}','line_number':261,'multiline':False]
['text':' This deletes "a.y".','line_number':265,'multiline':False]
['text':' preImage:   {_id: 14, a: {x: {i: 14, ii: 14}, y: 14}, b: 14, c: 14}','line_number':266,'multiline':False]
['text':' postImage:  {_id: 14, a: {x: {i: 14, ii: 14}}, b: 14, c: 14}','line_number':267,'multiline':False]
['text':' This inserts "a.z".','line_number':272,'multiline':False]
['text':' preImage:   {_id: 15, a: {x: {i: 15, ii: 15}, y: 15}, b: 15, c: 15}','line_number':273,'multiline':False]
['text':' postImage:  {_id: 15, a: {x: {i: 15, ii: 15}, y: 15, z: 15}, b: 15, c: 15}','line_number':274,'multiline':False]
['text':' This updates "c".','line_number':278,'multiline':False]
['text':' preImage:   {_id: 16, a: {x: {i: 16, ii: 16}, y: 16}, b: 16, c: 16}','line_number':279,'multiline':False]
['text':' postImage:  {_id: 16, a: {x: {i: 16, ii: 16}, y: 16}, b: 16, c: -16}','line_number':280,'multiline':False]
['text':' This deletes "c".','line_number':284,'multiline':False]
['text':' preImage:   {_id: 17, a: {x: {i: 17, ii: 17}, y: 17}, b: 17, c: 17}','line_number':285,'multiline':False]
['text':' postImage:  {_id: 17, a: {x: {i: 17, ii: 17}, y: 17}, b: 17]}','line_number':286,'multiline':False]
['text':' Turn off query sampling and wait for sampling to become inactive. The wait is necessary for','line_number':291,'multiline':False]
['text':' preventing the internal aggregate commands run by the analyzeShardKey commands below from','line_number':292,'multiline':False]
['text':' getting sampled.','line_number':293,'multiline':False]
['text':' user ','line_number':315,'multiline':True]
['text':' ignoreFCV ','line_number':315,'multiline':True]
['text':' The behavior for unsharded collections is the same for all the context types so just test the','line_number':324,'multiline':False]
['text':' basic one.','line_number':325,'multiline':False]
