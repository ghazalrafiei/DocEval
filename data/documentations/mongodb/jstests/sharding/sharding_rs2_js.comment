['text':'','line_number':1,'multiline':False]
['text':' Testing mongos with replica sets:','line_number':2,'multiline':False]
['text':'  - config server should update when replica set config changes.','line_number':3,'multiline':False]
['text':'  - test insert and find commands are routed appropriately to shard primaries','line_number':4,'multiline':False]
['text':'    and secondaries.','line_number':5,'multiline':False]
['text':'','line_number':6,'multiline':False]
['text':' This test involves using fsync to lock the secondaries, so cannot be run on','line_number':7,'multiline':False]
['text':' storage engines which do not support the command.','line_number':8,'multiline':False]
['text':' @tags: [','line_number':9,'multiline':False]
['text':'    requires_fsync,','line_number':10,'multiline':False]
['text':' ]','line_number':11,'multiline':False]
['text':' The mongod secondaries are set to priority 0 to prevent the primaries from stepping down during','line_number':13,'multiline':False]
['text':' migrations on slow evergreen builders.','line_number':14,'multiline':False]
['text':' The default WC is 'majority' and fsyncLock will prevent satisfying any majority writes.','line_number':38,'multiline':False]
['text':' The default RC is 'local' but fsync will block any refresh on secondaries, that's why RC is','line_number':39,'multiline':False]
['text':' defaulted to 'available'.','line_number':40,'multiline':False]
['text':' -------------------------------------------------------------------------------------------','line_number':48,'multiline':False]
['text':' ---------- test that config server updates when replica set config changes ----------------','line_number':49,'multiline':False]
['text':' -------------------------------------------------------------------------------------------','line_number':50,'multiline':False]
['text':' this os ok as rs's may close connections on a change of primary','line_number':74,'multiline':False]
['text':' cleanup after adding node','line_number':88,'multiline':False]
['text':'','line_number':93,'multiline':False]
['text':' Make sure we wait for secondaries here - otherwise a secondary could come online later and be','line_number':100,'multiline':False]
['text':' used for the','line_number':101,'multiline':False]
['text':' count command before being fully replicated','line_number':102,'multiline':False]
['text':' -------------------------------------------------------------------------------------------','line_number':106,'multiline':False]
['text':' ---------- test routing to secondaries ----------------','line_number':107,'multiline':False]
['text':' -------------------------------------------------------------------------------------------','line_number':108,'multiline':False]
['text':' --- not sharded ----','line_number':110,'multiline':False]
['text':' --- add more data ----','line_number':134,'multiline':False]
['text':' Counts pass the options of the connection - which is secondaryOk'd, so we need to wait for','line_number':146,'multiline':False]
['text':' replication for this and future tests to pass','line_number':147,'multiline':False]
['text':' --- sharded ----','line_number':158,'multiline':False]
['text':' We're doing some manual chunk stuff, so stop the balancer first','line_number':164,'multiline':False]
['text':' by non-shard key','line_number':186,'multiline':False]
['text':' by shard key','line_number':206,'multiline':False]
['text':' fsyncLock the secondaries and enable command logging on all the mongods.','line_number':234,'multiline':False]
['text':' Modify data only on the primary replica of the primary shard.','line_number':243,'multiline':False]
['text':' { x: 60 } goes to the shard of "rs", which is the primary shard.','line_number':244,'multiline':False]
['text':' Read from secondary through mongos, the doc is not there due to replication delay or fsync.','line_number':246,'multiline':False]
['text':' But we can guarantee not to read from primary.','line_number':247,'multiline':False]
['text':' Unlock the secondaries','line_number':249,'multiline':False]
['text':' Clean up the data','line_number':253,'multiline':False]
