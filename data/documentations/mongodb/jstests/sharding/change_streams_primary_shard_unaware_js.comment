['text':' Tests the behavior of a change stream on a collection that becomes sharded, however the primary','line_number':1,'multiline':False]
['text':' shard is unaware and still sees the collection as unsharded.','line_number':2,'multiline':False]
['text':'','line_number':3,'multiline':False]
['text':' This test triggers a compiler bug that causes a crash when compiling with optimizations on, see','line_number':4,'multiline':False]
['text':' SERVER-36321.','line_number':5,'multiline':False]
['text':'','line_number':6,'multiline':False]
['text':' @tags: [','line_number':7,'multiline':False]
['text':'   denylist_from_rhel_67_s390x,','line_number':8,'multiline':False]
['text':'   requires_majority_read_concern,','line_number':9,'multiline':False]
['text':'   requires_persistence,','line_number':10,'multiline':False]
['text':'   uses_change_streams,','line_number':11,'multiline':False]
['text':' ]','line_number':12,'multiline':False]
['text':' Returns true if the shard is aware that the collection is sharded.','line_number':15,'multiline':False]
['text':' Disable checking for index consistency to ensure that the config server doesn't trigger a','line_number':22,'multiline':False]
['text':' StaleShardVersion exception on shard0 and cause it to refresh its sharding metadata.','line_number':23,'multiline':False]
['text':' Use a higher frequency for periodic noops to speed up the test.','line_number':34,'multiline':False]
['text':' Ensure that shard0 is the primary shard.','line_number':46,'multiline':False]
['text':' Create unsharded collection on primary shard.','line_number':50,'multiline':False]
['text':' Before sharding the collection, issue a write through mongos2 to ensure that it knows the','line_number':54,'multiline':False]
['text':' collection exists and believes it is unsharded. This is needed later in the test to avoid','line_number':55,'multiline':False]
['text':' triggering a refresh when a change stream is established through mongos2.','line_number':56,'multiline':False]
['text':' Create index on the shard key.','line_number':61,'multiline':False]
['text':' Shard the collection.','line_number':64,'multiline':False]
['text':' Restart the primary shard and ensure that it is no longer aware that the collection is','line_number':68,'multiline':False]
['text':' sharded.','line_number':69,'multiline':False]
['text':' Establish change stream cursor on the second mongos, which is not aware that the','line_number':76,'multiline':False]
['text':' collection is sharded.','line_number':77,'multiline':False]
['text':' Establish a change stream cursor on the now sharded collection through the first mongos.','line_number':83,'multiline':False]
['text':' Ensure that the primary shard is still unaware that the collection is sharded.','line_number':89,'multiline':False]
['text':' Insert a doc and verify that the primary shard is now aware that the collection is sharded.','line_number':92,'multiline':False]
['text':' Verify that both cursors are able to pick up an inserted document.','line_number':96,'multiline':False]
['text':' Split the collection into 2 chunks: [MinKey, 0), [0, MaxKey).','line_number':112,'multiline':False]
['text':' Move a chunk to the non-primary shard.','line_number':115,'multiline':False]
['text':' Update the document on the primary shard.','line_number':123,'multiline':False]
['text':' Insert another document to each shard.','line_number':125,'multiline':False]
['text':' Verify that both cursors pick up the first inserted doc regardless of the moveChunk','line_number':129,'multiline':False]
['text':' operation.','line_number':130,'multiline':False]
['text':' Restart the primary shard and ensure that it is no longer aware that the collection is','line_number':147,'multiline':False]
['text':' sharded.','line_number':148,'multiline':False]
['text':' Establish change stream cursor on mongos2 using the resume token from the change steam on','line_number':152,'multiline':False]
['text':' mongos1. Mongos2 is aware that the collection exists and thinks that it's unsharded, so it','line_number':153,'multiline':False]
['text':' won't trigger a routing table refresh. This must be done using a resume token from an update','line_number':154,'multiline':False]
['text':' otherwise the shard will generate the documentKey based on the assumption that the shard key','line_number':155,'multiline':False]
['text':' is _id which will cause the cursor establishment to fail due to SERVER-32085.','line_number':156,'multiline':False]
