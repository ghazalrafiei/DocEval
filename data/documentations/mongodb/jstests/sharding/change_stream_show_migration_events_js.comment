['text':' Tests the undocumented 'showMigrationEvents' option for change streams.','line_number':1,'multiline':False]
['text':'','line_number':2,'multiline':False]
['text':' @tags: [','line_number':3,'multiline':False]
['text':'   requires_majority_read_concern,','line_number':4,'multiline':False]
['text':'   uses_change_streams,','line_number':5,'multiline':False]
['text':' ]','line_number':6,'multiline':False]
['text':' TODO WT-3864: Re-enable test for LSM once transaction visibility bug in LSM is resolved.','line_number':24,'multiline':False]
['text':' Use a higher frequency for periodic noops to speed up the test.','line_number':31,'multiline':False]
['text':' Enable sharding to inform mongos of the database, allowing us to open a cursor. All chunks start','line_number':41,'multiline':False]
['text':' on shard0','line_number':42,'multiline':False]
['text':' Open a change stream cursor before the collection is sharded.','line_number':46,'multiline':False]
['text':' Change streams opened on mongos do not allow showMigrationEvents to be set to true.','line_number':54,'multiline':False]
['text':' Once we have a cursor, actually shard the collection.','line_number':61,'multiline':False]
['text':' Insert two documents.','line_number':65,'multiline':False]
['text':' Split the collection into two chunks: [MinKey, 10) and [10, MaxKey].','line_number':69,'multiline':False]
['text':' Check that each change stream returns the expected events.','line_number':84,'multiline':False]
['text':' Insert into both the chunks.','line_number':89,'multiline':False]
['text':' Split again, and move a second chunk to the first shard. The new chunks are:','line_number':93,'multiline':False]
['text':' [MinKey, 0), [0, 10), and [10, MaxKey].','line_number':94,'multiline':False]
['text':' Insert again, into all three chunks.','line_number':104,'multiline':False]
['text':' Check that each change stream returns the expected events.','line_number':123,'multiline':False]
['text':' Make sure we're at the end of the stream.','line_number':127,'multiline':False]
['text':' Test that migrating the last chunk to shard 1 (meaning all chunks are now on the same shard)','line_number':131,'multiline':False]
['text':' will not invalidate the change stream.','line_number':132,'multiline':False]
['text':' Insert into all three chunks.','line_number':134,'multiline':False]
['text':' Insert again, into all three chunks.','line_number':148,'multiline':False]
['text':' Inserts for a given migration are ordered by `RecordId` in the recipient shard. For normal','line_number':153,'multiline':False]
['text':' collections that's the insertion order but for clustered colls that's the cluster key order.','line_number':154,'multiline':False]
['text':' Check that each change stream returns the expected events.','line_number':157,'multiline':False]
['text':' Clustered order.','line_number':166,'multiline':False]
['text':' Non-clustered order.','line_number':175,'multiline':False]
['text':' Now test that adding a new shard and migrating a chunk to it will continue to','line_number':184,'multiline':False]
['text':' return the correct results.','line_number':185,'multiline':False]
['text':' At this point, there haven't been any migrations to that shard; check that the changeStream','line_number':194,'multiline':False]
['text':' works normally.','line_number':195,'multiline':False]
['text':' Now migrate a chunk to the new shard and verify the stream continues to return results','line_number':212,'multiline':False]
['text':' from both before and after the migration.','line_number':213,'multiline':False]
['text':' Clustered order.','line_number':236,'multiline':False]
['text':' Non-clustered order.','line_number':251,'multiline':False]
['text':' Check that each change stream returns the expected events.','line_number':255,'multiline':False]
['text':' Make sure all change streams are empty.','line_number':261,'multiline':False]
