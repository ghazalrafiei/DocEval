['text':' Basic integration tests for the background job that periodically kills idle cursors, in both','line_number':1,'multiline':False]
['text':' mongod and mongos.  This test creates the following four cursors:','line_number':2,'multiline':False]
['text':'','line_number':3,'multiline':False]
['text':' 1. A no-timeout cursor through mongos, not attached to a session.','line_number':4,'multiline':False]
['text':' 2. A no-timeout cursor through mongod, not attached to a session.','line_number':5,'multiline':False]
['text':' 3. A normal cursor through mongos, not attached to a session.','line_number':6,'multiline':False]
['text':' 4. A normal cursor through mongod, not attached to a session.','line_number':7,'multiline':False]
['text':' 5. A normal cursor through mongos, attached to a session.','line_number':8,'multiline':False]
['text':' 6. A normal cursor through mongod, attached to a session.','line_number':9,'multiline':False]
['text':'','line_number':10,'multiline':False]
['text':' After a period of inactivity, the test asserts that cursors #1 and #2 are still alive, cursors #3','line_number':11,'multiline':False]
['text':' and #4 have been killed, and cursors #5 and #6 are still alive (as of SERVER-6036, only cursors','line_number':12,'multiline':False]
['text':' not opened as part of a session should be killed by the cursor-timeout mechanism). It then kills','line_number':13,'multiline':False]
['text':' the session cursors #5 and #6 are attached to to simulate that session timing out, and ensures','line_number':14,'multiline':False]
['text':' that cursors #5 and #6 are killed as a result.','line_number':15,'multiline':False]
['text':'','line_number':16,'multiline':False]
['text':' @tags: [','line_number':17,'multiline':False]
['text':'   requires_sharding, requires_fcv_51','line_number':18,'multiline':False]
['text':' ]','line_number':19,'multiline':False]
['text':' This test manually simulates a session, which is not compatible with implicit sessions.','line_number':20,'multiline':False]
['text':' Cursor timeout on mongod is handled by a single thread/timer that will sleep for','line_number':23,'multiline':False]
['text':' "clientCursorMonitorFrequencySecs" and add the sleep value to each operation's duration when','line_number':24,'multiline':False]
['text':' it wakes up, timing out those whose "now() - last accessed since" time exceeds. A cursor','line_number':25,'multiline':False]
['text':' timeout of 5 seconds with a monitor frequency of 1 second means an effective timeout period','line_number':26,'multiline':False]
['text':' of 4 to 5 seconds.','line_number':27,'multiline':False]
['text':' Cursor timeout on mongos is handled by checking whether the "last accessed" cursor time stamp','line_number':30,'multiline':False]
['text':' is older than "now() - cursorTimeoutMillis" and is checked every','line_number':31,'multiline':False]
['text':' "clientCursorMonitorFrequencySecs" by a global thread/timer. A timeout of 4 seconds with a','line_number':32,'multiline':False]
['text':' monitor frequency of 1 second means an effective timeout period of 4 to 5 seconds.','line_number':33,'multiline':False]
['text':' Open both a normal and a no-timeout cursor on mongos. Batch size is 1 to ensure that','line_number':84,'multiline':False]
['text':' cursor.next() performs only a single operation.','line_number':85,'multiline':False]
['text':' Open a session on mongos.','line_number':90,'multiline':False]
['text':' Open both a normal and a no-timeout cursor on mongod. Batch size is 1 to ensure that','line_number':95,'multiline':False]
['text':' cursor.next() performs only a single operation.','line_number':96,'multiline':False]
['text':' Open a session on mongod.','line_number':101,'multiline':False]
['text':' Execute initial find on each cursor.','line_number':106,'multiline':False]
['text':' Wait until the idle cursor background job has killed the session-unattached cursors that do not','line_number':114,'multiline':False]
['text':' have the "no timeout" flag set.  We use the "cursorTimeoutMillis" and','line_number':115,'multiline':False]
['text':' "clientCursorMonitorFrequencySecs" setParameters above to reduce the amount of time we need to','line_number':116,'multiline':False]
['text':' wait here.','line_number':117,'multiline':False]
['text':' Wait for the shard to have four open cursors on it (routerCursorWithNoTimeout,','line_number':122,'multiline':False]
['text':' routerSessionCursor, shardCursorWithNoTimeout, and shardSessionCursor).  We cannot reliably use','line_number':123,'multiline':False]
['text':' metrics.cursor.timedOut here, because this will be 2 if routerCursorWithTimeout is killed for','line_number':124,'multiline':False]
['text':' timing out on the shard, and 1 if routerCursorWithTimeout is killed by a killCursors command from','line_number':125,'multiline':False]
['text':' the mongos.','line_number':126,'multiline':False]
['text':' Kill the session that routerSessionCursor and shardSessionCursor are attached to, to simulate','line_number':138,'multiline':False]
['text':' that session's expiration. The cursors should be killed and cleaned up once the session is.','line_number':139,'multiline':False]
['text':' Wait for the shard to have two open cursors on it (routerCursorWithNoTimeout,','line_number':143,'multiline':False]
['text':' shardCursorWithNoTimeout).','line_number':144,'multiline':False]
['text':' Verify that the session cursors are really gone by running a killCursors command, and checking','line_number':156,'multiline':False]
['text':' that the cursorors are reported as "not found". Credit to kill_pinned_cursor_js_test for this','line_number':157,'multiline':False]
['text':' idea.','line_number':158,'multiline':False]
['text':' +1 because we already advanced one. Ensure that the session-unattached cursors are still valid.','line_number':168,'multiline':False]
['text':' Confirm that cursors opened within a session will timeout when the','line_number':172,'multiline':False]
['text':' 'enableTimeoutOfInactiveSessionCursors' setParameter has been enabled.','line_number':173,'multiline':False]
['text':' Open a session on mongos.','line_number':180,'multiline':False]
['text':' Open a session on mongod.','line_number':186,'multiline':False]
['text':' Execute initial find on each cursor.','line_number':192,'multiline':False]
['text':' Wait until mongos reflects the newly timed out cursors.','line_number':196,'multiline':False]
['text':' Wait until mongod reflects the newly timed out cursors.','line_number':202,'multiline':False]
