['text':'*
 * Test that mongod will not allow creation of collection validators using new query features when
 * the feature compatibility version is older than the latest version.
 *
 * We restart mongod during the test and expect it to have the same data after restarting.
 * @tags: [requires_persistence]
 ','line_number':1,'multiline':True]
['text':' An array of feature flags that must be enabled to run feature flag tests.','line_number':12,'multiline':False]
['text':' These arrays should be populated with','line_number':15,'multiline':False]
['text':'','line_number':16,'multiline':False]
['text':'      { validator: { ... }, nonMatchingDocument: { ... }, lastStableErrCode }','line_number':17,'multiline':False]
['text':'','line_number':18,'multiline':False]
['text':' objects that use query features in new versions of mongod. Note that this also','line_number':19,'multiline':False]
['text':' includes new aggregation expressions able to be used with the $expr match expression. This','line_number':20,'multiline':False]
['text':' test ensures that a collection validator accepts the new query feature when the feature','line_number':21,'multiline':False]
['text':' compatibility version is the latest version, and rejects it when the feature compatibility','line_number':22,'multiline':False]
['text':' version is the last version.','line_number':23,'multiline':False]
['text':' The 'lastStableErrCode' field indicates what error the last version would throw when','line_number':24,'multiline':False]
['text':' parsing the validator.','line_number':25,'multiline':False]
['text':'','line_number':27,'multiline':False]
['text':' Populate with any new expressions.','line_number':28,'multiline':False]
['text':'','line_number':29,'multiline':False]
['text':' Tests Feature Compatibility Version behavior of the validator of a collection by executing test','line_number':38,'multiline':False]
['text':' cases 'testCases' and using a previous stable version 'lastVersion' of mongod. 'lastVersion' can','line_number':39,'multiline':False]
['text':' have values "last-lts" and "last-continuous".','line_number':40,'multiline':False]
['text':' Explicitly set the feature compatibility version to the latest version.','line_number':65,'multiline':False]
['text':' Create a collection with a validator using new query features.','line_number':70,'multiline':False]
['text':' The validator should cause this insert to fail.','line_number':76,'multiline':False]
['text':' Set a validator using new query features on an existing collection.','line_number':83,'multiline':False]
['text':' Another failing update.','line_number':90,'multiline':False]
['text':' Set the feature compatibility version to the last version.','line_number':98,'multiline':False]
['text':' The validator is already in place, so it should still cause this insert to fail.','line_number':104,'multiline':False]
['text':' Trying to create a new collection with a validator using new query features should','line_number':112,'multiline':False]
['text':' fail while feature compatibility version is the last version.','line_number':113,'multiline':False]
['text':' Trying to update a collection with a validator using new query features should also','line_number':125,'multiline':False]
['text':' fail.','line_number':126,'multiline':False]
['text':' Versions of mongod 4.2 and later are able to start up with a collection validator that's','line_number':141,'multiline':False]
['text':' considered invalid. However, any writes to the collection will fail.','line_number':142,'multiline':False]
['text':' Check that writes fail to all collections with validators using new query features.','line_number':148,'multiline':False]
['text':' Starting up the latest version of mongod, however, should succeed, even though the feature','line_number':157,'multiline':False]
['text':' compatibility version is still set to the last version.','line_number':158,'multiline':False]
['text':' And the validator should still work.','line_number':165,'multiline':False]
['text':' Remove the validator.','line_number':174,'multiline':False]
['text':' Now, we should be able to start up the last version of mongod.','line_number':180,'multiline':False]
['text':' The rest of the test uses the latest version of mongod.','line_number':190,'multiline':False]
['text':' Set the feature compatibility version back to the latest version.','line_number':197,'multiline':False]
['text':' Now we should be able to create a collection with a validator using new query features','line_number':204,'multiline':False]
['text':' again.','line_number':205,'multiline':False]
['text':' And we should be able to modify a collection to have a validator using new query','line_number':210,'multiline':False]
['text':' features.','line_number':211,'multiline':False]
['text':' Set the feature compatibility version to the last version and then restart with','line_number':217,'multiline':False]
['text':' internalValidateFeaturesAsPrimary=false.','line_number':218,'multiline':False]
['text':' Even though the feature compatibility version is the last version, we should still','line_number':234,'multiline':False]
['text':' be able to add a validator using new query features, because','line_number':235,'multiline':False]
['text':' internalValidateFeaturesAsPrimary is false.','line_number':236,'multiline':False]
['text':' We should also be able to modify a collection to have a validator using new query','line_number':241,'multiline':False]
['text':' features.','line_number':242,'multiline':False]
