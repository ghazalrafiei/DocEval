['text':' Tests the 'fullDocument' argument to the $changeStream stage.','line_number':1,'multiline':False]
['text':'','line_number':2,'multiline':False]
['text':' The $changeStream stage is not allowed within a $facet stage.','line_number':3,'multiline':False]
['text':' @tags: [','line_number':4,'multiline':False]
['text':'   do_not_wrap_aggregations_in_facets,','line_number':5,'multiline':False]
['text':'   uses_multiple_connections,','line_number':6,'multiline':False]
['text':' ]','line_number':7,'multiline':False]
['text':' Test that not specifying 'fullDocument' does include a 'fullDocument' in the result for','line_number':21,'multiline':False]
['text':' an insert.','line_number':22,'multiline':False]
['text':' Test that not specifying 'fullDocument' does include a 'fullDocument' in the result for a','line_number':29,'multiline':False]
['text':' replacement-style update.','line_number':30,'multiline':False]
['text':' Test that not specifying 'fullDocument' does not include a 'fullDocument' in the result','line_number':37,'multiline':False]
['text':' for a non-replacement update.','line_number':38,'multiline':False]
['text':' Test that specifying 'fullDocument' as 'default' does include a 'fullDocument' in the','line_number':46,'multiline':False]
['text':' result for an insert.','line_number':47,'multiline':False]
['text':' Test that specifying 'fullDocument' as 'default' does include a 'fullDocument' in the','line_number':55,'multiline':False]
['text':' result for a replacement-style update.','line_number':56,'multiline':False]
['text':' Test that specifying 'fullDocument' as 'default' does not include a 'fullDocument' in the','line_number':63,'multiline':False]
['text':' result for a non-replacement update.','line_number':64,'multiline':False]
['text':' Test that specifying 'fullDocument' as 'updateLookup' does include a 'fullDocument' in','line_number':72,'multiline':False]
['text':' the result for an insert.','line_number':73,'multiline':False]
['text':' Test that specifying 'fullDocument' as 'updateLookup' does include a 'fullDocument' in','line_number':81,'multiline':False]
['text':' the result for a replacement-style update.','line_number':82,'multiline':False]
['text':' Test that specifying 'fullDocument' as 'updateLookup' does include a 'fullDocument' in','line_number':89,'multiline':False]
['text':' the result for a non-replacement update.','line_number':90,'multiline':False]
['text':' Test how a change stream behaves when it is created with 'fullDocument: updateLookup', then a','line_number':97,'multiline':False]
['text':' document is updated and removed, and then events are retrieved from the change stream.','line_number':98,'multiline':False]
['text':' If this test is running with secondary read preference, it's necessary for the remove','line_number':105,'multiline':False]
['text':' to propagate to all secondary nodes and be available for majority reads before we can','line_number':106,'multiline':False]
['text':' assume looking up the document will fail.','line_number':107,'multiline':False]
['text':' The next entry is the 'update' operation. Because the corresponding document has been deleted,','line_number':110,'multiline':False]
['text':' our attempt to look up the post-image results in a null document.','line_number':111,'multiline':False]
['text':' Test how a change stream behaves when it is created with 'fullDocument: updateLookup' using a','line_number':119,'multiline':False]
['text':' resume token from an earlier point in time, then the collection gets dropped, and then events','line_number':120,'multiline':False]
['text':' are retrieved from the change stream.','line_number':121,'multiline':False]
['text':' Open the $changeStream cursor with batchSize 0 so that no change stream events are prefetched','line_number':125,'multiline':False]
['text':' before the collection is dropped.','line_number':126,'multiline':False]
['text':' Drop the collection and wait until two-phase drop finishes.','line_number':136,'multiline':False]
['text':' If this test is running with secondary read preference, it's necessary for the drop','line_number':141,'multiline':False]
['text':' to propagate to all secondary nodes and be available for majority reads before we can','line_number':142,'multiline':False]
['text':' assume looking up the document will fail.','line_number':143,'multiline':False]
['text':' Check the next $changeStream entry; this is the test document inserted above.','line_number':146,'multiline':False]
['text':' The next entry is the 'update' operation. Because the collection has been dropped, our','line_number':152,'multiline':False]
['text':' attempt to look up the post-image results in a null document.','line_number':153,'multiline':False]
['text':' After a collection has been dropped, verify that a change stream can be created with','line_number':159,'multiline':False]
['text':' 'fullDocument: updateLookup' using a resume token from an earlier point in time.','line_number':160,'multiline':False]
['text':' The next entry is the 'insert' operation.','line_number':170,'multiline':False]
['text':' The next entry is the 'update' operation. Because the collection has been dropped, our','line_number':176,'multiline':False]
['text':' attempt to look up the post-image results in a null document.','line_number':177,'multiline':False]
['text':' Test how a change stream behaves when a collection is dropped and re-created, then the change','line_number':183,'multiline':False]
['text':' stream is created with 'fullDocument: updateLookup' using a resume token from before the','line_number':184,'multiline':False]
['text':' collection was dropped, and then events are retrieved from the change stream.','line_number':185,'multiline':False]
['text':' Insert a new document with the same _id as the document from the previous incarnation of this','line_number':188,'multiline':False]
['text':' collection.','line_number':189,'multiline':False]
['text':' After a collection has been dropped and re-created, verify a change stream can be created with','line_number':192,'multiline':False]
['text':' 'fullDocument: updateLookup' using a resume token from before the collection was dropped.','line_number':193,'multiline':False]
['text':' The next entry is the 'insert' operation.','line_number':203,'multiline':False]
['text':' The next entry is the 'update' operation. Confirm that the next entry's post-image is null','line_number':209,'multiline':False]
['text':' because the original collection (i.e. the collection that the 'update' was applied to) has','line_number':210,'multiline':False]
['text':' been dropped and the new incarnation of the collection has a different UUID.','line_number':211,'multiline':False]
['text':' Test that invalidate entries don't have 'fullDocument' even if 'updateLookup' is','line_number':229,'multiline':False]
['text':' specified.','line_number':230,'multiline':False]
['text':' Wait until two-phase drop finishes.','line_number':238,'multiline':False]
['text':' Only single-collection change streams will be invalidated by the drop.','line_number':246,'multiline':False]
