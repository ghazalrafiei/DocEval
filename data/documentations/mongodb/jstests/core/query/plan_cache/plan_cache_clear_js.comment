['text':' Test clearing of the plan cache, either manually through the planCacheClear command,','line_number':1,'multiline':False]
['text':' or due to system events such as an index build.','line_number':2,'multiline':False]
['text':'','line_number':3,'multiline':False]
['text':' @tags: [','line_number':4,'multiline':False]
['text':'   # The test runs commands that are not allowed with security token: planCacheClear, reIndex.','line_number':5,'multiline':False]
['text':'   not_allowed_with_signed_security_token,','line_number':6,'multiline':False]
['text':'   # This test attempts to perform queries and introspect/manipulate the server's plan cache','line_number':7,'multiline':False]
['text':'   # entries. The former operation may be routed to a secondary in the replica set, whereas the','line_number':8,'multiline':False]
['text':'   # latter must be routed to the primary.','line_number':9,'multiline':False]
['text':'   assumes_read_concern_unchanged,','line_number':10,'multiline':False]
['text':'   assumes_read_preference_unchanged,','line_number':11,'multiline':False]
['text':'   does_not_support_stepdowns,','line_number':12,'multiline':False]
['text':'   # If all chunks are moved off of a shard, it can cause the plan cache to miss commands.','line_number':13,'multiline':False]
['text':'   assumes_balancer_off,','line_number':14,'multiline':False]
['text':'   assumes_unsharded_collection,','line_number':15,'multiline':False]
['text':'   # Plan cache state is node-local and will not get migrated alongside tenant data.','line_number':16,'multiline':False]
['text':'   tenant_migration_incompatible,','line_number':17,'multiline':False]
['text':'   # The SBE plan cache was first enabled in 6.3.','line_number':18,'multiline':False]
['text':'   requires_fcv_63,','line_number':19,'multiline':False]
['text':'   # TODO SERVER-67607: Test plan cache with CQF enabled.','line_number':20,'multiline':False]
['text':'   cqf_experimental_incompatible,','line_number':21,'multiline':False]
['text':'   references_foreign_collection,','line_number':22,'multiline':False]
['text':' ]','line_number':23,'multiline':False]
['text':' Run query 'queryArg' against collection 'collArg' and add it to the map 'curCache'.','line_number':40,'multiline':False]
['text':' Check that the query produced 'resCount' results, and that 'curCache' contains','line_number':41,'multiline':False]
['text':' 'numCachedQueries' entries.','line_number':42,'multiline':False]
['text':' Essentially, this functions runs a query, and add its both to the query cache and to','line_number':43,'multiline':False]
['text':' the map 'curCache' which should mirror the queries in the query cache.','line_number':44,'multiline':False]
['text':' This allows the test to keep curCache in sync with the query cache.','line_number':45,'multiline':False]
['text':' Remove a query both from the query cache, and curCache.','line_number':61,'multiline':False]
['text':' In this way both are kept in sync.','line_number':62,'multiline':False]
['text':' We need two indices so that the MultiPlanRunner is executed.','line_number':93,'multiline':False]
['text':' The queries in this set are expected to be in the query cache at any time.','line_number':97,'multiline':False]
['text':' Run a query so that an entry is inserted into the cache.','line_number':100,'multiline':False]
['text':' Invalid key should be a no-op.','line_number':109,'multiline':False]
['text':' Introduce a second plan cache entry.','line_number':113,'multiline':False]
['text':' Drop one of the two shapes from the cache.','line_number':123,'multiline':False]
['text':' Drop the second shape from the cache.','line_number':127,'multiline':False]
['text':' planCacheClear can clear $expr queries.','line_number':131,'multiline':False]
['text':' planCacheClear fails with an $expr query with an unbound variable.','line_number':142,'multiline':False]
['text':' Insert two more shapes into the cache.','line_number':146,'multiline':False]
['text':' Error cases.','line_number':164,'multiline':False]
['text':' 'sort' parameter is not allowed without 'query' parameter.','line_number':171,'multiline':False]
['text':' 'projection' parameter is not allowed with 'query' parameter.','line_number':174,'multiline':False]
['text':' Drop query cache. This clears all cached queries in the collection.','line_number':178,'multiline':False]
['text':' Clearing the plan cache for a non-existent collection should succeed.','line_number':181,'multiline':False]
['text':' Plan cache commands should work against the main collection only, not foreignColl','line_number':187,'multiline':False]
['text':' collections, when $lookup is pushed down into SBE.','line_number':188,'multiline':False]
['text':' We need two indices so that the multi-planner is executed.','line_number':193,'multiline':False]
['text':' Test case 1: clear plan cache on the main collection.','line_number':204,'multiline':False]
['text':'','line_number':205,'multiline':False]
['text':' Run a query against the 'foreignColl' and make sure it's cached.','line_number':206,'multiline':False]
['text':' Run the '$lookup' query and make sure it's cached.','line_number':218,'multiline':False]
['text':' Drop query cache on the main collection. This clears all cached queries in the main','line_number':228,'multiline':False]
['text':' collection only.','line_number':229,'multiline':False]
['text':' Test case 2: clear plan cache on the foreign collection.','line_number':235,'multiline':False]
['text':'','line_number':236,'multiline':False]
['text':' Run the '$lookup' query again and make sure it's cached.','line_number':237,'multiline':False]
['text':' Drop query cache on the foreign collection. Make sure that the plan cache on the main','line_number':247,'multiline':False]
['text':' collection is not affected.','line_number':248,'multiline':False]
['text':' Test case 3: clear plan cache on the main collection by query shape.','line_number':252,'multiline':False]
['text':'','line_number':253,'multiline':False]
['text':' Run a query against the 'foreignColl' and make sure it's cached.','line_number':254,'multiline':False]
['text':' Run the '$lookup' query and make sure it's cached.','line_number':266,'multiline':False]
['text':' Drop query cache by the query shape. This clears all cached queries in the main','line_number':276,'multiline':False]
['text':' collection only.','line_number':277,'multiline':False]
['text':' Test case 4: clear plan cache on the foreign collection by (empty) query shape.','line_number':283,'multiline':False]
['text':'','line_number':284,'multiline':False]
['text':' Run two queries against the 'foreignColl' and make sure they're cached.','line_number':285,'multiline':False]
['text':' Run the '$lookup' query and make sure it's cached.','line_number':304,'multiline':False]
['text':' Drop query cache on the foreign collection by the query shape. This clears one cached','line_number':314,'multiline':False]
['text':' query in the foreign collection only.','line_number':315,'multiline':False]
['text':' Test case 5: clear by query shape which matches $lookup and non-$lookup queries.','line_number':322,'multiline':False]
['text':'','line_number':323,'multiline':False]
['text':' Run the query on the main collection whose plan cache key command shape matches the shape of','line_number':324,'multiline':False]
['text':' the $lookup query.','line_number':325,'multiline':False]
['text':' Run another query on the main collection with a totally different shape.','line_number':335,'multiline':False]
['text':' Drop query cache on the main collection by the query shape. This clears two cached queries in','line_number':345,'multiline':False]
['text':' the main collection which match the query shape.','line_number':346,'multiline':False]
['text':'','line_number':354,'multiline':False]
['text':' Query Plan Revision','line_number':355,'multiline':False]
['text':' http://docs.mongodb.org/manual/core/query-plans/#query-plan-revision','line_number':356,'multiline':False]
['text':' As collections change over time, the query optimizer deletes the query plan and re-evaluates','line_number':357,'multiline':False]
['text':' after any of the following events:','line_number':358,'multiline':False]
['text':' - The reIndex rebuilds the index.','line_number':359,'multiline':False]
['text':' - You add or drop an index.','line_number':360,'multiline':False]
['text':' - The mongod process restarts.','line_number':361,'multiline':False]
['text':'','line_number':362,'multiline':False]
['text':' Make sure the cache is emtpy.','line_number':364,'multiline':False]
['text':' Case 1: The reIndex rebuilds the index.','line_number':367,'multiline':False]
['text':' Steps:','line_number':368,'multiline':False]
['text':'     Populate the cache with 1 entry.','line_number':369,'multiline':False]
['text':'     Run reIndex on the collection.','line_number':370,'multiline':False]
['text':'     Confirm that cache is empty.','line_number':371,'multiline':False]
['text':' (Only standalone mode supports the reIndex command.)','line_number':372,'multiline':False]
['text':' Case 2: You add or drop an index.','line_number':387,'multiline':False]
['text':' Steps:','line_number':388,'multiline':False]
['text':'     Populate the cache with 1 entry.','line_number':389,'multiline':False]
['text':'     Add an index.','line_number':390,'multiline':False]
['text':'     Confirm that cache is empty.','line_number':391,'multiline':False]
['text':' Case 3: The mongod process restarts','line_number':404,'multiline':False]
['text':' Not applicable.','line_number':405,'multiline':False]
