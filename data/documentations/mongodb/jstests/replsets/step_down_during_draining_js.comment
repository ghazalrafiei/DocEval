['text':' Test stepdown during drain mode','line_number':1,'multiline':False]
['text':' 1. Set up a 3-node set. Assume Node 1 is the primary at the beginning for simplicity.','line_number':2,'multiline':False]
['text':' 2. Prevent applying retrieved ops on all secondaries, including Node 2.','line_number':3,'multiline':False]
['text':' 3. Insert data to ensure Node 2 has ops to apply in its queue.','line_number':4,'multiline':False]
['text':' 4. Step up Node 2. Now it enters drain mode, but cannot proceed.','line_number':5,'multiline':False]
['text':' 5. Step up Node 1. Wait until Node 2 knows of a higher term and steps down.','line_number':6,'multiline':False]
['text':'    Node 2 re-enables bgsync producer while it's still in drain mode.','line_number':7,'multiline':False]
['text':' 6. Step up Node 2 again. It enters drain mode again.','line_number':8,'multiline':False]
['text':' 7. Enable applying ops.','line_number':9,'multiline':False]
['text':' 8. Ensure the ops in queue are applied and that Node 2 begins to accept writes as usual.','line_number':10,'multiline':False]
['text':' Set verbosity for replication on all nodes.','line_number':27,'multiline':False]
['text':' The default WC is majority and rsSyncApplyStop failpoint will prevent satisfying any majority','line_number':49,'multiline':False]
['text':' writes.','line_number':50,'multiline':False]
['text':' Do an initial insert to prevent the secondary from going into recovery','line_number':54,'multiline':False]
['text':' Enable fail point to stop replication.','line_number':60,'multiline':False]
['text':' Secondary doesn't allow writes yet.','line_number':87,'multiline':False]
['text':' Original primary steps up.','line_number':91,'multiline':False]
['text':' Disable fail point to allow replication.','line_number':98,'multiline':False]
['text':' Wait for draining to complete.','line_number':101,'multiline':False]
['text':' Ensure new primary is writable, and wait until the write has been replicated to all nodes, to','line_number':105,'multiline':False]
['text':' allow rollback (should it occur), to complete.','line_number':106,'multiline':False]
['text':' Check that all writes reached the secondary's op queue prior to','line_number':109,'multiline':False]
['text':' stepping down the original primary and got applied.','line_number':110,'multiline':False]
