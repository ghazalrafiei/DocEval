['text':'*
 * This tests that upgrading and downgrading FCV will unblock and reply to waiting hello
 * requests.
 *
 * @tags: [multiversion_incompatible]
 ','line_number':1,'multiline':True]
['text':' We only expect to increment the server TopologyVersion when the minWireVersion has changed.','line_number':22,'multiline':False]
['text':' This can only happen in two scenarios:','line_number':23,'multiline':False]
['text':' 1. Setting featureCompatibilityVersion from downgrading to fullyDowngraded.','line_number':24,'multiline':False]
['text':' 2. Setting featureCompatibilityVersion from fullyDowngraded to upgrading.','line_number':25,'multiline':False]
['text':' minWireVersion should always equal maxWireVersion if we have not fully downgraded FCV.','line_number':37,'multiline':False]
['text':' This test manually runs hello with the 'internalClient' field, which means that to the','line_number':58,'multiline':False]
['text':' mongod, the connection appears to be from another server. This makes mongod to return an','line_number':59,'multiline':False]
['text':' hello response with a real 'minWireVersion' for internal clients instead of 0.','line_number':60,'multiline':False]
['text':'','line_number':61,'multiline':False]
['text':' The value of 'internalClient.maxWireVersion' in the hello command does not matter for the','line_number':62,'multiline':False]
['text':' purpose of this test and the hello command will succeed regardless because this is run','line_number':63,'multiline':False]
['text':' through the shell and the shell is always compatible talking to the server. In reality','line_number':64,'multiline':False]
['text':' though, a real internal client with a lower binary version is expected to hang up immediately','line_number':65,'multiline':False]
['text':' after receiving the response to the hello command from a latest server with an upgraded','line_number':66,'multiline':False]
['text':' FCV.','line_number':67,'multiline':False]
['text':'','line_number':68,'multiline':False]
['text':' And we need to use a side connection to do so in order to prevent the test connection from','line_number':69,'multiline':False]
['text':' being closed on FCV changes.','line_number':70,'multiline':False]
['text':' Get the server topologyVersion, minWireVersion, and maxWireversion.','line_number':81,'multiline':False]
['text':' A failpoint signalling that the servers have received the hello request and are waiting','line_number':99,'multiline':False]
['text':' for a topology change.','line_number':100,'multiline':False]
['text':' Send an awaitable hello request. This will block until maxAwaitTimeMS has elapsed or a','line_number':104,'multiline':False]
['text':' topology change happens.','line_number':105,'multiline':False]
['text':' isPrimary ','line_number':110,'multiline':True]
['text':' isPrimary ','line_number':118,'multiline':True]
['text':' Each node has one hello request waiting on a topology change.','line_number':125,'multiline':False]
['text':' Setting the FCV to the same version will not trigger an hello response.','line_number':133,'multiline':False]
['text':' Each node still has one hello request waiting on a topology change.','line_number':139,'multiline':False]
['text':' Downgrading the FCV will cause the hello requests to respond on both primary and','line_number':148,'multiline':False]
['text':' secondary.','line_number':149,'multiline':False]
['text':' Ensure the featureCompatibilityVersion document update has been replicated.','line_number':154,'multiline':False]
['text':' The new configuration may not have been installed on the secondary yet, though it has reached','line_number':158,'multiline':False]
['text':' the secondary.','line_number':159,'multiline':False]
['text':' All hello requests should have been responded to after the FCV change.','line_number':162,'multiline':False]
['text':' Get the new topologyVersion.','line_number':170,'multiline':False]
['text':' Test upgrading from last-lts to last-continuous FCV. We allow this upgrade path via the','line_number':184,'multiline':False]
['text':' setFeatureCompatibilityVersion command with fromConfigServer: true.','line_number':185,'multiline':False]
['text':' Reconfigure the failpoint to refresh the number of times the failpoint has been entered.','line_number':187,'multiline':False]
['text':' isPrimary ','line_number':194,'multiline':True]
['text':' isPrimary ','line_number':202,'multiline':True]
['text':' Each node has one hello request waiting on a topology change.','line_number':209,'multiline':False]
['text':' Upgrade the FCV to last-continuous.','line_number':217,'multiline':False]
['text':' Ensure the featureCompatibilityVersion document update has been replicated.','line_number':226,'multiline':False]
['text':' All hello requests should have been responded to after the FCV change.','line_number':231,'multiline':False]
['text':' Reset the FCV back to last-lts and the get the new hello parameters.','line_number':239,'multiline':False]
['text':' We must upgrade to latestFCV first since downgrading from last-continuous to last-stable','line_number':240,'multiline':False]
['text':' is forbidden.','line_number':241,'multiline':False]
['text':' The new configuration may not have been installed on the secondary yet, though it has','line_number':249,'multiline':False]
['text':' reached the secondary.','line_number':250,'multiline':False]
['text':' Reconfigure the failpoint to refresh the number of times the failpoint has been entered.','line_number':266,'multiline':False]
['text':' isPrimary ','line_number':273,'multiline':True]
['text':' isPrimary ','line_number':281,'multiline':True]
['text':' Each node has one hello request waiting on a topology change.','line_number':288,'multiline':False]
['text':' Setting the FCV to the same version will not trigger an hello response.','line_number':296,'multiline':False]
['text':' Each node still has one hello request waiting on a topology change.','line_number':302,'multiline':False]
['text':' Upgrading the FCV will cause the hello requests to respond on both primary and secondary.','line_number':311,'multiline':False]
['text':' Ensure the featureCompatibilityVersion document update has been replicated.','line_number':316,'multiline':False]
['text':' All hello requests should have been responded to after the FCV change.','line_number':321,'multiline':False]
