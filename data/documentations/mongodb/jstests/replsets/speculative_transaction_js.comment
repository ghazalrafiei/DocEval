['text':'*
 * Test that transactions are executed speculatively.  This means two transactions affecting
 * the same document can run back to back without waiting for the first transaction to
 * commit to a majority.
 *
 * @tags: [uses_transactions, requires_majority_read_concern]
 ','line_number':1,'multiline':True]
['text':' The default WC is majority and stopServerReplication will prevent satisfying any majority writes.','line_number':21,'multiline':False]
['text':' Do an initial write so we have something to update.','line_number':28,'multiline':False]
['text':' Stop replication on the secondary so the majority commit never moves forward.','line_number':32,'multiline':False]
['text':' Initiate a session on the primary.','line_number':35,'multiline':False]
['text':' Start the first transaction.  Do not use majority commit for this one.','line_number':40,'multiline':False]
['text':' The document should be updated on the local snapshot.','line_number':48,'multiline':False]
['text':' The document should not be updated in the majority snapshot.','line_number':51,'multiline':False]
['text':' Start a second transaction.  Still do not use majority commit for this one.','line_number':55,'multiline':False]
['text':' We should see the updated doc within the transaction as a result of speculative read','line_number':58,'multiline':False]
['text':' concern.','line_number':59,'multiline':False]
['text':' Update it again.','line_number':62,'multiline':False]
['text':' Update a different document outside the transaction.','line_number':65,'multiline':False]
['text':' Within the transaction, we should not see the out-of-transaction update.','line_number':68,'multiline':False]
['text':' The document should be updated on the local snapshot.','line_number':73,'multiline':False]
['text':' The document should not be updated in the majority snapshot.','line_number':76,'multiline':False]
['text':' Make sure write conflicts are caught with speculative transactions.','line_number':79,'multiline':False]
['text':' Read some data inside the transaction.','line_number':83,'multiline':False]
['text':' Write it outside the transaction.','line_number':86,'multiline':False]
['text':' Can still read old data in transaction.','line_number':89,'multiline':False]
['text':' But update fails','line_number':92,'multiline':False]
['text':' Restart server replication to allow majority commit point to advance.','line_number':99,'multiline':False]
['text':' Start a third transaction, with majority commit.','line_number':103,'multiline':False]
['text':' We should see the updated doc within the transaction.','line_number':106,'multiline':False]
['text':' Update it one more time.','line_number':109,'multiline':False]
['text':' The document should be updated on the local snapshot.','line_number':114,'multiline':False]
['text':' The document should also be updated in the majority snapshot.','line_number':117,'multiline':False]
