['text':'*
 * Tests that initial sync chooses the correct sync source based on chaining and the
 * initialSyncReadPreference.
 *
 * @tags: [
 * ]
 ','line_number':1,'multiline':True]
['text':' Hang the node before it undergoes sync source selection.','line_number':12,'multiline':False]
['text':' Wait until the initial sync node knows who the primary is, and for heartbeats from the','line_number':19,'multiline':False]
['text':' primary to increase the ping time.','line_number':20,'multiline':False]
['text':' The primary should always be node 0, since node 1 has priority 0.','line_number':24,'multiline':False]
['text':' Allow the node to advance past the sync source selection stage.','line_number':30,'multiline':False]
['text':' Wait for the restarted node to hit initial sync, then wait for heartbeats. This is to','line_number':50,'multiline':False]
['text':' prevent a potential race where we wait for heartbeats in startup recovery, which satisfies','line_number':51,'multiline':False]
['text':' the JS test, but then restart heartbeats and treat the other nodes as DOWN when entering','line_number':52,'multiline':False]
['text':' initial sync.','line_number':53,'multiline':False]
['text':' Adds a delay long enough to make a node not the "nearest" sync source.','line_number':58,'multiline':False]
['text':' Skip validation while bringing the initial sync node up and down, because we don't wait for the','line_number':69,'multiline':False]
['text':' sync to complete.','line_number':70,'multiline':False]
['text':' Add some data to be cloned.','line_number':73,'multiline':False]
['text':' Ensure we see the sync source progress messages.','line_number':78,'multiline':False]
['text':' With zero votes and a default initialSyncSourceReadPreference, the secondary should be the sync','line_number':98,'multiline':False]
['text':' source because this is equivalent to "nearest" and the primary is delayed.','line_number':99,'multiline':False]
['text':'-----------------------------------------------------------------------------------------------','line_number':104,'multiline':True]
['text':' With an initialSyncSourceReadPreference of 'primaryPreferred', the primary should be the sync','line_number':111,'multiline':False]
['text':' source even when it is delayed.','line_number':112,'multiline':False]
['text':'-----------------------------------------------------------------------------------------------','line_number':117,'multiline':True]
['text':' Switch to a configuration with a voting node, which should prefer the primary normally.       ','line_number':118,'multiline':True]
['text':'-----------------------------------------------------------------------------------------------','line_number':119,'multiline':True]
['text':' Ensure sync source selection is logged.','line_number':127,'multiline':False]
['text':' With a voting node and a default initialSyncSourceReadPreference, the primary should be the sync','line_number':131,'multiline':False]
['text':' source, though it is delayed.','line_number':132,'multiline':False]
['text':'-----------------------------------------------------------------------------------------------','line_number':137,'multiline':True]
['text':' Even with a voting node, the secondary should be chosen when 'secondaryPreferred' is used.','line_number':144,'multiline':False]
['text':'-----------------------------------------------------------------------------------------------','line_number':149,'multiline':True]
['text':' Switch back to a non-voting node, and disable chaining also.                                  ','line_number':150,'multiline':True]
['text':'-----------------------------------------------------------------------------------------------','line_number':151,'multiline':True]
['text':'-----------------------------------------------------------------------------------------------','line_number':158,'multiline':True]
['text':' With chaining disabled, the default should be to select the primary even though it is delayed.','line_number':163,'multiline':False]
['text':'-----------------------------------------------------------------------------------------------','line_number':168,'multiline':True]
['text':' With chaining disabled, we choose the delayed secondary over the non-delayed primary when','line_number':173,'multiline':False]
['text':' readPreference is explicitly 'nearest'.','line_number':174,'multiline':False]
['text':' Once we become secondary, the secondary read preference no longer matters and we choose the','line_number':179,'multiline':False]
['text':' primary because chaining is disallowed.','line_number':180,'multiline':False]
