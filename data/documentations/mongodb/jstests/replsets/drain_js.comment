['text':' Test drain mode when transitioning to PRIMARY','line_number':1,'multiline':False]
['text':' 1. Set up a 3-node set.','line_number':2,'multiline':False]
['text':' 2. Prevent applying retrieved ops on the SECONDARY.','line_number':3,'multiline':False]
['text':' 3. Insert data to ensure the SECONDARY has ops to apply in its queue.','line_number':4,'multiline':False]
['text':' 4. Shutdown PRIMARY.','line_number':5,'multiline':False]
['text':' 5. Wait for SECONDARY to become PRIMARY.','line_number':6,'multiline':False]
['text':' 6. Confirm that the new PRIMARY cannot accept writes while in drain mode.','line_number':7,'multiline':False]
['text':' 6a. Confirm that the new PRIMARY cannot accept reads while in drain mode.','line_number':8,'multiline':False]
['text':' 7. Enable applying ops.','line_number':9,'multiline':False]
['text':' 8. Ensure the ops in queue are applied and that the PRIMARY begins to accept writes as usual.','line_number':10,'multiline':False]
['text':' No primary catch-up so we focus on the drain mode.','line_number':22,'multiline':False]
['text':' The default WC is majority and rsSyncApplyStop failpoint will prevent satisfying any majority','line_number':29,'multiline':False]
['text':' writes.','line_number':30,'multiline':False]
['text':' Do an initial insert to prevent the secondary from going into recovery','line_number':34,'multiline':False]
['text':' Kill primary; secondary will enter drain mode to catch up','line_number':61,'multiline':False]
['text':' Ensure new primary is not yet writable','line_number':66,'multiline':False]
['text':' Ensure new primary is not yet readable without secondaryOk bit.','line_number':71,'multiline':False]
['text':' Nor should it be readable with the secondaryOk bit.','line_number':79,'multiline':False]
['text':' Allow draining to complete','line_number':85,'multiline':False]
['text':' Ensure new primary is writable','line_number':92,'multiline':False]
['text':' Check for at least two entries. There was one prior to freezing op application on the','line_number':95,'multiline':False]
['text':' secondary and we cannot guarantee all writes reached the secondary's op queue prior to','line_number':96,'multiline':False]
['text':' shutting down the original primary.','line_number':97,'multiline':False]
