['text':'*
 * Tests for the validation of the "on" fields at parse-time of $merge stage itself, as well as
 * during runtime extraction of the "on" fields from documents in the aggregation pipeline.
 *
 * This test creates unique indexes on various combinations of fields, so it cannot be run in suites
 * that implicitly shard the collection with a hashed shard key.
 * @tags: [
 *   cannot_create_unique_index_when_using_hashed_shard_key,
 * ]
 ','line_number':1,'multiline':True]
['text':'','line_number':19,'multiline':False]
['text':' Tests for invalid "on" fields specifications.','line_number':20,'multiline':False]
['text':'','line_number':21,'multiline':False]
['text':' A non-array or string "on" fields is prohibited.','line_number':30,'multiline':False]
['text':' Explicitly specifying an empty-array "on" fields is invalid.','line_number':34,'multiline':False]
['text':' The "on" fields array won't be accepted if any element is not a string.','line_number':37,'multiline':False]
['text':'','line_number':43,'multiline':False]
['text':' An error is raised if $merge encounters a document that is missing one or more of the','line_number':44,'multiline':False]
['text':' "on" fields.','line_number':45,'multiline':False]
['text':'','line_number':46,'multiline':False]
['text':' Missing both "name" and "team".','line_number':58,'multiline':False]
['text':' Missing "name".','line_number':61,'multiline':False]
['text':' Missing "team".','line_number':65,'multiline':False]
['text':' A document with both "name" and "team" will be accepted.','line_number':69,'multiline':False]
['text':'','line_number':74,'multiline':False]
['text':' An error is raised if $merge encounters a document where one of the "on" fields is a nullish','line_number':75,'multiline':False]
['text':' value.','line_number':76,'multiline':False]
['text':'','line_number':77,'multiline':False]
['text':' Explicit null "song" (a prefix of an "on" field).','line_number':89,'multiline':False]
['text':' Explicit undefined "song" (a prefix of an "on" field).','line_number':93,'multiline':False]
['text':' Explicit null "song.artist".','line_number':97,'multiline':False]
['text':' Explicit undefined "song.artist".','line_number':101,'multiline':False]
['text':' A valid "artist" will be accepted.','line_number':105,'multiline':False]
['text':'','line_number':110,'multiline':False]
['text':' An error is raised if $merge encounters a document where one of the "on" fields (or a prefix','line_number':111,'multiline':False]
['text':' of an "on" field) is an array.','line_number':112,'multiline':False]
['text':'','line_number':113,'multiline':False]
['text':' "address.street" is an array.','line_number':125,'multiline':False]
['text':' "address" is an array (a prefix of an "on" field).','line_number':130,'multiline':False]
['text':' A scalar "address.street" is accepted.','line_number':134,'multiline':False]
['text':' Test that the 'on' field can contain dots and dollars.','line_number':139,'multiline':False]
['text':' '$'-prefixed fields are not allowed here because $merge's 'on' field must be indexed, but we','line_number':140,'multiline':False]
['text':' cannot build indexes on $-prefixed fields. Field names containing dots also cannot be used','line_number':141,'multiline':False]
['text':' here, because the "on" field of $merge does implicit path traversal, so "a.b" always refers','line_number':142,'multiline':False]
['text':' to the path {a: {b: ...}} here. These tests just make sure we can still merge on fields','line_number':143,'multiline':False]
['text':' containing $s in arbitrary non-prefix places.','line_number':144,'multiline':False]
['text':' Create index on given fieldname.','line_number':148,'multiline':False]
['text':' Update object to use fieldname.','line_number':151,'multiline':False]
['text':' Test $merge on fieldname.','line_number':155,'multiline':False]
