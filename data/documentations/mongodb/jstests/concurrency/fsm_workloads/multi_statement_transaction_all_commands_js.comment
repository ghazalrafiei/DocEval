['text':'*
 * Runs findAndModify, update, delete, find, and getMore within a transaction.
 *
 * @tags: [uses_transactions, state_functions_share_transaction]
 ','line_number':1,'multiline':True]
['text':' joinAndRetry is true either if there is a TransientTransactionError or if','line_number':20,'multiline':False]
['text':' startTransaction fails with ConflictingOperationInProgress. The latter occurs when we','line_number':21,'multiline':False]
['text':' attempt to start a transaction with a txnNumber that is already active on this session.','line_number':22,'multiline':False]
['text':' In both cases, we will re-run the command with this txnNumber without calling','line_number':23,'multiline':False]
['text':' startTransaction, and essentially join the already running transaction.','line_number':24,'multiline':False]
['text':' We pass `ignoreActiveTxn = true` to startTransaction so that we will not','line_number':36,'multiline':False]
['text':' throw `Transaction already in progress on this session` when trying to start','line_number':37,'multiline':False]
['text':' a new transaction on this client session that already has an active','line_number':38,'multiline':False]
['text':' transaction on it. We instead will catch the ConflictingOperationInProgress','line_number':39,'multiline':False]
['text':' error that the server later throws, and will re-run the command with','line_number':40,'multiline':False]
['text':' 'startTransaction = false' so that we join the already running transaction.','line_number':41,'multiline':False]
['text':' shouldJoin is true when commitTransaction fails with ConflictingOperationInProgress.','line_number':106,'multiline':False]
['text':' This occurs when there's a transaction with the same txnNumber running on this','line_number':107,'multiline':False]
['text':' session. In this case we "join" this other transaction and retry the commit, meaning','line_number':108,'multiline':False]
['text':' all operations that were run on this thread will be committed in the same transaction','line_number':109,'multiline':False]
['text':' as the transaction we join.','line_number':110,'multiline':False]
['text':' If we get TransactionTooOld, TransactionCommitted, or NoSuchTransaction','line_number':121,'multiline':False]
['text':' we do not try to commit this transaction.','line_number':122,'multiline':False]
['text':' Wrap each state in a cleanupOnLastIteration() invocation.','line_number':142,'multiline':False]
['text':' Advance each router's cluster time to be >= the time of the writes, so the first','line_number':163,'multiline':False]
['text':' global snapshots chosen by each is guaranteed to include the inserted documents.','line_number':164,'multiline':False]
