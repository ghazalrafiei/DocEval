['text':'!/bin/bash','line_number':1,'multiline':False]
['text':' Copyright 2019 The Kubernetes Authors.','line_number':3,'multiline':False]
['text':'','line_number':4,'multiline':False]
['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':5,'multiline':False]
['text':' you may not use this file except in compliance with the License.','line_number':6,'multiline':False]
['text':' You may obtain a copy of the License at','line_number':7,'multiline':False]
['text':'','line_number':8,'multiline':False]
['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':9,'multiline':False]
['text':'','line_number':10,'multiline':False]
['text':' Unless required by applicable law or agreed to in writing, software','line_number':11,'multiline':False]
['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':12,'multiline':False]
['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':13,'multiline':False]
['text':' See the License for the specific language governing permissions and','line_number':14,'multiline':False]
['text':' limitations under the License.','line_number':15,'multiline':False]
['text':' A small smoke test to run against a just-deployed kube-up cluster with Windows','line_number':17,'multiline':False]
['text':' nodes. Performs checks such as:','line_number':18,'multiline':False]
['text':'   1) Verifying that all Windows nodes have status Ready.','line_number':19,'multiline':False]
['text':'   2) Verifying that no system pods are attempting to run on Windows nodes.','line_number':20,'multiline':False]
['text':'   3) Verifying pairwise connectivity between most of the following: Linux','line_number':21,'multiline':False]
['text':'      pods, Windows pods, K8s services, and the Internet.','line_number':22,'multiline':False]
['text':'   4) Verifying that basic DNS resolution works in Windows pods.','line_number':23,'multiline':False]
['text':'','line_number':24,'multiline':False]
['text':' This script assumes that it is run from the root of the kubernetes repository.','line_number':25,'multiline':False]
['text':'','line_number':26,'multiline':False]
['text':' TODOs:','line_number':27,'multiline':False]
['text':'   - Implement the node-to-pod checks.','line_number':28,'multiline':False]
['text':'   - Capture stdout for each command to a file and only print it when the test','line_number':29,'multiline':False]
['text':'     fails.','line_number':30,'multiline':False]
['text':'   - Move copy-pasted code into reusable functions.','line_number':31,'multiline':False]
['text':'   - Continue running all checks after one fails.','line_number':32,'multiline':False]
['text':'   - Test service connectivity by running a test pod with an http server and','line_number':33,'multiline':False]
['text':'     exposing it as a service (rather than curl-ing from existing system','line_number':34,'multiline':False]
['text':'     services that don't serve http requests).','line_number':35,'multiline':False]
['text':'   - Add test retries for transient errors, such as:','line_number':36,'multiline':False]
['text':'     "error: unable to upgrade connection: Authorization error','line_number':37,'multiline':False]
['text':'     (user=kube-apiserver, verb=create, resource=nodes, subresource=proxy)"','line_number':38,'multiline':False]
['text':' Override this to use a different kubectl binary.','line_number':40,'multiline':False]
['text':' kubectl filtering is the worst.','line_number':47,'multiline':False]
['text':' Untaint the windows nodes to allow test workloads without tolerations to be','line_number':62,'multiline':False]
['text':' scheduled onto them.','line_number':63,'multiline':False]
['text':' Returns the name of an arbitrary Linux webserver pod.','line_number':142,'multiline':False]
['text':' Returns the IP address of an arbitrary Linux webserver pod.','line_number':148,'multiline':False]
['text':' Returns the name of an arbitrary Linux command pod.','line_number':219,'multiline':False]
['text':' Returns the IP address of an arbitrary Linux command pod.','line_number':225,'multiline':False]
['text':' Installs test executables (ping, curl) in the Linux command pod.','line_number':231,'multiline':False]
['text':' NOTE: this assumes that there is only one Linux "command pod".','line_number':232,'multiline':False]
['text':' TODO(pjh): fix this.','line_number':233,'multiline':False]
['text':' The default port for 'agnhost serve-hostname'. The documentation says that','line_number':250,'multiline':False]
['text':' this can be changed but the --port arg does not seem to work.','line_number':251,'multiline':False]
['text':' A multi-arch Windows container that runs an HTTP server on port','line_number':258,'multiline':False]
['text':' $windows_webserver_port that serves the container's hostname.','line_number':259,'multiline':False]
['text':'   curl -s http://<pod_ip>:$windows_webserver_port','line_number':260,'multiline':False]
['text':' Deploys a multi-arch Windows pod capable of running PowerShell.','line_number':339,'multiline':False]
['text':' TODO(pjh): this test flakily fails on brand-new clusters, not sure why.','line_number':439,'multiline':False]
['text':' % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current','line_number':440,'multiline':False]
['text':'                                Dload  Upload   Total   Spent    Left  Speed','line_number':441,'multiline':False]
['text':' 0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0','line_number':442,'multiline':False]
['text':' curl: (6) Could not resolve host:','line_number':443,'multiline':False]
['text':' command terminated with exit code 6','line_number':444,'multiline':False]
['text':' A stable (hopefully) HTTP server provided by Cloudflare.','line_number':466,'multiline':False]
['text':' curl-ing the metrics-server service downloads 14 bytes of unprintable binary','line_number':491,'multiline':False]
['text':' data and sets a return code of success (0).','line_number':492,'multiline':False]
['text':' TODO(pjh): this test failed for me once with','line_number':510,'multiline':False]
['text':'   error: unable to upgrade connection: container not found ("nettest")','line_number':511,'multiline':False]
['text':' Maybe the container crashed for some reason? Investigate if it happens more.','line_number':512,'multiline':False]
['text':'','line_number':513,'multiline':False]
['text':' TODO(pjh): another one-time failure:','line_number':514,'multiline':False]
['text':'   error: unable to upgrade connection: Authorization error','line_number':515,'multiline':False]
['text':'   (user=kube-apiserver, verb=create, resource=nodes, subresource=proxy)','line_number':516,'multiline':False]
['text':' A stable (hopefully) HTTP server provided by Cloudflare. If this ever stops','line_number':555,'multiline':False]
['text':' working, we can request from 8.8.8.8 (Google DNS) using https instead.','line_number':556,'multiline':False]
['text':' curl-ing the metrics-server service results in a ServerProtocolViolation','line_number':582,'multiline':False]
['text':' ("The server committed a protocol violation. Section=ResponseStatusLine")','line_number':583,'multiline':False]
['text':' exception. Since we don't care about what the metrics-server actually gives','line_number':584,'multiline':False]
['text':' back to us, just that we can reach it, we check that we get the expected','line_number':585,'multiline':False]
['text':' exception code and not some other exception code.','line_number':586,'multiline':False]
['text':' TODO: it might be less fragile to check that we don't get the "Unable to','line_number':587,'multiline':False]
['text':' connect to the remote server" exception code (2) instead of specifically','line_number':588,'multiline':False]
['text':' expecting the protocol-violation exception code (11).','line_number':589,'multiline':False]
['text':' Note: test_windows_node_to_k8s_service is not supported at this time.','line_number':666,'multiline':False]
['text':' https://docs.microsoft.com/en-us/virtualization/windowscontainers/kubernetes/common-problems#my-windows-node-cannot-access-my-services-using-the-service-ip','line_number':667,'multiline':False]
