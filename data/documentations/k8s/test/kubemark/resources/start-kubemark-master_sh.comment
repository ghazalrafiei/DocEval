['text':'!/usr/bin/env bash','line_number':1,'multiline':False]
['text':' Copyright 2015 The Kubernetes Authors.','line_number':3,'multiline':False]
['text':'','line_number':4,'multiline':False]
['text':' Licensed under the Apache License, Version 2.0 (the "License");','line_number':5,'multiline':False]
['text':' you may not use this file except in compliance with the License.','line_number':6,'multiline':False]
['text':' You may obtain a copy of the License at','line_number':7,'multiline':False]
['text':'','line_number':8,'multiline':False]
['text':'     http://www.apache.org/licenses/LICENSE-2.0','line_number':9,'multiline':False]
['text':'','line_number':10,'multiline':False]
['text':' Unless required by applicable law or agreed to in writing, software','line_number':11,'multiline':False]
['text':' distributed under the License is distributed on an "AS IS" BASIS,','line_number':12,'multiline':False]
['text':' WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.','line_number':13,'multiline':False]
['text':' See the License for the specific language governing permissions and','line_number':14,'multiline':False]
['text':' limitations under the License.','line_number':15,'multiline':False]
['text':' Script that starts kubelet on kubemark-master as a supervisord process','line_number':17,'multiline':False]
['text':' and then runs the master components as pods using kubelet.','line_number':18,'multiline':False]
['text':' Define key path variables.','line_number':24,'multiline':False]
['text':' The GCI image has host firewall which drop most inbound/forwarded packets.','line_number':30,'multiline':False]
['text':' We need to add rules to accept all TCP/UDP/ICMP packets.','line_number':31,'multiline':False]
['text':' Setup working directory for kubelet.','line_number':53,'multiline':False]
['text':' Remove any default etcd config dirs/files.','line_number':60,'multiline':False]
['text':' Compute etcd related variables.','line_number':76,'multiline':False]
['text':' TODO: Set larger quota to see if that helps with','line_number':81,'multiline':False]
['text':' 'mvcc: database space exceeded' errors. If so, pipe','line_number':82,'multiline':False]
['text':' though our setup scripts.','line_number':83,'multiline':False]
['text':' Formats the given device ($1) if needed and mounts it at given mount point','line_number':88,'multiline':False]
['text':' ($2).','line_number':89,'multiline':False]
['text':' Format only if the disk is not already formatted.','line_number':94,'multiline':False]
['text':' Finds a PD device with name '$1' attached to the master.','line_number':104,'multiline':False]
['text':'#* }','line_number':111,'multiline':False]
['text':' Mounts a persistent disk (formatting if needed) to store the persistent data','line_number':115,'multiline':False]
['text':' on the master. safe-format-and-mount only formats an unformatted disk, and','line_number':116,'multiline':False]
['text':' mkdir -p will leave a directory be if it already exists.','line_number':117,'multiline':False]
['text':' Format and mount the disk, create directories on it for all of the master's','line_number':129,'multiline':False]
['text':' persistent data, and link them to where they're used.','line_number':130,'multiline':False]
['text':' NOTE: These locations on the PD store persistent data, so to maintain','line_number':135,'multiline':False]
['text':' upgradeability, these locations should not change.  If they do, take care','line_number':136,'multiline':False]
['text':' to maintain a migration path from these locations to whatever new','line_number':137,'multiline':False]
['text':' locations.','line_number':138,'multiline':False]
['text':' Create kubeconfig for controller-manager's service account authentication.','line_number':141,'multiline':False]
['text':' Since it's a test cluster','line_number':217,'multiline':False]
['text':' TODO(shyamjvs): Incorporate network plugin options, etc later.','line_number':218,'multiline':False]
['text':' For setting ulimit -n','line_number':220,'multiline':False]
['text':' A helper function for loading a docker image. It keeps trying up to 5 times.','line_number':224,'multiline':False]
['text':'','line_number':225,'multiline':False]
['text':' $1: Full path of the docker image','line_number':226,'multiline':False]
['text':' Temporarily turn off errexit, because we don't want to exit on first failure.','line_number':230,'multiline':False]
['text':' Re-enable errexit.','line_number':243,'multiline':False]
['text':' Loads kube-system docker images. It is better to do it before starting kubelet,','line_number':247,'multiline':False]
['text':' as kubelet will restart docker daemon, which may interfere with loading images.','line_number':248,'multiline':False]
['text':' Computes command line arguments to be passed to kubelet.','line_number':257,'multiline':False]
['text':' Creates the systemd config file for kubelet.service.','line_number':271,'multiline':False]
['text':' Write the systemd service file for kubelet.','line_number':278,'multiline':False]
['text':' This function assembles the kubelet systemd service file and starts it using','line_number':296,'multiline':False]
['text':' systemctl, on the kubemark master.','line_number':297,'multiline':False]
['text':' Create systemd config.','line_number':299,'multiline':False]
['text':' Flush iptables nat table','line_number':303,'multiline':False]
['text':' Start the kubelet service.','line_number':306,'multiline':False]
['text':' Create the log file and set its properties.','line_number':310,'multiline':False]
['text':'','line_number':311,'multiline':False]
['text':' $1 is the file to create.','line_number':312,'multiline':False]
['text':' A helper function for copying addon manifests and set dir/files','line_number':319,'multiline':False]
['text':' permissions.','line_number':320,'multiline':False]
['text':'','line_number':321,'multiline':False]
['text':' $1: addon category under /etc/kubernetes','line_number':322,'multiline':False]
['text':' $2: manifest source dir','line_number':323,'multiline':False]
['text':' Write the config for the audit policy.','line_number':342,'multiline':False]
['text':' Note: This duplicates the function in cluster/gce/gci/configure-helper.sh.','line_number':343,'multiline':False]
['text':' TODO: Get rid of this function when #53321 is fixed.','line_number':344,'multiline':False]
['text':' Known api groups','line_number':354,'multiline':False]
['text':' The following requests were manually identified as high-volume and low-risk,','line_number':377,'multiline':False]
['text':' so drop them.','line_number':378,'multiline':False]
['text':' core','line_number':383,'multiline':False]
['text':' Ingress controller reads 'configmaps/ingress-uid' through the unsecured port.','line_number':386,'multiline':False]
['text':' TODO(#46983): Change this to the ingress controller service account.','line_number':387,'multiline':False]
['text':' core','line_number':392,'multiline':False]
['text':' legacy kubelet identity','line_number':395,'multiline':False]
['text':' core','line_number':398,'multiline':False]
['text':' core','line_number':404,'multiline':False]
['text':' core','line_number':414,'multiline':False]
['text':' core','line_number':420,'multiline':False]
['text':' Don't log HPA fetching metrics.','line_number':422,'multiline':False]
['text':' Don't log these read-only URLs.','line_number':429,'multiline':False]
['text':' Don't log events requests.','line_number':435,'multiline':False]
['text':' core','line_number':438,'multiline':False]
['text':' node and pod status calls from nodes are high-volume and can be large, don't log responses for expected updates from nodes','line_number':440,'multiline':False]
['text':' core','line_number':445,'multiline':False]
['text':' core','line_number':453,'multiline':False]
['text':' deletecollection calls can be large, don't log responses for expected namespace deletions','line_number':457,'multiline':False]
['text':' Secrets, ConfigMaps, TokenRequest and TokenReviews can contain sensitive & binary data,','line_number':463,'multiline':False]
['text':' so only log at the Metadata level.','line_number':464,'multiline':False]
['text':' core','line_number':467,'multiline':False]
['text':' Get responses can be large; skip them.','line_number':473,'multiline':False]
['text':' Default level for known APIs','line_number':479,'multiline':False]
['text':' Default level for all other requests.','line_number':484,'multiline':False]
['text':' Computes command line arguments to be passed to etcd.','line_number':491,'multiline':False]
['text':' Enable apiserver->etcd auth.','line_number':499,'multiline':False]
['text':' Computes command line arguments to be passed to etcd-events.','line_number':510,'multiline':False]
['text':' Computes command line arguments to be passed to apiserver.','line_number':522,'multiline':False]
['text':' Enable apiserver->etcd auth.','line_number':531,'multiline':False]
['text':' Create the audit policy file, and mount it into the apiserver pod.','line_number':577,'multiline':False]
['text':' The config below matches the one in cluster/gce/gci/configure-helper.sh.','line_number':580,'multiline':False]
['text':' TODO: Currently supporting just log backend. Support webhook if needed.','line_number':581,'multiline':False]
['text':' Append APISERVER_TEST_ARGS to the end, which will allow for','line_number':588,'multiline':False]
['text':' the above defaults to be overridden.','line_number':589,'multiline':False]
['text':' Computes command line arguments to be passed to controller-manager.','line_number':594,'multiline':False]
['text':' Computes command line arguments to be passed to scheduler.','line_number':608,'multiline':False]
['text':' Computes command line arguments to be passed to addon-manager.','line_number':615,'multiline':False]
['text':' Start a kubernetes master component '$1' which can be any of the following:','line_number':620,'multiline':False]
['text':' 1. etcd','line_number':621,'multiline':False]
['text':' 2. etcd-events','line_number':622,'multiline':False]
['text':' 3. kube-apiserver','line_number':623,'multiline':False]
['text':' 4. kube-controller-manager','line_number':624,'multiline':False]
['text':' 5. kube-scheduler','line_number':625,'multiline':False]
['text':' 6. kube-addon-manager','line_number':626,'multiline':False]
['text':'','line_number':627,'multiline':False]
['text':' It prepares the log file, loads the docker tag, calculates variables, sets them','line_number':628,'multiline':False]
['text':' in the manifest file, and then copies the manifest file to /etc/kubernetes/manifests.','line_number':629,'multiline':False]
['text':'','line_number':630,'multiline':False]
['text':' Assumed vars:','line_number':631,'multiline':False]
['text':'   DOCKER_REGISTRY','line_number':632,'multiline':False]
['text':' Evaluate variables.','line_number':640,'multiline':False]
['text':'############################## Main Function ########################################','line_number':674,'multiline':False]
['text':' Extract files from the server tar and setup master env variables.','line_number':677,'multiline':False]
['text':' Setup IP firewall rules, required directory structure and etcd config.','line_number':684,'multiline':False]
['text':' Setup authentication tokens and kubeconfigs for kube-controller-manager and kube-scheduler,','line_number':691,'multiline':False]
['text':' only if their kubeconfigs don't already exist as this script could be running on reboot.','line_number':692,'multiline':False]
['text':' Mount master PD for etcd and create symbolic links to it.','line_number':708,'multiline':False]
['text':' Contains all the data stored in etcd.','line_number':712,'multiline':False]
['text':' Setup the dynamically generated apiserver auth certs and keys to pd.','line_number':717,'multiline':False]
['text':' Copy the files to the PD only if they don't exist (so we do it only the first time).','line_number':720,'multiline':False]
['text':' Directory for kube-apiserver to store SSH key (if necessary).','line_number':724,'multiline':False]
['text':' Mount master PD for event-etcd (if required) and create symbolic links to it.','line_number':729,'multiline':False]
['text':' Contains all the data stored in event etcd.','line_number':736,'multiline':False]
['text':' Setup docker flags and load images of the master components.','line_number':743,'multiline':False]
['text':' Start kubelet as a supervisord process and master components as pods.','line_number':750,'multiline':False]
['text':' Wait till apiserver is working fine or timeout.','line_number':763,'multiline':False]
