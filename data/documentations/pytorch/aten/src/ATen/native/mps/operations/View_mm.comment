['text':'  Copyright Â© 2022 Apple Inc.','line_number':1,'multiline':False]
['text':' initializes the MTLBuffers for tensor data and runs the MPSGraph for the view op','line_number':46,'multiline':False]
['text':' in case of scatter, we use output tensor as input buffer and write the results back to the source buffer','line_number':62,'multiline':False]
['text':' Workaround for MPSShaderLibrary bug in macOS Monterey','line_number':85,'multiline':False]
['text':' This is fixed in macOS Ventura','line_number':86,'multiline':False]
['text':' Assuming input tensor has default strides','line_number':124,'multiline':False]
['text':' offset is determined traversing backwards through stride','line_number':132,'multiline':False]
['text':' Detect only expand dims, allows for duplicate strides','line_number':141,'multiline':False]
['text':' Not an expand dims','line_number':149,'multiline':False]
['text':' Did not use every dimension of source','line_number':178,'multiline':False]
['text':' Detect contiguous reshapes, no slicing','line_number':193,'multiline':False]
['text':' Not a reshape','line_number':201,'multiline':False]
['text':' Duplicate strides cannot be done','line_number':243,'multiline':False]
['text':' Skip for zero in dst shape','line_number':257,'multiline':False]
['text':' 1. Flatten the inputTensor if necessary','line_number':264,'multiline':False]
['text':' Flatten inputs to remove duplicate strides.','line_number':267,'multiline':False]
['text':' We have to leave at least 1 dimension, if all input dims are 1','line_number':273,'multiline':False]
['text':' Populate the dimension order, slice info, and broadcast info','line_number':282,'multiline':False]
['text':' This dimension should be a broadcast','line_number':290,'multiline':False]
['text':' Find what dimension and native length was for the specified stride','line_number':295,'multiline':False]
['text':' Stride does not exist in source tensor, or the specified size is too long. Not possible','line_number':302,'multiline':False]
['text':' TODO: Longer length with same stride + removal of dim(s) above this is a flatten/reshape. Consider adding','line_number':303,'multiline':False]
['text':' support','line_number':304,'multiline':False]
['text':' the offset + length of destination should not be larger than source's length when slicing','line_number':306,'multiline':False]
['text':' Get the src dimension corresponding to the requested stride','line_number':310,'multiline':False]
['text':' 2. Slice out any unused dimensions','line_number':317,'multiline':False]
['text':' Find any src strides/dims that are not present in the dst','line_number':321,'multiline':False]
['text':' 3. Transpose if necessary','line_number':349,'multiline':False]
['text':' TODO: Use Transpose API','line_number':352,'multiline':False]
['text':' 4. Squeeze any unused dimensions following transpose','line_number':360,'multiline':False]
['text':' Transpose the missing dims back','line_number':363,'multiline':False]
['text':' 5. Slice','line_number':375,'multiline':False]
['text':' Only dstDims with nonzero stride are in the current tensor, skip broadcasts','line_number':380,'multiline':False]
['text':' 6. Expand then broadcast the source tensor','line_number':391,'multiline':False]
['text':' Slice any remaining dimensions','line_number':551,'multiline':False]
['text':' create stride Tensors for each rank of the input tensor','line_number':594,'multiline':False]
['text':' Call gather to coalesce the needed values. Result will be of same shape as flattened indices tensor','line_number':634,'multiline':False]
['text':' Reshape the data to desired size','line_number':640,'multiline':False]
['text':' if there's no base_shape stored in MPSAllocator, then infer it from tensor's size and store it','line_number':649,'multiline':False]
['text':' IntArrayRef wouldn't own the data, so we use a static storage','line_number':651,'multiline':False]
['text':' self.sizes().size() could be zero','line_number':653,'multiline':False]
['text':' base_shape will be retained in MPSAllocator until buffer gets recycled','line_number':658,'multiline':False]
['text':' There are few cases we need to consider:','line_number':665,'multiline':False]
['text':' Here nodes are the Tensors and the edges are the operations performed on the','line_number':666,'multiline':False]
['text':' Tensor. As a result of the operation performed we can have result as View','line_number':667,'multiline':False]
['text':' Tensor (View T) or a Non view tensor (NonView T). The difference is if its','line_number':668,'multiline':False]
['text':' mapped by the same underlying storage ptr or a new MTLBuffer was allocated.','line_number':669,'multiline':False]
['text':'                T = Tensor','line_number':670,'multiline':False]
['text':'                 ----------','line_number':671,'multiline':False]
['text':'                 | Orig T |','line_number':672,'multiline':False]
['text':'                 ----------','line_number':673,'multiline':False]
['text':'                /     |     \','line_number':674,'multiline':False]
['text':'             View T  View T  NonView T','line_number':675,'multiline':False]
['text':'             /      /    \      |','line_number':676,'multiline':False]
['text':'            View T /      \     |','line_number':677,'multiline':False]
['text':'            |     /        \    |','line_number':678,'multiline':False]
['text':'            |    /          \   |','line_number':679,'multiline':False]
['text':'            |   /            \  |','line_number':680,'multiline':False]
['text':'            NonView T         NonView T','line_number':681,'multiline':False]
['text':' Workaround for MPSShaderLibrary bug in macOS Monterey','line_number':695,'multiline':False]
['text':' This is fixed in macOS Ventura','line_number':696,'multiline':False]
['text':' Self is the input tensor we are creating view of','line_number':702,'multiline':False]
['text':'needsScatter','line_number':811,'multiline':True]
['text':'needsScatter','line_number':812,'multiline':True]
['text':'needsScatter=','line_number':822,'multiline':True]
['text':'needsScatter=','line_number':827,'multiline':True]
['text':' this function call is a no-op if MPS Profiler is not enabled','line_number':829,'multiline':False]
['text':'needsScatter','line_number':874,'multiline':True]
['text':'needsScatter','line_number':875,'multiline':True]
['text':'needsScatter=','line_number':890,'multiline':True]
['text':'needsScatter=','line_number':895,'multiline':True]
['text':' namespace mps','line_number':935,'multiline':False]
['text':' implementation of as_strided() op','line_number':937,'multiline':False]
['text':' creating the view graph will be deferred until gatherViewTensor() or scatterViewTensor() are called.','line_number':947,'multiline':False]
['text':' In as_strided, we just update the base shape of the buffer in order to retrieve it later','line_number':948,'multiline':False]
['text':' when we create/run the view graph.','line_number':949,'multiline':False]
['text':' namespace at::native','line_number':957,'multiline':False]
